<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha256-XOqroi11tY4EFQMR9ZYwZWKj5ZXiftSx36RRuC3anlA=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"wangwen135.github.io","root":"/","images":"/images","scheme":"Pisces","darkmode":false,"version":"8.20.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":true,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="这是一个使用 Hexo 构建的博客，用于分享我的编程经验和学习笔记。">
<meta property="og:type" content="website">
<meta property="og:title" content="王某某的笔记">
<meta property="og:url" content="https://wangwen135.github.io/page/10/index.html">
<meta property="og:site_name" content="王某某的笔记">
<meta property="og:description" content="这是一个使用 Hexo 构建的博客，用于分享我的编程经验和学习笔记。">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="王某某">
<meta property="article:tag" content="java">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://wangwen135.github.io/page/10/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"page/10/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>王某某的笔记</title>
  
  <script class="next-config" data-name="google_analytics" type="application/json">{"tracking_id":"G-MBG120GJ9P","only_pageview":true,"measure_protocol_api_secret":null}</script>
  <script src="/js/third-party/analytics/google-analytics.js"></script>








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">王某某的笔记</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">记录我的编程之路</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="王某某"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">王某某</p>
  <div class="site-description" itemprop="description">这是一个使用 Hexo 构建的博客，用于分享我的编程经验和学习笔记。</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">169</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">55</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">146</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/wangwen135" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;wangwen135" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.jianshu.com/u/66c41e72644b" title="简  书 → https:&#x2F;&#x2F;www.jianshu.com&#x2F;u&#x2F;66c41e72644b" rel="noopener me" target="_blank"><i class="fa fa-link fa-fw"></i>简  书</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:wangwen135@gmail.com" title="E-Mail → mailto:wangwen135@gmail.com" rel="noopener me" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://twitter.com/wangwen135" title="Twitter → https:&#x2F;&#x2F;twitter.com&#x2F;wangwen135" rel="noopener me" target="_blank"><i class="fab fa-twitter fa-fw"></i>Twitter</a>
      </span>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://wangwen135.github.io/Elasticsearch/elasticsearch%20%E8%8A%82%E7%82%B9%E9%87%8D%E5%90%AF%E9%97%AE%E9%A2%98/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="王某某">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="王某某的笔记">
      <meta itemprop="description" content="这是一个使用 Hexo 构建的博客，用于分享我的编程经验和学习笔记。">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 王某某的笔记">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/Elasticsearch/elasticsearch%20%E8%8A%82%E7%82%B9%E9%87%8D%E5%90%AF%E9%97%AE%E9%A2%98/" class="post-title-link" itemprop="url">elasticsearch 节点重启问题</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2018-09-26 15:29:00" itemprop="dateCreated datePublished" datetime="2018-09-26T15:29:00+08:00">2018-09-26</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Elasticsearch/" itemprop="url" rel="index"><span itemprop="name">Elasticsearch</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>655</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>2 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>ElasticSearch集群的高可用和自平衡方案会在节点挂掉（重启）后自动在别的结点上复制该结点的分片，这将导致了大量的IO和网络开销。</p>
<p>如果离开的节点重新加入集群，elasticsearch为了对数据分片(shard)进行再平衡，会为重新加入的节点再次分配数据分片(Shard), 当一台es因为压力过大而挂掉以后，其他的es服务会备份本应那台es保存的数据，造成更大压力，于是整个集群会发生雪崩。</p>
<p>生产环境下建议关闭自动平衡。</p>
<h2 id="数据分片与自平衡"><a href="#数据分片与自平衡" class="headerlink" title="数据分片与自平衡"></a>数据分片与自平衡</h2><p>一：关闭自动分片，即使新建index也无法分配数据分片</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">curl -XPUT http://192.168.1.213:9200/_cluster/settings -d &#x27;&#123;</span><br><span class="line">  &quot;transient&quot; : &#123;</span><br><span class="line">    &quot;cluster.routing.allocation.enable&quot; : &quot;none&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;&#x27;</span><br></pre></td></tr></table></figure>

<p>二：关闭自动平衡，只在增减ES节点时不自动平衡数据分片</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">curl -XPUT http://192.168.1.213:9200/_cluster/settings?pretty -d &#x27;&#123;</span><br><span class="line">  &quot;transient&quot; : &#123;</span><br><span class="line">    &quot;cluster.routing.rebalance.enable&quot; : &quot;none&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;&#x27;</span><br></pre></td></tr></table></figure>

<p>设置完以后查看设置是否添加成功：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http://192.168.1.213:9200/_cluster/settings?pretty</span><br></pre></td></tr></table></figure>

<p>重新启用自动分片</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">curl -XPUT http://192.168.1.213:9200/_cluster/settings -d &#x27;&#123;</span><br><span class="line">  &quot;transient&quot; : &#123;</span><br><span class="line">    &quot;cluster.routing.allocation.enable&quot; : &quot;all&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="延迟副本的重新分配"><a href="#延迟副本的重新分配" class="headerlink" title="延迟副本的重新分配"></a>延迟副本的重新分配</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">PUT /_all/_settings</span><br><span class="line">&#123;</span><br><span class="line">  &quot;settings&quot;: &#123;</span><br><span class="line">    &quot;index.unassigned.node_left.delayed_timeout&quot;: &quot;5m&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>未分配节点重新分配延迟到5分钟之后</p>
<p>下面是修改 elasticsearch.yml 文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gateway.recover_after_nodes: 8</span><br></pre></td></tr></table></figure>
<p>这将防止Elasticsearch立即开始数据恢复，直到集群中至少有八个（数据节点或主节点）节点存在。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">gateway.expected_nodes: 10 </span><br><span class="line"></span><br><span class="line">gateway.recover_after_time: 5m</span><br></pre></td></tr></table></figure>
<p>集群开始数据恢复等到5分钟后或者10个节点加入，以先到者为准。</p>
<p>参考：<br><a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/reference/2.4/modules-gateway.html">https://www.elastic.co/guide/en/elasticsearch/reference/2.4/modules-gateway.html</a></p>
<h2 id="脑裂问题"><a href="#脑裂问题" class="headerlink" title="脑裂问题"></a>脑裂问题</h2><p>对某一个实例进行重启后，很有可能会导致该实例无法找到master而将自己推举为master的情况出现，为防止这种情况，需要调整 elasticsearch.yml 中的内容</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">discovery.zen.minimum_master_nodes: 2</span><br></pre></td></tr></table></figure>
<p>这个配置就是告诉Elasticsearch除非有足够可用的master候选节点，否则就不选举master，只有有足够可用的master候选节点才进行选举。<br>该设置应该始终被配置为有主节点资格的点数&#x2F;2 + 1，例如:<br>有10个符合规则的节点数，则配置为6.<br>有3个则配置为2.</p>
<hr>
<h2 id="关于设置的有效性"><a href="#关于设置的有效性" class="headerlink" title="关于设置的有效性"></a>关于设置的有效性</h2><p><strong>persistent</strong> 重启后设置也会存在<br><strong>transient</strong> 整个集群重启后会消失的设置</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">PUT /_cluster/settings</span><br><span class="line">&#123;</span><br><span class="line">    &quot;persistent&quot; : &#123;</span><br><span class="line">        &quot;discovery.zen.minimum_master_nodes&quot; : 2</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<hr>
<hr>
<h2 id="一般设置下面两个就可以了"><a href="#一般设置下面两个就可以了" class="headerlink" title="一般设置下面两个就可以了"></a>一般设置下面两个就可以了</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># 通过配置大多数节点(节点总数/ 2 + 1)来防止脑裂</span><br><span class="line">#</span><br><span class="line">discovery.zen.minimum_master_nodes: 2</span><br><span class="line"></span><br><span class="line"># 在一个完整的集群重新启动到N个节点开始之前，阻止初始恢复</span><br><span class="line">#</span><br><span class="line">gateway.recover_after_nodes: 3</span><br></pre></td></tr></table></figure>




      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://wangwen135.github.io/MySQL/%E6%9F%A5%E7%9C%8Bbinlog%E6%97%A5%E5%BF%97/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="王某某">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="王某某的笔记">
      <meta itemprop="description" content="这是一个使用 Hexo 构建的博客，用于分享我的编程经验和学习笔记。">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 王某某的笔记">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/MySQL/%E6%9F%A5%E7%9C%8Bbinlog%E6%97%A5%E5%BF%97/" class="post-title-link" itemprop="url">查看binlog日志</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2018-09-25 23:41:00" itemprop="dateCreated datePublished" datetime="2018-09-25T23:41:00+08:00">2018-09-25</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/MySQL/" itemprop="url" rel="index"><span itemprop="name">MySQL</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>896</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>3 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="mysqlbinlog"><a href="#mysqlbinlog" class="headerlink" title="mysqlbinlog"></a>mysqlbinlog</h3><p>使用mysqlbinlog 命令查看</p>
<p>常用选项：  </p>
<ul>
<li>–start-position&#x3D;953                   起始pos点</li>
<li>–stop-position&#x3D;1437                   结束pos点</li>
<li>–start-datetime&#x3D;”2013-11-29 13:18:54” 起始时间点</li>
<li>–stop-datetime&#x3D;”2013-11-29 13:21:53”  结束时间点</li>
</ul>
<p>如：</p>
<blockquote>
<p>进入到binlog目录执行，指定具体的binlog文件名</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 从指定的时间开始查</span><br><span class="line">$ mysqlbinlog mysql-bin.001575 --start-datetime=&quot;2018-09-25 11:25:54&quot;</span><br><span class="line"></span><br><span class="line"># 从指定位置开始查</span><br><span class="line">$ mysqlbinlog mysql-bin.001575 --start-position=16839697</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>默认只能查看到base-64编码的信息<br>如：</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"># at 22452867</span><br><span class="line">#180925 11:44:02 server id 8  end_log_pos 22452944 CRC32 0xc23d3641     Table_map: `base`.`by_renew_history` mapped to number 182</span><br><span class="line"># at 22452944</span><br><span class="line">#180925 11:44:02 server id 8  end_log_pos 22453106 CRC32 0x7a809e4e     Update_rows: table id 182 flags: STMT_END_F</span><br><span class="line"></span><br><span class="line">BINLOG &#x27;</span><br><span class="line">Aq+pWxMIAAAATQAAANCaVgEAALYAAAAAAAEABGJhc2UAEGJ5X3JlbmV3X2hpc3RvcnkACwMPAw8S</span><br><span class="line">ARIDEgMDB5YAWgAAAAD+B0E2PcI=</span><br><span class="line">Aq+pWx8IAAAAogAAAHKbVgEAALYAAAAAAAEAAgAL/////wD+igAAAA4yMDE4MDcyNTE2MzcyNugD</span><br><span class="line">AAAQMTExMTExMTExMDExMTExNJmgcwlbAZmgcwlbAwAAAJmgcwlaAP6KAAAADjIwMTgwNzI1MTYz</span><br><span class="line">NzI26AMAABAxMTExMTExMTEwMTExMTEzmaBzCVsBmaBzCVsDAAAAmaBzCVpOnoB6</span><br><span class="line">&#x27;/*!*/;</span><br><span class="line"># at 22453106</span><br><span class="line">#180925 11:44:02 server id 8  end_log_pos 22453137 CRC32 0x3787881e     Xid = 8121164</span><br><span class="line">COMMIT/*!*/;</span><br><span class="line">SET @@SESSION.GTID_NEXT= &#x27;AUTOMATIC&#x27; /* added by mysqlbinlog */ /*!*/;</span><br><span class="line">DELIMITER ;</span><br><span class="line"># End of log file</span><br><span class="line">/*!50003 SET COMPLETION_TYPE=@OLD_COMPLETION_TYPE*/;</span><br><span class="line">/*!50530 SET @@SESSION.PSEUDO_SLAVE_MODE=0*/;</span><br></pre></td></tr></table></figure>

<p>此时需要 <strong>–base64-output&#x3D;value</strong> 选项</p>
<p>此选项确定何时应使用BINLOG语句将事件编码为base-64字符串。该选项具有以下允许值（不区分大小写）:</p>
<ul>
<li><p>AUTO （“自动”）或UNSPEC（“未指定”）在必要时自动显示BINLOG语句（即，用于格式描述事件和行事件）。如果没有给出–base64-output选项，则效果与–base64-output &#x3D; AUTO相同。</p>
</li>
<li><p>NEVER 不显示BINLOG语句</p>
</li>
<li><p>DECODE-ROWS 通过配合–verbose选项将行事件解码并显示为注释的SQL语句。</p>
</li>
</ul>
<hr>
<p>使用参数–verbose(或-v)，将生成带注释的语句，如果使用两次这个参数(如-v -v)，会生成字段的类型、长度、是否为null等属性信息。</p>
<p>如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ mysqlbinlog -v --base64-output=DECODE-ROWS mysql-bin.001576 --start-datetime=&quot;2018-09-25 13:41:30&quot;</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"># at 1664232</span><br><span class="line">#180925 13:42:02 server id 8  end_log_pos 1664309 CRC32 0x28bbcc7e      Table_map: `base`.`by_renew_history` mapped to number 182</span><br><span class="line"># at 1664309</span><br><span class="line">#180925 13:42:02 server id 8  end_log_pos 1664471 CRC32 0xca13320e      Update_rows: table id 182 flags: STMT_END_F</span><br><span class="line">### UPDATE `base`.`by_renew_history`</span><br><span class="line">### WHERE</span><br><span class="line">###   @1=138</span><br><span class="line">###   @2=&#x27;20180725163726&#x27;</span><br><span class="line">###   @3=1000</span><br><span class="line">###   @4=&#x27;1111111110111113&#x27;</span><br><span class="line">###   @5=&#x27;2018-07-25 16:37:27&#x27;</span><br><span class="line">###   @6=1</span><br><span class="line">###   @7=&#x27;2018-07-25 16:37:27&#x27;</span><br><span class="line">###   @8=3</span><br><span class="line">###   @9=&#x27;2018-07-25 16:37:26&#x27;</span><br><span class="line">###   @10=NULL</span><br><span class="line">###   @11=NULL</span><br><span class="line">### SET</span><br><span class="line">###   @1=138</span><br><span class="line">###   @2=&#x27;20180725163726&#x27;</span><br><span class="line">###   @3=1000</span><br><span class="line">###   @4=&#x27;1111111110111114&#x27;</span><br><span class="line">###   @5=&#x27;2018-07-25 16:37:27&#x27;</span><br><span class="line">###   @6=1</span><br><span class="line">###   @7=&#x27;2018-07-25 16:37:27&#x27;</span><br><span class="line">###   @8=3</span><br><span class="line">###   @9=&#x27;2018-07-25 16:37:26&#x27;</span><br><span class="line">###   @10=NULL</span><br><span class="line">###   @11=NULL</span><br><span class="line"># at 1664471</span><br><span class="line">#180925 13:42:02 server id 8  end_log_pos 1664502 CRC32 0xb64f6d4f      Xid = 8266920</span><br><span class="line">COMMIT/*!*/;</span><br><span class="line">SET @@SESSION.GTID_NEXT= &#x27;AUTOMATIC&#x27; /* added by mysqlbinlog */ /*!*/;</span><br><span class="line">DELIMITER ;</span><br><span class="line"># End of log file</span><br><span class="line">/*!50003 SET COMPLETION_TYPE=@OLD_COMPLETION_TYPE*/;</span><br><span class="line">/*!50530 SET @@SESSION.PSEUDO_SLAVE_MODE=0*/;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqlbinlog -v -v --base64-output=DECODE-ROWS mysql-bin.001576 --start-datetime=&quot;2018-09-25 13:41:30&quot;</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"># at 1899587</span><br><span class="line">#180925 13:44:02 server id 8  end_log_pos 1899664 CRC32 0x7fff0312      Table_map: `base`.`by_renew_history` mapped to number 182</span><br><span class="line"># at 1899664</span><br><span class="line">#180925 13:44:02 server id 8  end_log_pos 1899826 CRC32 0x5cdb92c1      Update_rows: table id 182 flags: STMT_END_F</span><br><span class="line">### UPDATE `base`.`by_renew_history`</span><br><span class="line">### WHERE</span><br><span class="line">###   @1=138 /* INT meta=0 nullable=0 is_null=0 */</span><br><span class="line">###   @2=&#x27;20180725163726&#x27; /* VARSTRING(150) meta=150 nullable=1 is_null=0 */</span><br><span class="line">###   @3=1000 /* INT meta=0 nullable=1 is_null=0 */</span><br><span class="line">###   @4=&#x27;1111111110111114&#x27; /* VARSTRING(90) meta=90 nullable=1 is_null=0 */</span><br><span class="line">###   @5=&#x27;2018-07-25 16:37:27&#x27; /* DATETIME(0) meta=0 nullable=1 is_null=0 */</span><br><span class="line">###   @6=1 /* TINYINT meta=0 nullable=1 is_null=0 */</span><br><span class="line">###   @7=&#x27;2018-07-25 16:37:27&#x27; /* DATETIME(0) meta=0 nullable=1 is_null=0 */</span><br><span class="line">###   @8=3 /* INT meta=0 nullable=1 is_null=0 */</span><br><span class="line">###   @9=&#x27;2018-07-25 16:37:26&#x27; /* DATETIME(0) meta=0 nullable=1 is_null=0 */</span><br><span class="line">###   @10=NULL /* INT meta=0 nullable=1 is_null=1 */</span><br><span class="line">###   @11=NULL /* INT meta=0 nullable=1 is_null=1 */</span><br><span class="line">### SET</span><br><span class="line">###   @1=138 /* INT meta=0 nullable=0 is_null=0 */</span><br><span class="line">###   @2=&#x27;20180725163726&#x27; /* VARSTRING(150) meta=150 nullable=1 is_null=0 */</span><br><span class="line">###   @3=1000 /* INT meta=0 nullable=1 is_null=0 */</span><br><span class="line">###   @4=&#x27;1111111110111113&#x27; /* VARSTRING(90) meta=90 nullable=1 is_null=0 */</span><br><span class="line">###   @5=&#x27;2018-07-25 16:37:27&#x27; /* DATETIME(0) meta=0 nullable=1 is_null=0 */</span><br><span class="line">###   @6=1 /* TINYINT meta=0 nullable=1 is_null=0 */</span><br><span class="line">###   @7=&#x27;2018-07-25 16:37:27&#x27; /* DATETIME(0) meta=0 nullable=1 is_null=0 */</span><br><span class="line">###   @8=3 /* INT meta=0 nullable=1 is_null=0 */</span><br><span class="line">###   @9=&#x27;2018-07-25 16:37:26&#x27; /* DATETIME(0) meta=0 nullable=1 is_null=0 */</span><br><span class="line">###   @10=NULL /* INT meta=0 nullable=1 is_null=1 */</span><br><span class="line">###   @11=NULL /* INT meta=0 nullable=1 is_null=1 */</span><br><span class="line"># at 1899826</span><br><span class="line">#180925 13:44:02 server id 8  end_log_pos 1899857 CRC32 0xc1b4c0c7      Xid = 8297691</span><br><span class="line">COMMIT/*!*/;</span><br><span class="line">SET @@SESSION.GTID_NEXT= &#x27;AUTOMATIC&#x27; /* added by mysqlbinlog */ /*!*/;</span><br><span class="line">DELIMITER ;</span><br><span class="line"># End of log file</span><br><span class="line">/*!50003 SET COMPLETION_TYPE=@OLD_COMPLETION_TYPE*/;</span><br><span class="line">/*!50530 SET @@SESSION.PSEUDO_SLAVE_MODE=0*/;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://wangwen135.github.io/java/Swing/javaSwing%E4%B8%8D%E8%A7%84%E5%88%99%E7%AA%97%E4%BD%93/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="王某某">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="王某某的笔记">
      <meta itemprop="description" content="这是一个使用 Hexo 构建的博客，用于分享我的编程经验和学习笔记。">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 王某某的笔记">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/java/Swing/javaSwing%E4%B8%8D%E8%A7%84%E5%88%99%E7%AA%97%E4%BD%93/" class="post-title-link" itemprop="url">java不规则窗体</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2018-09-18 20:11:00" itemprop="dateCreated datePublished" datetime="2018-09-18T20:11:00+08:00">2018-09-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Java/" itemprop="url" rel="index"><span itemprop="name">Java</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Java/Swing/" itemprop="url" rel="index"><span itemprop="name">Swing</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>715</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>3 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>用背景透明的png图片</p>
<p><img src="https://img.wangwen135.top:23456/note/2024/08/66ac91f302fa6.png" alt="1722585581717.png"></p>
<h3 id="不规则窗体"><a href="#不规则窗体" class="headerlink" title="不规则窗体"></a>不规则窗体</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br></pre></td><td class="code"><pre><span class="line">package com.wwh.excel.tools.swing;</span><br><span class="line"></span><br><span class="line">import java.awt.Color;</span><br><span class="line">import java.awt.Component;</span><br><span class="line">import java.awt.Graphics;</span><br><span class="line">import java.awt.Image;</span><br><span class="line">import java.awt.Point;</span><br><span class="line">import java.awt.Toolkit;</span><br><span class="line">import java.awt.datatransfer.DataFlavor;</span><br><span class="line">import java.awt.dnd.DnDConstants;</span><br><span class="line">import java.awt.dnd.DropTarget;</span><br><span class="line">import java.awt.dnd.DropTargetAdapter;</span><br><span class="line">import java.awt.dnd.DropTargetDropEvent;</span><br><span class="line">import java.awt.event.MouseAdapter;</span><br><span class="line">import java.awt.event.MouseEvent;</span><br><span class="line">import java.awt.event.MouseMotionAdapter;</span><br><span class="line">import java.io.File;</span><br><span class="line">import java.util.List;</span><br><span class="line"></span><br><span class="line">import javax.swing.ImageIcon;</span><br><span class="line">import javax.swing.JFrame;</span><br><span class="line">import javax.swing.JLabel;</span><br><span class="line">import javax.swing.JOptionPane;</span><br><span class="line"></span><br><span class="line">import com.wwh.excel.tools.worker.Csv2Xls;</span><br><span class="line"></span><br><span class="line">public class ImageFrame extends JFrame &#123;</span><br><span class="line"></span><br><span class="line">    private static final long serialVersionUID = 1L;</span><br><span class="line">    private ImageIcon icon;</span><br><span class="line">    private Point origin = new Point();; // 用于移动窗体</span><br><span class="line"></span><br><span class="line">    // 小弹出框</span><br><span class="line">    private PopupDialog popupDialog;</span><br><span class="line"></span><br><span class="line">    public ImageFrame(ImageIcon icon2) &#123;</span><br><span class="line">        this.icon = icon2;</span><br><span class="line">        JLabel imageLabel = new JLabel() &#123;</span><br><span class="line">            private static final long serialVersionUID = 1L;</span><br><span class="line"></span><br><span class="line">            @Override</span><br><span class="line">            public void paint(Graphics g) &#123;</span><br><span class="line">                super.paint(g);</span><br><span class="line">                icon.paintIcon(this, g, 0, 0);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        this.add(imageLabel);</span><br><span class="line"></span><br><span class="line">        this.setUndecorated(true); // 关键语句1 不启用窗体装饰</span><br><span class="line"></span><br><span class="line">        this.setSize(icon.getIconWidth(), icon.getIconHeight()); // 设置窗口大小</span><br><span class="line"></span><br><span class="line">        // 这个需要包的支持</span><br><span class="line">        // AWTUtilities.setWindowOpaque(this, false);</span><br><span class="line"></span><br><span class="line">        // JDK 1.7 版本以上，使用 this.setBackground(new Color(0, 0, 0, 0));</span><br><span class="line">        this.setBackground(new Color(0, 0, 0, 0)); // 关键句2</span><br><span class="line"></span><br><span class="line">        // 设置透明度</span><br><span class="line">        this.setOpacity(0.9f);</span><br><span class="line"></span><br><span class="line">        this.setLocationRelativeTo(null); // 设置窗口居中</span><br><span class="line">        // setVisible(true);</span><br><span class="line"></span><br><span class="line">        this.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);</span><br><span class="line"></span><br><span class="line">        // 鼠标事件监听</span><br><span class="line">        // 由于取消了默认的窗体结构，所以我们要手动设置一下移动窗体的方法</span><br><span class="line">        this.addMouseListener(new MouseAdapter() &#123;</span><br><span class="line">            public void mousePressed(MouseEvent e) &#123;</span><br><span class="line">                origin.x = e.getX();</span><br><span class="line">                origin.y = e.getY();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            // 窗体上单击鼠标右键关闭程序</span><br><span class="line">            public void mouseClicked(MouseEvent e) &#123;</span><br><span class="line"></span><br><span class="line">                if (e.getButton() == MouseEvent.BUTTON3) &#123;</span><br><span class="line">                    System.exit(0);</span><br><span class="line">                &#125; else &#123;</span><br><span class="line">                    if (popupDialog != null) &#123;</span><br><span class="line">                        popupDialog.showDelayHide();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        this.addMouseMotionListener(new MouseMotionAdapter() &#123;</span><br><span class="line">            public void mouseDragged(MouseEvent e) &#123;</span><br><span class="line">                Point p = getLocation();</span><br><span class="line">                setLocation(p.x + e.getX() - origin.x, p.y + e.getY() - origin.y);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        drag(imageLabel);</span><br><span class="line"></span><br><span class="line">        // 设置窗口图标</span><br><span class="line">        Image img2 = Toolkit.getDefaultToolkit().getImage(ImageFrame.class.getResource(&quot;/icon.png&quot;));</span><br><span class="line">        setIconImage(img2);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 定义的拖拽方法</span><br><span class="line">    public void drag(Component c) &#123;</span><br><span class="line">        // c 表示要接受拖拽的控件</span><br><span class="line">        new DropTarget(c, DnDConstants.ACTION_COPY_OR_MOVE, new DropTargetAdapter() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void drop(DropTargetDropEvent dtde)// 重写适配器的drop方法</span><br><span class="line">            &#123;</span><br><span class="line">                try &#123;</span><br><span class="line">                    if (dtde.isDataFlavorSupported(DataFlavor.javaFileListFlavor))// 如果拖入的文件格式受支持</span><br><span class="line">                    &#123;</span><br><span class="line">                        dtde.acceptDrop(DnDConstants.ACTION_COPY_OR_MOVE);// 接收拖拽来的数据</span><br><span class="line"></span><br><span class="line">                        @SuppressWarnings(&quot;unchecked&quot;)</span><br><span class="line">                        List&lt;File&gt; list = (List&lt;File&gt;) (dtde.getTransferable()</span><br><span class="line">                                .getTransferData(DataFlavor.javaFileListFlavor));</span><br><span class="line"></span><br><span class="line">                        if (list.size() &gt; 1) &#123;</span><br><span class="line">                            JOptionPane.showMessageDialog(null, &quot;一次拖一个文件，靓仔&quot;);</span><br><span class="line">                            return;</span><br><span class="line">                        &#125;</span><br><span class="line"></span><br><span class="line">                        Csv2Xls.convert(list.get(0));</span><br><span class="line"></span><br><span class="line">                        popupDialog.showDelayHide();</span><br><span class="line"></span><br><span class="line">                        dtde.dropComplete(true);// 指示拖拽操作已完成</span><br><span class="line"></span><br><span class="line">                    &#125; else &#123;</span><br><span class="line">                        dtde.rejectDrop();// 否则拒绝拖拽来的数据</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; catch (Exception e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                    JOptionPane.showMessageDialog(null, &quot;出错了，靓仔\n&quot; + e.getMessage());</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public PopupDialog getPopupDialog() &#123;</span><br><span class="line">        return popupDialog;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setPopupDialog(PopupDialog popupDialog) &#123;</span><br><span class="line">        this.popupDialog = popupDialog;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="不规则弹出框"><a href="#不规则弹出框" class="headerlink" title="不规则弹出框"></a>不规则弹出框</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line">package com.wwh.excel.tools.swing;</span><br><span class="line"></span><br><span class="line">import java.awt.Color;</span><br><span class="line">import java.awt.Frame;</span><br><span class="line">import java.awt.Graphics;</span><br><span class="line">import java.awt.event.ActionEvent;</span><br><span class="line">import java.awt.event.ActionListener;</span><br><span class="line">import java.awt.event.MouseAdapter;</span><br><span class="line">import java.awt.event.MouseEvent;</span><br><span class="line"></span><br><span class="line">import javax.swing.ImageIcon;</span><br><span class="line">import javax.swing.JDialog;</span><br><span class="line">import javax.swing.JLabel;</span><br><span class="line">import javax.swing.Timer;</span><br><span class="line"></span><br><span class="line">public class PopupDialog extends JDialog &#123;</span><br><span class="line"></span><br><span class="line">    private static final long serialVersionUID = 1L;</span><br><span class="line"></span><br><span class="line">    private ImageIcon icon;</span><br><span class="line"></span><br><span class="line">    private Frame owner;</span><br><span class="line"></span><br><span class="line">    private Timer timer;</span><br><span class="line"></span><br><span class="line">    private void initTimer(int delayTime) &#123;</span><br><span class="line">        // 定时消失</span><br><span class="line">        ActionListener taskPerformer = new ActionListener() &#123;</span><br><span class="line">            public void actionPerformed(ActionEvent evt) &#123;</span><br><span class="line">                setVisible(false);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        timer = new Timer(delayTime, taskPerformer);</span><br><span class="line">        timer.setRepeats(false);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * Create the dialog.</span><br><span class="line">     */</span><br><span class="line">    public PopupDialog(Frame owner, ImageIcon icon2, int delayTime) &#123;</span><br><span class="line">        super(owner);</span><br><span class="line">        this.icon = icon2;</span><br><span class="line">        this.owner = owner;</span><br><span class="line"></span><br><span class="line">        initTimer(delayTime);</span><br><span class="line"></span><br><span class="line">        JLabel imageLabel = new JLabel() &#123;</span><br><span class="line">            private static final long serialVersionUID = 1L;</span><br><span class="line"></span><br><span class="line">            @Override</span><br><span class="line">            public void paint(Graphics g) &#123;</span><br><span class="line">                super.paint(g);</span><br><span class="line">                icon.paintIcon(this, g, 0, 0);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        this.add(imageLabel);</span><br><span class="line"></span><br><span class="line">        this.setUndecorated(true); // 关键语句1 不启用窗体装饰</span><br><span class="line"></span><br><span class="line">        this.setSize(icon.getIconWidth(), icon.getIconHeight()); // 设置窗口大小</span><br><span class="line"></span><br><span class="line">        // 这个需要包的支持</span><br><span class="line">        // AWTUtilities.setWindowOpaque(this, false);</span><br><span class="line"></span><br><span class="line">        // JDK 1.7 版本以上，使用 this.setBackground(new Color(0, 0, 0, 0));</span><br><span class="line">        this.setBackground(new Color(0, 0, 0, 0)); // 关键句2</span><br><span class="line"></span><br><span class="line">        this.setLocationRelativeTo(owner);</span><br><span class="line"></span><br><span class="line">        this.setDefaultCloseOperation(HIDE_ON_CLOSE);</span><br><span class="line"></span><br><span class="line">        this.addMouseListener(new MouseAdapter() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void mouseClicked(MouseEvent e) &#123;</span><br><span class="line"></span><br><span class="line">                PopupDialog.this.setVisible(false);</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 先显示再延期隐藏</span><br><span class="line">     */</span><br><span class="line">    public void showDelayHide() &#123;</span><br><span class="line">        this.setLocationRelativeTo(owner);</span><br><span class="line">        setVisible(true);</span><br><span class="line">        timer.start();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void setVisible(boolean b) &#123;</span><br><span class="line">        super.setVisible(b);</span><br><span class="line">        if (!b) &#123;</span><br><span class="line">            timer.stop();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * Launch the application.</span><br><span class="line">     */</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            ImageIcon icon = new ImageIcon(PopupDialog.class.getResource(&quot;/images/success.png&quot;));</span><br><span class="line">            PopupDialog dialog = new PopupDialog(null, icon, 10000);</span><br><span class="line">            dialog.setDefaultCloseOperation(JDialog.DISPOSE_ON_CLOSE);</span><br><span class="line">            // dialog.setVisible(true);</span><br><span class="line">            dialog.showDelayHide();</span><br><span class="line"></span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://wangwen135.github.io/%E8%84%9A%E6%9C%AC/bat/windows%20%E6%9D%80%E5%8D%A0%E7%94%A8%E7%AB%AF%E5%8F%A3%E7%9A%84%E8%BF%9B%E7%A8%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="王某某">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="王某某的笔记">
      <meta itemprop="description" content="这是一个使用 Hexo 构建的博客，用于分享我的编程经验和学习笔记。">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 王某某的笔记">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/%E8%84%9A%E6%9C%AC/bat/windows%20%E6%9D%80%E5%8D%A0%E7%94%A8%E7%AB%AF%E5%8F%A3%E7%9A%84%E8%BF%9B%E7%A8%8B/" class="post-title-link" itemprop="url">windows 杀占用端口的进程</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2018-08-27 09:52:00" itemprop="dateCreated datePublished" datetime="2018-08-27T09:52:00+08:00">2018-08-27</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%84%9A%E6%9C%AC/" itemprop="url" rel="index"><span itemprop="name">脚本</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%84%9A%E6%9C%AC/bat/" itemprop="url" rel="index"><span itemprop="name">bat</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>123</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>1 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h4 id="先找到占用端口的进程号"><a href="#先找到占用端口的进程号" class="headerlink" title="先找到占用端口的进程号"></a>先找到占用端口的进程号</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\Administrator&gt;netstat -ano  | grep 8080</span><br><span class="line">  TCP    0.0.0.0:8080           0.0.0.0:0              LISTENING       10288</span><br><span class="line">  TCP    [::]:8080              [::]:0                 LISTENING       10288</span><br></pre></td></tr></table></figure>
<p>grep 命令原生是没有的，通过写批处理命令的方式支持的，可以用findstr命令</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;netstat -ano  | findstr 8080</span><br></pre></td></tr></table></figure>

<h4 id="杀进程"><a href="#杀进程" class="headerlink" title="杀进程"></a>杀进程</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\Administrator&gt;taskkill -PID 10288</span><br><span class="line">错误: 无法终止 PID 为 10288 的进程。</span><br><span class="line">原因: 只能强行终止这个进程(带 /F 选项)。</span><br></pre></td></tr></table></figure>

<h4 id="强制杀进程"><a href="#强制杀进程" class="headerlink" title="强制杀进程"></a>强制杀进程</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\Administrator&gt;taskkill /F -PID 10288</span><br><span class="line">成功: 已终止 PID 为 10288 的进程。</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://wangwen135.github.io/Maven/%E4%BE%9D%E8%B5%96%E6%9C%AC%E5%9C%B0jar%E5%8C%85/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="王某某">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="王某某的笔记">
      <meta itemprop="description" content="这是一个使用 Hexo 构建的博客，用于分享我的编程经验和学习笔记。">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 王某某的笔记">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/Maven/%E4%BE%9D%E8%B5%96%E6%9C%AC%E5%9C%B0jar%E5%8C%85/" class="post-title-link" itemprop="url">依赖本地jar包</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2018-08-18 17:51:00" itemprop="dateCreated datePublished" datetime="2018-08-18T17:51:00+08:00">2018-08-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Maven/" itemprop="url" rel="index"><span itemprop="name">Maven</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>88</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>1 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="依赖本地jar包"><a href="#依赖本地jar包" class="headerlink" title="依赖本地jar包"></a>依赖本地jar包</h2><p>有的jar包，在maven中心库里面没有，我们一般是放到项目的lib目录下<br>如：这里的xxxx.jar</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">├─lib</span><br><span class="line">│  └─xxxx.jar</span><br><span class="line">├─src</span><br><span class="line">│  ├─main</span><br><span class="line">│  │  ├─java</span><br><span class="line">│  │  │  └─com</span><br><span class="line">│  │  │      └─xxx</span><br><span class="line">│  │  └─resources</span><br><span class="line">│  │      └─xxx</span><br><span class="line">│  └─test</span><br><span class="line">│      ├─java</span><br><span class="line">│      └─resources</span><br><span class="line">└─target</span><br></pre></td></tr></table></figure>

<p>此时在pom.xml里面增加依赖引入该jar<br>例如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependencies&gt;</span><br><span class="line">	&lt;dependency&gt;</span><br><span class="line">		&lt;groupId&gt;org.xxx&lt;/groupId&gt;</span><br><span class="line">		&lt;artifactId&gt;xxx&lt;/artifactId&gt;</span><br><span class="line">		&lt;version&gt;1.0&lt;/version&gt;</span><br><span class="line">		&lt;scope&gt;system&lt;/scope&gt;</span><br><span class="line">		&lt;systemPath&gt;$&#123;basedir&#125;/lib/xxxxx.jar&lt;/systemPath&gt;</span><br><span class="line">	&lt;/dependency&gt;</span><br><span class="line">&lt;/dependencies&gt;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://wangwen135.github.io/Maven/%E6%9F%A5%E7%9C%8Bmaven-plugin%E6%89%80%E5%8C%85%E5%90%AB%E7%9A%84goal/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="王某某">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="王某某的笔记">
      <meta itemprop="description" content="这是一个使用 Hexo 构建的博客，用于分享我的编程经验和学习笔记。">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 王某某的笔记">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/Maven/%E6%9F%A5%E7%9C%8Bmaven-plugin%E6%89%80%E5%8C%85%E5%90%AB%E7%9A%84goal/" class="post-title-link" itemprop="url">查看maven-plugin所包含的goal</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2018-08-18 17:51:00" itemprop="dateCreated datePublished" datetime="2018-08-18T17:51:00+08:00">2018-08-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Maven/" itemprop="url" rel="index"><span itemprop="name">Maven</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>305</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>1 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>要使用maven插件提供的goal，首先得知道这些插件提供了哪些goal以及他们的用法。</p>
<p>maven的核心插件之一 — help插件（Maven Help Plugin）可以用于查看插件提供了哪些goal。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mvn help:describe -Dplugin=groupId:artifactId:version</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<blockquote>
<p>可以省略版本号</p>
</blockquote>
<p>还可以使用插件目标前缀替换坐标:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ mvn help:describe -Dplugin=compiler</span><br></pre></td></tr></table></figure>

<h4 id="例子："><a href="#例子：" class="headerlink" title="例子："></a>例子：</h4><p>查看 maven-source-plugin 的信息</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">mvn help:describe -Dplugin=org.apache.maven.plugins:maven-source-plugin</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">......</span><br><span class="line">Name: Apache Maven Source Plugin</span><br><span class="line">Description: The Maven Source Plugin creates a JAR archive of the source</span><br><span class="line">  files of the current project.</span><br><span class="line">Group Id: org.apache.maven.plugins</span><br><span class="line">Artifact Id: maven-source-plugin</span><br><span class="line">Version: 3.0.1</span><br><span class="line">Goal Prefix: source</span><br><span class="line"></span><br><span class="line">This plugin has 7 goals:</span><br><span class="line"></span><br><span class="line">source:aggregate</span><br><span class="line">  Description: Aggregate sources for all modules in an aggregator project.</span><br><span class="line"></span><br><span class="line">source:generated-test-jar</span><br><span class="line">  Description: This plugin bundles all the test sources into a jar archive.</span><br><span class="line"></span><br><span class="line">source:help</span><br><span class="line">  Description: Display help information on maven-source-plugin.</span><br><span class="line">    Call mvn source:help -Ddetail=true -Dgoal=&lt;goal-name&gt; to display parameter</span><br><span class="line">    details.</span><br><span class="line"></span><br><span class="line">source:jar</span><br><span class="line">  Description: This plugin bundles all the sources into a jar archive.</span><br><span class="line"></span><br><span class="line">source:jar-no-fork</span><br><span class="line">  Description: This goal bundles all the sources into a jar archive. This</span><br><span class="line">    goal functions the same as the jar goal but does not fork the build and is</span><br><span class="line">    suitable for attaching to the build lifecycle.</span><br><span class="line"></span><br><span class="line">source:test-jar</span><br><span class="line">  Description: This plugin bundles all the test sources into a jar archive.</span><br><span class="line"></span><br><span class="line">source:test-jar-no-fork</span><br><span class="line">  Description: This goal bundles all the test sources into a jar archive.</span><br><span class="line">    This goal functions the same as the test-jar goal but does not fork the</span><br><span class="line">    build, and is suitable for attaching to the build lifecycle.</span><br><span class="line"></span><br><span class="line">For more information, run &#x27;mvn help:describe [...] -Ddetail&#x27;</span><br><span class="line">......</span><br><span class="line"></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://wangwen135.github.io/Redis/Redis%E5%AE%89%E8%A3%85/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="王某某">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="王某某的笔记">
      <meta itemprop="description" content="这是一个使用 Hexo 构建的博客，用于分享我的编程经验和学习笔记。">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 王某某的笔记">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/Redis/Redis%E5%AE%89%E8%A3%85/" class="post-title-link" itemprop="url">Redis安装</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2018-06-19 23:41:00" itemprop="dateCreated datePublished" datetime="2018-06-19T23:41:00+08:00">2018-06-19</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Redis/" itemprop="url" rel="index"><span itemprop="name">Redis</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>501</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>2 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Redis-安装"><a href="#Redis-安装" class="headerlink" title="Redis 安装"></a>Redis 安装</h1><h4 id="1-安装-gcc-c"><a href="#1-安装-gcc-c" class="headerlink" title="1. 安装 gcc-c++"></a>1. 安装 gcc-c++</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install gcc-c++</span><br></pre></td></tr></table></figure>
<p>一般都装好了</p>
<h4 id="2-下载"><a href="#2-下载" class="headerlink" title="2. 下载"></a>2. 下载</h4><p>下载地址：<a target="_blank" rel="noopener" href="http://download.redis.io/releases/">http://download.redis.io/releases/</a><br>这里下载最新的稳定版 (当前的稳定版本是：4.0.2)  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">cd /var/tmp</span><br><span class="line"></span><br><span class="line">wget http://download.redis.io/releases/redis-stable.tar.gz</span><br><span class="line"></span><br><span class="line">#or</span><br><span class="line"></span><br><span class="line">curl -O http://download.redis.io/releases/redis-stable.tar.gz</span><br></pre></td></tr></table></figure>

<h4 id="3-解压编译"><a href="#3-解压编译" class="headerlink" title="3. 解压编译"></a>3. 解压编译</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf redis-stable.tar.gz</span><br><span class="line"></span><br><span class="line">cd redis-stable</span><br><span class="line"></span><br><span class="line">make</span><br></pre></td></tr></table></figure>

<h4 id="4-安装"><a href="#4-安装" class="headerlink" title="4. 安装"></a>4. 安装</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make PREFIX=/usr/local/redis install</span><br></pre></td></tr></table></figure>

<h4 id="5-复制配置文件"><a href="#5-复制配置文件" class="headerlink" title="5. 复制配置文件"></a>5. 复制配置文件</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cp redis.conf /usr/local/redis/</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="6-启动"><a href="#6-启动" class="headerlink" title="6. 启动"></a>6. 启动</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/local/redis/</span><br><span class="line"></span><br><span class="line">ls</span><br><span class="line"></span><br><span class="line">cd bin</span><br><span class="line"></span><br><span class="line">./redis-server </span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="7-配置文件"><a href="#7-配置文件" class="headerlink" title="7. 配置文件"></a>7. 配置文件</h4><p>修改配置文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd ..</span><br><span class="line">vi redis.conf</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>后台启动</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 修改</span><br><span class="line"># daemonize no</span><br><span class="line"># 为 yes</span><br><span class="line"></span><br><span class="line">daemonize yes</span><br></pre></td></tr></table></figure>
<p>指定服务器绑定的IP地址</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bind 0.0.0.0</span><br></pre></td></tr></table></figure>
<p>监听端口号，默认为 6379</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">port 6379</span><br></pre></td></tr></table></figure>
<p>定本地数据文件名，默认值为dump.rdb </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dbfilename dump.rdb</span><br></pre></td></tr></table></figure>
<p>数据文件存放目录，可以改成绝对路径</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#dir ./</span><br><span class="line">dir /data/redis/data/</span><br></pre></td></tr></table></figure>

<h4 id="8-通过指定配置文件进行启动"><a href="#8-通过指定配置文件进行启动" class="headerlink" title="8. 通过指定配置文件进行启动"></a>8. 通过指定配置文件进行启动</h4><p>实现后台运行等</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/redis-server redis.conf </span><br></pre></td></tr></table></figure>

<h4 id="9-关闭Redis"><a href="#9-关闭Redis" class="headerlink" title="9. 关闭Redis"></a>9. 关闭Redis</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/redis-cli shutdown</span><br></pre></td></tr></table></figure>
<p><em>不要随便杀进程</em></p>
<h4 id="9-服务方式运行"><a href="#9-服务方式运行" class="headerlink" title="9. 服务方式运行"></a>9. 服务方式运行</h4><p>进入到程序包的 <strong>redis-4.0.2&#x2F;utils</strong> 目录中<br>执行.&#x2F;install_server.sh 文件，按照提示进行服务安装：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"> ./install_server.sh </span><br><span class="line">Welcome to the redis service installer</span><br><span class="line">This script will help you easily set up a running redis server</span><br><span class="line"></span><br><span class="line">Please select the redis port for this instance: [6379] </span><br><span class="line">Selecting default: 6379</span><br><span class="line">Please select the redis config file name [/etc/redis/6379.conf] /usr/local/redis/redis.conf</span><br><span class="line">Please select the redis log file name [/var/log/redis_6379.log] </span><br><span class="line">Selected default - /var/log/redis_6379.log</span><br><span class="line">Please select the data directory for this instance [/var/lib/redis/6379] /data/redis</span><br><span class="line">Please select the redis executable path [] /usr/local/redis/bin/redis-server</span><br><span class="line">Selected config:</span><br><span class="line">Port           : 6379</span><br><span class="line">Config file    : /usr/local/redis/redis.conf</span><br><span class="line">Log file       : /var/log/redis_6379.log</span><br><span class="line">Data dir       : /data/redis</span><br><span class="line">Executable     : /usr/local/redis/bin/redis-server</span><br><span class="line">Cli Executable : /usr/local/redis/bin/redis-cli</span><br><span class="line">Is this ok? Then press ENTER to go on or Ctrl-C to abort.</span><br><span class="line">Copied /tmp/6379.conf =&gt; /etc/init.d/redis_6379</span><br><span class="line">Installing service...</span><br><span class="line">Successfully added to chkconfig!</span><br><span class="line">Successfully added to runlevels 345!</span><br><span class="line">Starting Redis server...</span><br><span class="line">Installation successful!</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>完成后将在&#x2F;etc&#x2F;rc.d&#x2F;init.d目录生成一个redis_6379 文件，安装的服务也叫这个名字，服务默认开机启动。</p>
<p>启动redis服务:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service redis_6379 start</span><br></pre></td></tr></table></figure>

<p>停止redis服务:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service redis_6379 stop</span><br></pre></td></tr></table></figure>

<p>设为开机启动:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chkconfig redis_6379 on</span><br></pre></td></tr></table></figure>

<p>关闭开机启动:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chkconfig redis_6379 off</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://wangwen135.github.io/Zookeeper/Curator%20%E4%BE%8B%E5%AD%90/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="王某某">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="王某某的笔记">
      <meta itemprop="description" content="这是一个使用 Hexo 构建的博客，用于分享我的编程经验和学习笔记。">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 王某某的笔记">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/Zookeeper/Curator%20%E4%BE%8B%E5%AD%90/" class="post-title-link" itemprop="url">Curator 例子</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2018-06-13 23:41:00" itemprop="dateCreated datePublished" datetime="2018-06-13T23:41:00+08:00">2018-06-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Zookeeper/" itemprop="url" rel="index"><span itemprop="name">Zookeeper</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>567</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>2 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>先在applicationContext.xml 文件中集成Curator</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 重连策略 --&gt;</span><br><span class="line">&lt;bean id=&quot;retryPolicy&quot; class=&quot;org.apache.curator.retry.ExponentialBackoffRetry&quot;&gt;</span><br><span class="line">    &lt;constructor-arg index=&quot;0&quot; value=&quot;$&#123;curator.retry.baseSleepTimeMs&#125;&quot; /&gt; &lt;!-- 间隔时间基数 --&gt;</span><br><span class="line">    &lt;constructor-arg index=&quot;1&quot; value=&quot;$&#123;curator.retry.maxRetries&#125;&quot; /&gt;&lt;!-- 最多重试几次 --&gt;</span><br><span class="line">&lt;/bean&gt;</span><br><span class="line"></span><br><span class="line">&lt;bean id=&quot;curatorClient&quot; class=&quot;org.apache.curator.framework.CuratorFrameworkFactory&quot; factory-method=&quot;newClient&quot; init-method=&quot;start&quot; destroy-method=&quot;close&quot;&gt;</span><br><span class="line">    &lt;constructor-arg index=&quot;0&quot; value=&quot;$&#123;curator.server.list&#125;&quot; /&gt;</span><br><span class="line">    &lt;constructor-arg index=&quot;1&quot; value=&quot;$&#123;curator.session.timeout&#125;&quot; /&gt;&lt;!-- sessionTimeoutMs会话超时时间，单位为毫秒。默认是60000ms --&gt;</span><br><span class="line">    &lt;constructor-arg index=&quot;2&quot; value=&quot;$&#123;curator.connection.timeout&#125;&quot; /&gt;&lt;!-- connectionTimeoutMs连接创建超时时间，单位毫秒，默认15000ms --&gt;</span><br><span class="line">    &lt;constructor-arg index=&quot;3&quot; ref=&quot;retryPolicy&quot; /&gt;</span><br><span class="line">&lt;/bean&gt;</span><br><span class="line">    </span><br></pre></td></tr></table></figure>
<p>config.properties</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">## curator 的相关配置</span><br><span class="line">#间隔时间基数</span><br><span class="line">curator.retry.baseSleepTimeMs=1000</span><br><span class="line">#最多重试几次</span><br><span class="line">curator.retry.maxRetries=3</span><br><span class="line"></span><br><span class="line">curator.server.list=192.168.1.213:2181</span><br><span class="line">curator.session.timeout=15000</span><br><span class="line">curator.connection.timeout=10000</span><br></pre></td></tr></table></figure>

<p>java</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">import java.util.List;</span><br><span class="line">import java.util.concurrent.TimeUnit;</span><br><span class="line">import java.util.concurrent.locks.Condition;</span><br><span class="line">import java.util.concurrent.locks.ReentrantLock;</span><br><span class="line"></span><br><span class="line">import org.apache.curator.framework.CuratorFramework;</span><br><span class="line">import org.apache.curator.framework.recipes.locks.InterProcessMutex;</span><br><span class="line">import org.slf4j.Logger;</span><br><span class="line">import org.slf4j.LoggerFactory;</span><br><span class="line">import org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line">import org.springframework.beans.factory.annotation.Value;</span><br><span class="line">import org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * &lt;pre&gt;</span><br><span class="line"> * 任务线程</span><br><span class="line"> * &lt;/pre&gt;</span><br><span class="line"> * </span><br><span class="line"> * @author wwh</span><br><span class="line"> */</span><br><span class="line">@Component</span><br><span class="line">public class TaskThread2 implements Runnable &#123;</span><br><span class="line"></span><br><span class="line">    private final static Logger logger = LoggerFactory.getLogger(TaskThread2.class);</span><br><span class="line">    /**</span><br><span class="line">     * 获取锁的超时时间</span><br><span class="line">     */</span><br><span class="line">    private static final int LOCK_ACQUIRE_TIMEOUT = 1000;</span><br><span class="line">    /**</span><br><span class="line">     * 锁路径&lt;br&gt;</span><br><span class="line">     * 全路径为：zkBasePath + LOCK_PATH + task.getId();</span><br><span class="line">     */</span><br><span class="line">    private static final String LOCK_PATH = &quot;/lock/&quot;;</span><br><span class="line">    @Autowired</span><br><span class="line">    private CuratorFramework curatorClient;</span><br><span class="line">    /**</span><br><span class="line">     * 基础路径</span><br><span class="line">     */</span><br><span class="line">    @Value(&quot;$&#123;zookeeper.basePath&#125;&quot;)</span><br><span class="line">    private String zkBasePath;</span><br><span class="line"></span><br><span class="line">    private Thread thread;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 运行标记</span><br><span class="line">     */</span><br><span class="line">    private boolean runFlag = true;</span><br><span class="line"></span><br><span class="line">    private final ReentrantLock lock = new ReentrantLock();</span><br><span class="line">    private final Condition sysClose = lock.newCondition();</span><br><span class="line"></span><br><span class="line">    private String task;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void run() &#123;</span><br><span class="line">        InterProcessMutex lock = new InterProcessMutex(curatorClient, getLockPath());</span><br><span class="line"></span><br><span class="line">        while (runFlag) &#123;</span><br><span class="line">            try &#123;</span><br><span class="line">                if (lock.acquire(LOCK_ACQUIRE_TIMEOUT, TimeUnit.MILLISECONDS)) &#123;</span><br><span class="line">                    try &#123;</span><br><span class="line">                        logger.debug(&quot;当前线程获取到锁，开始处理数据&quot;);</span><br><span class="line">                        doWithLock();</span><br><span class="line">                    &#125; catch (Exception e) &#123;</span><br><span class="line">                        logger.error(&quot;执行任务：&#123;&#125; 处理逻辑时异常，&quot;, task, e);</span><br><span class="line">                    &#125; finally &#123;</span><br><span class="line">                        try &#123;</span><br><span class="line">                            lock.release();</span><br><span class="line">                        &#125; catch (Exception e) &#123;</span><br><span class="line">                            logger.error(&quot;任务：&#123;&#125; , 释放锁时：ZK错误或链接中断&quot;, task, e);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; catch (Exception e) &#123;</span><br><span class="line">                logger.error(&quot;任务：&#123;&#125; 获取锁时：ZK错误或链接中断&quot;, task, e);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        logger.info(&quot;任务：&#123;&#125; , 处理线程退出&quot;, task);</span><br><span class="line">        // 移除zookeeper上锁节点</span><br><span class="line">        destroyZKLockPath();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 具体执行代码&lt;br&gt;</span><br><span class="line">     * 获取到锁的时候才会运行</span><br><span class="line">     */</span><br><span class="line">    private void doWithLock() &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 获取锁的路径，以任务ID为锁</span><br><span class="line">     * </span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    private String getLockPath() &#123;</span><br><span class="line">        // 以任务id作为锁的路径</span><br><span class="line">        return zkBasePath + LOCK_PATH + task;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private void destroyZKLockPath() &#123;</span><br><span class="line">        // 删除锁的条件是没有其他的节点了</span><br><span class="line">        try &#123;</span><br><span class="line">            String path = getLockPath();</span><br><span class="line">            List&lt;String&gt; list = curatorClient.getChildren().forPath(path);</span><br><span class="line">            if (list == null || list.isEmpty()) &#123;</span><br><span class="line">                // 如果没有其他节点还在获取锁就删除</span><br><span class="line">                curatorClient.delete().forPath(path);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 启动任务</span><br><span class="line">     * </span><br><span class="line">     * @param task</span><br><span class="line">     */</span><br><span class="line">    public void start(String task) &#123;</span><br><span class="line">        // 只能启动一次</span><br><span class="line">        if (thread != null) &#123;</span><br><span class="line">            throw new IllegalStateException(&quot;任务线程只能启动一次&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        logger.info(&quot;开始处理任务：&#123;&#125;&quot;, task);</span><br><span class="line">        this.task = task;</span><br><span class="line">        // 启动线程</span><br><span class="line">        thread = new Thread(this, &quot;T-&quot; + task);</span><br><span class="line">        thread.start();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 停止任务</span><br><span class="line">     */</span><br><span class="line">    public void stop() &#123;</span><br><span class="line">        runFlag = false;</span><br><span class="line">        // 如果是获取锁时的等待无法唤醒</span><br><span class="line">        lock.lock();</span><br><span class="line">        try &#123;</span><br><span class="line">            sysClose.signalAll();// 唤醒空数据时的等待</span><br><span class="line">        &#125; finally &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://wangwen135.github.io/Zookeeper/curator%20%E5%85%A5%E9%97%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="王某某">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="王某某的笔记">
      <meta itemprop="description" content="这是一个使用 Hexo 构建的博客，用于分享我的编程经验和学习笔记。">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 王某某的笔记">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/Zookeeper/curator%20%E5%85%A5%E9%97%A8/" class="post-title-link" itemprop="url">curator 入门</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2018-06-13 23:41:00" itemprop="dateCreated datePublished" datetime="2018-06-13T23:41:00+08:00">2018-06-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Zookeeper/" itemprop="url" rel="index"><span itemprop="name">Zookeeper</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>332</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>1 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p><a target="_blank" rel="noopener" href="http://curator.apache.org/getting-started.html">http://curator.apache.org/getting-started.html</a></p>
<blockquote>
<p>学习ZooKeeper<br>http: &#x2F;&#x2F;zookeeper.apache.org&#x2F;doc&#x2F;trunk&#x2F;zookeeperStarted.html</p>
</blockquote>
<h2 id="使用curator"><a href="#使用curator" class="headerlink" title="使用curator"></a>使用curator</h2><p>curator的JAR包可从Maven Central获得。Maven，Gradle，Ant等的用户可以轻松地将curator包含在他们的构建脚本中。</p>
<p>Maven</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line"> &lt;groupId&gt;org.apache.curator&lt;/groupId&gt;</span><br><span class="line"> &lt;artifactId&gt;curator-recipes&lt;/artifactId&gt;</span><br><span class="line"> &lt;version&gt;4.0.0&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>


<h2 id="获得连接"><a href="#获得连接" class="headerlink" title="获得连接"></a>获得连接</h2><p>curator使用 Fluent Style 风格的API。</p>
<p>curator连接实例（CuratorFramework）由CuratorFrameworkFactory分配。要连接到的ZooKeeper群集只需要 <strong>一个</strong> CuratorFramework对象：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CuratorFrameworkFactory.newClient(zookeeperConnectionString, retryPolicy)</span><br><span class="line"> ）</span><br></pre></td></tr></table></figure>
<p>使用默认值创建与ZooKeeper群集的连接，唯一需要指定的是重试策略。在大多数情况下，应该使用：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">RetryPolicy retryPolicy = new ExponentialBackoffRetry(1000, 3)</span><br><span class="line">CuratorFramework client = CuratorFrameworkFactory.newClient(zookeeperConnectionString, retryPolicy);</span><br><span class="line">client.start();</span><br></pre></td></tr></table></figure>
<p>必须启动客户端（不再需要时关闭）。</p>
<h2 id="直接使用ZooKeeper"><a href="#直接使用ZooKeeper" class="headerlink" title="直接使用ZooKeeper"></a>直接使用ZooKeeper</h2><p>一旦有一个CuratorFramework实例，就可以直接调用ZooKeeper，方法与使用ZooKeeper发行版中提供的原始ZooKeeper对象类似。例如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">client.create().forPath(&quot;/my/path&quot;, myData)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>这里的好处是curator管理ZooKeeper连接，如果有连接问题，将重试操作。</p>
<h2 id="食谱-Recipes"><a href="#食谱-Recipes" class="headerlink" title="食谱 Recipes"></a>食谱 Recipes</h2><h3 id="分布式锁"><a href="#分布式锁" class="headerlink" title="分布式锁"></a>分布式锁</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">InterProcessMutex lock = new InterProcessMutex(client, lockPath);</span><br><span class="line">if ( lock.acquire(maxWait, waitUnit) ) </span><br><span class="line">&#123;</span><br><span class="line">    try </span><br><span class="line">    &#123;</span><br><span class="line">        // do some work inside of the critical section here</span><br><span class="line">    &#125;</span><br><span class="line">    finally</span><br><span class="line">    &#123;</span><br><span class="line">        lock.release();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="领导选举"><a href="#领导选举" class="headerlink" title="领导选举"></a>领导选举</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">LeaderSelectorListener listener = new LeaderSelectorListenerAdapter()</span><br><span class="line">&#123;</span><br><span class="line">    public void takeLeadership(CuratorFramework client) throws Exception</span><br><span class="line">    &#123;</span><br><span class="line">        // this callback will get called when you are the leader</span><br><span class="line">        // do whatever leader work you need to and only exit</span><br><span class="line">        // this method when you want to relinquish leadership</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">LeaderSelector selector = new LeaderSelector(client, path, listener);</span><br><span class="line">selector.autoRequeue();  // not required, but this is behavior that you will probably expect</span><br><span class="line">selector.start();</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://wangwen135.github.io/Redis/Redis%E6%B5%8B%E8%AF%95%20java%E4%BB%A3%E7%A0%81/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="王某某">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="王某某的笔记">
      <meta itemprop="description" content="这是一个使用 Hexo 构建的博客，用于分享我的编程经验和学习笔记。">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 王某某的笔记">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/Redis/Redis%E6%B5%8B%E8%AF%95%20java%E4%BB%A3%E7%A0%81/" class="post-title-link" itemprop="url">Redis测试-java代码</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2018-06-04 23:41:00" itemprop="dateCreated datePublished" datetime="2018-06-04T23:41:00+08:00">2018-06-04</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Redis/" itemprop="url" rel="index"><span itemprop="name">Redis</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>636</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>2 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>pom.xml</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;redis.clients&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;jedis&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;2.9.0&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<h2 id="简单测试"><a href="#简单测试" class="headerlink" title="简单测试"></a>简单测试</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">public static void main(String[] args) &#123;</span><br><span class="line">    Jedis jedis = new Jedis(&quot;192.168.1.213&quot;);</span><br><span class="line">    jedis.set(&quot;foo&quot;, &quot;bar&quot;);</span><br><span class="line">    String value = jedis.get(&quot;foo&quot;);</span><br><span class="line">    System.out.println(value);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果用这种方法连集群，会看到如下的错误</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Exception in thread &quot;main&quot; redis.clients.jedis.exceptions.JedisMovedDataException: MOVED 12182 192.168.1.214:6382</span><br></pre></td></tr></table></figure>

<h2 id="Redis集群测试"><a href="#Redis集群测试" class="headerlink" title="Redis集群测试"></a>Redis集群测试</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">public static void main(String[] args) &#123;</span><br><span class="line">    Set&lt;HostAndPort&gt; jedisClusterNodes = new HashSet&lt;HostAndPort&gt;();</span><br><span class="line">    // Jedis集群将尝试自动发现集群节点</span><br><span class="line">    jedisClusterNodes.add(new HostAndPort(&quot;192.168.1.214&quot;, 6379));</span><br><span class="line">    // jedisClusterNodes.add(new HostAndPort(&quot;192.168.1.214&quot;, 6380));</span><br><span class="line">    // jedisClusterNodes.add(new HostAndPort(&quot;192.168.1.214&quot;, 6381));</span><br><span class="line">    JedisCluster jc = new JedisCluster(jedisClusterNodes);</span><br><span class="line">    jc.set(&quot;foo&quot;, &quot;bar&quot;);</span><br><span class="line">    jc.set(&quot;foo1&quot;, &quot;bar1&quot;);</span><br><span class="line">    jc.set(&quot;foo2&quot;, &quot;bar2&quot;);</span><br><span class="line">    jc.set(&quot;foo3&quot;, &quot;bar3&quot;);</span><br><span class="line">    jc.set(&quot;foo4&quot;, &quot;bar4&quot;);</span><br><span class="line">    jc.set(&quot;foo5&quot;, &quot;bar5&quot;);</span><br><span class="line">    jc.set(&quot;foo6&quot;, &quot;bar6&quot;);</span><br><span class="line"></span><br><span class="line">    System.out.println(jc.get(&quot;foo&quot;));</span><br><span class="line">    System.out.println(jc.get(&quot;foo1&quot;));</span><br><span class="line">    System.out.println(jc.get(&quot;foo2&quot;));</span><br><span class="line">    System.out.println(jc.get(&quot;foo3&quot;));</span><br><span class="line">    System.out.println(jc.get(&quot;foo4&quot;));</span><br><span class="line">    System.out.println(jc.get(&quot;foo5&quot;));</span><br><span class="line">    System.out.println(jc.get(&quot;foo6&quot;));</span><br><span class="line"></span><br><span class="line">    System.out.println(&quot;===================&quot;);</span><br><span class="line"></span><br><span class="line">    Map&lt;String, JedisPool&gt; map = jc.getClusterNodes();</span><br><span class="line">    for (Map.Entry&lt;String, JedisPool&gt; e : map.entrySet()) &#123;</span><br><span class="line">        System.out.println(e.getKey());</span><br><span class="line">        System.out.println(&quot;===================&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行时报错：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Exception in thread &quot;main&quot; redis.clients.jedis.exceptions.JedisConnectionException: Could not get a resource from the pool</span><br><span class="line">	at redis.clients.util.Pool.getResource(Pool.java:53)</span><br><span class="line">	at redis.clients.jedis.JedisPool.getResource(JedisPool.java:226)</span><br><span class="line">	at redis.clients.jedis.JedisSlotBasedConnectionHandler.getConnectionFromSlot(JedisSlotBasedConnectionHandler.java:66)</span><br><span class="line">...</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>因为在之前创建创建集群时使用的IP是127.0.0.1，当返回(error) MOVED 10439 127.0.0.1:6381时，系统尝试连接本地的端口，然后连不上失败了</p>
<p>修改Redis配置文件，绑定到正确的IP上，然后重新创建集群指定具体的IP地址：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./redis-trib.rb create --replicas 1 192.168.1.214:6379 192.168.1.214:6381 192.168.1.214:6382 192.168.1.214:6383 192.168.1.214:6384 192.168.1.214:6385</span><br></pre></td></tr></table></figure>

<hr>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">#杀掉redis进程</span><br><span class="line">ps -ef | grep redis | awk &#x27;&#123;print $2&#125;&#x27; | xargs kill</span><br><span class="line"></span><br><span class="line">#删除</span><br><span class="line">rm -f /data/redis/d63*/dump.rdb</span><br><span class="line">rm -f /data/redis/d63*/nodes.conf</span><br><span class="line"></span><br><span class="line">#批量替换</span><br><span class="line">sed -i &#x27;s/192.168.1.214/0.0.0.0/&#x27; */redis.conf</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="Jedis客户端分片测试"><a href="#Jedis客户端分片测试" class="headerlink" title="Jedis客户端分片测试"></a>Jedis客户端分片测试</h2><p>分片使用一种称为“一致哈希”的技术，并根据一些散列算法（md5和murmur，后者不太标准，但速度更快）在一组redis服务器上同等地分配key值。这样的节点被称为“分片”。优点是每个分片只会占总内存的 1&#x2F;n（对于n是分片数量）。</p>
<blockquote>
<p>先配置三个独立的redis服务 </p>
</blockquote>
<h3 id="直连接方式"><a href="#直连接方式" class="headerlink" title="直连接方式"></a>直连接方式</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">public static void main(String[] args) &#123;</span><br><span class="line">    List&lt;JedisShardInfo&gt; shards = new ArrayList&lt;JedisShardInfo&gt;();</span><br><span class="line">    JedisShardInfo si = new JedisShardInfo(&quot;192.168.1.213&quot;, 6380);</span><br><span class="line">    shards.add(si);</span><br><span class="line">    si = new JedisShardInfo(&quot;192.168.1.213&quot;, 6381);</span><br><span class="line">    shards.add(si);</span><br><span class="line">    si = new JedisShardInfo(&quot;192.168.1.213&quot;, 6382);</span><br><span class="line">    shards.add(si);</span><br><span class="line"></span><br><span class="line">    // 直接连接</span><br><span class="line">    ShardedJedis jedis = new ShardedJedis(shards);</span><br><span class="line">    jedis.set(&quot;a&quot;, &quot;foo&quot;);</span><br><span class="line">    jedis.set(&quot;a1&quot;, &quot;foo1&quot;);</span><br><span class="line">    jedis.set(&quot;a2&quot;, &quot;foo2&quot;);</span><br><span class="line">    jedis.set(&quot;a3&quot;, &quot;foo3&quot;);</span><br><span class="line">    jedis.set(&quot;a4&quot;, &quot;foo4&quot;);</span><br><span class="line"></span><br><span class="line">    System.out.println(jedis.get(&quot;a&quot;));</span><br><span class="line">    System.out.println(jedis.get(&quot;a1&quot;));</span><br><span class="line">    System.out.println(jedis.get(&quot;a2&quot;));</span><br><span class="line">    System.out.println(jedis.get(&quot;a3&quot;));</span><br><span class="line">    System.out.println(jedis.get(&quot;a4&quot;));</span><br><span class="line"></span><br><span class="line">    ShardInfo&lt;?&gt; sinfo = jedis.getShardInfo(&quot;a&quot;);</span><br><span class="line">    System.out.println(sinfo);</span><br><span class="line"></span><br><span class="line">    jedis.disconnect();</span><br><span class="line">    jedis.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="连接池方式"><a href="#连接池方式" class="headerlink" title="连接池方式"></a>连接池方式</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">public static void main(String[] args) &#123;</span><br><span class="line">    List&lt;JedisShardInfo&gt; shards = new ArrayList&lt;JedisShardInfo&gt;();</span><br><span class="line">    JedisShardInfo si = new JedisShardInfo(&quot;192.168.1.213&quot;, 6380);</span><br><span class="line">    shards.add(si);</span><br><span class="line">    si = new JedisShardInfo(&quot;192.168.1.213&quot;, 6381);</span><br><span class="line">    shards.add(si);</span><br><span class="line">    si = new JedisShardInfo(&quot;192.168.1.213&quot;, 6382);</span><br><span class="line">    shards.add(si);</span><br><span class="line"></span><br><span class="line">    // 池连接</span><br><span class="line">    JedisPoolConfig jedisPoolConfig = new JedisPoolConfig();</span><br><span class="line">    ShardedJedisPool pool = new ShardedJedisPool(jedisPoolConfig, shards);</span><br><span class="line"></span><br><span class="line">    try (ShardedJedis jedis = pool.getResource()) &#123;</span><br><span class="line">        jedis.set(&quot;x&quot;, &quot;foo&quot;);</span><br><span class="line">        jedis.set(&quot;x1&quot;, &quot;foo1&quot;);</span><br><span class="line">        jedis.set(&quot;x2&quot;, &quot;foo2&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    try (ShardedJedis jedis2 = pool.getResource()) &#123;</span><br><span class="line">        jedis2.set(&quot;y&quot;, &quot;bar&quot;);</span><br><span class="line">        jedis2.set(&quot;y1&quot;, &quot;bar1&quot;);</span><br><span class="line">        jedis2.set(&quot;y2&quot;, &quot;bar2&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    try (ShardedJedis jedis = pool.getResource()) &#123;</span><br><span class="line">        System.out.println(jedis.get(&quot;x&quot;));</span><br><span class="line">        System.out.println(jedis.get(&quot;x1&quot;));</span><br><span class="line">        System.out.println(jedis.get(&quot;x2&quot;));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    try (ShardedJedis jedis2 = pool.getResource()) &#123;</span><br><span class="line">        System.out.println(jedis2.get(&quot;y&quot;));</span><br><span class="line">        System.out.println(jedis2.get(&quot;y1&quot;));</span><br><span class="line">        System.out.println(jedis2.get(&quot;y2&quot;));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    pool.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" title="上一页" aria-label="上一页" href="/page/9/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/9/">9</a><span class="page-number current">10</span><a class="page-number" href="/page/11/">11</a><span class="space">&hellip;</span><a class="page-number" href="/page/17/">17</a><a class="extend next" rel="next" title="下一页" aria-label="下一页" href="/page/11/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2024</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">王某某</span>
  </div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
    <span title="站点总字数">150k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">9:05</span>
  </span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/pisces/" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script><script src="/js/bookmark.js"></script>

  






  





</body>
</html>
