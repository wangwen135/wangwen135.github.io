<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha256-XOqroi11tY4EFQMR9ZYwZWKj5ZXiftSx36RRuC3anlA=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"wangwen135.github.io","root":"/","images":"/images","scheme":"Pisces","darkmode":false,"version":"8.20.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":true,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="这是一个使用 Hexo 构建的博客，用于分享我的编程经验和学习笔记。">
<meta property="og:type" content="website">
<meta property="og:title" content="王某某的笔记">
<meta property="og:url" content="https://wangwen135.github.io/page/13/index.html">
<meta property="og:site_name" content="王某某的笔记">
<meta property="og:description" content="这是一个使用 Hexo 构建的博客，用于分享我的编程经验和学习笔记。">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="王某某">
<meta property="article:tag" content="java">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://wangwen135.github.io/page/13/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"page/13/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>王某某的笔记</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">王某某的笔记</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">记录我的编程之路</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="王某某"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">王某某</p>
  <div class="site-description" itemprop="description">这是一个使用 Hexo 构建的博客，用于分享我的编程经验和学习笔记。</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">158</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">51</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">121</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/wangwen135" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;wangwen135" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.jianshu.com/u/66c41e72644b" title="简  书 → https:&#x2F;&#x2F;www.jianshu.com&#x2F;u&#x2F;66c41e72644b" rel="noopener me" target="_blank"><i class="fa fa-link fa-fw"></i>简  书</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:wangwen135@gmail.com" title="E-Mail → mailto:wangwen135@gmail.com" rel="noopener me" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://twitter.com/wangwen135" title="Twitter → https:&#x2F;&#x2F;twitter.com&#x2F;wangwen135" rel="noopener me" target="_blank"><i class="fab fa-twitter fa-fw"></i>Twitter</a>
      </span>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://wangwen135.github.io/%E7%BD%91%E7%BB%9C%E4%B8%8E%E5%AE%89%E5%85%A8/%E4%BB%A3%E7%90%86/I2P%20%E9%9A%90%E5%BD%A2%E7%BD%91%E9%A1%B9%E7%9B%AE/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="王某某">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="王某某的笔记">
      <meta itemprop="description" content="这是一个使用 Hexo 构建的博客，用于分享我的编程经验和学习笔记。">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 王某某的笔记">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/%E7%BD%91%E7%BB%9C%E4%B8%8E%E5%AE%89%E5%85%A8/%E4%BB%A3%E7%90%86/I2P%20%E9%9A%90%E5%BD%A2%E7%BD%91%E9%A1%B9%E7%9B%AE/" class="post-title-link" itemprop="url">I2P 隐形网项目</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2018-03-17 00:00:00" itemprop="dateCreated datePublished" datetime="2018-03-17T00:00:00+08:00">2018-03-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%BD%91%E7%BB%9C%E4%B8%8E%E5%AE%89%E5%85%A8/" itemprop="url" rel="index"><span itemprop="name">网络与安全</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%BD%91%E7%BB%9C%E4%B8%8E%E5%AE%89%E5%85%A8/%E4%BB%A3%E7%90%86/" itemprop="url" rel="index"><span itemprop="name">代理</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>1k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>4 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>I2P是一个匿名网络，它只暴露一个简单的层，提供给应用程序之间进行匿名和安全的通讯。 这个网络本身是严格基于消息的(通过IP方式)，但也存在一个库可用于在其之上传输可靠的信息流(通过TCP方式)。 所有的通讯都是端到端加密的(发送一条消息总共会进行四层加密)，甚至是终结点(目标)也是加密的标识(本质上是一对公钥)。</p>
<p>官方网站： <a target="_blank" rel="noopener" href="https://geti2p.net/">https://geti2p.net/</a><br>维基百科：<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/I2P">https://zh.wikipedia.org/wiki/I2P</a></p>
<h3 id="安全性"><a href="#安全性" class="headerlink" title="安全性"></a>安全性</h3><p>TOR 是洋葱路由，而 I2P是大蒜路由。是洋葱路由的改进版,安全性更好、隐匿性更强。</p>
<p>TOR 和 I2P 的相同点在于：<br>都是经过若干个网络节点来加密和中转数据，并防止你的真实 IP 暴露。</p>
<blockquote>
<p>两者的差别在于：</p>
</blockquote>
<ul>
<li>TOR 使用【同一条网络链路】实现数据的发送和接收；</li>
<li>I2P 使用【多条网络链路】发送数据和接受数据——并且发送和接收数据的链路，数量可以是不同的。</li>
</ul>
<h3 id="抗封杀"><a href="#抗封杀" class="headerlink" title="抗封杀"></a>抗封杀</h3><p>在抗封杀方面，I2P 比 TOR 要坚挺。</p>
<p>TOR 每次启动时，需要先连接到某个 TOR 的目录服务器，获取网络上可用节点的信息。由于目录服务器数量有限，GFW 就把互联网上所有的 TOR 目录服务器的 IP 地址都列入黑名单。后来，TOR 官网提供网桥中继，帮助网友接入 TOR 网络。但是TOR 的网桥中继，数量依然不太多。据说 GFW 专门有人在盯着 TOR 官网更新的网桥中继地址——每次有新的中继地址贴出来，就列入黑名单。经过 GFW 的不懈努力，大部分 TOR 的网桥都被封杀。所以最近2年，TOR 在天朝内不太好使。</p>
<p>I2P 为啥封杀不了：<br>　　I2P 使用 Kad 算法（用过电驴或电骡的网友，应该听说过）来获取网络节点的信息。这么做有几个好处：  </p>
<ol>
<li>不需要目录服务器</li>
<li>Kad 算法拿到的节点信息只是整个 I2P 网络的一小部分</li>
<li>每一台运行 I2P 的主机都可以成为中继，帮别人转发数据（类似于 P2P 下载）</li>
</ol>
<p>　<br>由于上述好处，GFW 很难把所有 I2P 节点都列入黑名单。</p>
<h3 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h3><p>速度慢，速度慢是 I2P 为了安全性而不得不付出的代价。</p>
<h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><p>先去官网下载，然后按照，再运行</p>
<p>　I2P 本身不提供 GUI 界面，但是提供 Web 界面。I2P 启动后，你只需在浏览器地址栏输入 <a target="_blank" rel="noopener" href="http://127.0.0.1:7657/">http://127.0.0.1:7657/</a> 即可看到 I2P 的控制界面。</p>
<h3 id="补种"><a href="#补种" class="headerlink" title="补种"></a>补种</h3><p>这是非常关键的一步</p>
<p>I2P 是依靠 Kad 网络算法，通过不断扩散，来获取越来越多的节点信息。但是这个 Kad 网络算法不是万能的——它需要一些初始的种子，才能开始工作。在 I2P 的安装包中，已经内置了若干种子（节点信息）。但是GFW 早就把这些内置的节点彻底封杀了。所以在国内，第一次启动 I2P 会找不到网络。这时候就需要补种（reseed）。</p>
<p>通常来说，补种只需要做一次，之后你的 I2P 就可以一直联网了。如果你的 I2P 停了很长时间（几个月）没有运行，那么下一次运行的时候，可能会无法联网，这时候就需要再补种。</p>
<blockquote>
<p>补种(Reseeding)是一个网络引导(Bootstrip)过程，新用户通过这个过程发现其他I2P用户，很久未上线的老用户在已知的有效节点很少时也会进入引导&#x2F;补种状态。</p>
</blockquote>
<p>访问界面：<br><a target="_blank" rel="noopener" href="http://127.0.0.1:7657/configreseed">http://127.0.0.1:7657/configreseed</a><br>在下面填上能够翻墙的代理地址和端口，点击 保存修改 + 立刻开始网络引导</p>
<p>设置浏览器的 HTTP 代理 为 127.0.0.1:4444， 然后才能浏览 I2P 站点。</p>
<p><a target="_blank" rel="noopener" href="http://i2pwiki.i2p/">http://i2pwiki.i2p</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://wangwen135.github.io/%E8%84%9A%E6%9C%AC/shell/shell%E5%88%A4%E6%96%AD%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%83%85%E5%86%B5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="王某某">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="王某某的笔记">
      <meta itemprop="description" content="这是一个使用 Hexo 构建的博客，用于分享我的编程经验和学习笔记。">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 王某某的笔记">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/%E8%84%9A%E6%9C%AC/shell/shell%E5%88%A4%E6%96%AD%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%83%85%E5%86%B5/" class="post-title-link" itemprop="url">shell判断命令执行情况</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2018-03-08 14:54:00" itemprop="dateCreated datePublished" datetime="2018-03-08T14:54:00+08:00">2018-03-08</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%84%9A%E6%9C%AC/" itemprop="url" rel="index"><span itemprop="name">脚本</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%84%9A%E6%9C%AC/shell/" itemprop="url" rel="index"><span itemprop="name">shell</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>188</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>1 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>shell判断命令执行情况</p>
<p>命令执行失败时退出shell</p>
<p>判断</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">if ! command; then echo &quot;command failed&quot;; exit 1; fi</span><br></pre></td></tr></table></figure>

<p>判断上一个命令的返回值不为0</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">command</span><br><span class="line">if [ &quot;$?&quot; -ne 0 ]; then echo &quot;command failed&quot;; exit 1; fi</span><br></pre></td></tr></table></figure>

<p>逻辑与<br>执行多个命令</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">command1  &amp;&amp; command2</span><br></pre></td></tr></table></figure>
<p>&amp;&amp;左边的命令（命令1）返回真(即返回0，成功被执行）后，&amp;&amp;右边的命令（命令2）才能够被执行；换句话说，“如果这个命令执行成功&amp;&amp;那么执行这个命令”。</p>
<p>逻辑或</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">command1 || command2</span><br></pre></td></tr></table></figure>
<p>||则与&amp;&amp;相反。如果||左边的命令（command1）未执行成功，那么就执行||右边的命令（command2）；或者换句话说，“如果这个命令执行失败了||那么就执行这个命令。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">command || &#123; echo &quot;command failed&quot;; exit 1; &#125;</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://wangwen135.github.io/%E6%95%B0%E6%8D%AE%E4%BA%A4%E6%8D%A2%E6%A0%BC%E5%BC%8F/YAML/yaml%E6%A0%BC%E5%BC%8F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="王某某">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="王某某的笔记">
      <meta itemprop="description" content="这是一个使用 Hexo 构建的博客，用于分享我的编程经验和学习笔记。">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 王某某的笔记">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/%E6%95%B0%E6%8D%AE%E4%BA%A4%E6%8D%A2%E6%A0%BC%E5%BC%8F/YAML/yaml%E6%A0%BC%E5%BC%8F/" class="post-title-link" itemprop="url">yaml格式</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2018-03-08 00:00:00" itemprop="dateCreated datePublished" datetime="2018-03-08T00:00:00+08:00">2018-03-08</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%95%B0%E6%8D%AE%E4%BA%A4%E6%8D%A2%E6%A0%BC%E5%BC%8F/" itemprop="url" rel="index"><span itemprop="name">数据交换格式</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%95%B0%E6%8D%AE%E4%BA%A4%E6%8D%A2%E6%A0%BC%E5%BC%8F/YAML/" itemprop="url" rel="index"><span itemprop="name">YAML</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>786</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>3 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="YAML"><a href="#YAML" class="headerlink" title="YAML"></a>YAML</h1><p>方便人类读写的一种数据串行化格式</p>
<p>基本语法规则：</p>
<ul>
<li>大小写敏感</li>
<li>使用缩进表示层级关系</li>
<li>缩进时不允许使用Tab键，只允许使用空格</li>
<li>缩进的空格数目不重要，只要相同层级的元素左侧对齐即可</li>
<li>#表示注释，从这个字符一直到行尾，都会被解析器忽略</li>
</ul>
<p>支持的数据结构：</p>
<ul>
<li>对象：键值对的集合，又称为映射（mapping）&#x2F; 哈希（hashes） &#x2F; 字典（dictionary）</li>
<li>数组：一组按次序排列的值，又称为序列（sequence） &#x2F; 列表（list）</li>
<li>纯量（scalars）：单个的、不可再分的值</li>
</ul>
<h2 id="对象表达方式"><a href="#对象表达方式" class="headerlink" title="对象表达方式"></a>对象表达方式</h2><p>对象的一组键值对，使用冒号结构表示</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">animal: pets</span><br></pre></td></tr></table></figure>
<p>键值对写成一个行内对象</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hash: &#123; name: Steve, foo: bar &#125; </span><br></pre></td></tr></table></figure>

<h2 id="数组"><a href="#数组" class="headerlink" title="数组"></a>数组</h2><p>一组连词线开头的行，构成一个数组</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">- Cat</span><br><span class="line">- Dog</span><br><span class="line">- Goldfish</span><br></pre></td></tr></table></figure>
<p>数据结构的子成员是一个数组，则可以在该项下面缩进一个空格</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">-</span><br><span class="line"> - Cat</span><br><span class="line"> - Dog</span><br><span class="line"> - Goldfish</span><br></pre></td></tr></table></figure>
<p>转为 JavaScript 如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[ [ &#x27;Cat&#x27;, &#x27;Dog&#x27;, &#x27;Goldfish&#x27; ] ]</span><br></pre></td></tr></table></figure>

<p>数组也可以采用行内表示法</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">animal: [Cat, Dog]</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="复合结构"><a href="#复合结构" class="headerlink" title="复合结构"></a>复合结构</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">languages:</span><br><span class="line"> - Ruby</span><br><span class="line"> - Perl</span><br><span class="line"> - Python </span><br><span class="line">websites:</span><br><span class="line"> YAML: yaml.org </span><br><span class="line"> Ruby: ruby-lang.org </span><br><span class="line"> Python: python.org </span><br><span class="line"> Perl: use.perl.org </span><br></pre></td></tr></table></figure>

<h2 id="纯量"><a href="#纯量" class="headerlink" title="纯量"></a>纯量</h2><ul>
<li>字符串</li>
<li>整数</li>
<li>浮点数</li>
<li>Null</li>
<li>时间</li>
<li>日期</li>
<li>布尔值</li>
</ul>
<p>数值直接以字面量的形式表示</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">number: 12.30</span><br></pre></td></tr></table></figure>

<p>布尔值用true和false表示</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">isSet: true</span><br></pre></td></tr></table></figure>

<p><strong>null</strong>用 &#x3D;&#x3D;~&#x3D;&#x3D; 表示</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">parent: ~ </span><br></pre></td></tr></table></figure>
<p>等同于如下JavaScript </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123; parent: null &#125;</span><br></pre></td></tr></table></figure>

<p>时间采用 ISO8601 格式</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iso8601: 2001-12-14t21:59:43.10-05:00 </span><br></pre></td></tr></table></figure>
<p>后面的 <em>-05:00</em> 表示时区</p>
<p>日期采用复合 iso8601 格式的年、月、日表示</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">date: 1976-07-31</span><br></pre></td></tr></table></figure>

<p>使用两个感叹号，强制转换数据类型</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">e: !!str 123</span><br><span class="line">f: !!str true</span><br></pre></td></tr></table></figure>

<h2 id="字符串"><a href="#字符串" class="headerlink" title="字符串"></a>字符串</h2><p>字符串默认不使用引号表示</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">str: 这是一行字符串</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>如果字符串之中包含空格或特殊字符，需要放在引号之中</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">str: &#x27;内容： 字符串&#x27;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>单引号和双引号都可以使用，双引号不会对特殊字符转义</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">s1: &#x27;内容\n字符串&#x27;</span><br><span class="line">s2: &quot;内容\n字符串&quot;</span><br></pre></td></tr></table></figure>

<p>单引号之中如果还有单引号，必须连续使用两个单引号转义</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">str: &#x27;labor&#x27;&#x27;s day&#x27; </span><br></pre></td></tr></table></figure>

<p>字符串可以写成多行，从第二行开始，必须有一个单空格缩进。换行符会被转为空格</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">str: 这是一段</span><br><span class="line">  多行</span><br><span class="line">  字符串</span><br></pre></td></tr></table></figure>
<p>转为 JavaScript </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123; str: &#x27;这是一段 多行 字符串&#x27; &#125;</span><br></pre></td></tr></table></figure>

<p>多行字符串可以使用 &#x3D;&#x3D;<strong>|</strong>&#x3D;&#x3D; 保留换行符，也可以使用 &#x3D;&#x3D;<strong>&gt;</strong>&#x3D;&#x3D; 折叠换行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">this: |</span><br><span class="line">  Foo</span><br><span class="line">  Bar</span><br><span class="line">that: &gt;</span><br><span class="line">  Foo</span><br><span class="line">  Bar</span><br></pre></td></tr></table></figure>

<p>转为 JavaScript</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123; this: &#x27;Foo\nBar\n&#x27;, that: &#x27;Foo Bar\n&#x27; &#125;</span><br></pre></td></tr></table></figure>

<p>&#x3D;&#x3D;<strong>+</strong>&#x3D;&#x3D; 表示保留文字块末尾的换行，&#x3D;&#x3D;<strong>-</strong>&#x3D;&#x3D; 表示删除字符串末尾的换行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">s1: |</span><br><span class="line">  Foo</span><br><span class="line"></span><br><span class="line">s2: |+</span><br><span class="line">  Foo</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">s3: |-</span><br><span class="line">  Foo</span><br></pre></td></tr></table></figure>
<p>转为 JavaScript</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123; s1: &#x27;Foo\n&#x27;, s2: &#x27;Foo\n\n\n&#x27;, s3: &#x27;Foo&#x27; &#125;</span><br></pre></td></tr></table></figure>

<p>字符串之中可以插入 HTML 标记</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">message: |</span><br><span class="line"></span><br><span class="line">  &lt;p style=&quot;color: red&quot;&gt;</span><br><span class="line">    段落</span><br><span class="line">  &lt;/p&gt;</span><br></pre></td></tr></table></figure>

<p>转为 JavaScript 如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123; message: &#x27;\n&lt;p style=&quot;color: red&quot;&gt;\n  段落\n&lt;/p&gt;\n&#x27; &#125;</span><br></pre></td></tr></table></figure>

<h2 id="引用"><a href="#引用" class="headerlink" title="引用"></a>引用</h2><p>锚点 &#x3D;&#x3D;<strong>&amp;</strong>&#x3D;&#x3D; 和别名 &#x3D;&#x3D;<strong>*</strong>&#x3D;&#x3D;，可以用来引用</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">defaults: &amp;defaults</span><br><span class="line">  adapter:  postgres</span><br><span class="line">  host:     localhost</span><br><span class="line"></span><br><span class="line">development:</span><br><span class="line">  database: myapp_development</span><br><span class="line">  &lt;&lt;: *defaults</span><br><span class="line"></span><br><span class="line">test:</span><br><span class="line">  database: myapp_test</span><br><span class="line">  &lt;&lt;: *default</span><br></pre></td></tr></table></figure>
<p>等同于下面的代码。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">defaults:</span><br><span class="line">  adapter:  postgres</span><br><span class="line">  host:     localhost</span><br><span class="line"></span><br><span class="line">development:</span><br><span class="line">  database: myapp_development</span><br><span class="line">  adapter:  postgres</span><br><span class="line">  host:     localhost</span><br><span class="line"></span><br><span class="line">test:</span><br><span class="line">  database: myapp_test</span><br><span class="line">  adapter:  postgres</span><br><span class="line">  host:     localhost</span><br></pre></td></tr></table></figure>

<p><strong>&amp;</strong> 用来建立锚点（defaults），**&lt;&lt;** 表示合并到当前数据，<strong>*</strong> 用来引用锚点。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://wangwen135.github.io/%E8%84%9A%E6%9C%AC/bat/bat%20%E5%9C%A8%E7%9B%AE%E5%BD%95%E4%B8%8B%E9%80%92%E5%BD%92%E5%BE%AA%E7%8E%AF%E6%89%A7%E8%A1%8C%E5%91%BD%E4%BB%A4/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="王某某">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="王某某的笔记">
      <meta itemprop="description" content="这是一个使用 Hexo 构建的博客，用于分享我的编程经验和学习笔记。">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 王某某的笔记">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/%E8%84%9A%E6%9C%AC/bat/bat%20%E5%9C%A8%E7%9B%AE%E5%BD%95%E4%B8%8B%E9%80%92%E5%BD%92%E5%BE%AA%E7%8E%AF%E6%89%A7%E8%A1%8C%E5%91%BD%E4%BB%A4/" class="post-title-link" itemprop="url">bat 在目录下递归循环执行命令</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2018-02-15 12:01:00" itemprop="dateCreated datePublished" datetime="2018-02-15T12:01:00+08:00">2018-02-15</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%84%9A%E6%9C%AC/" itemprop="url" rel="index"><span itemprop="name">脚本</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%84%9A%E6%9C%AC/bat/" itemprop="url" rel="index"><span itemprop="name">bat</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>289</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>1 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line">@echo off</span><br><span class="line"></span><br><span class="line">rem 想用bat 做一个递归清理文件</span><br><span class="line">rem 目前就是递归执行一下 maven的清理命令</span><br><span class="line">rem 语法真的是渣</span><br><span class="line"></span><br><span class="line">rem echo 当前盘符：%~d0</span><br><span class="line">rem echo 当前盘符和路径：%~dp0</span><br><span class="line">rem echo 当前批处理全路径：%~f0</span><br><span class="line">rem echo 当前盘符和路径的短文件名格式：%~sdp0</span><br><span class="line">rem echo 当前CMD默认目录：%cd%</span><br><span class="line"></span><br><span class="line">echo ************************************</span><br><span class="line">echo ************ 清理数据 **************</span><br><span class="line">echo ************************************</span><br><span class="line"></span><br><span class="line">IF &quot;%1&quot;==&quot;&quot; (</span><br><span class="line">  echo 清理目录:%cd%</span><br><span class="line">  set prodir=%cd%</span><br><span class="line">) ELSE (</span><br><span class="line">  echo 当前参数参数是：[%1]</span><br><span class="line">  echo 清理目录：%1</span><br><span class="line">  set prodir=%1</span><br><span class="line">  if exist %1/ (</span><br><span class="line">	cd %1</span><br><span class="line">  ) else (</span><br><span class="line">  	echo 目录:[%1]不存在，即将退出！</span><br><span class="line">	pause</span><br><span class="line">	exit</span><br><span class="line">  )</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">rem echo 路径：</span><br><span class="line">rem chdir</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">for /D %%s in (*) do (</span><br><span class="line">  </span><br><span class="line">  echo 当前循环的值是:%%s</span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">  REM 跳过git目录</span><br><span class="line"> </span><br><span class="line">  IF %%s==.git (</span><br><span class="line">	echo 这是一个git目录，跳过</span><br><span class="line">	</span><br><span class="line">  ) ELSE (</span><br><span class="line">	  echo 进入目录:%%s</span><br><span class="line">	  cd %%s	  </span><br><span class="line">	  REM echo 判断pom文件是否存在</span><br><span class="line">	  REM dir</span><br><span class="line">	  </span><br><span class="line">	   IF EXIST pom.xml (</span><br><span class="line">		 echo 存在pom文件，开始执行清理命令...</span><br><span class="line">		 </span><br><span class="line">		 mvn clean</span><br><span class="line">		 </span><br><span class="line">		 @echo off</span><br><span class="line">		 </span><br><span class="line">	   ) ELSE (</span><br><span class="line">		 echo 不存在pom文件，进入下一层目录</span><br><span class="line">		 REM goto BB</span><br><span class="line">		 REM call %~f0 %cd%</span><br><span class="line">		 call %~f0</span><br><span class="line">		 </span><br><span class="line">		 echo 子目录处理完成</span><br><span class="line">		 </span><br><span class="line">	   )</span><br><span class="line">	  </span><br><span class="line">	  echo 退出目录:%%s</span><br><span class="line">	  </span><br><span class="line">	  cd .. </span><br><span class="line">  )</span><br><span class="line"></span><br><span class="line">  echo 本次循环结束，循环值是：%%s</span><br><span class="line">  echo ============================================================</span><br><span class="line"></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">echo 执行完成</span><br><span class="line"></span><br></pre></td></tr></table></figure>



      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://wangwen135.github.io/Elasticsearch/ElasticSearch%205.2.X%E5%AE%89%E8%A3%85ElasticSearch-head/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="王某某">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="王某某的笔记">
      <meta itemprop="description" content="这是一个使用 Hexo 构建的博客，用于分享我的编程经验和学习笔记。">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 王某某的笔记">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/Elasticsearch/ElasticSearch%205.2.X%E5%AE%89%E8%A3%85ElasticSearch-head/" class="post-title-link" itemprop="url">ElasticSearch 5.2.X安装ElasticSearch-head</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2018-02-07 11:19:00" itemprop="dateCreated datePublished" datetime="2018-02-07T11:19:00+08:00">2018-02-07</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Elasticsearch/" itemprop="url" rel="index"><span itemprop="name">Elasticsearch</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>423</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>2 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <ol>
<li><p>安装nodejs环境</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">wget https://npm.taobao.org/mirrors/node/latest-v4.x/node-v4.4.7-linux-x64.tar.gz</span><br><span class="line"></span><br><span class="line">tar -zxvf node-v4.4.7-linux-x64.tar.gz</span><br><span class="line"></span><br><span class="line">export PATH=$PATH:/soft/node-v4.4.7-linux-x64/bin</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>nodejs包中已经包含了nmp<br>测试</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">node --version</span><br><span class="line">v4.4.7</span><br><span class="line"></span><br><span class="line">npm --version</span><br><span class="line">2.15.8</span><br></pre></td></tr></table></figure>
</li>
<li><p>安装grunt<br>安装grunt命令行工具grunt-cli</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g grunt-cli</span><br></pre></td></tr></table></figure>
<p>安装grunt及其插件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g grunt --save-dev</span><br></pre></td></tr></table></figure>
<p>测试</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">grunt -version</span><br><span class="line">grunt-cli v1.2.0</span><br></pre></td></tr></table></figure>

</li>
<li><p>安装elasticsearch-head<br>如果没有Git先安装</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum install git</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>先克隆项目</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git clone git://github.com/mobz/elasticsearch-head.git</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>安装</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cd elasticsearch-head</span><br><span class="line"></span><br><span class="line">npm install</span><br><span class="line"></span><br><span class="line">npm install grunt --save</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>elasticsearch-head的配置文件是Gruntfile.js，默认监听在127.0.0.1下9100端口</p>
</li>
</ol>
<p>然后cd &#x2F;usr&#x2F;local&#x2F;elasticsearch-head  执行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grunt server</span><br></pre></td></tr></table></figure>

<p>浏览器访问 <a target="_blank" rel="noopener" href="http://172.16.31.220:9100/">http://172.16.31.220:9100/</a></p>
<hr>
<hr>
<p>问题：</p>
<p>启动完之后，head主控页面是可以显示的，但是显示连接失败</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">“集群健康值: 未连接”</span><br></pre></td></tr></table></figure>
<p>查资料：解决方案，修改elasticsearch.yml文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vim $ES_HOME$/config/elasticsearch.yml</span><br><span class="line"># 增加如下字段</span><br><span class="line">http.cors.enabled: true</span><br><span class="line">http.cors.allow-origin: &quot;*&quot;</span><br></pre></td></tr></table></figure>
<p>重启es和head即可  </p>
<hr>
<p>说明：</p>
<table>
<thead>
<tr>
<th>key</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>http.cors.enabled</td>
<td>是否支持跨域，默认为false</td>
</tr>
<tr>
<td>http.cors.allow-origin</td>
<td>当设置允许跨域，默认为*,表示支持所有域名，如果我们只是允许某些网站能访问，那么可以使用正则表达式。比如只允许本地地址。 &#x2F;https?://localhost(:[0-9]+)?&#x2F;</td>
</tr>
<tr>
<td>http.cors.max-age</td>
<td>浏览器发送一个“预检”OPTIONS请求，以确定CORS设置。最大年龄定义多久的结果应该缓存。默认为1728000（20天）</td>
</tr>
<tr>
<td>http.cors.allow-methods</td>
<td>允许跨域的请求方式，默认OPTIONS,HEAD,GET,POST,PUT,DELETE</td>
</tr>
<tr>
<td>http.cors.allow-headers</td>
<td>跨域允许设置的头信息，默认为X-Requested-With,Content-Type,Content-Length</td>
</tr>
<tr>
<td>http.cors.allow-credentials</td>
<td>是否返回设置的跨域Access-Control-Allow-Credentials头，如果设置为true,那么会返回给客户端。</td>
</tr>
</tbody></table>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://wangwen135.github.io/%E7%BD%91%E7%BB%9C%E4%B8%8E%E5%AE%89%E5%85%A8/%E4%BB%A3%E7%90%86/Privoxy%20%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="王某某">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="王某某的笔记">
      <meta itemprop="description" content="这是一个使用 Hexo 构建的博客，用于分享我的编程经验和学习笔记。">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 王某某的笔记">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/%E7%BD%91%E7%BB%9C%E4%B8%8E%E5%AE%89%E5%85%A8/%E4%BB%A3%E7%90%86/Privoxy%20%E5%AE%89%E8%A3%85%E9%85%8D%E7%BD%AE/" class="post-title-link" itemprop="url">Privoxy 安装配置</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-12-15 00:00:00" itemprop="dateCreated datePublished" datetime="2017-12-15T00:00:00+08:00">2017-12-15</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%BD%91%E7%BB%9C%E4%B8%8E%E5%AE%89%E5%85%A8/" itemprop="url" rel="index"><span itemprop="name">网络与安全</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%BD%91%E7%BB%9C%E4%B8%8E%E5%AE%89%E5%85%A8/%E4%BB%A3%E7%90%86/" itemprop="url" rel="index"><span itemprop="name">代理</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>783</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>3 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>使用Privoxy 将socks5代理转成http代理</p>
<p>操作系统 CentOS 7</p>
<h4 id="1、先安装epel源"><a href="#1、先安装epel源" class="headerlink" title="1、先安装epel源"></a>1、先安装epel源</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">yum install epel-release</span><br><span class="line"></span><br><span class="line">#安装完成之后可以通过下面的命令查看</span><br><span class="line">yum repolist</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#可以看到多了一个</span><br><span class="line">#Extra Packages for Enterprise Linux 7 - x86_64</span><br></pre></td></tr></table></figure>


<h4 id="2、使用yum命令安装"><a href="#2、使用yum命令安装" class="headerlink" title="2、使用yum命令安装"></a>2、使用yum命令安装</h4><p>用yum命令看一下，是最新版本</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"> yum info privoxy</span><br><span class="line"> </span><br><span class="line">名称    ：privoxy</span><br><span class="line">架构    ：x86_64</span><br><span class="line">版本    ：3.0.26</span><br><span class="line">发布    ：1.el7</span><br><span class="line">大小    ：936 k</span><br><span class="line">源    ：epel/x86_64</span><br><span class="line">简介    ： Privacy enhancing proxy</span><br><span class="line">网址    ：http://www.privoxy.org/</span><br><span class="line">协议    ： GPLv2+</span><br><span class="line">描述    ： Privoxy is a web proxy with advanced filtering capabilities for</span><br><span class="line">         : protecting privacy, filtering web page content, managing cookies,</span><br><span class="line">         : controlling access, and removing ads, banners, pop-ups and other</span><br><span class="line">         : obnoxious Internet junk. Privoxy has a very flexible configuration and</span><br><span class="line">         : can be customized to suit individual needs and tastes. Privoxy has application</span><br><span class="line">         : for both stand-alone systems and multi-user networks.</span><br><span class="line">         : </span><br><span class="line">         : Privoxy is based on the Internet Junkbuster.</span><br></pre></td></tr></table></figure>

<p>直接安装 privoxy</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">yum install privoxy</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="3、-配置"><a href="#3、-配置" class="headerlink" title="3、 配置"></a>3、 配置</h4><p>配置文件位于目录：**&#x2F;etc&#x2F;privoxy**</p>
<h5 id="3-1、修改config文件"><a href="#3-1、修改config文件" class="headerlink" title="3.1、修改config文件"></a>3.1、修改config文件</h5><blockquote>
<p>说明：<br><a target="_blank" rel="noopener" href="https://www.privoxy.org/user-manual/config.html">https://www.privoxy.org/user-manual/config.html</a></p>
</blockquote>
<p>修改绑定地址，搜索 &#x3D;&#x3D;listen-address&#x3D;&#x3D; ，修改需要绑定的IP</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">listen-address  0.0.0.0:8118</span><br></pre></td></tr></table></figure>

<p>设置socks5 转发，搜索 &#x3D;&#x3D;forward-socks5t&#x3D;&#x3D; ，去掉注释，修改对应IP</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">forward-socks5t   /               118.193.225.166:9150 .</span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意后面的点不要删掉</p>
</blockquote>
<p>配置不走代理，直接本地转发的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">forward         192.168.*.*/     .</span><br><span class="line">forward           127.*.*.*/     .</span><br></pre></td></tr></table></figure>

<hr>
<p>由于网络不稳定，经常出现503，增加转发重试<br>默认值是：0</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">forwarded-connect-retries  1</span><br></pre></td></tr></table></figure>

<p>配置最大客户端的连接<br>默认值是：128</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">max-client-connections 256</span><br></pre></td></tr></table></figure>

<hr>
<p>这个用于开启和关闭广告过滤和内容过滤，1表示开启，0表示关闭<br>默认值是：1</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">toggle  0</span><br></pre></td></tr></table></figure>

<hr>
<p>共享连接</p>
<p>是否保持活动的传出连接应该在不同的传入连接之间共享</p>
<blockquote>
<p>这个还没怎么测试，按照字面意思理解</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">connection-sharing 1</span><br></pre></td></tr></table></figure>



<h5 id="3-1、修改user-action-配置文件"><a href="#3-1、修改user-action-配置文件" class="headerlink" title="3.1、修改user.action 配置文件"></a>3.1、修改user.action 配置文件</h5><p>拦截服务端禁止在iframe中加载的响应头，在user.action 末尾添加</p>
<p><strong>只能处理http的连接</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123; +crunch-server-header&#123;X-Frame-Options&#125; &#125;</span><br><span class="line">/</span><br></pre></td></tr></table></figure>

<hr>
<p>修改服务端的响应头，去掉设置cookie时的 HttpOnly ，让客户端可以通过js获取cookie<br>Privoxy 使用类似Perl的 s&#x2F;&#x2F;&#x2F; 操作来实现对内容的替换修改</p>
<blockquote>
<p>注意，它使用的是|作为分隔符，而不是&#x2F;，因为模式包含一个正斜杠，否则必须以反斜杠(\)来转义。如果表达式中有|线则用@符号。（文档中没有看到明确的说明，但是例子中是这么写的）</p>
</blockquote>
<p><strong>只能处理http的连接</strong></p>
<p>在user.filter文件中新增</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SERVER-HEADER-FILTER: delete-http-only delete server response head setCookie http only tag</span><br><span class="line">s@^(Set-Cookie.+)(;[ ]*httponly)@$1@i</span><br></pre></td></tr></table></figure>

<p>在user.action文件中新增</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;+server-header-filter&#123;delete-http-only&#125;&#125;</span><br><span class="line">/</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<hr>
<h4 id="4、启动服务"><a href="#4、启动服务" class="headerlink" title="4、启动服务"></a>4、启动服务</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ systemctl start privoxy</span><br><span class="line">$ systemctl status privoxy</span><br><span class="line"></span><br><span class="line">● privoxy.service - Privoxy Web Proxy With Advanced Filtering Capabilities</span><br><span class="line">   Loaded: loaded (/usr/lib/systemd/system/privoxy.service; disabled; vendor preset: disabled)</span><br><span class="line">   Active: active (running) since 三 2017-11-15 16:38:12 CST; 9s ago</span><br><span class="line">  Process: 22643 ExecStart=/usr/sbin/privoxy --pidfile /run/privoxy.pid --user privoxy /etc/privoxy/config (code=exited, status=0/SUCCESS)</span><br><span class="line"> Main PID: 22644 (privoxy)</span><br><span class="line">   CGroup: /system.slice/privoxy.service</span><br><span class="line">           └─22644 /usr/sbin/privoxy --pidfile /run/privoxy.pid --user privoxy /etc/privoxy/config</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<h4 id="5、检查测试"><a href="#5、检查测试" class="headerlink" title="5、检查测试"></a>5、检查测试</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">netstat -an | grep 8118</span><br><span class="line"></span><br><span class="line">tcp        0      0 127.0.0.1:8118          0.0.0.0:*               LISTEN     </span><br></pre></td></tr></table></figure>


<h4 id="6、浏览器访问"><a href="#6、浏览器访问" class="headerlink" title="6、浏览器访问"></a>6、浏览器访问</h4><p>浏览器配置代理指向privoxy</p>
<p>访问地址：<a target="_blank" rel="noopener" href="http://p.p/">http://p.p/</a> 可以进入到privoxy的一个管理页面</p>
<p>访问地址：<a target="_blank" rel="noopener" href="https://check.torproject.org/">https://check.torproject.org/</a> 可以进入到一个tor检查页面</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://wangwen135.github.io/%E7%BD%91%E7%BB%9C%E4%B8%8E%E5%AE%89%E5%85%A8/%E4%BB%A3%E7%90%86/SS5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="王某某">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="王某某的笔记">
      <meta itemprop="description" content="这是一个使用 Hexo 构建的博客，用于分享我的编程经验和学习笔记。">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 王某某的笔记">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/%E7%BD%91%E7%BB%9C%E4%B8%8E%E5%AE%89%E5%85%A8/%E4%BB%A3%E7%90%86/SS5/" class="post-title-link" itemprop="url">SS5</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-12-11 00:00:00" itemprop="dateCreated datePublished" datetime="2017-12-11T00:00:00+08:00">2017-12-11</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%BD%91%E7%BB%9C%E4%B8%8E%E5%AE%89%E5%85%A8/" itemprop="url" rel="index"><span itemprop="name">网络与安全</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%BD%91%E7%BB%9C%E4%B8%8E%E5%AE%89%E5%85%A8/%E4%BB%A3%E7%90%86/" itemprop="url" rel="index"><span itemprop="name">代理</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>1.3k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>5 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>centos7安装socks5</p>
<p>项目地址：<br><a target="_blank" rel="noopener" href="http://ss5.sourceforge.net/">http://ss5.sourceforge.net</a></p>
<p>下载地址：<br><a target="_blank" rel="noopener" href="https://sourceforge.net/projects/ss5/files/">https://sourceforge.net/projects/ss5/files/</a></p>
<h2 id="一次安装配置的记录"><a href="#一次安装配置的记录" class="headerlink" title="一次安装配置的记录"></a>一次安装配置的记录</h2><p>下载解压</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ wget https://jaist.dl.sourceforge.net/project/ss5/ss5/3.8.9-8/ss5-3.8.9-8.tar.gz</span><br><span class="line"></span><br><span class="line">$ tar -zxvf ss5-3.8.9-8.tar.gz</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>编译</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ cd ss5-3.8.9</span><br><span class="line"></span><br><span class="line">$ ./configure --prefix=/usr/local/ss5</span><br><span class="line"></span><br><span class="line">#提示缺省 pam 模块</span><br><span class="line">......</span><br><span class="line">......</span><br><span class="line">checking for syslog.h... yes</span><br><span class="line">checking for unistd.h... (cached) yes</span><br><span class="line">checking security/pam_misc.h usability... no</span><br><span class="line">checking security/pam_misc.h presence... no</span><br><span class="line">checking for security/pam_misc.h... no</span><br><span class="line">configure: error: *** Some of the headers weren&#x27;t found ***</span><br></pre></td></tr></table></figure>

<p><strong>安装pam</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ yum -y install pam pam-devel</span><br></pre></td></tr></table></figure>

<p>再编译</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">$ ./configure --prefix=/usr/local/ss5</span><br><span class="line">......</span><br><span class="line">......</span><br><span class="line">checking for socket... yes</span><br><span class="line">checking for strdup... yes</span><br><span class="line">checking for strtol... yes</span><br><span class="line">configure: creating ./config.status</span><br><span class="line">config.status: creating Makefile</span><br><span class="line">config.status: creating modules/Makefile</span><br><span class="line">config.status: creating modules/mod_authen/Makefile</span><br><span class="line">config.status: creating modules/mod_author/Makefile</span><br><span class="line">config.status: creating modules/mod_balance/Makefile</span><br><span class="line">config.status: creating modules/mod_bandwidth/Makefile</span><br><span class="line">config.status: creating modules/mod_dump/Makefile</span><br><span class="line">config.status: creating modules/mod_filter/Makefile</span><br><span class="line">config.status: creating modules/mod_log/Makefile</span><br><span class="line">config.status: creating modules/mod_proxy/Makefile</span><br><span class="line">config.status: creating modules/mod_socks4/Makefile</span><br><span class="line">config.status: creating modules/mod_socks5/Makefile</span><br><span class="line">config.status: creating modules/mod_statistics/Makefile</span><br><span class="line">config.status: creating common/Makefile</span><br><span class="line">config.status: creating src/Makefile</span><br><span class="line">config.status: creating include/config.h</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ make </span><br><span class="line">make[1]: 进入目录“/data/softwares/ss5-3.8.9/common”</span><br><span class="line">gcc -g -O2 -DLINUX -D_FILE_OFFSET_BITS=64 -I . -I ../include   -fPIC   -c -o SS5OpenLdap.o SS5OpenLdap.c</span><br><span class="line">SS5OpenLdap.c:29:18: 致命错误：ldap.h：没有那个文件或目录</span><br><span class="line"> #include &lt;ldap.h&gt;</span><br><span class="line">                  ^</span><br><span class="line">编译中断。</span><br><span class="line">make[1]: *** [SS5OpenLdap.o] 错误 1</span><br><span class="line">make[1]: 离开目录“/data/softwares/ss5-3.8.9/common”</span><br><span class="line">make: *** [common] 错误 2</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>再装ldap</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum -y install openldap-devel </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>再来一次</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ make</span><br><span class="line">make[1]: 进入目录“/data/softwares/ss5-3.8.9/common”</span><br><span class="line">gcc -g -O2 -DLINUX -D_FILE_OFFSET_BITS=64 -I . -I ../include   -fPIC   -c -o SS5OpenLdap.o SS5OpenLdap.c</span><br><span class="line">gcc -g -O2 -DLINUX -D_FILE_OFFSET_BITS=64 -I . -I ../include   -fPIC   -c -o SS5Radius.o SS5Radius.c</span><br><span class="line">In file included from SS5Radius.c:22:0:</span><br><span class="line">../include/SS5Radius.h:22:25: 致命错误：openssl/md5.h：没有那个文件或目录</span><br><span class="line"> #include &lt;openssl/md5.h&gt;</span><br><span class="line">                         ^</span><br><span class="line">编译中断。</span><br><span class="line">make[1]: *** [SS5Radius.o] 错误 1</span><br><span class="line">make[1]: 离开目录“/data/softwares/ss5-3.8.9/common”</span><br><span class="line">make: *** [common] 错误 2</span><br></pre></td></tr></table></figure>

<p><strong>再安装openssl</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">$ yum install openssl-devel</span><br><span class="line"></span><br><span class="line">......</span><br><span class="line">......</span><br><span class="line"></span><br><span class="line">已安装:</span><br><span class="line">  openssl-devel.x86_64 1:1.0.2k-8.el7                                                         </span><br><span class="line">作为依赖被安装:</span><br><span class="line">  keyutils-libs-devel.x86_64 0:1.5.8-3.el7     krb5-devel.x86_64 0:1.15.1-8.el7        libcom_err-devel.x86_64 0:1.42.9-10.el7     libkadm5.x86_64 0:1.15.1-8.el7       libselinux-devel.x86_64 0:2.5-11.el7    </span><br><span class="line">  libsepol-devel.x86_64 0:2.5-6.el7            libverto-devel.x86_64 0:0.2.5-4.el7     pcre-devel.x86_64 0:8.32-17.el7             zlib-devel.x86_64 0:1.2.7-17.el7    </span><br><span class="line"></span><br><span class="line">作为依赖被升级:</span><br><span class="line">  e2fsprogs.x86_64 0:1.42.9-10.el7             e2fsprogs-libs.x86_64 0:1.42.9-10.el7        krb5-libs.x86_64 0:1.15.1-8.el7        libcom_err.x86_64 0:1.42.9-10.el7        libselinux.x86_64 0:2.5-11.el7       </span><br><span class="line">  libselinux-python.x86_64 0:2.5-11.el7        libselinux-utils.x86_64 0:2.5-11.el7         libss.x86_64 0:1.42.9-10.el7           pcre.x86_64 0:8.32-17.el7               </span><br><span class="line"></span><br><span class="line">完毕！</span><br></pre></td></tr></table></figure>

<p>再来一次就正常了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">make</span><br><span class="line"></span><br><span class="line">make install</span><br></pre></td></tr></table></figure>
<p>安装完成之后相关配置文件在：<br>&#x2F;etc&#x2F;opt&#x2F;ss5&#x2F; 目录下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ ll /etc/opt/ss5/</span><br><span class="line">总用量 20</span><br><span class="line">-rw-r--r-- 1 root root 11609 5月   2 15:07 ss5.conf</span><br><span class="line">-rw-r--r-- 1 root root   118 5月   2 15:07 ss5.ha</span><br><span class="line">-rw-r--r-- 1 root root     1 5月   2 15:07 ss5.passwd</span><br></pre></td></tr></table></figure>
<p>启动一下试试看</p>
<p><strong>先给文件加上执行权限</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod +x /etc/rc.d/init.d/ss5</span><br></pre></td></tr></table></figure>
<p><strong>启动服务</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ service ss5 start</span><br><span class="line">Reloading systemd:                                         [  确定  ]</span><br><span class="line">Starting ss5 (via systemctl):                              [  确定  ]</span><br></pre></td></tr></table></figure>
<p>检查一下端口（默认使用1080端口）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ netstat -an | grep 1080</span><br><span class="line">tcp        0      0 0.0.0.0:1080            0.0.0.0:*               LISTEN   </span><br></pre></td></tr></table></figure>
<p>测试一下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ curl --socks5 127.0.0.1:1080 http://www.baidu.com</span><br><span class="line">curl: (7) No authentication method was acceptable. (It is quite likely that the SOCKS5 server wanted a username/password, since none was supplied to the server on this connection.)</span><br></pre></td></tr></table></figure>
<p>并不行</p>
<p>修改ss5.conf文件试试看<br>去掉 auth 和 permit 两项配置的注释</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">......</span><br><span class="line">......</span><br><span class="line">#       SHost           SPort           Authentication</span><br><span class="line">#</span><br><span class="line">auth    0.0.0.0/0               -               -</span><br><span class="line"></span><br><span class="line">......</span><br><span class="line">......</span><br><span class="line"># /////////////////////////////////////////////////////////////////////////////////////////////////</span><br><span class="line">#      Auth     SHost           SPort   DHost           DPort   Fixup   Group   Band    ExpDate</span><br><span class="line">#</span><br><span class="line">permit -        0.0.0.0/0       -       0.0.0.0/0       -       -       -       -       -</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>重启服务</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@wwh215 init.d]# service ss5 stop </span><br><span class="line">Stopping ss5 (via systemctl):                              [  确定  ]</span><br><span class="line">[root@wwh215 init.d]# service ss5 start</span><br><span class="line">Starting ss5 (via systemctl):                              [  确定  ]</span><br></pre></td></tr></table></figure>
<p>再用curl命令测试，能正常访问了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">curl --socks5 127.0.0.1:1080 http://www.baidu.com</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>下一步测试需要授权的，使用用户名、密码授权</p>
<p>修复ss5.conf文件  </p>
<blockquote>
<p>后面改成 u</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">auth    0.0.0.0/0               -               u</span><br></pre></td></tr></table></figure>
<p>修改ss5.passwd，增加一对用户名密码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">test test</span><br></pre></td></tr></table></figure>

<p>重启服务，再用上面的curl命令测试，发现又不能访问了<br>加上用户名密码就可以访问了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl --socks5 test:test@127.0.0.1:1080 --user test:test http://www.baidu.com   </span><br></pre></td></tr></table></figure>

<p>测试完成</p>
<h2 id="将ss5加入开机自启动"><a href="#将ss5加入开机自启动" class="headerlink" title="将ss5加入开机自启动"></a>将ss5加入开机自启动<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chkconfig --add ss5</span><br></pre></td></tr></table></figure></h2><h2 id="精简版本"><a href="#精简版本" class="headerlink" title="精简版本"></a>精简版本</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">$ yum install pam-devel openldap-devel openssl-devel</span><br><span class="line"></span><br><span class="line">#如果没有编译环境，也可以把gcc和make也安装上</span><br><span class="line">$ yum -y install gcc automake make pam-devel openldap-devel cyrus-sasl-devel openssl-devel</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$ wget https://jaist.dl.sourceforge.net/project/ss5/ss5/3.8.9-8/ss5-3.8.9-8.tar.gz</span><br><span class="line"></span><br><span class="line">$ tar -zxvf ss5-3.8.9-8.tar.gz</span><br><span class="line"></span><br><span class="line">$ cd ss5-3.8.9</span><br><span class="line"></span><br><span class="line">$ ./configure --prefix=/usr/local/ss5</span><br><span class="line"></span><br><span class="line">$ make</span><br><span class="line"></span><br><span class="line">$ make install</span><br><span class="line"></span><br><span class="line">$ chmod +x /etc/rc.d/init.d/ss5</span><br><span class="line"></span><br><span class="line"># 修改 /etc/opt/ss5/ss5.conf 文件</span><br><span class="line"># 去掉 auth 和 permit 前面的注释</span><br><span class="line"></span><br><span class="line">$ service ss5 start</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<hr>
<h3 id="修改ss5启动的参数，自定义代理端口"><a href="#修改ss5启动的参数，自定义代理端口" class="headerlink" title="修改ss5启动的参数，自定义代理端口"></a>修改ss5启动的参数，自定义代理端口</h3><p>默认是1080</p>
<p>修改文件 <strong>&#x2F;etc&#x2F;sysconfig&#x2F;ss5</strong><br>将</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#SS5_OPTS=” -u root”</span><br></pre></td></tr></table></figure>

<p>取消注释，修改成下面这样</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SS5_OPTS=&quot; -u root -b 0.0.0.0:10808&quot;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="防火墙配置"><a href="#防火墙配置" class="headerlink" title="防火墙配置"></a>防火墙配置</h2><p>开放一个端口</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --zone=public --add-port=1080/tcp --permanent</span><br></pre></td></tr></table></figure>

<p>重新加载防火墙规则并保存状态信息</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --reload</span><br></pre></td></tr></table></figure>

<p>查看已经开放的端口</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd --list-ports</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="浏览器使用socks5-代理不能设置用户名密码的问题"><a href="#浏览器使用socks5-代理不能设置用户名密码的问题" class="headerlink" title="浏览器使用socks5 代理不能设置用户名密码的问题"></a>浏览器使用socks5 代理不能设置用户名密码的问题</h2><p>firefox浏览器安装FoxyProxy Standard 扩展  </p>
<p><a target="_blank" rel="noopener" href="https://addons.mozilla.org/zh-CN/firefox/addon/foxyproxy-standard/">https://addons.mozilla.org/zh-CN/firefox/addon/foxyproxy-standard/</a></p>
<hr>
<h2 id="服务启动失败的问题"><a href="#服务启动失败的问题" class="headerlink" title="服务启动失败的问题"></a>服务启动失败的问题</h2><p>服务器启动失败时，查看服务状态</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># service ss5 status</span><br><span class="line">● ss5.service - SYSV: This script takes care of starting and stopping ss5</span><br><span class="line">   Loaded: loaded (/etc/rc.d/init.d/ss5; bad; vendor preset: disabled)</span><br><span class="line">   Active: active (exited) since Mon 2018-05-28 16:51:10 CST; 1min 29s ago</span><br><span class="line">     Docs: man:systemd-sysv-generator(8)</span><br><span class="line">  Process: 32456 ExecStart=/etc/rc.d/init.d/ss5 start (code=exited, status=0/SUCCESS)</span><br><span class="line"></span><br><span class="line">May 28 16:51:10 MyCloudServer ss5[32456]: [29B blob data]</span><br><span class="line">May 28 16:51:10 MyCloudServer ss5[32456]: Can&#x27;t create pid file /var/run/ss5/ss5.pid</span><br><span class="line">May 28 16:51:10 MyCloudServer ss5[32456]: Can&#x27;t unlink pid file /var/run/ss5/ss5.pid</span><br></pre></td></tr></table></figure>
<p>发现不能创建pid文件，原因是父级目录没有创建好</p>
<p>创建一下即可：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir /var/run/ss5/</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://wangwen135.github.io/%E7%BD%91%E7%BB%9C%E4%B8%8E%E5%AE%89%E5%85%A8/%E4%BB%A3%E7%90%86/CentOS%207%20%E5%AE%89%E8%A3%85%20Tor/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="王某某">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="王某某的笔记">
      <meta itemprop="description" content="这是一个使用 Hexo 构建的博客，用于分享我的编程经验和学习笔记。">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 王某某的笔记">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/%E7%BD%91%E7%BB%9C%E4%B8%8E%E5%AE%89%E5%85%A8/%E4%BB%A3%E7%90%86/CentOS%207%20%E5%AE%89%E8%A3%85%20Tor/" class="post-title-link" itemprop="url">CentOS 7 安装 Tor</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-11-23 00:00:00" itemprop="dateCreated datePublished" datetime="2017-11-23T00:00:00+08:00">2017-11-23</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%BD%91%E7%BB%9C%E4%B8%8E%E5%AE%89%E5%85%A8/" itemprop="url" rel="index"><span itemprop="name">网络与安全</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%BD%91%E7%BB%9C%E4%B8%8E%E5%AE%89%E5%85%A8/%E4%BB%A3%E7%90%86/" itemprop="url" rel="index"><span itemprop="name">代理</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>132</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>1 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install tor</span><br></pre></td></tr></table></figure>

<p>如果yum中没有tor，请安装epel源：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">yum install epel-release</span><br><span class="line"></span><br><span class="line">#安装完成之后可以通过下面的命令查看</span><br><span class="line">yum repolist</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#可以看到多了一个</span><br><span class="line">#Extra Packages for Enterprise Linux 7 - x86_64</span><br></pre></td></tr></table></figure>

<p>修改配置文件：&#x2F;etc&#x2F;tor&#x2F;torrc 指定服务绑定IP和端口：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SOCKSPort 0.0.0.0:9150</span><br></pre></td></tr></table></figure>

<p>启动服务：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Systemctl start tor</span><br></pre></td></tr></table></figure>

<p>检查上方配置文件中指定的端口是否正在监听：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netstat -an | grep 9150</span><br></pre></td></tr></table></figure>

<p>检查防火墙设置，确保服务器能正常连接到VPS上的Tor服务端口。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://wangwen135.github.io/%E7%BD%91%E7%BB%9C%E4%B8%8E%E5%AE%89%E5%85%A8/%E4%BB%A3%E7%90%86/Ubuntu%20%E5%AE%89%E8%A3%85%20%E6%9C%80%E6%96%B0%20TOR/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="王某某">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="王某某的笔记">
      <meta itemprop="description" content="这是一个使用 Hexo 构建的博客，用于分享我的编程经验和学习笔记。">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 王某某的笔记">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/%E7%BD%91%E7%BB%9C%E4%B8%8E%E5%AE%89%E5%85%A8/%E4%BB%A3%E7%90%86/Ubuntu%20%E5%AE%89%E8%A3%85%20%E6%9C%80%E6%96%B0%20TOR/" class="post-title-link" itemprop="url">Ubuntu-安装-最新-TOR</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-11-23 00:00:00" itemprop="dateCreated datePublished" datetime="2017-11-23T00:00:00+08:00">2017-11-23</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%BD%91%E7%BB%9C%E4%B8%8E%E5%AE%89%E5%85%A8/" itemprop="url" rel="index"><span itemprop="name">网络与安全</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%BD%91%E7%BB%9C%E4%B8%8E%E5%AE%89%E5%85%A8/%E4%BB%A3%E7%90%86/" itemprop="url" rel="index"><span itemprop="name">代理</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>318</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>1 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p><a target="_blank" rel="noopener" href="https://www.torproject.org/download/download-unix.html.en">https://www.torproject.org/download/download-unix.html.en</a></p>
<p>按照这个站点上的进行操作</p>
<hr>
<p>系统：Ubuntu</p>
<hr>
<p>1、先设置软件包存储库，然后才能获取Tor</p>
<p>2、弄清楚你的发行版的名字</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ lsb_release -c</span><br><span class="line">Codename:       precise</span><br><span class="line"></span><br><span class="line">cat /etc/issue</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>3、先卸载之前安装的老版本<br>sudo apt-get remove package –purge 删除包，包括配置文件等</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get remove tor --purge</span><br></pre></td></tr></table></figure>

<p>4、系统比较老，先升级</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">apt-get dist-upgrade</span><br><span class="line"></span><br><span class="line">do-release-upgrade</span><br></pre></td></tr></table></figure>

<p>在&#x2F;etc&#x2F;apt&#x2F;sources.list.d&#x2F;下添加一个新文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi torproject.list</span><br></pre></td></tr></table></figure>
<p>内容如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">deb http://deb.torproject.org/torproject.org xenial main</span><br><span class="line">deb-src http://deb.torproject.org/torproject.org xenial main</span><br></pre></td></tr></table></figure>
<p>或者</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">deb http://deb.torproject.org/torproject.org trusty main</span><br><span class="line">deb-src http://deb.torproject.org/torproject.org trusty main</span><br></pre></td></tr></table></figure>


<p>然后通过在命令提示符处运行以下命令来添加用于签署软件包的gpg密钥：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gpg --keyserver keys.gnupg.net --recv A3C4F0F979CAA22CDBA8F512EE8CBC9E886DDD89</span><br><span class="line">gpg --export A3C4F0F979CAA22CDBA8F512EE8CBC9E886DDD89 | sudo apt-key add -</span><br></pre></td></tr></table></figure>

<p>更新并安装</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ apt update</span><br><span class="line">$ apt install tor</span><br></pre></td></tr></table></figure>


<p>有可能会</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">W: 无法下载 http://deb.torproject.org/torproject.org/dists/xenial/InRelease  无法连接上 deb.torproject.org:80 (31.13.84.8)，连接超时</span><br><span class="line">W: 部分索引文件下载失败。如果忽略它们，那将转而使用旧的索引文件。</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<p>我们提供了一个Debian软件包来帮助您保持我们的签名密钥。建议您使用它。安装它使用：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">apt-get install deb.torproject.org-keyring</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>修改配置：&#x2F;etc&#x2F;tor&#x2F;torrc</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SOCKSPort 0.0.0.0:9150</span><br></pre></td></tr></table></figure>

<p>重启服务：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">service tor restart</span><br><span class="line"></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://wangwen135.github.io/java/Swing/javaSwing%E7%94%BB%E7%9B%91%E6%8E%A7%E9%9D%A2%E6%9D%BF/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="王某某">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="王某某的笔记">
      <meta itemprop="description" content="这是一个使用 Hexo 构建的博客，用于分享我的编程经验和学习笔记。">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 王某某的笔记">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/java/Swing/javaSwing%E7%94%BB%E7%9B%91%E6%8E%A7%E9%9D%A2%E6%9D%BF/" class="post-title-link" itemprop="url">java画监控面板</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2017-08-02 23:41:00" itemprop="dateCreated datePublished" datetime="2017-08-02T23:41:00+08:00">2017-08-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Java/" itemprop="url" rel="index"><span itemprop="name">Java</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Java/Swing/" itemprop="url" rel="index"><span itemprop="name">Swing</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>3.8k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>14 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p><img src="https://img.wangwen135.top:23456/note/2024/08/66ac92c406c4c.png" alt="1722585790528.png"></p>
<h3 id="画面板-MonitorPanel"><a href="#画面板-MonitorPanel" class="headerlink" title="画面板 MonitorPanel"></a>画面板 MonitorPanel</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br></pre></td><td class="code"><pre><span class="line">package com.wwh.test.swing.monitor;</span><br><span class="line"></span><br><span class="line">import java.awt.Color;</span><br><span class="line">import java.awt.Font;</span><br><span class="line">import java.awt.FontMetrics;</span><br><span class="line">import java.awt.Graphics;</span><br><span class="line">import java.awt.Graphics2D;</span><br><span class="line">import java.awt.image.BufferedImage;</span><br><span class="line">import java.text.SimpleDateFormat;</span><br><span class="line">import java.util.Date;</span><br><span class="line">import java.util.List;</span><br><span class="line"></span><br><span class="line">import javax.swing.JPanel;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * &lt;pre&gt;</span><br><span class="line"> * 有XY轴的曲线图监控面板</span><br><span class="line"> * </span><br><span class="line"> * &lt;pre&gt;</span><br><span class="line"> * </span><br><span class="line"> * @author 313921</span><br><span class="line"> * @date 2015-01-28 22:11:04</span><br><span class="line"> */</span><br><span class="line">public class MonitorPanel extends JPanel implements MonitorPanelModelListener &#123;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 最合适的Y轴线条高度间距</span><br><span class="line">     */</span><br><span class="line">    private static final int bastYAxisLineHeightInterval = 26;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * X轴上默认的线与线之间的像素</span><br><span class="line">     */</span><br><span class="line">    public static final int DEFAULT_X_AXIS_LINE_INTERVAL = 70;</span><br><span class="line">    /**</span><br><span class="line">     * 默认的当前值文本宽度</span><br><span class="line">     */</span><br><span class="line">    private static final int defaultCurrentTextWidth = 50;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 最少的Y轴线条数量</span><br><span class="line">     */</span><br><span class="line">    private static final int minYAxisLineCount = 3;</span><br><span class="line"></span><br><span class="line">    private static final long serialVersionUID = 1L;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 图片</span><br><span class="line">     */</span><br><span class="line">    private BufferedImage bufferImage;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 显示当前值的文本宽度</span><br><span class="line">     */</span><br><span class="line">    private int currentTextWidth = 50;</span><br><span class="line"></span><br><span class="line">    private MonitorPanelModel dataModel;</span><br><span class="line"></span><br><span class="line">    private SimpleDateFormat dateF = new SimpleDateFormat(&quot;HH:mm&quot;);</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 是否显示最后一个值</span><br><span class="line">     */</span><br><span class="line">    private boolean displayLastValue = true;</span><br><span class="line"></span><br><span class="line">    private boolean drawEmptyGraph = true;</span><br><span class="line"></span><br><span class="line">    private Color fontColor = Color.BLACK;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 曲线区域的背景颜色</span><br><span class="line">     */</span><br><span class="line">    private Color graphBackgroundColor = new Color(0, 100, 0);</span><br><span class="line"></span><br><span class="line">    private Graphics2D graphics;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 曲线的颜色</span><br><span class="line">     */</span><br><span class="line">    private Color graphLineColor = new Color(250, 0, 0);</span><br><span class="line"></span><br><span class="line">    private String graphTitle = &quot;监控面板&quot;;</span><br><span class="line"></span><br><span class="line">    private Color gridLineColor = new Color(0, 0, 0);</span><br><span class="line">    /**</span><br><span class="line">     * 图片的高度</span><br><span class="line">     */</span><br><span class="line">    private int imgHeight;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 图片的宽度，整个组件就是一个画上去的图片</span><br><span class="line">     */</span><br><span class="line">    private int imgWidth;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 标题字体</span><br><span class="line">     */</span><br><span class="line">    private Font titleFont = new Font(&quot;宋体&quot;, Font.BOLD, 14);</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 标题颜色</span><br><span class="line">     */</span><br><span class="line">    private Color titleFontColor = Color.BLACK;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 标题的高度</span><br><span class="line">     */</span><br><span class="line">    private int titleHeight = 20;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * X轴上的线与线之间的像素</span><br><span class="line">     */</span><br><span class="line">    private int xAxisLineInterval = DEFAULT_X_AXIS_LINE_INTERVAL;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * X轴上的一个与像素点的比例</span><br><span class="line">     */</span><br><span class="line">    private double xRatio;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * X轴的文本高度</span><br><span class="line">     */</span><br><span class="line">    private int XTextHeight = 20;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * Y轴上一个与像素点的比例</span><br><span class="line">     */</span><br><span class="line">    private double yRatio;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * Y轴的文本宽度</span><br><span class="line">     */</span><br><span class="line">    private int YTextWidth = 40;</span><br><span class="line"></span><br><span class="line">    public MonitorPanel() &#123;</span><br><span class="line">        this(null);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public MonitorPanel(MonitorPanelModel model) &#123;</span><br><span class="line">        if (model == null) &#123;</span><br><span class="line">            model = new MonitorPanelModel();</span><br><span class="line">        &#125;</span><br><span class="line">        setModel(model);</span><br><span class="line">        updateUI();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * &lt;pre&gt;</span><br><span class="line">     * 计算X轴的比例</span><br><span class="line">     * &lt;/pre&gt;</span><br><span class="line">     */</span><br><span class="line">    private void calcXRatio() &#123;</span><br><span class="line">        Long maxXCoords = dataModel.getMaxXCoords();</span><br><span class="line">        if (maxXCoords == null) &#123;</span><br><span class="line">            return;</span><br><span class="line">        &#125;</span><br><span class="line">        Long minXCoords = dataModel.getMinXCoords();</span><br><span class="line">        if (minXCoords == null) &#123;</span><br><span class="line">            return;</span><br><span class="line">        &#125;</span><br><span class="line">        // 曲线图的宽度</span><br><span class="line">        int graphWidth = getGraphWidth();</span><br><span class="line">        if (graphWidth &lt;= 0) &#123;</span><br><span class="line">            xRatio = 0;</span><br><span class="line">            return;</span><br><span class="line">        &#125;</span><br><span class="line">        long xv = maxXCoords - minXCoords;</span><br><span class="line">        // 得到比例</span><br><span class="line">        xRatio = (double) graphWidth / (double) xv;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * &lt;pre&gt;</span><br><span class="line">     * 计算Y轴比例 </span><br><span class="line">     * 既：值与显示区域的像素的比例</span><br><span class="line">     * &lt;/pre&gt;</span><br><span class="line">     */</span><br><span class="line">    private void calcYRatio() &#123;</span><br><span class="line">        Long maxYCoords = dataModel.getMaxYCoords();</span><br><span class="line">        if (maxYCoords == null) &#123;</span><br><span class="line">            return;</span><br><span class="line">        &#125;</span><br><span class="line">        Long minYCoords = dataModel.getMinYCoords();</span><br><span class="line">        if (minYCoords == null) &#123;</span><br><span class="line">            return;</span><br><span class="line">        &#125;</span><br><span class="line">        // 计算曲线图的高度</span><br><span class="line">        int graphHeight = getGraphHeight();</span><br><span class="line"></span><br><span class="line">        if (graphHeight &lt;= 0) &#123;</span><br><span class="line">            yRatio = 0;</span><br><span class="line">            return;</span><br><span class="line">        &#125;</span><br><span class="line">        long yd = maxYCoords - minYCoords;// Y轴</span><br><span class="line">        if (yd &lt;= 0) &#123;</span><br><span class="line">            yRatio = 0;</span><br><span class="line">            return;</span><br><span class="line">        &#125;</span><br><span class="line">        yRatio = (double) graphHeight / (double) yd;// 得到比例</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private void clearBufferImage() &#123;</span><br><span class="line">        graphics.setBackground(getBackground());</span><br><span class="line">        graphics.clearRect(0, 0, imgWidth, imgHeight);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private void drawDefaultXAxis() &#123;</span><br><span class="line">        int graphWidth = getGraphWidth();</span><br><span class="line">        int graphHeight = getGraphHeight();</span><br><span class="line">        // 每隔一定的像素画一条竖线</span><br><span class="line">        graphics.setColor(gridLineColor);</span><br><span class="line"></span><br><span class="line">        for (int i = YTextWidth + xAxisLineInterval; i &lt; YTextWidth + graphWidth; i += xAxisLineInterval) &#123;</span><br><span class="line">            graphics.drawLine(i, titleHeight, i, titleHeight + graphHeight);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private void drawDefaultYAxis() &#123;</span><br><span class="line">        // 每隔一定的像素画一条线</span><br><span class="line">        int graphWidth = getGraphWidth();</span><br><span class="line">        int graphHeight = getGraphHeight();</span><br><span class="line"></span><br><span class="line">        // 画横线</span><br><span class="line">        graphics.setColor(gridLineColor);</span><br><span class="line">        for (int i = graphHeight; i - bastYAxisLineHeightInterval &gt; 0; i -= bastYAxisLineHeightInterval) &#123;</span><br><span class="line">            int yPosition = i - bastYAxisLineHeightInterval + titleHeight;</span><br><span class="line">            graphics.drawLine(YTextWidth, yPosition, YTextWidth + graphWidth, yPosition);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 绘制曲线</span><br><span class="line">     */</span><br><span class="line">    private void drawGraph() &#123;</span><br><span class="line">        graphics.setColor(graphLineColor);</span><br><span class="line">        List&lt;Coordinate&gt; coordinatelist = dataModel.getCoordinatelist();</span><br><span class="line">        int size = coordinatelist.size();</span><br><span class="line">        if (size &lt; 2) &#123;</span><br><span class="line">            return;</span><br><span class="line">        &#125;</span><br><span class="line">        int[] xPoints = new int[size];</span><br><span class="line">        int[] yPoints = new int[size];</span><br><span class="line"></span><br><span class="line">        for (int i = 0; i &lt; size; i++) &#123;</span><br><span class="line">            xPoints[i] = getXPoint(coordinatelist.get(i).getxValue());</span><br><span class="line">            yPoints[i] = getYPoint(coordinatelist.get(i).getyValue());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        graphics.drawPolyline(xPoints, yPoints, size);</span><br><span class="line"></span><br><span class="line">        // 画一个当前值</span><br><span class="line">        Font font = graphics.getFont();</span><br><span class="line">        FontMetrics fm = graphics.getFontMetrics(font);</span><br><span class="line">        int descent = fm.getDescent();</span><br><span class="line">        graphics.setColor(fontColor);</span><br><span class="line">        int _yPoint = yPoints[size - 1];</span><br><span class="line">        int graphWidth = getGraphWidth();</span><br><span class="line">        int _xPoint = YTextWidth + graphWidth + 1;</span><br><span class="line">        long currentValue = coordinatelist.get(coordinatelist.size() - 1).getyValue();</span><br><span class="line">        String valueOf = String.valueOf(currentValue);</span><br><span class="line">        graphics.drawString(valueOf, _xPoint, _yPoint - descent);</span><br><span class="line">        graphics.drawLine(_xPoint, _yPoint, _xPoint + fm.stringWidth(valueOf), _yPoint);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * &lt;pre&gt;</span><br><span class="line">     * 画背景</span><br><span class="line">     * &lt;/pre&gt;</span><br><span class="line">     */</span><br><span class="line">    private void drawGraphBackgound() &#123;</span><br><span class="line">        int graphWidth = getGraphWidth();</span><br><span class="line">        int graphHeight = getGraphHeight();</span><br><span class="line"></span><br><span class="line">        graphics.setColor(graphBackgroundColor);</span><br><span class="line">        // big.fill3DRect(YTextWidth, titleHeight, imgWidth - YTextWidth</span><br><span class="line">        // - cutlineWidth, imgHeight - titleHeight - XTextHeight, false);</span><br><span class="line"></span><br><span class="line">        // 填充指定的矩形。该矩形左边缘和右边缘分别位于 x 和 x + width - 1。上边缘和下边缘分别位于 y 和 y + height -</span><br><span class="line">        // 1。得到的矩形覆盖 width 像素宽乘以 height 像素高的区域。使用图形上下文的当前颜色填充该矩形。</span><br><span class="line">        graphics.fillRect(YTextWidth, titleHeight, graphWidth, graphHeight);</span><br><span class="line"></span><br><span class="line">        graphics.setColor(gridLineColor);</span><br><span class="line">        // 绘制指定矩形的边框。矩形的左边缘和右边缘分别位于 x 和 x + width。上边缘和下边缘分别位于 y 和 y +</span><br><span class="line">        // height。使用图形上下文的当前颜色绘制该矩形。</span><br><span class="line">        graphics.drawRect(YTextWidth, titleHeight, graphWidth, graphHeight);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * &lt;pre&gt;</span><br><span class="line">     * 将内容画在图片上</span><br><span class="line">     * &lt;/pre&gt;</span><br><span class="line">     */</span><br><span class="line">    private void drawImage() &#123;</span><br><span class="line">        int tw = getWidth();</span><br><span class="line">        int th = getHeight();</span><br><span class="line">        if (tw != imgWidth || th != imgHeight) &#123;</span><br><span class="line">            // 大小有变化，重建一张图片</span><br><span class="line">            imgWidth = tw;</span><br><span class="line">            imgHeight = th;</span><br><span class="line">            bufferImage = new BufferedImage(imgWidth, imgHeight, BufferedImage.TYPE_INT_RGB);</span><br><span class="line">            graphics = bufferImage.createGraphics();</span><br><span class="line">        &#125;</span><br><span class="line">        if (bufferImage == null) &#123;</span><br><span class="line">            return;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        // 先清空图片</span><br><span class="line">        clearBufferImage();</span><br><span class="line"></span><br><span class="line">        // 画标题</span><br><span class="line">        drawTitle();</span><br><span class="line"></span><br><span class="line">        // 画内容区域 背景</span><br><span class="line">        drawGraphBackgound();</span><br><span class="line"></span><br><span class="line">        // 获取XY轴上的线</span><br><span class="line">        long[] xLine = dataModel.getXAxisLines(getBestXAxisLineCount());</span><br><span class="line">        long[] yLine = dataModel.getYAxisLines(getBestYAxisLineCount());</span><br><span class="line"></span><br><span class="line">        // 计算X 和 Y 的比例</span><br><span class="line">        calcYRatio();</span><br><span class="line">        calcXRatio();</span><br><span class="line"></span><br><span class="line">        // 画X坐标</span><br><span class="line">        if (xLine != null) &#123;</span><br><span class="line">            drawXAxis(xLine);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            if (drawEmptyGraph) &#123;</span><br><span class="line">                // 画缺省的X坐标</span><br><span class="line">                drawDefaultXAxis();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        // 画Y坐标</span><br><span class="line">        if (yLine != null) &#123;</span><br><span class="line">            drawYAxis(yLine);</span><br><span class="line">        &#125; else if (drawEmptyGraph) &#123;</span><br><span class="line">            // 画缺省的Y坐标</span><br><span class="line">            drawDefaultYAxis();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        // 画曲线</span><br><span class="line">        drawGraph();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * &lt;pre&gt;</span><br><span class="line">     * 画标题</span><br><span class="line">     * &lt;/pre&gt;</span><br><span class="line">     */</span><br><span class="line">    private void drawTitle() &#123;</span><br><span class="line">        if (graphTitle == null || graphTitle.isEmpty() || titleHeight &lt; 1) &#123;</span><br><span class="line">            return;</span><br><span class="line">        &#125;</span><br><span class="line">        graphics.setColor(titleFontColor);</span><br><span class="line">        graphics.setFont(titleFont);</span><br><span class="line">        FontMetrics fm = graphics.getFontMetrics(titleFont);</span><br><span class="line">        int titleWidth = fm.stringWidth(graphTitle);</span><br><span class="line"></span><br><span class="line">        int graphWidth = getGraphWidth();</span><br><span class="line">        int titleX = (graphWidth - titleWidth) / 2 + YTextWidth;</span><br><span class="line">        graphics.drawString(graphTitle, titleX, fm.getAscent());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * &lt;pre&gt;</span><br><span class="line">     * 画X轴</span><br><span class="line">     * &lt;/pre&gt;</span><br><span class="line">     */</span><br><span class="line">    private void drawXAxis(long[] xLine) &#123;</span><br><span class="line">        if (xLine == null) &#123;</span><br><span class="line">            return;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Font font = graphics.getFont();</span><br><span class="line">        FontMetrics fm = graphics.getFontMetrics(font);</span><br><span class="line">        int ascent = fm.getAscent();</span><br><span class="line">        // int descent = fm.getDescent();</span><br><span class="line">        // int fHeight = fm.getHeight();</span><br><span class="line"></span><br><span class="line">        int graphHeight = getGraphHeight();</span><br><span class="line"></span><br><span class="line">        // 画X坐标</span><br><span class="line">        for (long l : xLine) &#123;</span><br><span class="line">            int xPoint = getXPoint(l);</span><br><span class="line"></span><br><span class="line">            graphics.setColor(gridLineColor);</span><br><span class="line">            graphics.drawLine(xPoint, titleHeight, xPoint, titleHeight + graphHeight);</span><br><span class="line"></span><br><span class="line">            Date date = new Date(l);</span><br><span class="line">            String dateStr = dateF.format(date);</span><br><span class="line"></span><br><span class="line">            graphics.setColor(fontColor);</span><br><span class="line">            graphics.drawString(dateStr, xPoint, titleHeight + graphHeight + ascent);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * &lt;pre&gt;</span><br><span class="line">     * 画Y轴</span><br><span class="line">     * &lt;/pre&gt;</span><br><span class="line">     */</span><br><span class="line">    private void drawYAxis(long[] yLine) &#123;</span><br><span class="line">        if (yLine == null) &#123;</span><br><span class="line">            return;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Font font = graphics.getFont();</span><br><span class="line">        FontMetrics fm = graphics.getFontMetrics(font);</span><br><span class="line">        int descent = fm.getDescent();</span><br><span class="line">        // 先设置字体</span><br><span class="line">        graphics.setFont(font);</span><br><span class="line"></span><br><span class="line">        // 画最大值</span><br><span class="line">        // String maxYStr = String.valueOf(maxY);</span><br><span class="line">        // big.drawString(maxYStr, YTextWidth - fm.stringWidth(maxYStr) - 1,</span><br><span class="line">        // titleHeight + descent);</span><br><span class="line">        // // 画最小值</span><br><span class="line">        // String minYStr = String.valueOf(minY);</span><br><span class="line">        // big.drawString(minYStr, YTextWidth - fm.stringWidth(minYStr) - 1,</span><br><span class="line">        // titleHeight + graphHeight);</span><br><span class="line"></span><br><span class="line">        int graphWidth = getGraphWidth();</span><br><span class="line"></span><br><span class="line">        for (long l : yLine) &#123;</span><br><span class="line">            String yNumberStr = String.valueOf(l);</span><br><span class="line">            int yPosition = getYPoint(l);</span><br><span class="line">            if (YTextWidth &gt; 0) &#123;</span><br><span class="line">                // 数字</span><br><span class="line">                graphics.setColor(fontColor);</span><br><span class="line">                graphics.drawString(yNumberStr, YTextWidth - fm.stringWidth(yNumberStr) - 1, yPosition + descent);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            // 画横线</span><br><span class="line">            graphics.setColor(gridLineColor);</span><br><span class="line">            graphics.drawLine(YTextWidth, yPosition, YTextWidth + graphWidth, yPosition);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private int getBestXAxisLineCount() &#123;</span><br><span class="line">        // 在X轴能显示几条线</span><br><span class="line">        int lineCount = getGraphWidth() / xAxisLineInterval;</span><br><span class="line">        lineCount = lineCount &gt; 1 ? lineCount : 1;</span><br><span class="line">        return lineCount;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 根据坐标系高度计算最佳的横线条数</span><br><span class="line">     * </span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    private int getBestYAxisLineCount() &#123;</span><br><span class="line">        int lineCount = getGraphHeight() / bastYAxisLineHeightInterval;</span><br><span class="line">        lineCount = lineCount &gt; minYAxisLineCount ? lineCount : minYAxisLineCount;</span><br><span class="line">        return lineCount;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public int getCurrentTextWidth() &#123;</span><br><span class="line">        return currentTextWidth;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public boolean getDisplayLastValue() &#123;</span><br><span class="line">        return displayLastValue;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Color getFontColor() &#123;</span><br><span class="line">        return fontColor;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Color getGraphBackgroundColor() &#123;</span><br><span class="line">        return graphBackgroundColor;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 获取曲线图区域的高度</span><br><span class="line">     * </span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public int getGraphHeight() &#123;</span><br><span class="line">        if (bufferImage == null) &#123;</span><br><span class="line">            return 0;</span><br><span class="line">        &#125;</span><br><span class="line">        return bufferImage.getHeight() - titleHeight - XTextHeight;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Color getGraphLineColor() &#123;</span><br><span class="line">        return graphLineColor;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getGraphTitle() &#123;</span><br><span class="line">        return graphTitle;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 获取曲线图区域的宽度</span><br><span class="line">     * </span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public int getGraphWidth() &#123;</span><br><span class="line">        if (bufferImage == null) &#123;</span><br><span class="line">            return 0;</span><br><span class="line">        &#125;</span><br><span class="line">        return bufferImage.getWidth() - YTextWidth - currentTextWidth;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Color getGridLineColor() &#123;</span><br><span class="line">        return gridLineColor;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * &lt;pre&gt;</span><br><span class="line">     * 获取值对应X点坐标</span><br><span class="line">     * &lt;/pre&gt;</span><br><span class="line">     * </span><br><span class="line">     * @param value</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    private int getXPoint(long value) &#123;</span><br><span class="line">        Long minXCoords = dataModel.getMinXCoords();</span><br><span class="line">        long v = value - minXCoords;</span><br><span class="line">        int x = (int) (v * xRatio);</span><br><span class="line">        return x + YTextWidth;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * &lt;pre&gt;</span><br><span class="line">     * 获取值对应Y点坐标</span><br><span class="line">     * &lt;/pre&gt;</span><br><span class="line">     * </span><br><span class="line">     * @param value</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    private int getYPoint(long value) &#123;</span><br><span class="line">        Long minYCoords = dataModel.getMinYCoords();</span><br><span class="line">        long v = value - minYCoords;</span><br><span class="line">        int y = (int) (v * yRatio);</span><br><span class="line">        int graphHeight = getGraphHeight();</span><br><span class="line">        return graphHeight - y + titleHeight;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public boolean isDrawEmptyGraph() &#123;</span><br><span class="line">        return drawEmptyGraph;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void monitorPanelChanged(MonitorPanelModelEvent e) &#123;</span><br><span class="line">        repaint();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void paint(Graphics g) &#123;</span><br><span class="line">        super.paint(g);</span><br><span class="line"></span><br><span class="line">        drawImage();</span><br><span class="line">        // 用图片</span><br><span class="line">        if (bufferImage != null) &#123;</span><br><span class="line">            g.drawImage(bufferImage, 0, 0, this);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setCurrentTextWidth(int currentTextWidth) &#123;</span><br><span class="line">        this.currentTextWidth = currentTextWidth;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setDisplayLastValue(boolean display) &#123;</span><br><span class="line">        displayLastValue = display;</span><br><span class="line">        if (display) &#123;</span><br><span class="line">            currentTextWidth = defaultCurrentTextWidth;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            currentTextWidth = 0;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setDrawEmptyGraph(boolean drawEmptyGraph) &#123;</span><br><span class="line">        this.drawEmptyGraph = drawEmptyGraph;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setFontColor(Color fontColor) &#123;</span><br><span class="line">        this.fontColor = fontColor;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setGraphBackgroundColor(Color graphBackgroundColor) &#123;</span><br><span class="line">        this.graphBackgroundColor = graphBackgroundColor;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setGraphLineColor(Color graphLineColor) &#123;</span><br><span class="line">        this.graphLineColor = graphLineColor;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setGraphTitle(String title) &#123;</span><br><span class="line">        this.graphTitle = title;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setGridLineColor(Color gridLineColor) &#123;</span><br><span class="line">        this.gridLineColor = gridLineColor;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setModel(MonitorPanelModel model) &#123;</span><br><span class="line">        if (model == null) &#123;</span><br><span class="line">            throw new IllegalArgumentException(&quot;不能为空&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        if (this.dataModel != model) &#123;</span><br><span class="line">            MonitorPanelModel old = this.dataModel;</span><br><span class="line">            if (old != null) &#123;</span><br><span class="line">                old.removeMonitorPanelModelListener(this);</span><br><span class="line">            &#125;</span><br><span class="line">            this.dataModel = model;</span><br><span class="line">            model.addMonitorPanelModelListener(this);</span><br><span class="line">            repaint();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="数据模型-MonitorPanelModel"><a href="#数据模型-MonitorPanelModel" class="headerlink" title="数据模型 MonitorPanelModel"></a>数据模型 MonitorPanelModel</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br></pre></td><td class="code"><pre><span class="line">package com.wwh.test.swing.monitor;</span><br><span class="line"></span><br><span class="line">import java.io.Serializable;</span><br><span class="line">import java.util.ArrayList;</span><br><span class="line">import java.util.Collections;</span><br><span class="line">import java.util.List;</span><br><span class="line"></span><br><span class="line">import javax.swing.event.EventListenerList;</span><br><span class="line"></span><br><span class="line">// 应该抽象出接口</span><br><span class="line">public class MonitorPanelModel implements Serializable &#123;</span><br><span class="line"></span><br><span class="line">    public enum XAxisMode &#123;</span><br><span class="line">        AUTO, FIXED, KEEP_MOVE</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public enum YAxisMode &#123;</span><br><span class="line">        AUTO, FIXED</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 默认的最大坐标点的数量1000</span><br><span class="line">     */</span><br><span class="line">    public static final int DEFAULT_MAX_COORDINATE_NUMBER = 1000;</span><br><span class="line">    private static final long serialVersionUID = 1L;</span><br><span class="line">    /**</span><br><span class="line">     * 坐标集合</span><br><span class="line">     */</span><br><span class="line">    private List&lt;Coordinate&gt; coordinatelist;</span><br><span class="line">    /**</span><br><span class="line">     * 使X轴呈现一个向左边移动的效果&lt;br&gt;</span><br><span class="line">     * 需要指定一个时间段</span><br><span class="line">     */</span><br><span class="line">    private Long keepMoveTimeInterval;</span><br><span class="line">    private EventListenerList listenerList = new EventListenerList();</span><br><span class="line">    /**</span><br><span class="line">     * 最大的坐标点个数</span><br><span class="line">     */</span><br><span class="line">    private int maxCoordinateCount = DEFAULT_MAX_COORDINATE_NUMBER;</span><br><span class="line">    /**</span><br><span class="line">     * 最大X坐标</span><br><span class="line">     */</span><br><span class="line">    private Long maxXCoords;</span><br><span class="line">    /**</span><br><span class="line">     * X轴上的最大值</span><br><span class="line">     */</span><br><span class="line">    private Long maxXValue;</span><br><span class="line">    /**</span><br><span class="line">     * 最大Y坐标</span><br><span class="line">     */</span><br><span class="line">    private Long maxYCoords;</span><br><span class="line">    /**</span><br><span class="line">     * Y轴上的最大值</span><br><span class="line">     */</span><br><span class="line">    private Long maxYValue;</span><br><span class="line">    /**</span><br><span class="line">     * 最小X坐标</span><br><span class="line">     */</span><br><span class="line">    private Long minXCoords;</span><br><span class="line">    /**</span><br><span class="line">     * X轴上的最小值</span><br><span class="line">     */</span><br><span class="line">    private Long minXValue;</span><br><span class="line">    /**</span><br><span class="line">     * 最小Y坐标</span><br><span class="line">     */</span><br><span class="line">    private Long minYCoords;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * Y轴上的最小值</span><br><span class="line">     */</span><br><span class="line">    private Long minYValue;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 记录一个开始的时间</span><br><span class="line">     */</span><br><span class="line">    private Long startTime;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * X 轴间距</span><br><span class="line">     */</span><br><span class="line">    private Long xAxisInterval;</span><br><span class="line"></span><br><span class="line">    private XAxisMode xAxisMode = XAxisMode.AUTO;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * Y轴间距</span><br><span class="line">     */</span><br><span class="line">    private Long yAxisInterval;</span><br><span class="line"></span><br><span class="line">    private YAxisMode yAxisMode = YAxisMode.AUTO;</span><br><span class="line"></span><br><span class="line">    public MonitorPanelModel() &#123;</span><br><span class="line">        coordinatelist = new ArrayList&lt;Coordinate&gt;();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void addCoordinate(Coordinate coordinate) &#123;</span><br><span class="line">        coordinatelist.add(coordinate);</span><br><span class="line">        if (coordinatelist.size() &gt; maxCoordinateCount) &#123;</span><br><span class="line">            coordinatelist.remove(0);</span><br><span class="line">            fireMonitorPanelDataChanged();</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            fireMonitorPanelDataAdd(coordinate);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void addMonitorPanelModelListener(MonitorPanelModelListener l) &#123;</span><br><span class="line">        listenerList.add(MonitorPanelModelListener.class, l);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 根据间隔计算Y轴上的线条数量</span><br><span class="line">     * </span><br><span class="line">     * @param interval</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    private int calcLineCountByInterval(long interval) &#123;</span><br><span class="line">        // 计算Y轴的最大值</span><br><span class="line">        long tmp = maxYValue / interval;</span><br><span class="line">        maxYCoords = tmp * interval;</span><br><span class="line">        if (maxYCoords &lt; maxYValue) &#123;</span><br><span class="line">            maxYCoords += interval;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        tmp = minYValue / interval;</span><br><span class="line">        minYCoords = tmp * interval;</span><br><span class="line">        if (minYCoords &gt; minYValue) &#123;</span><br><span class="line">            minYCoords -= interval;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        long line = (maxYCoords - minYCoords) / interval;</span><br><span class="line"></span><br><span class="line">        yAxisInterval = interval;</span><br><span class="line"></span><br><span class="line">        return (int) line;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void clearCoordinate() &#123;</span><br><span class="line">        coordinatelist.clear();</span><br><span class="line">        fireMonitorPanelDataChanged();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private void fireMonitorPanelChanged(MonitorPanelModelEvent e) &#123;</span><br><span class="line">        Object[] listeners = listenerList.getListenerList();</span><br><span class="line">        for (int i = listeners.length - 2; i &gt;= 0; i -= 2) &#123;</span><br><span class="line">            if (listeners[i] == MonitorPanelModelListener.class) &#123;</span><br><span class="line">                ((MonitorPanelModelListener) listeners[i + 1]).monitorPanelChanged(e);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private void fireMonitorPanelDataAdd(Coordinate coordinate) &#123;</span><br><span class="line">        refreshValue(coordinate);</span><br><span class="line">        fireMonitorPanelChanged(new MonitorPanelModelEvent(this));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private void fireMonitorPanelDataChanged() &#123;</span><br><span class="line">        // 刷新数据</span><br><span class="line">        refreshAllValue();</span><br><span class="line">        fireMonitorPanelChanged(new MonitorPanelModelEvent(this));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private void fireMonitorPanelPropertyChanged(String property, Object oldValue, Object newValue) &#123;</span><br><span class="line">        // 属性先不管</span><br><span class="line">        fireMonitorPanelChanged(new MonitorPanelModelEvent(this));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private long[] getAutoXAxisLines(int bestXLineCount) &#123;</span><br><span class="line">        if (maxXValue == null || minXValue == null) &#123;</span><br><span class="line">            return null;</span><br><span class="line">        &#125;</span><br><span class="line">        long differ = maxXValue - minXValue;</span><br><span class="line">        if (differ == 0) &#123;</span><br><span class="line">            return null;</span><br><span class="line">        &#125;</span><br><span class="line">        minXCoords = minXValue;</span><br><span class="line">        maxXCoords = maxXValue;</span><br><span class="line">        xAxisInterval = differ / bestXLineCount;</span><br><span class="line">        if (xAxisInterval &lt; 1) &#123;</span><br><span class="line">            return null;</span><br><span class="line">        &#125;</span><br><span class="line">        List&lt;Long&gt; l = new ArrayList&lt;&gt;();</span><br><span class="line">        long tmp = maxXCoords;</span><br><span class="line">        while (tmp &gt; minXCoords) &#123;</span><br><span class="line">            l.add(tmp);</span><br><span class="line">            tmp -= xAxisInterval;</span><br><span class="line">        &#125;</span><br><span class="line">        long[] ret = new long[l.size()];</span><br><span class="line">        for (int i = 0; i &lt; ret.length; i++) &#123;</span><br><span class="line">            ret[i] = l.get(i);</span><br><span class="line">        &#125;</span><br><span class="line">        return ret;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private long[] getAutoYAxisLines(int bestYLineCount) &#123;</span><br><span class="line">        if (maxYValue == null || minYValue == null) &#123;</span><br><span class="line">            return null;</span><br><span class="line">        &#125;</span><br><span class="line">        long differValue = maxYValue - minYValue;</span><br><span class="line">        if (differValue == 0) &#123;</span><br><span class="line">            // 此时可能是一条横线</span><br><span class="line">            yAxisInterval = 1L;</span><br><span class="line">            long absMaxYValue = Math.abs(maxYValue);</span><br><span class="line">            if (absMaxYValue &gt; 10) &#123;</span><br><span class="line">                double log = Math.log10(absMaxYValue / 10);</span><br><span class="line">                // 四舍五入取整</span><br><span class="line">                log = Math.round(log);</span><br><span class="line">                // 间距</span><br><span class="line">                yAxisInterval = (long) Math.pow(10, log);</span><br><span class="line">            &#125;</span><br><span class="line">            maxYCoords = ((maxYValue / yAxisInterval) + 1) * yAxisInterval;</span><br><span class="line">            minYCoords = ((maxYValue / yAxisInterval) - 1) * yAxisInterval;</span><br><span class="line">            long middleValue = (maxYValue / yAxisInterval) * yAxisInterval;</span><br><span class="line">            return new long[] &#123; minYCoords, middleValue, maxYCoords &#125;;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        long interval = 1;</span><br><span class="line">        if (differValue &gt; 10) &#123;</span><br><span class="line">            double log = Math.log10(differValue / 10);</span><br><span class="line">            // 四舍五入取整</span><br><span class="line">            log = Math.round(log);</span><br><span class="line">            // 间距</span><br><span class="line">            interval = (long) Math.pow(10, log);</span><br><span class="line">        &#125;</span><br><span class="line">        readjustYAxis(interval, bestYLineCount);</span><br><span class="line"></span><br><span class="line">        // 返回Y轴上的坐标线</span><br><span class="line">        return getFixedYAxisLines();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public List&lt;Coordinate&gt; getCoordinatelist() &#123;</span><br><span class="line">        return Collections.unmodifiableList(coordinatelist);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public int getCoordinateSize() &#123;</span><br><span class="line">        return coordinatelist.size();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private long[] getFixedXAxisLines() &#123;</span><br><span class="line">        if (maxXCoords == null || minXCoords == null || xAxisInterval == null) &#123;</span><br><span class="line">            throw new IllegalArgumentException(&quot;固定模式下，最大值、最小值、间距都不能为空&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        List&lt;Long&gt; l = new ArrayList&lt;&gt;();</span><br><span class="line">        long tmp = minXCoords;</span><br><span class="line">        while (tmp &lt;= maxXCoords) &#123;</span><br><span class="line">            l.add(tmp);</span><br><span class="line">            tmp += xAxisInterval;</span><br><span class="line">        &#125;</span><br><span class="line">        long[] ret = new long[l.size()];</span><br><span class="line">        for (int i = 0; i &lt; ret.length; i++) &#123;</span><br><span class="line">            ret[i] = l.get(i);</span><br><span class="line">        &#125;</span><br><span class="line">        return ret;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private long[] getFixedYAxisLines() &#123;</span><br><span class="line">        if (maxYCoords == null || minYCoords == null || yAxisInterval == null) &#123;</span><br><span class="line">            throw new IllegalArgumentException(&quot;固定模式下，最大值、最小值、间距都不能为空&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        List&lt;Long&gt; l = new ArrayList&lt;&gt;();</span><br><span class="line">        long tmp = minYCoords;</span><br><span class="line">        while (tmp &lt;= maxYCoords) &#123;</span><br><span class="line">            l.add(tmp);</span><br><span class="line">            tmp += yAxisInterval;</span><br><span class="line">        &#125;</span><br><span class="line">        long[] ret = new long[l.size()];</span><br><span class="line">        for (int i = 0; i &lt; ret.length; i++) &#123;</span><br><span class="line">            ret[i] = l.get(i);</span><br><span class="line">        &#125;</span><br><span class="line">        return ret;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Long getKeepMoveTimeInterval() &#123;</span><br><span class="line">        return keepMoveTimeInterval;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private long[] getKeepMoveXAxisLines(int bestXLineCount) &#123;</span><br><span class="line">        if (keepMoveTimeInterval == null || keepMoveTimeInterval &lt; 1) &#123;</span><br><span class="line">            throw new IllegalArgumentException(&quot;移动模式下，固定的时间段不能为空或小于1&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        if (startTime == null) &#123;</span><br><span class="line">            startTime = System.currentTimeMillis();</span><br><span class="line">        &#125;</span><br><span class="line">        maxXCoords = System.currentTimeMillis();</span><br><span class="line">        minXCoords = maxXCoords - keepMoveTimeInterval;</span><br><span class="line"></span><br><span class="line">        xAxisInterval = keepMoveTimeInterval / bestXLineCount;</span><br><span class="line">        if (xAxisInterval &lt; 1) &#123;</span><br><span class="line">            return null;</span><br><span class="line">        &#125;</span><br><span class="line">        List&lt;Long&gt; l = new ArrayList&lt;&gt;();</span><br><span class="line">        long tmp = startTime;</span><br><span class="line">        while (tmp &lt;= maxXCoords) &#123;</span><br><span class="line">            if (tmp &gt;= minXCoords) &#123;</span><br><span class="line">                l.add(tmp);</span><br><span class="line">            &#125;</span><br><span class="line">            tmp += xAxisInterval;</span><br><span class="line">        &#125;</span><br><span class="line">        long[] ret = new long[l.size()];</span><br><span class="line">        for (int i = 0; i &lt; ret.length; i++) &#123;</span><br><span class="line">            ret[i] = l.get(i);</span><br><span class="line">        &#125;</span><br><span class="line">        return ret;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public int getMaxCoordinateCount() &#123;</span><br><span class="line">        return maxCoordinateCount;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Long getMaxXCoords() &#123;</span><br><span class="line">        return maxXCoords;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Long getMaxXValue() &#123;</span><br><span class="line">        return maxXValue;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Long getMaxYCoords() &#123;</span><br><span class="line">        return maxYCoords;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Long getMaxYValue() &#123;</span><br><span class="line">        return maxYValue;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Long getMinXCoords() &#123;</span><br><span class="line">        return minXCoords;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Long getMinXValue() &#123;</span><br><span class="line">        return minXValue;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Long getMinYCoords() &#123;</span><br><span class="line">        return minYCoords;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Long getMinYValue() &#123;</span><br><span class="line">        return minYValue;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public MonitorPanelModelListener[] getMonitorPanelModelListeners() &#123;</span><br><span class="line">        return listenerList.getListeners(MonitorPanelModelListener.class);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public long getXAxisFirstValue() &#123;</span><br><span class="line">        if (coordinatelist.isEmpty()) &#123;</span><br><span class="line">            return 0;</span><br><span class="line">        &#125;</span><br><span class="line">        return coordinatelist.get(0).getxValue();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Long getxAxisInterval() &#123;</span><br><span class="line">        return xAxisInterval;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public long getXAxisLastValue() &#123;</span><br><span class="line">        if (coordinatelist.isEmpty()) &#123;</span><br><span class="line">            return 0;</span><br><span class="line">        &#125;</span><br><span class="line">        return coordinatelist.get(coordinatelist.size() - 1).getxValue();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * X 轴上要画的竖线</span><br><span class="line">     * </span><br><span class="line">     * @param bestXLineCount 最佳的竖线条数</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public long[] getXAxisLines(int bestXLineCount) &#123;</span><br><span class="line"></span><br><span class="line">        switch (xAxisMode) &#123;</span><br><span class="line">        case AUTO:</span><br><span class="line">            return getAutoXAxisLines(bestXLineCount);</span><br><span class="line">        case FIXED:</span><br><span class="line">            return getFixedXAxisLines();</span><br><span class="line">        case KEEP_MOVE:</span><br><span class="line">            return getKeepMoveXAxisLines(bestXLineCount);</span><br><span class="line">        default:</span><br><span class="line">            return null;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public XAxisMode getxAxisMode() &#123;</span><br><span class="line">        return xAxisMode;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Long getyAxisInterval() &#123;</span><br><span class="line">        return yAxisInterval;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * Y 轴上要画的横线</span><br><span class="line">     * </span><br><span class="line">     * @param bestYLineCount 最佳的横线条数</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public long[] getYAxisLines(int bestYLineCount) &#123;</span><br><span class="line">        switch (yAxisMode) &#123;</span><br><span class="line">        case AUTO:</span><br><span class="line">            return getAutoYAxisLines(bestYLineCount);</span><br><span class="line">        case FIXED:</span><br><span class="line">            return getFixedYAxisLines();</span><br><span class="line">        default:</span><br><span class="line">            return null;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public YAxisMode getyAxisMode() &#123;</span><br><span class="line">        return yAxisMode;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 重新计算Y轴</span><br><span class="line">     * </span><br><span class="line">     * @param interval</span><br><span class="line">     */</span><br><span class="line">    private void readjustYAxis(long interval, int bestYLineCount) &#123;</span><br><span class="line">        // 先根据目前的间距计算一次Y轴的行数</span><br><span class="line">        int lineCount = calcLineCountByInterval(interval);</span><br><span class="line"></span><br><span class="line">        // 再尝试调整为最佳的</span><br><span class="line">        long newInterval = 0;</span><br><span class="line">        if (bestYLineCount &gt; lineCount) &#123;</span><br><span class="line">            // 减小间距</span><br><span class="line">            float f = (float) bestYLineCount / lineCount;</span><br><span class="line">            int p = Math.round(f);</span><br><span class="line">            if (p == 1) &#123;</span><br><span class="line">                return;</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                for (int i = p; i &gt; 1; i--) &#123;</span><br><span class="line">                    if (interval % i == 0) &#123;</span><br><span class="line">                        newInterval = interval / i;</span><br><span class="line">                        break;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            // 增加间距</span><br><span class="line">            float f = (float) lineCount / bestYLineCount;</span><br><span class="line">            int p = Math.round(f);</span><br><span class="line">            if (p == 1) &#123;</span><br><span class="line">                return;</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                newInterval = interval * p;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        if (newInterval != 0) &#123;</span><br><span class="line">            // 根据调整后的间距再算一次</span><br><span class="line">            lineCount = calcLineCountByInterval(newInterval);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private void refreshAllValue() &#123;</span><br><span class="line">        minXValue = null;</span><br><span class="line">        maxXValue = null;</span><br><span class="line">        minYValue = null;</span><br><span class="line">        maxYValue = null;</span><br><span class="line">        for (Coordinate coordinate : coordinatelist) &#123;</span><br><span class="line">            refreshValue(coordinate);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private void refreshValue(Coordinate coordinate) &#123;</span><br><span class="line">        long y = coordinate.getyValue();</span><br><span class="line">        long x = coordinate.getxValue();</span><br><span class="line">        if (maxYValue == null || y &gt; maxYValue) &#123;</span><br><span class="line">            maxYValue = y;</span><br><span class="line">        &#125;</span><br><span class="line">        if (minYValue == null || y &lt; minYValue) &#123;</span><br><span class="line">            minYValue = y;</span><br><span class="line">        &#125;</span><br><span class="line">        if (maxXValue == null || x &gt; maxXValue) &#123;</span><br><span class="line">            maxXValue = x;</span><br><span class="line">        &#125;</span><br><span class="line">        if (minXValue == null || x &lt; minXValue) &#123;</span><br><span class="line">            minXValue = x;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void removeMonitorPanelModelListener(MonitorPanelModelListener l) &#123;</span><br><span class="line">        listenerList.remove(MonitorPanelModelListener.class, l);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setCoordinatelist(List&lt;Coordinate&gt; coordinatelist) &#123;</span><br><span class="line">        if (coordinatelist == null) &#123;</span><br><span class="line">            throw new IllegalArgumentException(&quot;不能为空&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        this.coordinatelist = coordinatelist;</span><br><span class="line">        fireMonitorPanelDataChanged();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setKeepMoveTimeInterval(Long keepMoveTimeInterval) &#123;</span><br><span class="line">        fireMonitorPanelPropertyChanged(null, null, null);</span><br><span class="line">        this.keepMoveTimeInterval = keepMoveTimeInterval;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setMaxCoordinateCount(int maxCoordinateCount) &#123;</span><br><span class="line">        fireMonitorPanelPropertyChanged(null, null, null);</span><br><span class="line">        this.maxCoordinateCount = maxCoordinateCount;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setMaxXCoords(Long maxXCoords) &#123;</span><br><span class="line">        fireMonitorPanelPropertyChanged(null, null, null);</span><br><span class="line">        this.maxXCoords = maxXCoords;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setMaxYCoords(Long maxYCoords) &#123;</span><br><span class="line">        fireMonitorPanelPropertyChanged(null, null, null);</span><br><span class="line">        this.maxYCoords = maxYCoords;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setMinXCoords(Long minXCoords) &#123;</span><br><span class="line">        fireMonitorPanelPropertyChanged(null, null, null);</span><br><span class="line">        this.minXCoords = minXCoords;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setMinYCoords(Long minYCoords) &#123;</span><br><span class="line">        fireMonitorPanelPropertyChanged(null, null, null);</span><br><span class="line">        this.minYCoords = minYCoords;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setxAxisInterval(Long xAxisInterval) &#123;</span><br><span class="line">        fireMonitorPanelPropertyChanged(null, null, null);</span><br><span class="line">        this.xAxisInterval = xAxisInterval;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setxAxisMode(XAxisMode xAxisMode) &#123;</span><br><span class="line">        fireMonitorPanelPropertyChanged(null, null, null);</span><br><span class="line">        this.xAxisMode = xAxisMode;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setyAxisInterval(Long yAxisInterval) &#123;</span><br><span class="line">        fireMonitorPanelPropertyChanged(null, null, null);</span><br><span class="line">        this.yAxisInterval = yAxisInterval;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setyAxisMode(YAxisMode yAxisMode) &#123;</span><br><span class="line">        fireMonitorPanelPropertyChanged(null, null, null);</span><br><span class="line">        this.yAxisMode = yAxisMode;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="坐标-Coordinate"><a href="#坐标-Coordinate" class="headerlink" title="坐标 Coordinate"></a>坐标 Coordinate</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">package com.wwh.test.swing.monitor;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * &lt;pre&gt;</span><br><span class="line"> * xy坐标</span><br><span class="line"> * X轴 为 具体的值</span><br><span class="line"> * Y轴 为 时间</span><br><span class="line"> * &lt;/pre&gt;</span><br><span class="line"> * </span><br><span class="line"> * @author wwh</span><br><span class="line"> */</span><br><span class="line">public class Coordinate &#123;</span><br><span class="line"></span><br><span class="line">    private long xValue;</span><br><span class="line">    private long yValue;</span><br><span class="line"></span><br><span class="line">    public Coordinate(long x, long y) &#123;</span><br><span class="line">        this.xValue = x;</span><br><span class="line">        this.yValue = y;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public long getxValue() &#123;</span><br><span class="line">        return xValue;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setxValue(long xValue) &#123;</span><br><span class="line">        this.xValue = xValue;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public long getyValue() &#123;</span><br><span class="line">        return yValue;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setyValue(long yValue) &#123;</span><br><span class="line">        this.yValue = yValue;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="事件-MonitorPanelModelEvent"><a href="#事件-MonitorPanelModelEvent" class="headerlink" title="事件 MonitorPanelModelEvent"></a>事件 MonitorPanelModelEvent</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">package com.wwh.test.swing.monitor;</span><br><span class="line"></span><br><span class="line">public class MonitorPanelModelEvent extends java.util.EventObject &#123;</span><br><span class="line">    private static final long serialVersionUID = 1L;</span><br><span class="line"></span><br><span class="line">    public MonitorPanelModelEvent(Object source) &#123;</span><br><span class="line">        super(source);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="监听器接口-MonitorPanelModelListener"><a href="#监听器接口-MonitorPanelModelListener" class="headerlink" title="监听器接口 MonitorPanelModelListener"></a>监听器接口 MonitorPanelModelListener</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">package com.wwh.test.swing.monitor;</span><br><span class="line"></span><br><span class="line">public interface MonitorPanelModelListener extends java.util.EventListener &#123;</span><br><span class="line"></span><br><span class="line">    public void monitorPanelChanged(MonitorPanelModelEvent e);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="测试-MonitorPanelTest"><a href="#测试-MonitorPanelTest" class="headerlink" title="测试 MonitorPanelTest"></a>测试 MonitorPanelTest</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br></pre></td><td class="code"><pre><span class="line">package com.wwh.test.swing.monitor;</span><br><span class="line"></span><br><span class="line">import java.awt.BorderLayout;</span><br><span class="line">import java.awt.Color;</span><br><span class="line">import java.awt.EventQueue;</span><br><span class="line">import java.awt.GridLayout;</span><br><span class="line">import java.awt.event.ActionEvent;</span><br><span class="line">import java.awt.event.ActionListener;</span><br><span class="line">import java.util.Random;</span><br><span class="line"></span><br><span class="line">import javax.swing.JButton;</span><br><span class="line">import javax.swing.JFrame;</span><br><span class="line">import javax.swing.JPanel;</span><br><span class="line">import javax.swing.border.EmptyBorder;</span><br><span class="line"></span><br><span class="line">import com.wwh.test.swing.monitor.MonitorPanelModel.XAxisMode;</span><br><span class="line">import com.wwh.test.swing.monitor.MonitorPanelModel.YAxisMode;</span><br><span class="line"></span><br><span class="line">public class MonitorPanelTest extends JFrame &#123;</span><br><span class="line"></span><br><span class="line">    private static final long serialVersionUID = 1L;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * Launch the application.</span><br><span class="line">     */</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        EventQueue.invokeLater(new Runnable() &#123;</span><br><span class="line">            public void run() &#123;</span><br><span class="line">                try &#123;</span><br><span class="line">                    MonitorPanelTest frame = new MonitorPanelTest();</span><br><span class="line">                    frame.setVisible(true);</span><br><span class="line">                &#125; catch (Exception e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private JButton btn_clear1;</span><br><span class="line">    private JButton btn_clear2;</span><br><span class="line">    private JButton btn_clear3;</span><br><span class="line">    private JButton btn_clear4;</span><br><span class="line"></span><br><span class="line">    private JButton btn_start2;</span><br><span class="line">    private JButton btn_start3;</span><br><span class="line">    private JButton btn_start4;</span><br><span class="line"></span><br><span class="line">    private JButton btn_stop1;</span><br><span class="line">    private JButton btn_stop2;</span><br><span class="line">    private JButton btn_stop3;</span><br><span class="line">    private JButton btn_stop4;</span><br><span class="line"></span><br><span class="line">    private JPanel contentPane;</span><br><span class="line">    private MonitorPanel mPanel1;</span><br><span class="line">    private MonitorPanel mPanel2;</span><br><span class="line">    private MonitorPanel mPanel3;</span><br><span class="line">    private MonitorPanel mPanel4;</span><br><span class="line"></span><br><span class="line">    private MonitorPanelModel mpModel1;</span><br><span class="line">    private MonitorPanelModel mpModel2;</span><br><span class="line">    private MonitorPanelModel mpModel3;</span><br><span class="line">    private MonitorPanelModel mpModel4;</span><br><span class="line">    private JPanel panel_1;</span><br><span class="line">    private JPanel panel_2;</span><br><span class="line">    private JPanel panel_2_btn;</span><br><span class="line">    private JPanel panel_3;</span><br><span class="line">    private JPanel panel_3_btn;</span><br><span class="line">    private JPanel panel_4;</span><br><span class="line">    private JPanel panel_4_btn;</span><br><span class="line">    private boolean runFlag1 = false;</span><br><span class="line">    private boolean runFlag2 = false;</span><br><span class="line">    private boolean runFlag3 = false;</span><br><span class="line">    private boolean runFlag4 = false;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * Create the frame.</span><br><span class="line">     */</span><br><span class="line">    public MonitorPanelTest() &#123;</span><br><span class="line">        setTitle(&quot;监控面板测试&quot;);</span><br><span class="line">        setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);</span><br><span class="line">        setBounds(100, 100, 1183, 681);</span><br><span class="line">        contentPane = new JPanel();</span><br><span class="line">        contentPane.setBorder(new EmptyBorder(5, 5, 5, 5));</span><br><span class="line">        setContentPane(contentPane);</span><br><span class="line">        contentPane.setLayout(new GridLayout(2, 2, 0, 0));</span><br><span class="line"></span><br><span class="line">        createMonitorPanel1();</span><br><span class="line"></span><br><span class="line">        createMonitorPanel2();</span><br><span class="line"></span><br><span class="line">        createMonitorPanel3();</span><br><span class="line"></span><br><span class="line">        createMonitorPanel4();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private void createMonitorPanel1() &#123;</span><br><span class="line">        panel_1 = new JPanel();</span><br><span class="line">        contentPane.add(panel_1);</span><br><span class="line">        panel_1.setLayout(new BorderLayout(0, 0));</span><br><span class="line">        mpModel1 = new MonitorPanelModel();</span><br><span class="line">        mPanel1 = new MonitorPanel(mpModel1);</span><br><span class="line">        panel_1.add(mPanel1);</span><br><span class="line"></span><br><span class="line">        mpModel1.setMaxCoordinateCount(200);</span><br><span class="line"></span><br><span class="line">        mPanel1.setGraphTitle(&quot;0到10000之间的随机数&quot;);</span><br><span class="line"></span><br><span class="line">        JPanel panel_1_btn = new JPanel();</span><br><span class="line">        panel_1.add(panel_1_btn, BorderLayout.SOUTH);</span><br><span class="line"></span><br><span class="line">        JButton btn_start1 = new JButton(&quot;启  动&quot;);</span><br><span class="line">        btn_start1.addActionListener(new ActionListener() &#123;</span><br><span class="line">            public void actionPerformed(ActionEvent e) &#123;</span><br><span class="line">                start1();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        panel_1_btn.add(btn_start1);</span><br><span class="line"></span><br><span class="line">        btn_stop1 = new JButton(&quot;停  止&quot;);</span><br><span class="line">        btn_stop1.addActionListener(new ActionListener() &#123;</span><br><span class="line">            public void actionPerformed(ActionEvent e) &#123;</span><br><span class="line">                runFlag1 = false;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        panel_1_btn.add(btn_stop1);</span><br><span class="line"></span><br><span class="line">        btn_clear1 = new JButton(&quot;清  空&quot;);</span><br><span class="line">        btn_clear1.addActionListener(new ActionListener() &#123;</span><br><span class="line">            public void actionPerformed(ActionEvent e) &#123;</span><br><span class="line">                mpModel1.clearCoordinate();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        panel_1_btn.add(btn_clear1);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private void createMonitorPanel2() &#123;</span><br><span class="line">        panel_2 = new JPanel();</span><br><span class="line">        contentPane.add(panel_2);</span><br><span class="line">        panel_2.setLayout(new BorderLayout(0, 0));</span><br><span class="line"></span><br><span class="line">        mpModel2 = new MonitorPanelModel();</span><br><span class="line">        mpModel2.setxAxisMode(XAxisMode.KEEP_MOVE);</span><br><span class="line">        mpModel2.setKeepMoveTimeInterval(10 * 60 * 1000L);</span><br><span class="line"></span><br><span class="line">        mpModel2.setMaxCoordinateCount(600);</span><br><span class="line"></span><br><span class="line">        mPanel2 = new MonitorPanel(mpModel2);</span><br><span class="line"></span><br><span class="line">        mPanel2.setGraphTitle(&quot;内存图测试&quot;);</span><br><span class="line">        mPanel2.setGraphBackgroundColor(new Color(38, 38, 38));</span><br><span class="line">        mPanel2.setGridLineColor(new Color(0, 225, 34));</span><br><span class="line">        mPanel2.setGraphLineColor(Color.YELLOW);</span><br><span class="line"></span><br><span class="line">        panel_2.add(mPanel2);</span><br><span class="line"></span><br><span class="line">        panel_2_btn = new JPanel();</span><br><span class="line">        panel_2.add(panel_2_btn, BorderLayout.SOUTH);</span><br><span class="line"></span><br><span class="line">        btn_start2 = new JButton(&quot;启  动&quot;);</span><br><span class="line">        btn_start2.addActionListener(new ActionListener() &#123;</span><br><span class="line">            public void actionPerformed(ActionEvent e) &#123;</span><br><span class="line">                start2();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        panel_2_btn.add(btn_start2);</span><br><span class="line"></span><br><span class="line">        btn_stop2 = new JButton(&quot;停  止&quot;);</span><br><span class="line">        btn_stop2.addActionListener(new ActionListener() &#123;</span><br><span class="line">            public void actionPerformed(ActionEvent e) &#123;</span><br><span class="line">                runFlag2 = false;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        panel_2_btn.add(btn_stop2);</span><br><span class="line"></span><br><span class="line">        btn_clear2 = new JButton(&quot;清  空&quot;);</span><br><span class="line">        btn_clear2.addActionListener(new ActionListener() &#123;</span><br><span class="line">            public void actionPerformed(ActionEvent e) &#123;</span><br><span class="line">                mpModel2.clearCoordinate();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        panel_2_btn.add(btn_clear2);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private void createMonitorPanel3() &#123;</span><br><span class="line">        panel_3 = new JPanel();</span><br><span class="line">        contentPane.add(panel_3);</span><br><span class="line">        panel_3.setLayout(new BorderLayout(0, 0));</span><br><span class="line"></span><br><span class="line">        mpModel3 = new MonitorPanelModel();</span><br><span class="line">        mpModel3.setxAxisMode(XAxisMode.KEEP_MOVE);</span><br><span class="line">        mpModel3.setKeepMoveTimeInterval(10 * 60 * 1000L);</span><br><span class="line">        mpModel3.setMaxCoordinateCount(1200);</span><br><span class="line"></span><br><span class="line">        mPanel3 = new MonitorPanel(mpModel3);</span><br><span class="line">        mPanel3.setGraphTitle(&quot;递增递减&quot;);</span><br><span class="line"></span><br><span class="line">        panel_3.add(mPanel3, BorderLayout.CENTER);</span><br><span class="line"></span><br><span class="line">        panel_3_btn = new JPanel();</span><br><span class="line">        panel_3.add(panel_3_btn, BorderLayout.SOUTH);</span><br><span class="line"></span><br><span class="line">        btn_start3 = new JButton(&quot;启  动&quot;);</span><br><span class="line">        btn_start3.addActionListener(new ActionListener() &#123;</span><br><span class="line">            public void actionPerformed(ActionEvent e) &#123;</span><br><span class="line">                start3();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        panel_3_btn.add(btn_start3);</span><br><span class="line"></span><br><span class="line">        btn_stop3 = new JButton(&quot;停  止&quot;);</span><br><span class="line">        btn_stop3.addActionListener(new ActionListener() &#123;</span><br><span class="line">            public void actionPerformed(ActionEvent e) &#123;</span><br><span class="line">                runFlag3 = false;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        panel_3_btn.add(btn_stop3);</span><br><span class="line"></span><br><span class="line">        btn_clear3 = new JButton(&quot;清  空&quot;);</span><br><span class="line">        btn_clear3.addActionListener(new ActionListener() &#123;</span><br><span class="line">            public void actionPerformed(ActionEvent e) &#123;</span><br><span class="line">                mpModel3.clearCoordinate();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        panel_3_btn.add(btn_clear3);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private void createMonitorPanel4() &#123;</span><br><span class="line"></span><br><span class="line">        panel_4 = new JPanel();</span><br><span class="line">        contentPane.add(panel_4);</span><br><span class="line">        panel_4.setLayout(new BorderLayout(0, 0));</span><br><span class="line"></span><br><span class="line">        mpModel4 = new MonitorPanelModel();</span><br><span class="line">        mpModel4.setxAxisMode(XAxisMode.KEEP_MOVE);</span><br><span class="line">        mpModel4.setKeepMoveTimeInterval(360 * 1000L);</span><br><span class="line"></span><br><span class="line">        mpModel4.setMaxCoordinateCount(720);</span><br><span class="line"></span><br><span class="line">        mpModel4.setyAxisMode(YAxisMode.FIXED);</span><br><span class="line">        mpModel4.setMaxYCoords(100L);</span><br><span class="line">        mpModel4.setMinYCoords(-100L);</span><br><span class="line">        mpModel4.setyAxisInterval(20L);</span><br><span class="line"></span><br><span class="line">        mPanel4 = new MonitorPanel(mpModel4);</span><br><span class="line">        panel_4.add(mPanel4, BorderLayout.CENTER);</span><br><span class="line"></span><br><span class="line">        mPanel4.setGraphTitle(&quot;正弦函数&quot;);</span><br><span class="line">        mPanel4.setGraphBackgroundColor(new Color(38, 38, 38));</span><br><span class="line">        mPanel4.setGridLineColor(new Color(0, 225, 34));</span><br><span class="line">        mPanel4.setGraphLineColor(Color.YELLOW);</span><br><span class="line"></span><br><span class="line">        panel_4_btn = new JPanel();</span><br><span class="line">        panel_4.add(panel_4_btn, BorderLayout.SOUTH);</span><br><span class="line"></span><br><span class="line">        btn_start4 = new JButton(&quot;启  动&quot;);</span><br><span class="line">        btn_start4.addActionListener(new ActionListener() &#123;</span><br><span class="line">            public void actionPerformed(ActionEvent e) &#123;</span><br><span class="line">                start4();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        panel_4_btn.add(btn_start4);</span><br><span class="line"></span><br><span class="line">        btn_stop4 = new JButton(&quot;停  止&quot;);</span><br><span class="line">        btn_stop4.addActionListener(new ActionListener() &#123;</span><br><span class="line">            public void actionPerformed(ActionEvent e) &#123;</span><br><span class="line">                runFlag4 = false;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        panel_4_btn.add(btn_stop4);</span><br><span class="line"></span><br><span class="line">        btn_clear4 = new JButton(&quot;清  空&quot;);</span><br><span class="line">        btn_clear4.addActionListener(new ActionListener() &#123;</span><br><span class="line">            public void actionPerformed(ActionEvent e) &#123;</span><br><span class="line">                mpModel4.clearCoordinate();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        panel_4_btn.add(btn_clear4);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private void start1() &#123;</span><br><span class="line">        runFlag1 = true;</span><br><span class="line">        Thread t = new Thread(new Runnable() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void run() &#123;</span><br><span class="line">                int rint;</span><br><span class="line">                Random r = new Random();</span><br><span class="line">                while (runFlag1) &#123;</span><br><span class="line">                    try &#123;</span><br><span class="line">                        Thread.sleep(1000);</span><br><span class="line">                    &#125; catch (InterruptedException e) &#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125;</span><br><span class="line">                    rint = r.nextInt(10000);</span><br><span class="line">                    mpModel1.addCoordinate(new Coordinate(System.currentTimeMillis(), rint + 1));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        t.start();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private void start2() &#123;</span><br><span class="line">        if (runFlag2) &#123;</span><br><span class="line">            return;</span><br><span class="line">        &#125;</span><br><span class="line">        runFlag2 = true;</span><br><span class="line">        Thread t = new Thread(new Runnable() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void run() &#123;</span><br><span class="line">                Runtime rt = Runtime.getRuntime();</span><br><span class="line"></span><br><span class="line">                while (runFlag2) &#123;</span><br><span class="line">                    try &#123;</span><br><span class="line">                        Thread.sleep(1000);</span><br><span class="line">                    &#125; catch (InterruptedException e) &#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125;</span><br><span class="line">                    mpModel2.addCoordinate(new Coordinate(System.currentTimeMillis(), rt.freeMemory() / 1024 / 1024));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        t.start();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private void start3() &#123;</span><br><span class="line"></span><br><span class="line">        if (runFlag3) &#123;</span><br><span class="line">            return;</span><br><span class="line">        &#125;</span><br><span class="line">        runFlag3 = true;</span><br><span class="line">        Thread t = new Thread(new Runnable() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void run() &#123;</span><br><span class="line">                boolean b = true;</span><br><span class="line">                int i = 0;</span><br><span class="line">                while (runFlag3) &#123;</span><br><span class="line">                    if (b) &#123;</span><br><span class="line">                        if (i &lt; 100) &#123;</span><br><span class="line">                            i++;</span><br><span class="line">                        &#125; else &#123;</span><br><span class="line">                            b = !b;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125; else &#123;</span><br><span class="line">                        if (i &gt; 0) &#123;</span><br><span class="line">                            i--;</span><br><span class="line">                        &#125; else &#123;</span><br><span class="line">                            b = !b;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    try &#123;</span><br><span class="line">                        Thread.sleep(500);</span><br><span class="line">                    &#125; catch (InterruptedException e) &#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125;</span><br><span class="line">                    mpModel3.addCoordinate(new Coordinate(System.currentTimeMillis(), i));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        t.start();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private void start4() &#123;</span><br><span class="line">        if (runFlag4) &#123;</span><br><span class="line">            return;</span><br><span class="line">        &#125;</span><br><span class="line">        runFlag4 = true;</span><br><span class="line">        Thread t = new Thread(new Runnable() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void run() &#123;</span><br><span class="line">                int i = 0;</span><br><span class="line">                double d;</span><br><span class="line">                long l;</span><br><span class="line">                while (runFlag4) &#123;</span><br><span class="line">                    if (i == 360) &#123;</span><br><span class="line">                        i = 0;</span><br><span class="line">                    &#125;</span><br><span class="line">                    d = Math.sin(Math.toRadians(i));</span><br><span class="line">                    i++;</span><br><span class="line">                    try &#123;</span><br><span class="line">                        Thread.sleep(500);</span><br><span class="line">                    &#125; catch (InterruptedException e) &#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125;</span><br><span class="line">                    l = (long) (d * 100);</span><br><span class="line">                    mpModel4.addCoordinate(new Coordinate(System.currentTimeMillis(), l));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        t.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" title="上一页" aria-label="上一页" href="/page/12/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/12/">12</a><span class="page-number current">13</span><a class="page-number" href="/page/14/">14</a><span class="space">&hellip;</span><a class="page-number" href="/page/16/">16</a><a class="extend next" rel="next" title="下一页" aria-label="下一页" href="/page/14/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2024</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">王某某</span>
  </div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
    <span title="站点总字数">138k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">8:20</span>
  </span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/pisces/" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script><script src="/js/bookmark.js"></script>

  






  





</body>
</html>
