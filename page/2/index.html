<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha256-XOqroi11tY4EFQMR9ZYwZWKj5ZXiftSx36RRuC3anlA=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"wangwen135.github.io","root":"/","images":"/images","scheme":"Pisces","darkmode":false,"version":"8.20.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":true,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="这是一个使用 Hexo 构建的博客，用于分享我的编程经验和学习笔记。">
<meta property="og:type" content="website">
<meta property="og:title" content="王某某的笔记">
<meta property="og:url" content="https://wangwen135.github.io/page/2/index.html">
<meta property="og:site_name" content="王某某的笔记">
<meta property="og:description" content="这是一个使用 Hexo 构建的博客，用于分享我的编程经验和学习笔记。">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="王某某">
<meta property="article:tag" content="java">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://wangwen135.github.io/page/2/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"page/2/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>王某某的笔记</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">王某某的笔记</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">记录我的编程之路</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="王某某"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">王某某</p>
  <div class="site-description" itemprop="description">这是一个使用 Hexo 构建的博客，用于分享我的编程经验和学习笔记。</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">158</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">51</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">121</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/wangwen135" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;wangwen135" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.jianshu.com/u/66c41e72644b" title="简  书 → https:&#x2F;&#x2F;www.jianshu.com&#x2F;u&#x2F;66c41e72644b" rel="noopener me" target="_blank"><i class="fa fa-link fa-fw"></i>简  书</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:wangwen135@gmail.com" title="E-Mail → mailto:wangwen135@gmail.com" rel="noopener me" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://twitter.com/wangwen135" title="Twitter → https:&#x2F;&#x2F;twitter.com&#x2F;wangwen135" rel="noopener me" target="_blank"><i class="fab fa-twitter fa-fw"></i>Twitter</a>
      </span>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://wangwen135.github.io/MySQL/mysql-%E4%B8%BB%E4%BB%8E%E5%90%8C%E6%AD%A5%E6%B5%8B%E8%AF%95-1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="王某某">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="王某某的笔记">
      <meta itemprop="description" content="这是一个使用 Hexo 构建的博客，用于分享我的编程经验和学习笔记。">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 王某某的笔记">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/MySQL/mysql-%E4%B8%BB%E4%BB%8E%E5%90%8C%E6%AD%A5%E6%B5%8B%E8%AF%95-1/" class="post-title-link" itemprop="url">mysql-主从同步测试-1</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-12-02 23:41:00" itemprop="dateCreated datePublished" datetime="2023-12-02T23:41:00+08:00">2023-12-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/MySQL/" itemprop="url" rel="index"><span itemprop="name">MySQL</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>702</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>3 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>测试环境</p>
<ul>
<li>系统：WIN 10</li>
<li>MySQL版本：mysql-5.7.23</li>
</ul>
<h3 id="安装配置"><a href="#安装配置" class="headerlink" title="安装配置"></a>安装配置</h3><h4 id="解压文件"><a href="#解压文件" class="headerlink" title="解压文件"></a>解压文件</h4><p>使用mysql-5.7.23-winx64.zip包解压缩安装<br>路径分别为：</p>
<ul>
<li>D:\mysql\mysql-5.7.23-winx64</li>
<li>D:\mysql\mysql-5.7.23-winx64-3307</li>
</ul>
<blockquote>
<p>解压安装路径随意指定，注意需要与my.ini文件中的路径一致</p>
</blockquote>
<h4 id="my-ini配置文件"><a href="#my-ini配置文件" class="headerlink" title="my.ini配置文件"></a>my.ini配置文件</h4><p>分别在两个目录中创建my.ini 文件</p>
<blockquote>
<p>在同一台机器上测试，mysql实例使用不同端口<br>主数据库：3306 (默认)<br>从数据库：3307</p>
</blockquote>
<p>内容如下：</p>
<h5 id="主库my-ini"><a href="#主库my-ini" class="headerlink" title="主库my.ini"></a>主库my.ini</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[mysqld]</span><br><span class="line"># set basedir to your installation path</span><br><span class="line">basedir=D:/mysql/mysql-5.7.23-winx64</span><br><span class="line"># set datadir to the location of your data directory</span><br><span class="line">datadir=D:/mysql/mysql-5.7.23-winx64/data</span><br><span class="line"></span><br><span class="line"># 唯一标识</span><br><span class="line">server-id=1</span><br><span class="line"></span><br><span class="line"># binlog文件名（可以不指定）</span><br><span class="line">log-bin=mysql-binlog</span><br><span class="line"></span><br><span class="line"># 要写binlog的数据库，要同步多个数据库，就多加几个binlog-do-db=数据库名</span><br><span class="line">binlog-do-db=mstest</span><br><span class="line">binlog-do-db=test</span><br><span class="line"></span><br><span class="line"># 要忽略的数据库</span><br><span class="line">binlog-ignore-db=mysql</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h5 id="从库my-ini"><a href="#从库my-ini" class="headerlink" title="从库my.ini"></a>从库my.ini</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[mysqld]</span><br><span class="line"># 指定端口</span><br><span class="line">port=3307</span><br><span class="line"># set basedir to your installation path</span><br><span class="line">basedir=D:/mysql/mysql-5.7.23-winx64-3307</span><br><span class="line"># set datadir to the location of your data directory</span><br><span class="line">datadir=D:/mysql/mysql-5.7.23-winx64-3307/data</span><br><span class="line"></span><br><span class="line"># 唯一标识</span><br><span class="line">server-id=2</span><br><span class="line"></span><br><span class="line"># 要复制多个数据库，就多加几个replicate-do-db=数据库名</span><br><span class="line">replicate-do-db=mstest</span><br><span class="line">replicate-do-db=test</span><br><span class="line"></span><br><span class="line"># 要忽略的数据库</span><br><span class="line">replicate-ignore-db=mysql</span><br></pre></td></tr></table></figure>

<h4 id="初始化并启动数据库"><a href="#初始化并启动数据库" class="headerlink" title="初始化并启动数据库"></a>初始化并启动数据库</h4><p>分别初始化、启动两个数据库，并修改root密码  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mysqld --initialize --console</span><br><span class="line"></span><br><span class="line">mysqld.exe --console</span><br><span class="line"></span><br><span class="line">ALTER USER &#x27;root&#x27;@&#x27;localhost&#x27; IDENTIFIED BY &#x27;root&#x27;;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>具体见安装文档</p>
</blockquote>
<h4 id="数据库配置"><a href="#数据库配置" class="headerlink" title="数据库配置"></a>数据库配置</h4><h5 id="主库配置"><a href="#主库配置" class="headerlink" title="主库配置"></a>主库配置</h5><p>登录主库</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;mysql -uroot -p</span><br></pre></td></tr></table></figure>

<p>主数据库创建用于同步的用户</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GRANT REPLICATION SLAVE ON *.* TO &#x27;mstest&#x27;@&#x27;%&#x27; IDENTIFIED BY &#x27;123456&#x27;;</span><br></pre></td></tr></table></figure>

<h5 id="从数据库配置"><a href="#从数据库配置" class="headerlink" title="从数据库配置"></a>从数据库配置</h5><p>登录从库，指定端口3307</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;mysql -uroot -p -P3307</span><br></pre></td></tr></table></figure>

<p>配置从库连接到主库</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">change master to master_host=&#x27;127.0.0.1&#x27;,master_port=3306,</span><br><span class="line">master_user=&#x27;mstest&#x27;,master_password=&#x27;123456&#x27;;</span><br><span class="line"></span><br><span class="line">start slave;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="查看状态"><a href="#查看状态" class="headerlink" title="查看状态"></a>查看状态</h4><h5 id="主库"><a href="#主库" class="headerlink" title="主库"></a>主库</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show master status;</span><br><span class="line">+---------------------+----------+--------------+------------------+-------------------+</span><br><span class="line">| File                | Position | Binlog_Do_DB | Binlog_Ignore_DB | Executed_Gtid_Set |</span><br><span class="line">+---------------------+----------+--------------+------------------+-------------------+</span><br><span class="line">| mysql-binlog.000002 |      313 | mstest,test  | mysql            |                   |</span><br><span class="line">+---------------------+----------+--------------+------------------+-------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>


<h5 id="从库"><a href="#从库" class="headerlink" title="从库"></a>从库</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">mysql&gt; show slave status\G</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">               Slave_IO_State: Waiting for master to send event</span><br><span class="line">                  Master_Host: 127.0.0.1</span><br><span class="line">                  Master_User: mstest</span><br><span class="line">                  Master_Port: 3306</span><br><span class="line">                Connect_Retry: 60</span><br><span class="line">              Master_Log_File: mysql-binlog.000002</span><br><span class="line">          Read_Master_Log_Pos: 1306</span><br><span class="line">               Relay_Log_File: wwh-relay-bin.000005</span><br><span class="line">                Relay_Log_Pos: 323</span><br><span class="line">        Relay_Master_Log_File: mysql-binlog.000002</span><br><span class="line">             Slave_IO_Running: Yes</span><br><span class="line">            Slave_SQL_Running: Yes</span><br><span class="line">              Replicate_Do_DB: mstest,test</span><br><span class="line">          Replicate_Ignore_DB: mysql</span><br><span class="line"> ......</span><br><span class="line"> ......</span><br><span class="line"> ......</span><br><span class="line">             Master_Server_Id: 1</span><br><span class="line">                  Master_UUID: ea65d565-a8a0-11e8-807e-0a002700000a</span><br><span class="line">             Master_Info_File: D:\mysql\mysql-5.7.23-winx64-3307\data\master.info</span><br><span class="line">                    SQL_Delay: 0</span><br><span class="line">          SQL_Remaining_Delay: NULL</span><br><span class="line">      Slave_SQL_Running_State: Slave has read all relay log; waiting for more updates</span><br><span class="line">           Master_Retry_Count: 86400</span><br><span class="line">......</span><br><span class="line">......</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>


<h3 id="同步测试"><a href="#同步测试" class="headerlink" title="同步测试"></a>同步测试</h3><h4 id="创建数据库"><a href="#创建数据库" class="headerlink" title="创建数据库"></a>创建数据库</h4><h4 id="主库创建表，从库查看"><a href="#主库创建表，从库查看" class="headerlink" title="主库创建表，从库查看"></a>主库创建表，从库查看</h4><h4 id="主库插入记录，从库查看"><a href="#主库插入记录，从库查看" class="headerlink" title="主库插入记录，从库查看"></a>主库插入记录，从库查看</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; create database test;</span><br><span class="line">Query OK, 1 row affected (0.01 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; show databases;</span><br><span class="line">+--------------------+</span><br><span class="line">| Database           |</span><br><span class="line">+--------------------+</span><br><span class="line">| information_schema |</span><br><span class="line">| mysql              |</span><br><span class="line">| performance_schema |</span><br><span class="line">| sys                |</span><br><span class="line">| test               |</span><br><span class="line">| wwh                |</span><br><span class="line">+--------------------+</span><br><span class="line">6 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mysql&gt; status;</span><br><span class="line">--------------</span><br><span class="line">mysql  Ver 14.14 Distrib 5.7.23, for Win64 (x86_64)</span><br><span class="line"></span><br><span class="line">Connection id:          2</span><br><span class="line">Current database:</span><br><span class="line">Current user:           root@localhost</span><br><span class="line">SSL:                    Not in use</span><br><span class="line">Using delimiter:        ;</span><br><span class="line">Server version:         5.7.23 MySQL Community Server (GPL)</span><br><span class="line">Protocol version:       10</span><br><span class="line">Connection:             localhost via TCP/IP</span><br><span class="line">Server characterset:    latin1</span><br><span class="line">Db     characterset:    latin1</span><br><span class="line">Client characterset:    gbk</span><br><span class="line">Conn.  characterset:    gbk</span><br><span class="line">TCP port:               3307</span><br><span class="line">Uptime:                 7 min 37 sec</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">show binlog events\G</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">show master status\G</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="查询命令"><a href="#查询命令" class="headerlink" title="查询命令"></a>查询命令</h2><h3 id="在master上查看当前有多少个从节点"><a href="#在master上查看当前有多少个从节点" class="headerlink" title="在master上查看当前有多少个从节点"></a>在master上查看当前有多少个从节点</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select * from information_schema.processlist as p where p.command = &#x27;Binlog Dump&#x27;; </span><br><span class="line"></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://wangwen135.github.io/Nginx/CentOS7-%E5%AE%89%E8%A3%85-Nginx/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="王某某">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="王某某的笔记">
      <meta itemprop="description" content="这是一个使用 Hexo 构建的博客，用于分享我的编程经验和学习笔记。">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 王某某的笔记">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/Nginx/CentOS7-%E5%AE%89%E8%A3%85-Nginx/" class="post-title-link" itemprop="url">CentOS7-安装-Nginx</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-09-21 23:41:00" itemprop="dateCreated datePublished" datetime="2023-09-21T23:41:00+08:00">2023-09-21</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Nginx/" itemprop="url" rel="index"><span itemprop="name">Nginx</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>716</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>3 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="CentOS7-安装-Nginx"><a href="#CentOS7-安装-Nginx" class="headerlink" title="CentOS7 安装 Nginx"></a>CentOS7 安装 Nginx</h1><p>Nginx是一个高性能的Web服务器软件。它是一个比Apache HTTP服务器更灵活和轻量级的程序。</p>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><ol>
<li>安装epel源<br> EPEL (Extra Packages for Enterprise Linux，企业版Linux的额外软件包) 是Fedora小组维护的一个软件仓库项目，为RHEL&#x2F;CentOS提供他们默认不提供的软件包。这个源兼容RHEL及像CentOS和Scientific Linux这样的衍生版本。<br> 我们可以很容易地通过yum命令从EPEL源上获取上万个在CentOS自带源上没有的软件。EPEL提供的软件包大多基于其对应的Fedora软件包，不会与企业版Linux发行版本的软件发生冲突或替换其文件。<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">yum install epel-release</span><br><span class="line">#安装完成之后可以通过下面的命令查看</span><br><span class="line">yum repolist</span><br><span class="line">#可以看到多了一个</span><br><span class="line">#Extra Packages for Enterprise Linux 7 - x86_64</span><br></pre></td></tr></table></figure></li>
<li>安装Nginx<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install nginx</span><br></pre></td></tr></table></figure></li>
<li>启动Nginx<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl start nginx</span><br></pre></td></tr></table></figure>
如果运行防火墙，请运行以下命令以允许HTTP和HTTPS流量：<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo firewall-cmd --permanent --zone=public --add-service=http </span><br><span class="line">sudo firewall-cmd --permanent --zone=public --add-service=https</span><br><span class="line">sudo firewall-cmd --reload</span><br></pre></td></tr></table></figure></li>
<li>访问<br>在浏览器中访问<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http://server_domain_name_or_IP/</span><br><span class="line">http://192.168.1.213/</span><br></pre></td></tr></table></figure>
能看Nginx的默认页</li>
<li>系统启动时启动Nginx<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl enable nginx</span><br></pre></td></tr></table></figure></li>
<li>配置<br><strong>默认服务器根</strong><br>默认服务器根目录是 &#x2F;usr&#x2F;share&#x2F;nginx&#x2F;html 放置在其中的文件将在您的Web服务器上提供访问。<br>此位置在Nginx附带的默认服务器块配置文件中指定，该文件位于 &#x2F;etc&#x2F;nginx&#x2F;conf.d&#x2F;default.conf<br><strong>服务器块配置</strong><br>可以通过在&#x2F;etc&#x2F;nginx&#x2F;conf.d中创建新的配置文件来添加任何附加的服务器块（在Apache中称为虚拟主机）。当Nginx启动时，将加载该目录中以.conf结尾的文件。<br><strong>Nginx全局配置</strong><br>主要的Nginx配置文件位于&#x2F;etc&#x2F;nginx&#x2F;nginx.conf。在这里您可以更改设置，如运行Nginx守护进程的用户，以及当Nginx运行时生成的工作进程数等。</li>
</ol>
<hr>
<hr>
<p><em>忘了之前是怎么安装的了  ~~</em></p>
<h4 id="服务名是："><a href="#服务名是：" class="headerlink" title="服务名是："></a>服务名是：</h4><p>nginx16-nginx.service</p>
<h4 id="配置文件位于："><a href="#配置文件位于：" class="headerlink" title="配置文件位于："></a>配置文件位于：</h4><p>&#x2F;opt&#x2F;rh&#x2F;nginx16&#x2F;root&#x2F;etc&#x2F;nginx&#x2F;nginx.conf</p>
<p>内容：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">error_log  /var/log/nginx16/error.log;</span><br><span class="line"></span><br><span class="line">......</span><br><span class="line"></span><br><span class="line">access_log  /var/log/nginx16/access.log  main;</span><br><span class="line">   </span><br><span class="line">......</span><br><span class="line"></span><br><span class="line"> server &#123;</span><br><span class="line">        listen       80;</span><br><span class="line">        server_name  localhost;</span><br><span class="line"></span><br><span class="line">        #charset koi8-r;</span><br><span class="line"></span><br><span class="line">        #access_log  /opt/rh/nginx16/root/var/log/nginx/host.access.log  main;</span><br><span class="line"></span><br><span class="line">        location / &#123;</span><br><span class="line">            #root   /opt/rh/nginx16/root/usr/share/nginx/html;</span><br><span class="line">            #index  index.html index.htm;</span><br><span class="line"></span><br><span class="line">            root   /data/bdmi/html;</span><br><span class="line">            index  login.html index.html index.htm;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        location /baseUrl &#123;</span><br><span class="line">            rewrite  ^.+baseUrl/?(.*)$ /bdmi-biz/$1 break;</span><br><span class="line">            include  uwsgi_params;</span><br><span class="line">            proxy_pass   http://192.168.1.92:8080;</span><br><span class="line"></span><br><span class="line">            proxy_set_header Cookie $http_cookie;</span><br><span class="line">            proxy_cookie_path /bdmi-biz /;</span><br><span class="line"></span><br><span class="line">            proxy_set_header Host $host;</span><br><span class="line">            proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">......</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="关于SELINUX问题"><a href="#关于SELINUX问题" class="headerlink" title="关于SELINUX问题"></a>关于SELINUX问题</h4><p>首先查看本机SELinux的开启状态，如果SELinux status参数为enabled即为开启状态</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/sbin/ sestatus -v</span><br></pre></td></tr></table></figure>

<p>或者使用getenforce命令检查</p>
<p>SELinux can be run in <strong>enforcing</strong>, <strong>permissive</strong>, or <strong>disabled</strong> mode</p>
<p>To add httpd_t to the list of permissive domains, run this command:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># semanage permissive -a httpd_t</span><br></pre></td></tr></table></figure>

<p>To delete httpd_t from the list of permissive domains, run:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># semanage permissive -d httpd_t</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>To set the mode globally to enforcing, run:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># setenforce 1</span><br><span class="line"></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://wangwen135.github.io/MySQL/mysql-%E4%B8%BB%E4%BB%8E%E5%90%8C%E6%AD%A5%E6%B5%8B%E8%AF%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="王某某">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="王某某的笔记">
      <meta itemprop="description" content="这是一个使用 Hexo 构建的博客，用于分享我的编程经验和学习笔记。">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 王某某的笔记">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/MySQL/mysql-%E4%B8%BB%E4%BB%8E%E5%90%8C%E6%AD%A5%E6%B5%8B%E8%AF%95/" class="post-title-link" itemprop="url">mysql-主从同步测试</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-09-10 23:41:00" itemprop="dateCreated datePublished" datetime="2023-09-10T23:41:00+08:00">2023-09-10</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/MySQL/" itemprop="url" rel="index"><span itemprop="name">MySQL</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>701</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>3 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p><em>2018年的吧</em></p>
<hr>
<p>测试环境</p>
<ul>
<li>系统：WIN 10</li>
<li>MySQL版本：mysql-5.7.23</li>
</ul>
<h3 id="安装配置"><a href="#安装配置" class="headerlink" title="安装配置"></a>安装配置</h3><h4 id="解压文件"><a href="#解压文件" class="headerlink" title="解压文件"></a>解压文件</h4><p>使用mysql-5.7.23-winx64.zip包解压缩安装<br>路径分别为：</p>
<ul>
<li>D:\mysql\mysql-5.7.23-winx64</li>
<li>D:\mysql\mysql-5.7.23-winx64-3307</li>
</ul>
<blockquote>
<p>解压安装路径随意指定，注意需要与my.ini文件中的路径一致</p>
</blockquote>
<h4 id="my-ini配置文件"><a href="#my-ini配置文件" class="headerlink" title="my.ini配置文件"></a>my.ini配置文件</h4><p>分别在两个目录中创建my.ini 文件</p>
<blockquote>
<p>在同一台机器上测试，mysql实例使用不同端口<br>主数据库：3306 (默认)<br>从数据库：3307</p>
</blockquote>
<p>内容如下：</p>
<h5 id="主库my-ini"><a href="#主库my-ini" class="headerlink" title="主库my.ini"></a>主库my.ini</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[mysqld]</span><br><span class="line"># set basedir to your installation path</span><br><span class="line">basedir=D:/mysql/mysql-5.7.23-winx64</span><br><span class="line"># set datadir to the location of your data directory</span><br><span class="line">datadir=D:/mysql/mysql-5.7.23-winx64/data</span><br><span class="line"></span><br><span class="line"># 唯一标识</span><br><span class="line">server-id=1</span><br><span class="line"></span><br><span class="line"># binlog文件名</span><br><span class="line">log-bin=mysql-binlog</span><br><span class="line"></span><br><span class="line"># 要写binlog的数据库，要同步多个数据库，就多加几个binlog-do-db=数据库名</span><br><span class="line">binlog-do-db=mstest</span><br><span class="line">binlog-do-db=test</span><br><span class="line"></span><br><span class="line"># 要忽略的数据库</span><br><span class="line">binlog-ignore-db=mysql</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h5 id="从库my-ini"><a href="#从库my-ini" class="headerlink" title="从库my.ini"></a>从库my.ini</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[mysqld]</span><br><span class="line"># 指定端口</span><br><span class="line">port=3307</span><br><span class="line"># set basedir to your installation path</span><br><span class="line">basedir=D:/mysql/mysql-5.7.23-winx64-3307</span><br><span class="line"># set datadir to the location of your data directory</span><br><span class="line">datadir=D:/mysql/mysql-5.7.23-winx64-3307/data</span><br><span class="line"></span><br><span class="line"># 唯一标识</span><br><span class="line">server-id=2</span><br><span class="line"></span><br><span class="line"># 要复制多个数据库，就多加几个replicate-do-db=数据库名</span><br><span class="line">replicate-do-db=mstest</span><br><span class="line">replicate-do-db=test</span><br><span class="line"></span><br><span class="line"># 要忽略的数据库</span><br><span class="line">replicate-ignore-db=mysql</span><br></pre></td></tr></table></figure>

<h4 id="初始化并启动数据库"><a href="#初始化并启动数据库" class="headerlink" title="初始化并启动数据库"></a>初始化并启动数据库</h4><p>分别初始化、启动两个数据库，并修改root密码  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mysqld --initialize --console</span><br><span class="line"></span><br><span class="line">mysqld.exe --console</span><br><span class="line"></span><br><span class="line">ALTER USER &#x27;root&#x27;@&#x27;localhost&#x27; IDENTIFIED BY &#x27;root&#x27;;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>具体见安装文档</p>
</blockquote>
<h4 id="数据库配置"><a href="#数据库配置" class="headerlink" title="数据库配置"></a>数据库配置</h4><h5 id="主库配置"><a href="#主库配置" class="headerlink" title="主库配置"></a>主库配置</h5><p>登录主库</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;mysql -uroot -p</span><br></pre></td></tr></table></figure>

<p>主数据库创建用于同步的用户</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GRANT REPLICATION SLAVE ON *.* TO &#x27;mstest&#x27;@&#x27;%&#x27; IDENTIFIED BY &#x27;123456&#x27;;</span><br></pre></td></tr></table></figure>

<h5 id="从数据库配置"><a href="#从数据库配置" class="headerlink" title="从数据库配置"></a>从数据库配置</h5><p>登录从库，指定端口3307</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;mysql -uroot -p -P3307</span><br></pre></td></tr></table></figure>

<p>配置从库连接到主库</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">change master to master_host=&#x27;127.0.0.1&#x27;,master_port=3306,</span><br><span class="line">master_user=&#x27;mstest&#x27;,master_password=&#x27;123456&#x27;;</span><br><span class="line"></span><br><span class="line">start slave;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="查看状态"><a href="#查看状态" class="headerlink" title="查看状态"></a>查看状态</h4><h5 id="主库"><a href="#主库" class="headerlink" title="主库"></a>主库</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show master status;</span><br><span class="line">+---------------------+----------+--------------+------------------+-------------------+</span><br><span class="line">| File                | Position | Binlog_Do_DB | Binlog_Ignore_DB | Executed_Gtid_Set |</span><br><span class="line">+---------------------+----------+--------------+------------------+-------------------+</span><br><span class="line">| mysql-binlog.000002 |      313 | mstest,test  | mysql            |                   |</span><br><span class="line">+---------------------+----------+--------------+------------------+-------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>


<h5 id="从库"><a href="#从库" class="headerlink" title="从库"></a>从库</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">mysql&gt; show slave status\G</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">               Slave_IO_State: Waiting for master to send event</span><br><span class="line">                  Master_Host: 127.0.0.1</span><br><span class="line">                  Master_User: mstest</span><br><span class="line">                  Master_Port: 3306</span><br><span class="line">                Connect_Retry: 60</span><br><span class="line">              Master_Log_File: mysql-binlog.000002</span><br><span class="line">          Read_Master_Log_Pos: 1306</span><br><span class="line">               Relay_Log_File: wwh-relay-bin.000005</span><br><span class="line">                Relay_Log_Pos: 323</span><br><span class="line">        Relay_Master_Log_File: mysql-binlog.000002</span><br><span class="line">             Slave_IO_Running: Yes</span><br><span class="line">            Slave_SQL_Running: Yes</span><br><span class="line">              Replicate_Do_DB: mstest,test</span><br><span class="line">          Replicate_Ignore_DB: mysql</span><br><span class="line"> ......</span><br><span class="line"> ......</span><br><span class="line"> ......</span><br><span class="line">             Master_Server_Id: 1</span><br><span class="line">                  Master_UUID: ea65d565-a8a0-11e8-807e-0a002700000a</span><br><span class="line">             Master_Info_File: D:\mysql\mysql-5.7.23-winx64-3307\data\master.info</span><br><span class="line">                    SQL_Delay: 0</span><br><span class="line">          SQL_Remaining_Delay: NULL</span><br><span class="line">      Slave_SQL_Running_State: Slave has read all relay log; waiting for more updates</span><br><span class="line">           Master_Retry_Count: 86400</span><br><span class="line">......</span><br><span class="line">......</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>


<h3 id="同步测试"><a href="#同步测试" class="headerlink" title="同步测试"></a>同步测试</h3><h4 id="创建数据库"><a href="#创建数据库" class="headerlink" title="创建数据库"></a>创建数据库</h4><h4 id="主库创建表，从库查看"><a href="#主库创建表，从库查看" class="headerlink" title="主库创建表，从库查看"></a>主库创建表，从库查看</h4><h4 id="主库插入记录，从库查看"><a href="#主库插入记录，从库查看" class="headerlink" title="主库插入记录，从库查看"></a>主库插入记录，从库查看</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; create database test;</span><br><span class="line">Query OK, 1 row affected (0.01 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; show databases;</span><br><span class="line">+--------------------+</span><br><span class="line">| Database           |</span><br><span class="line">+--------------------+</span><br><span class="line">| information_schema |</span><br><span class="line">| mysql              |</span><br><span class="line">| performance_schema |</span><br><span class="line">| sys                |</span><br><span class="line">| test               |</span><br><span class="line">| wwh                |</span><br><span class="line">+--------------------+</span><br><span class="line">6 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mysql&gt; status;</span><br><span class="line">--------------</span><br><span class="line">mysql  Ver 14.14 Distrib 5.7.23, for Win64 (x86_64)</span><br><span class="line"></span><br><span class="line">Connection id:          2</span><br><span class="line">Current database:</span><br><span class="line">Current user:           root@localhost</span><br><span class="line">SSL:                    Not in use</span><br><span class="line">Using delimiter:        ;</span><br><span class="line">Server version:         5.7.23 MySQL Community Server (GPL)</span><br><span class="line">Protocol version:       10</span><br><span class="line">Connection:             localhost via TCP/IP</span><br><span class="line">Server characterset:    latin1</span><br><span class="line">Db     characterset:    latin1</span><br><span class="line">Client characterset:    gbk</span><br><span class="line">Conn.  characterset:    gbk</span><br><span class="line">TCP port:               3307</span><br><span class="line">Uptime:                 7 min 37 sec</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">show binlog events\G</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">show master status\G</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="查询命令"><a href="#查询命令" class="headerlink" title="查询命令"></a>查询命令</h2><h3 id="在master上查看当前有多少个从节点"><a href="#在master上查看当前有多少个从节点" class="headerlink" title="在master上查看当前有多少个从节点"></a>在master上查看当前有多少个从节点</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select * from information_schema.processlist as p where p.command = &#x27;Binlog Dump&#x27;; </span><br><span class="line"></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://wangwen135.github.io/%E7%BD%91%E7%BB%9C%E4%B8%8E%E5%AE%89%E5%85%A8/%E7%BD%91%E7%BB%9C/%E8%BF%9C%E7%A8%8B%E5%BC%80%E6%9C%BA%20%E7%BD%91%E7%BB%9C%E5%94%A4%E9%86%92%20WOL/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="王某某">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="王某某的笔记">
      <meta itemprop="description" content="这是一个使用 Hexo 构建的博客，用于分享我的编程经验和学习笔记。">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 王某某的笔记">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/%E7%BD%91%E7%BB%9C%E4%B8%8E%E5%AE%89%E5%85%A8/%E7%BD%91%E7%BB%9C/%E8%BF%9C%E7%A8%8B%E5%BC%80%E6%9C%BA%20%E7%BD%91%E7%BB%9C%E5%94%A4%E9%86%92%20WOL/" class="post-title-link" itemprop="url">远程开机 网络唤醒 WOL</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-05-29 00:00:00" itemprop="dateCreated datePublished" datetime="2023-05-29T00:00:00+08:00">2023-05-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%BD%91%E7%BB%9C%E4%B8%8E%E5%AE%89%E5%85%A8/" itemprop="url" rel="index"><span itemprop="name">网络与安全</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%BD%91%E7%BB%9C%E4%B8%8E%E5%AE%89%E5%85%A8/%E7%BD%91%E7%BB%9C/" itemprop="url" rel="index"><span itemprop="name">网络</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>2k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>7 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="什么是网络唤醒WOL"><a href="#什么是网络唤醒WOL" class="headerlink" title="什么是网络唤醒WOL"></a>什么是网络唤醒WOL</h2><blockquote>
<p>见维基百科：<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E7%B6%B2%E8%B7%AF%E5%96%9A%E9%86%92">https://zh.wikipedia.org/wiki/%E7%B6%B2%E8%B7%AF%E5%96%9A%E9%86%92</a></p>
</blockquote>
<p><strong>Wake-on-LAN</strong>简称<strong>WOL</strong>或<strong>WoL</strong>，中文多译为“<strong>网络唤醒</strong>”、“<strong>远程唤醒</strong>”技术。WOL是一种技术，同时也是该技术的规范标准，它的功效在于让&#x3D;&#x3D;休眠&#x3D;&#x3D;状态或&#x3D;&#x3D;关机&#x3D;&#x3D;状态的电脑，透过局域网的另一台电脑对其发令，使其唤醒、恢复成运作状态，或从关机状态转成引导状态。</p>
<h3 id="要求"><a href="#要求" class="headerlink" title="要求"></a>要求</h3><p>要想实现WOL，首先必须要有具备WOL功能的主板、网卡。</p>
<p>现在的主板通常只需在BIOS中开启PCI&#x2F;PCIe唤醒功能或网卡唤醒功能，主板内置的网卡可支持WOL。除了开启BIOS中的PCIe唤醒功能外，可能还要在操作系统中设置网卡的唤醒功能</p>
<blockquote>
<p>除了古董机之外现在的电脑一般都支持，多在BIOS中找找相关选项</p>
</blockquote>
<h3 id="工作原理"><a href="#工作原理" class="headerlink" title="工作原理"></a>工作原理</h3><p>电脑处在关机（或休眠）状态时，机内的网卡及主板部分仍保有微弱的供电，此微弱供电能让网卡保有最低的运作能力，使网卡能聆听来自电脑外部的网络广播信息，并对信息内容进行侦测与解读，一旦发现网络广播的内容中有特定的“魔法数据包”（Magic Packet），就会对该数据包的内容进行研判。</p>
<p>魔法数据包是以广播方式发送的，广播的方式与范畴可以是整个局域网（LAN），也可以是特定的子网（Subnet），同时魔法数据包内会有某部（或一群）电脑的网络地址资料，网卡一旦解读研判出所指的地址是自身所处的电脑时，网卡就会通知机内的主板、电源供应器，开始进行引导（或唤醒）的程序。</p>
<h3 id="魔法数据包"><a href="#魔法数据包" class="headerlink" title="魔法数据包"></a>魔法数据包</h3><p><strong>魔法数据包</strong>（Magic Packet）是一个广播性的帧（frame），透过端口7或端口9进行发送，且可以用无连接（Connectionless protocol）的通信协议（如UDP、IPX）来传递，不过一般而言多是用UDP</p>
<p>在魔法数据包内，每次都会先有连续6个”FF”（十六进制，换算成二进制即：11111111）的资料，即：FF FF FF FF FF FF，在连续6个”FF”后则开始带出MAC地址信息，有时还会带出4字节或6字节的密码，一旦经由网卡侦测、解读、研判（广播）魔法数据包的内容，内容中的MAC地址、密码若与电脑自身的地址、密码吻合，就会引导唤醒、引导的程序。</p>
<p>如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">00000000 : FF FF FF FF FF FF 6C BC 4A B3 F4 BC 6C BC 4A B3 </span><br><span class="line">00000010 : F4 BC 6C BC 4A B3 F4 BC 6C BC 4A B3 F4 BC 6C BC </span><br><span class="line">00000020 : 4A B3 F4 BC 6C BC 4A B3 F4 BC 6C BC 4A B3 F4 BC </span><br><span class="line">00000030 : 6C BC 4A B3 F4 BC 6C BC 4A B3 F4 BC 6C BC 4A B3 </span><br><span class="line">00000040 : F4 BC 6C BC 4A B3 F4 BC 6C BC 4A B3 F4 BC 6C BC </span><br><span class="line">00000050 : 4A B3 F4 BC 6C BC 4A B3 F4 BC 6C BC 4A B3 F4 BC </span><br><span class="line">00000060 : 6C BC 4A B3 F4 BC </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="设置"><a href="#设置" class="headerlink" title="设置"></a>设置</h2><h3 id="BIOS设置"><a href="#BIOS设置" class="headerlink" title="BIOS设置"></a>BIOS设置</h3><p>BIOS设置各不相同，如：</p>
<ol>
<li><p>高级 -&gt; 唤醒事件设置 -&gt; 将 PCIE设备唤醒 和 网络唤醒 设置为 允许 (Enable)</p>
</li>
<li><p>BIOS选单，选择Power Management Setup  把PME Event Wake Up 改成 Enabled即可设置成功</p>
</li>
<li><p>进入BIOS设置，Power-&gt;Automatic Power On里面，设置Wake on LAN &#x3D; Enable&#x2F;Automatic</p>
</li>
</ol>
<blockquote>
<p>不同机器的BIOS设置位置不同，找到对应的Wake on LAN选项设置就OK。一般2010年后的网卡都支持网卡唤醒功能，如果在BIOS设置里面找不到相应的设置项，很可能默认就是开启的。</p>
</blockquote>
<h3 id="电脑端设置"><a href="#电脑端设置" class="headerlink" title="电脑端设置"></a>电脑端设置</h3><p>进入网络适配器 ，选择对应网卡 右键 -&gt; 属性 -&gt; 配置 -&gt; 高级</p>
<ul>
<li>魔术封包唤醒 &#x3D; 开启</li>
</ul>
<p>电源管理 -&gt; 勾选 允许此设备唤醒计算机</p>
<h2 id="软件"><a href="#软件" class="headerlink" title="软件"></a>软件</h2><p>这个网站有各个平台的工具<br><a target="_blank" rel="noopener" href="https://www.depicus.com/wake-on-lan/">https://www.depicus.com/wake-on-lan/</a></p>
<h3 id="WEB网页工具"><a href="#WEB网页工具" class="headerlink" title="WEB网页工具"></a>WEB网页工具</h3><p><a target="_blank" rel="noopener" href="http://www.dslreports.com/wakeup">http://www.dslreports.com/wakeup</a></p>
<h3 id="桌面软件"><a href="#桌面软件" class="headerlink" title="桌面软件"></a>桌面软件</h3><p>发包软件：<br><a target="_blank" rel="noopener" href="https://www.depicus.com/downloads/wakeonlangui.zip">https://www.depicus.com/downloads/wakeonlangui.zip</a></p>
<p>收包测试软件：<br><a target="_blank" rel="noopener" href="https://www.depicus.com/downloads/wakeonlanmonitor.zip">https://www.depicus.com/downloads/wakeonlanmonitor.zip</a></p>
<blockquote>
<p>不用真正的不停的开关机，这个软件有监听到数据包就可以了<br>建议还是用Wireshark，规则栏里面写wol就可以，这个工具只能收指定端口的UDP包    </p>
</blockquote>
<h3 id="手机端控制软件"><a href="#手机端控制软件" class="headerlink" title="手机端控制软件"></a>手机端控制软件</h3><p>下载：</p>
<p><a target="_blank" rel="noopener" href="https://www.depicus.com/wake-on-lan/wake-on-lan-andriod">https://www.depicus.com/wake-on-lan/wake-on-lan-andriod</a></p>
<p>安装 -&gt; 打开应用，提示不兼容 没有关系忽略</p>
<p>或者：<a target="_blank" rel="noopener" href="https://apkpure.com/search?q=wake+on+lan">https://apkpure.com/search?q=wake+on+lan</a><br>里面有很多app</p>
<h2 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h2><p>这里用手机测试</p>
<blockquote>
<p>手机连入和电脑相同的局域网中</p>
</blockquote>
<p>输入mac地址，通过 getmac 或 ipconfig &#x2F;all 获取</p>
<p>IP地址输入广播地址，如：192.168.31.255</p>
<p>子网掩码输入当前网络的子网掩码，如：255.255.255.0</p>
<p>端口随意，点击 Wake Up</p>
<p>即可启动电脑</p>
<h2 id="公网远程开机"><a href="#公网远程开机" class="headerlink" title="公网远程开机"></a>公网远程开机</h2><p>前提是：<strong>路由器取得公网IP</strong></p>
<blockquote>
<p>没有公网IP就打电话找网络运营商，如中国电信，让他们改<br>光猫弄成桥接模式，用路由器拨号上网，要做端口映射  </p>
</blockquote>
<p>直接百度IP</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">123.0.99.18（本机）  </span><br><span class="line">地理地址: 中国 XXX XXX XXX  </span><br><span class="line">运营商: 中国电信</span><br></pre></td></tr></table></figure>

<h4 id="路由器设置端口映射"><a href="#路由器设置端口映射" class="headerlink" title="路由器设置端口映射"></a>路由器设置端口映射</h4><p>由于路由的端口转发不支持广播地址</p>
<blockquote>
<p>“子网定向广播”，默认情况下，大多数路由器和防火墙都禁用此选项</p>
</blockquote>
<p>这里做一下 DHCP静态IP分配</p>
<table>
<thead>
<tr>
<th>设备名称</th>
<th>IP地址</th>
<th>MAC地址</th>
</tr>
</thead>
<tbody><tr>
<td>TEST-PC</td>
<td>192.168.31.111</td>
<td>AA:BB:CC:11:11:11</td>
</tr>
</tbody></table>
<p>端口转发规则列表：  </p>
<table>
<thead>
<tr>
<th>名称</th>
<th>协议</th>
<th>外部端口</th>
<th>内部IP地址</th>
<th>内部端口</th>
</tr>
</thead>
<tbody><tr>
<td>远程唤醒</td>
<td>TCP和UDP</td>
<td>999</td>
<td>192.168.31.111</td>
<td>9</td>
</tr>
</tbody></table>
<p>用唤醒工具，填入公网的ip</p>
<blockquote>
<p>设置了DDNS后就可以用域名唤醒了，不用管IP的变化</p>
</blockquote>
<p>注意子网掩码填：255.255.255.255  </p>
<blockquote>
<p>这里唤醒的是指定的IP，不再是广播了，掩码要全是1</p>
</blockquote>
<p>端口填 前面映射的999</p>
<hr>
<h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><p>配置到这里，已经可以通过因特网发送唤醒数据包到我的电脑，电脑关机后两分钟内可以再次唤醒，但是超过2分钟，唤醒操作失败，原因就是路由器arp映射表动态更新后把关机电脑的arp项删除了，导致路由器接收到魔术包后不能正确的转发。</p>
<p>参考：<br><a target="_blank" rel="noopener" href="https://github.com/melonbo/wolTool">https://github.com/melonbo/wolTool</a><br><a target="_blank" rel="noopener" href="https://www.office26.com/luyouqi/miwifi-wol-waiwang.html">https://www.office26.com/luyouqi/miwifi-wol-waiwang.html</a>  </p>
<h2 id="解决办法"><a href="#解决办法" class="headerlink" title="解决办法"></a>解决办法</h2><p>路由器开启ssh，获取root权限，配置静态arp</p>
<h3 id="配置arp"><a href="#配置arp" class="headerlink" title="配置arp"></a>配置arp</h3><p>通过ssh登录路由器</p>
<p>设置arp静态绑定mac</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">arp -s ip地址 ma地址</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<blockquote>
<p>用 man arp 查看说明</p>
</blockquote>
<p>完了可以用arp命令查看结果</p>
<h4 id="路由器重启自动配置"><a href="#路由器重启自动配置" class="headerlink" title="路由器重启自动配置"></a>路由器重启自动配置</h4><p>但是有个问题，重启之后会丢失</p>
<blockquote>
<p>window下就是永久的….</p>
</blockquote>
<p>所以我们把这条指令写到启动脚本rc.local里面</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ vi /etc/rc.local </span><br><span class="line"></span><br><span class="line"># 增加arp映射</span><br><span class="line">arp -s 192.168.31.111 XX:XX:XX:XX:XX:XX</span><br></pre></td></tr></table></figure>

<h5 id="如果需要配置多个可以考虑配置在文件中"><a href="#如果需要配置多个可以考虑配置在文件中" class="headerlink" title="如果需要配置多个可以考虑配置在文件中"></a>如果需要配置多个可以考虑配置在文件中</h5><p>查看说明可以看到有个 arp -f 命令，可以从文件中读取，默认文件是：&#x2F;etc&#x2F;ethers</p>
<p>我们在这个文件中写入配置：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/ethers</span><br><span class="line"></span><br><span class="line">192.168.31.aa XX:XX:XX:XX:XX:XX</span><br><span class="line">192.168.31.aa XX:XX:XX:XX:XX:XX</span><br></pre></td></tr></table></figure>

<p>在开机启动下加入</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/rc.local </span><br><span class="line"></span><br><span class="line">arp -f</span><br></pre></td></tr></table></figure>


<h3 id="远程桌面"><a href="#远程桌面" class="headerlink" title="远程桌面"></a>远程桌面</h3><p>在电脑上设置一下开启远程桌面，设置一个强密码<br>在路由器上再配置一个端口映射，远程桌面的端口是3389</p>
<table>
<thead>
<tr>
<th>名称</th>
<th>协议</th>
<th>外部端口</th>
<th>内部IP地址</th>
<th>内部端口</th>
</tr>
</thead>
<tbody><tr>
<td>远程桌面</td>
<td>TCP和UDP</td>
<td>43389</td>
<td>192.168.31.111</td>
<td>3389</td>
</tr>
</tbody></table>
<h4 id="远程桌面软件："><a href="#远程桌面软件：" class="headerlink" title="远程桌面软件："></a>远程桌面软件：</h4><p>电脑端：mstsc</p>
<p>手机端：RD client</p>
<hr>
<h3 id="Centos-wol-工具"><a href="#Centos-wol-工具" class="headerlink" title="Centos wol 工具"></a>Centos wol 工具</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@wol ~]# yum -y install net-tools</span><br><span class="line"># ether-wake [MAC address of the computer you&#x27;d like to turn on]</span><br><span class="line">[root@wol ~]# ether-wake 00:22:68:5E:34:06   # send magick packets</span><br></pre></td></tr></table></figure>

<p>指定接口</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ether-wake -i eth0 11:22:33:44:55</span><br></pre></td></tr></table></figure>

<h3 id="java-工具"><a href="#java-工具" class="headerlink" title="java 工具"></a>java 工具</h3><p><a target="_blank" rel="noopener" href="https://github.com/wangwen135/wol4j">https://github.com/wangwen135/wol4j</a>  </p>
<p>直接java -jar 运行</p>
<p>参数说明：Mac地址 [广播地址] [端口]</p>
<p>如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># java -jar wol4j-1.0.0.jar 22-00-DD-11-44-7A 192.168.1.255</span><br></pre></td></tr></table></figure>
<blockquote>
<p>默认端口是：9</p>
</blockquote>
<p>这个工具也是发的UDP包</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://wangwen135.github.io/MySQL/Mysql%E6%95%B0%E6%8D%AE%E6%96%87%E4%BB%B6%E5%AD%98%E6%94%BE%E4%BD%8D%E7%BD%AE%E8%B0%83%E6%95%B4/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="王某某">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="王某某的笔记">
      <meta itemprop="description" content="这是一个使用 Hexo 构建的博客，用于分享我的编程经验和学习笔记。">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 王某某的笔记">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/MySQL/Mysql%E6%95%B0%E6%8D%AE%E6%96%87%E4%BB%B6%E5%AD%98%E6%94%BE%E4%BD%8D%E7%BD%AE%E8%B0%83%E6%95%B4/" class="post-title-link" itemprop="url">Mysql数据文件存放位置调整</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-05-26 23:41:00" itemprop="dateCreated datePublished" datetime="2023-05-26T23:41:00+08:00">2023-05-26</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/MySQL/" itemprop="url" rel="index"><span itemprop="name">MySQL</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>316</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>1 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p><em>2017年7月</em></p>
<hr>
<h2 id="查看数据文件存放位置"><a href="#查看数据文件存放位置" class="headerlink" title="查看数据文件存放位置"></a>查看数据文件存放位置</h2><ol>
<li><p>通过命令查看</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">show variables like &#x27;%dir%&#x27;; </span><br><span class="line"></span><br><span class="line">show global variables like &#x27;%datadir%&#x27;;</span><br></pre></td></tr></table></figure>
<p>datadir 指数据文件存放位置</p>
</li>
<li><p>查看配置文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /etc/my.cnf</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"># For advice on how to change settings please see</span><br><span class="line"># http://dev.mysql.com/doc/refman/5.6/en/server-configuration-defaults.html</span><br><span class="line"></span><br><span class="line">[mysqld]</span><br><span class="line">#</span><br><span class="line"># Remove leading # and set to the amount of RAM for the most important data</span><br><span class="line"># cache in MySQL. Start at 70% of total RAM for dedicated server, else 10%.</span><br><span class="line"># innodb_buffer_pool_size = 128M</span><br><span class="line">#</span><br><span class="line"># Remove leading # to turn on a very important data integrity option: logging</span><br><span class="line"># changes to the binary log between backups.</span><br><span class="line"># log_bin</span><br><span class="line">#</span><br><span class="line"># Remove leading # to set options mainly useful for reporting servers.</span><br><span class="line"># The server defaults are faster for transactions and fast SELECTs.</span><br><span class="line"># Adjust sizes as needed, experiment to find the optimal values.</span><br><span class="line"># join_buffer_size = 128M</span><br><span class="line"># sort_buffer_size = 2M</span><br><span class="line"># read_rnd_buffer_size = 2M</span><br><span class="line">datadir=/var/lib/mysql</span><br><span class="line">socket=/var/lib/mysql/mysql.sock</span><br><span class="line"></span><br><span class="line"># Disabling symbolic-links is recommended to prevent assorted security risks</span><br><span class="line">symbolic-links=0</span><br><span class="line"></span><br><span class="line"># Recommended in standard MySQL setup</span><br><span class="line">sql_mode=NO_ENGINE_SUBSTITUTION,STRICT_TRANS_TABLES</span><br><span class="line"></span><br><span class="line">[mysqld_safe]</span><br><span class="line">log-error=/var/log/mysqld.log</span><br><span class="line">pid-file=/var/run/mysqld/mysqld.pid</span><br><span class="line">~                                                                  </span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="修改数据文件位置"><a href="#修改数据文件位置" class="headerlink" title="修改数据文件位置"></a>修改数据文件位置</h2><ol>
<li>停止mysql服务<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service mysqld stop  </span><br></pre></td></tr></table></figure></li>
<li>创建新的数据库存放目录<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir /data/mysql  </span><br></pre></td></tr></table></figure></li>
<li>移动&#x2F;复制之前存放数据库目录文件，到新的数据库存放目录位置 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp -R /var/lib/mysql/* /data/mysql/ </span><br></pre></td></tr></table></figure></li>
<li>修改mysql数据库目录权限<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chown mysql:mysql -R /data/mysql/</span><br></pre></td></tr></table></figure></li>
<li>修改my.cnf配置文件<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/my.cnf</span><br><span class="line">    datadir=/data/mysql （指定为新的数据存放目录）</span><br></pre></td></tr></table></figure></li>
<li>启动数据库服务<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service mysqld start</span><br></pre></td></tr></table></figure></li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://wangwen135.github.io/Zookeeper/%E6%B8%85%E7%90%86Zookeeper%E7%9A%84%E5%8E%86%E5%8F%B2%E6%95%B0%E6%8D%AE/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="王某某">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="王某某的笔记">
      <meta itemprop="description" content="这是一个使用 Hexo 构建的博客，用于分享我的编程经验和学习笔记。">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 王某某的笔记">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/Zookeeper/%E6%B8%85%E7%90%86Zookeeper%E7%9A%84%E5%8E%86%E5%8F%B2%E6%95%B0%E6%8D%AE/" class="post-title-link" itemprop="url">清理Zookeeper的历史数据</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-04-27 23:41:00" itemprop="dateCreated datePublished" datetime="2023-04-27T23:41:00+08:00">2023-04-27</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Zookeeper/" itemprop="url" rel="index"><span itemprop="name">Zookeeper</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>369</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>1 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="zkCleanup"><a href="#zkCleanup" class="headerlink" title="zkCleanup"></a>zkCleanup</h2><p>zookeeper使用一段时间后占用了非常多的磁盘空间</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@node2 zookeeper]# du -h --max-dept=1</span><br><span class="line">294G    ./version-2</span><br><span class="line">294G    .</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>使用自带的zkCleanup进行清理</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">./zkCleanup.sh </span><br><span class="line">Usage:</span><br><span class="line">PurgeTxnLog dataLogDir [snapDir] -n count</span><br><span class="line">        dataLogDir -- path to the txn log directory</span><br><span class="line">        snapDir -- path to the snapshot directory</span><br><span class="line">        count -- the number of old snaps/logs you want to keep, value should be greater than or equal to 3</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@node2 bin]# ./zkCleanup.sh /data/zookeeper -n 5</span><br><span class="line"></span><br><span class="line">......</span><br><span class="line">Removing file: Mar 10, 2018 7:57:04 PM  /data/zookeeper/version-2/log.3150c663239</span><br><span class="line">Removing file: Feb 4, 2018 5:39:46 AM   /data/zookeeper/version-2/log.313054d1843</span><br><span class="line">Removing file: Apr 20, 2018 7:40:19 PM  /data/zookeeper/version-2/log.31607ac00d7</span><br><span class="line">Removing file: Apr 6, 2018 3:33:47 PM   /data/zookeeper/version-2/log.3153be932d2</span><br><span class="line">Removing file: Mar 31, 2018 3:46:12 PM  /data/zookeeper/version-2/log.3152f255a35</span><br><span class="line">Removing file: Mar 19, 2018 1:28:12 AM  /data/zookeeper/version-2/log.31516d3c5d7</span><br><span class="line">Removing file: Jan 16, 2018 10:16:43 AM /data/zookeeper/version-2/log.31205b9f349</span><br><span class="line">Removing file: Mar 26, 2018 7:05:37 AM  /data/zookeeper/version-2/log.315245d23e8</span><br><span class="line">Removing file: Apr 12, 2018 6:31:10 AM  /data/zookeeper/version-2/log.31548340db4</span><br><span class="line">......</span><br></pre></td></tr></table></figure>

<h2 id="设置自动清理"><a href="#设置自动清理" class="headerlink" title="设置自动清理"></a>设置自动清理</h2><p>修改zoo.cfg配置文件中的 autopurge.snapRetainCount 和 autopurge.purgeInterval 两个参数实现定时清理  </p>
<p>去掉注释即可</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># The number of snapshots to retain in dataDir</span><br><span class="line">autopurge.snapRetainCount=3</span><br><span class="line"># Purge task interval in hours</span><br><span class="line"># Set to &quot;0&quot; to disable auto purge feature</span><br><span class="line">autopurge.purgeInterval=1</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<blockquote>
<p>autopurge.purgeInterval  这个参数指定了清理频率，单位是小时，需要填写一个1或更大的整数，默认是0，表示不开启自动清理功能。</p>
</blockquote>
<blockquote>
<p>autopurge.snapRetainCount 这个参数和上面的参数搭配使用，这个参数指定了需要保留的快照文件数目，默认是保留3个。</p>
</blockquote>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://wangwen135.github.io/Netty/Netty-%E7%AC%94%E8%AE%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="王某某">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="王某某的笔记">
      <meta itemprop="description" content="这是一个使用 Hexo 构建的博客，用于分享我的编程经验和学习笔记。">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 王某某的笔记">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/Netty/Netty-%E7%AC%94%E8%AE%B0/" class="post-title-link" itemprop="url">Netty-笔记</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-04-22 23:41:00" itemprop="dateCreated datePublished" datetime="2023-04-22T23:41:00+08:00">2023-04-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Netty/" itemprop="url" rel="index"><span itemprop="name">Netty</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>7.4k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>27 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p><strong>基于netty 4.x</strong></p>
<p><strong>相关页面地址</strong>：<br>4.x用户指南：<a target="_blank" rel="noopener" href="https://netty.io/wiki/user-guide-for-4.x.html">https://netty.io/wiki/user-guide-for-4.x.html</a><br>Netty Example：<a target="_blank" rel="noopener" href="https://github.com/netty/netty/tree/4.1/example/src/main/java/io/netty/example">https://github.com/netty/netty/tree/4.1/example/src/main/java/io/netty/example</a><br>API：<a target="_blank" rel="noopener" href="https://netty.io/4.1/xref/index.html">https://netty.io/4.1/xref/index.html</a></p>
<h2 id="Netty框架"><a href="#Netty框架" class="headerlink" title="Netty框架"></a>Netty框架</h2><p>Netty是一个基于NIO的异步事件驱动的网络应用程序框架和工具，使用他可以快速轻松的开发<br>出高性能和高扩展性的网络应用程序，例如自定义协议的服务器和客户端。它极大地简化和简化了网络编程，如TCP和UDP套接字服务器的开发。</p>
<h2 id="线程模型与异步处理"><a href="#线程模型与异步处理" class="headerlink" title="线程模型与异步处理"></a>线程模型与异步处理</h2><h3 id="线程模型"><a href="#线程模型" class="headerlink" title="线程模型"></a>线程模型</h3><p>Reactor（反应堆模型）<br>Reactor模式也叫Dispatcher模式，即I&#x2F;O多路复用统一监听事件，收到事件后分发(Dispatch给某进程)</p>
<blockquote>
<p>Reactor就是一个执行while (true) { selector.select(); …}循环的线程，会源源不断的产生新的事件</p>
</blockquote>
<p>Reactor模型中有2个关键组成：</p>
<ul>
<li>Reactor Reactor在一个单独的线程中运行，负责监听和分发事件，分发给适当的处理程序来对IO事件做出反应。</li>
<li>Handlers 处理程序执行I&#x2F;O事件要完成的实际事件</li>
</ul>
<p>取决于Reactor的数量和Hanndler线程数量的不同，Reactor模型有3个变种</p>
<ul>
<li>单Reactor单线程</li>
<li>单Reactor多线程</li>
<li>主从Reactor多线程</li>
</ul>
<h4 id="Netty线程模型"><a href="#Netty线程模型" class="headerlink" title="Netty线程模型"></a>Netty线程模型</h4><p>Netty主要基于主从Reactors多线程模型，其中Reactor分为：MainReactor和SubReactor：</p>
<ul>
<li>MainReactor负责客户端的连接请求，并将请求转交给SubReactor</li>
<li>SubReactor负责相应通道的IO读写请求</li>
<li>非IO请求（具体逻辑处理）的任务则会直接写入队列，等待worker threads进行处理</li>
</ul>
<p>虽然Netty的线程模型基于主从Reactor多线程，但是实际实现上SubReactor和Worker线程在同一个线程池中</p>
<ul>
<li>bossGroup线程池则只是在bind某个端口后，获得其中一个线程作为MainReactor，专门处理端口的accept事件，每个端口对应一个boss线程</li>
<li>workerGroup线程池会被各个SubReactor和worker线程充分利用</li>
</ul>
<h3 id="异步处理"><a href="#异步处理" class="headerlink" title="异步处理"></a>异步处理</h3><p>Netty中的I&#x2F;O操作是异步的，包括bind、write、connect等操作会简单的返回一个ChannelFuture，调用者并不能立刻获得结果，通过Future-Listener机制，用户可以方便的主动获取或者通过通知机制获得IO操作结果。</p>
<ul>
<li>通过isDone方法来判断当前操作是否完成</li>
<li>通过isSuccess方法来判断已完成的当前操作是否成功</li>
<li>通过getCause方法来获取已完成的当前操作失败的原因</li>
<li>通过isCancelled方法来判断已完成的当前操作是否被取消</li>
<li>通过addListener方法来注册监听器，当操作已完成(isDone方法返回完成)，将会通知指定的监听器；如果future对象已完成，则立即通知指定的监听器</li>
</ul>
<hr>
<h2 id="内存"><a href="#内存" class="headerlink" title="内存"></a>内存</h2><p>Netty中使用了自己实现的ByteBuffer，直接内存，内存池化，引用计数器等技术，重点要看一下 io.netty.buffer.ByteBuf</p>
<h3 id="ByteBuffer"><a href="#ByteBuffer" class="headerlink" title="ByteBuffer"></a>ByteBuffer</h3><p>零个或多个字节（八位字节）的随机且顺序可访问的序列。此接口提供一个或多个原始字节数组（byte []）和NIO buffers 的抽象视图。</p>
<h4 id="创建缓冲区"><a href="#创建缓冲区" class="headerlink" title="创建缓冲区"></a>创建缓冲区</h4><p>建议在Unpooled中使用辅助方法创建一个新的缓冲区，而不是调用单个实现的构造函数。</p>
<h4 id="随机存取索引"><a href="#随机存取索引" class="headerlink" title="随机存取索引"></a>随机存取索引</h4><p>就像普通的原始字节数组一样，ByteBuf使用从零开始的索引。这意味着第一个字节的索引始终为0，而最后一个字节的索引始终为-1。例如，要迭代缓冲区的所有字节，您可以不管其内部实现如何，请执行以下操作：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ByteBuf buffer = ...;</span><br><span class="line">for (int i = 0; i &lt; buffer.capacity(); i ++) &#123;</span><br><span class="line">    byte b = buffer.getByte(i);</span><br><span class="line">    System.out.println((char) b);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="顺序访问索引"><a href="#顺序访问索引" class="headerlink" title="顺序访问索引"></a>顺序访问索引</h4><p>ByteBuf提供了两个指针变量来支持顺序读取和写入操作；分别是针对读操作的readerIndex和针对写操作的writerIndex。    </p>
<blockquote>
<p>无需像使用JDK中的Buffer那样手动flip()</p>
</blockquote>
<p><strong>读操作：</strong>  </p>
<p>名称以read或skip开头的任何操作都将获取或跳过当前readerIndex处的数据，并将其增加读取字节数。如果读取操作的参数是ByteBuf，并且未指定目标索引，则指定缓冲区的writerIndex会一起增加。<br>如果没有足够的内容，则会引发IndexOutOfBoundsException。<br>新分配，包装或复制的缓冲区的readerIndex的默认值为0。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// 迭代缓冲区的可读字节</span><br><span class="line">ByteBuf buffer = ...;</span><br><span class="line">while (buffer.isReadable()) &#123;</span><br><span class="line">    System.out.println(buffer.readByte());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p><strong>写操作：</strong></p>
<p>名称以write开头的任何操作都将在当前writerIndex处写入数据，并将增加其writerIndex的计数。如果写操作的参数是ByteBuf，并且未指定源索引，则指定缓冲区的readerIndex会一起增加。<br>如果没有足够的可写字节，则引发IndexOutOfBoundsException。新分配的缓冲区的writerIndex的默认值为0。包装或复制的缓冲区的writerIndex的默认值为缓冲区的容量。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// 用随机整数填充缓冲区的可写字节</span><br><span class="line">ByteBuf buffer = ...;</span><br><span class="line">while (buffer.maxWritableBytes() &gt;= 4) &#123;</span><br><span class="line">    buffer.writeInt(random.nextInt());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><strong>丢弃已经读取的字节：</strong></p>
<p>通过调用discardReadBytes()来丢弃已经读取的字节，以回收使用的字节区域。</p>
<p>示例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"> 调用 discardReadBytes() 之前 （已经读取了一定的字节）</span><br><span class="line"></span><br><span class="line">     +-------------------+------------------+------------------+</span><br><span class="line">     | discardable bytes |  readable bytes  |  writable bytes  |</span><br><span class="line">     +-------------------+------------------+------------------+</span><br><span class="line">     |                   |                  |                  |</span><br><span class="line">     0      &lt;=      readerIndex   &lt;=   writerIndex    &lt;=    capacity</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> 调用 discardReadBytes()之后 （相关指针前移，已经读取过的内容被丢弃）</span><br><span class="line"></span><br><span class="line">     +------------------+--------------------------------------+</span><br><span class="line">     |  readable bytes  |    writable bytes (got more space)   |</span><br><span class="line">     +------------------+--------------------------------------+</span><br><span class="line">     |                  |                                      |</span><br><span class="line">readerIndex (0) &lt;= writerIndex (decreased)        &lt;=        capacity</span><br></pre></td></tr></table></figure>



<p><strong>清除缓冲区索引：</strong></p>
<p>可以通过调用clear()将readerIndex和writerIndex都设置为0，它不会清除缓冲区内容（例如填充0），而只是清除两个指针。</p>
<blockquote>
<p><strong>请注意，此操作的语义与java.nio.ByteBuffer.clear()不同。</strong></p>
</blockquote>
<h4 id="搜索操作"><a href="#搜索操作" class="headerlink" title="搜索操作"></a>搜索操作</h4><p>对于简单的单字节搜索，请使用indexOf(int，int，byte) 和 bytesBefore(int，int，byte) 。当处理以NUL结尾的字符串时，bytesBefore(byte) 特别有用。对于复杂的搜索，请使用带有ByteProcessorimplementation的forEachByte(int，int，ByteProcessor)。</p>
<h4 id="标记和重置"><a href="#标记和重置" class="headerlink" title="标记和重置"></a>标记和重置</h4><p>每个缓冲区中都有两个标记索引。一种用于存储readerIndex，另一种用于存储writerIndex。您始终可以通过调用reset方法来重新定位两个索引之一。除了没有readlimit以外，它的工作方式与InputStream中的mark和reset方法类似。</p>
<h4 id="派生缓冲区"><a href="#派生缓冲区" class="headerlink" title="派生缓冲区"></a>派生缓冲区</h4><p>您可以通过调用以下方法之一来创建现有缓冲区的视图：</p>
<ul>
<li>duplicate()</li>
<li>slice()</li>
<li>slice(int, int)</li>
<li>readSlice(int)</li>
<li>retainedDuplicate()</li>
<li>retainedSlice()</li>
<li>retainedSlice(int, int)</li>
<li>readRetainedSlice(int)</li>
</ul>
<p>派生的缓冲区将具有独立的readerIndex，writerIndex和标记索引，而它共享其他内部数据表示形式，就像NIO缓冲区一样。<br>如果需要现有缓冲区的全新副本，请调用 copy( ) 方法。</p>
<h4 id="非保留和保留派生缓冲区"><a href="#非保留和保留派生缓冲区" class="headerlink" title="非保留和保留派生缓冲区"></a>非保留和保留派生缓冲区</h4><p>请注意，plicate()，slice()，slice(int，int)和readSlice(int) 不会在返回的派生缓冲区上调用retain()，因此不会增加其引用计数。如果需要创建具有增加的引用计数的派生缓冲区，请考虑使用retainedDuplicate()，retainedSlice()，retainedSlice(int，int) 和 readRetainedSlice(int)，这可能会返回产生较少垃圾的缓冲区实现。</p>
<h4 id="转换为现有的JDK类型"><a href="#转换为现有的JDK类型" class="headerlink" title="转换为现有的JDK类型"></a>转换为现有的JDK类型</h4><p><strong>字节数组</strong></p>
<p>如果ByteBuf由字节数组（即byte []）支持，则可以直接通过array()方法访问它。要确定缓冲区是否由字节数组支持，应使用hasArray()。</p>
<p><strong>NIO缓冲区</strong></p>
<p>如果ByteBuf可以转换为共享其内容的NIO ByteBuffer（即视图缓冲区），则可以通过nioBuffer()方法获取它。要确定是否可以将缓冲区转换为NIO缓冲区，请使用nioBufferCount()。</p>
<p><strong>String</strong></p>
<p>各种toString(Charset)方法将ByteBufin转换为String。请注意，toString()不是转换方法。</p>
<p><strong>I&#x2F;O流</strong></p>
<p>请参考ByteBufInputStream和ByteBufOutputStream。</p>
<hr>
<h3 id="计数引用"><a href="#计数引用" class="headerlink" title="计数引用"></a>计数引用</h3><p>ByteBuf 实现了 ReferenceCounted 接口</p>
<p>在Netty handler的设计规范中，所有输入的数据在处理结束时都会调用ReferenceCountUtil.release()释放，只是具体释放方法根据池化、非池化、直接内存、堆内存的不同实现不同。</p>
<h4 id="ReferenceCounted"><a href="#ReferenceCounted" class="headerlink" title="ReferenceCounted"></a>ReferenceCounted</h4><p>一个引用计数的对象，需要显式取消分配。</p>
<p>实例化一个新的ReferenceCounted时，它以引用计数为1开头。keep() 增加引用计数，release() 减少引用计数。<br>如果引用计数减小为0，则将显式释放该对象，并且 访问已释放对象通常会导致访问冲突。</p>
<p>如果实现ReferenceCounted的对象是其他实现ReferenceCounted的对象的容器，则当容器的引用计数变为0时，包含的对象也将通过release() 释放。</p>
<h4 id="ReferenceCountUtil"><a href="#ReferenceCountUtil" class="headerlink" title="ReferenceCountUtil"></a>ReferenceCountUtil</h4><p>一个工具方法集合，处理的对象需要实现 ReferenceCounted</p>
<h3 id="直接内存（堆外内存）"><a href="#直接内存（堆外内存）" class="headerlink" title="直接内存（堆外内存）"></a>直接内存（堆外内存）</h3><p>实现零拷贝，既使用时无需将内存从系统空间复制到用户空间</p>
<p>主要是指接收和发送 ByteBuffer 使用虚拟机的堆外内存，不用将内存内容拷贝到jvm的堆中</p>
<h3 id="内存块池化"><a href="#内存块池化" class="headerlink" title="内存块池化"></a>内存块池化</h3><p>对于堆外内存的申请分配以及释放是一个比较耗时的操作，不能像jvm中一样快（jvm已经提前像系统申请了一块内存空间）<br>Netty为了重用这些内存，将内存分成一块一块的小内存，然后将内存块像线程池中的线程一样重复使用，来避免重复的分配和回收操作。（据说性能超高，没有测试过）  </p>
<h3 id="ByteBufAllocator"><a href="#ByteBufAllocator" class="headerlink" title="ByteBufAllocator"></a>ByteBufAllocator</h3><p>实现负责分配缓冲区。这个接口的实现应该是线程安全的。</p>
<h4 id="UnpooledByteBufAllocator"><a href="#UnpooledByteBufAllocator" class="headerlink" title="UnpooledByteBufAllocator"></a>UnpooledByteBufAllocator</h4><p>非池化内存分配器</p>
<h4 id="PooledByteBufAllocator"><a href="#PooledByteBufAllocator" class="headerlink" title="PooledByteBufAllocator"></a>PooledByteBufAllocator</h4><p>池化内存分配器</p>
<h3 id="io-netty-buffer-Unpooled"><a href="#io-netty-buffer-Unpooled" class="headerlink" title="io.netty.buffer.Unpooled"></a>io.netty.buffer.Unpooled</h3><p>通过分配新空间或包装或复制现有字节数组、字节缓冲区和字符串来创建新的ByteBuf。</p>
<p><strong>静态方法</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">import static io.netty.buffer.Unpooled.*;</span><br><span class="line"></span><br><span class="line">ByteBuf heapBuffer    = buffer(128);</span><br><span class="line">ByteBuf directBuffer  = directBuffer(256);</span><br><span class="line">ByteBuf wrappedBuffer = wrappedBuffer(new byte[128], new byte[256]);</span><br><span class="line">ByteBuf copiedBuffer  = copiedBuffer(ByteBuffer.allocate(128));</span><br></pre></td></tr></table></figure>

<p><strong>分配新缓冲区</strong><br>buffer(int) 分配一个新的固定容量堆缓冲区。<br>directBuffer(int) 分配一个新的固定容量直接缓冲区。</p>
<p><strong>创建包装的缓冲区</strong><br>包装缓冲区是一种缓冲区，它是一个或多个现有字节数组和字节缓冲区的视图。原始数组或缓冲区内容的任何更改都将在包装的缓冲区中可见。提供了各种包装方法，它们的名称全为wrappedBuffer()。如果要创建一个由多个数组组成的缓冲区以减少内存副本的数量，则可能需要仔细研究一下接受varargs的方法。</p>
<p><strong>创建复制的缓冲区</strong><br>复制缓冲区是一个或多个现有字节数组，字节缓冲区或字符串的深层副本。与包装的缓冲区不同，原始数据和复制的缓冲区之间没有共享数据。提供了各种复制方法，它们的名称全为copyedBuffer()。使用此操作将多个缓冲区合并为一个缓冲区也很方便。</p>
<hr>
<h2 id="重点类介绍"><a href="#重点类介绍" class="headerlink" title="重点类介绍"></a>重点类介绍</h2><h3 id="启动辅助类"><a href="#启动辅助类" class="headerlink" title="启动辅助类"></a>启动辅助类</h3><h4 id="ServerBootstrap"><a href="#ServerBootstrap" class="headerlink" title="ServerBootstrap"></a>ServerBootstrap</h4><p><strong>服务端用</strong> </p>
<p>ServerBootstrapAcceptor的channelRead方法，<br>会将进入的连接注册到workerGroup （NioEventLoopGroup）中，之后的读写以及业务操作就是NioEventLoopGroup中的EventLoop来处理了</p>
<p>注册时会有一定的机制（DefaultEventExecutorChooserFactory，就是轮询）来决定用哪一个EventLoop来处理本次连接</p>
<h4 id="Bootstrap"><a href="#Bootstrap" class="headerlink" title="Bootstrap"></a>Bootstrap</h4><p><strong>客户端用</strong> </p>
<p>bind()方法与无连接传输如数据报（UDP）结合使用非常有用。对于常规TCP连接，请使用提供的connect()方法。</p>
<h3 id="Channel-（通道）"><a href="#Channel-（通道）" class="headerlink" title="Channel （通道）"></a>Channel （通道）</h3><p>网络套接字或能够进行I&#x2F;O操作(如读、写、连接和绑定)的组件的连接。</p>
<p><strong>通道为用户提供:</strong>  </p>
<ul>
<li>通道的当前状态(例如：是否打开，是否是连接状态)</li>
<li>通道的配置参数(例如接收缓冲区大小)</li>
<li>通道支持的I&#x2F;O操作(例如，读、写、连接和绑定)</li>
<li>ChannelPipeline处理与通道相关的所有I&#x2F;O事件和请求。</li>
</ul>
<p><strong>所有I&#x2F;O操作都是异步的</strong><br>Netty中的所有I&#x2F;O操作都是异步的。这意味着任何I&#x2F;O调用将立即返回，而不能保证所请求的I&#x2F;O操作在调用结束时已经完成。返回一个ChannelFuture实例，该实例将在请求的I&#x2F;O操作成功、失败或取消时通知你。</p>
<p><strong>释放资源</strong><br>一旦Channel使用完毕，调用ChannelOutboundInvoker.close()或ChannelOutboundInvoker.close(ChannelPromise)释放所有资源非常重要。这样可确保以适当的方式释放所有资源，如文件描述符。</p>
<h4 id="SocketChannel"><a href="#SocketChannel" class="headerlink" title="SocketChannel"></a>SocketChannel</h4><p>TCP&#x2F;IP套接字通道</p>
<p>两个常用子类<br><strong>NioServerSocketChannel</strong>  用于服务端，它使用基于NIO选择器的实现来接受新连接。<br><strong>NioSocketChannel</strong> 用于客户端，它使用基于NIO选择器的实现  </p>
<h4 id="DatagramChannel"><a href="#DatagramChannel" class="headerlink" title="DatagramChannel"></a>DatagramChannel</h4><p>UDP&#x2F;IP 通道</p>
<p>常用子类<br><strong>NioDatagramChannel</strong> NIO的UDP数据包通道</p>
<h3 id="NioEventLoop-（事件循环）"><a href="#NioEventLoop-（事件循环）" class="headerlink" title="NioEventLoop （事件循环）"></a>NioEventLoop （事件循环）</h3><p>SingleThreadEventLoop的实现，它将Channel注册到选择器中，并且在事件循环中对它们进行多路复用。<br>该类在单个线程中以有序&#x2F;串行的方式执行提交的所有任务。</p>
<p>本质上是一个单线程的线程池，通过execute方法提交的任务都将被这个Thread线程来执行</p>
<p>在注册时会执行execute方法，调用doStartThread，启动事件循环</p>
<blockquote>
<p> 调用doStartThread 只会执行一次</p>
</blockquote>
<p>代码在：</p>
<blockquote>
<p>SingleThreadEventExecutor.doStartThread()<br>SingleThreadEventExecutor.this.run();</p>
</blockquote>
<p>里面有个固定无限循环，来判断selector中是否有事件</p>
<p>就像我们写NOI的那个循环一样  </p>
<blockquote>
<p>NioEventLoop.run()</p>
</blockquote>
<blockquote>
<p>还实现了：ScheduledExecutorService 调度线程池</p>
</blockquote>
<p>channel 会绑定到一个eventLoop中，这个channel对应的所有操作都会由这个eventLoop来执行,<br>包括所有的IO操作和handler中业务逻辑</p>
<p>但是多个channel 可能会被分配到同一个eventLoop中</p>
<p>因为是单线程的，它将以有序&#x2F;串行方式处理所有提交的任务，这样不必要考虑并发同步的问题。</p>
<h3 id="NioEventLoopGroup-（事件循环组）"><a href="#NioEventLoopGroup-（事件循环组）" class="headerlink" title="NioEventLoopGroup （事件循环组）"></a>NioEventLoopGroup （事件循环组）</h3><p>MultithreadEventLoopGroup的实现，用于基于NIO 选择器的Channel。<br>它同时使用多个线程处理它的任务，通过它的next()方法提供要使用的EventExecutor。除此之外，它还负责处理它们的生命周期，并允许以全局方式关闭它们。</p>
<blockquote>
<p>new NioEventLoopGroup() 没有参数时:</p>
<ul>
<li>默认的NioEventLoop的数量是机器CPU数量的两倍</li>
<li>默认的拒绝策略是：拒绝（抛异常）</li>
<li>eventLoop做事件循环时的Selector如果没有指定将使用系统默认的，如windows的WindowsSelectorProvider</li>
</ul>
</blockquote>
<p>NioEventLoopGroup是用来管理NioEventLoop的，里面有一个 <code>EventExecutor[] children; </code>管理着这个组下的全部事件循环EventLoop对象</p>
<p>初始化时会实例化全部的NioEventLoop对象，通过 <code>EventLoop newChild(Executor executor, Object... args)</code> 方法</p>
<p>channel初始化时会进行注册，注册通道时调用 <code>next().register(channel)</code></p>
<p>服务端程序在 ServerBootstrapAcceptor 的channelRead 方法中将新的channel注册到workerGroup中</p>
<p>next方法会通过EventExecutorChooser（默认轮询）来获取EventExecutor（NioEventLoop）</p>
<blockquote>
<p><strong>bossGroup</strong> 只需要一个 NioEventLoop 就可以了，只负责将channel注册到 workerGroup 中<br><strong>workerGroup</strong> 默认CPU核心数*2 个NioEventLoop</p>
</blockquote>
<h3 id="ChannelPipeline-（管道）"><a href="#ChannelPipeline-（管道）" class="headerlink" title="ChannelPipeline （管道）"></a>ChannelPipeline （管道）</h3><p>ChannelHandler的列表，用于处理或拦截Channel的入站事件和出站操作。<br>ChannelPipeline实现了一种高级的拦截、过滤模式，以使用户可以完全控制事件的处理方式以及管道中的ChannelHandler如何相互交互。</p>
<p>每个Channel都有其自己的ChannelPipeline，并且在创建新Channel时会自动创建它。</p>
<p>下图描述了ChannelPipeline典型地ChannelHandler如何处理I&#x2F;O事件。 I&#x2F;O事件由ChannelInboundHandler或ChannelOutboundHandler处理，并通过调用ChannelHandlerContext中定义的事件传播方法（例如ChannelHandlerContext.fireChannelRead(Object)和ChannelHandlerContext.write(Object)）转发到其最近的处理程序。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">                                               I/O Request</span><br><span class="line">                                          via &#123;@link Channel&#125; or</span><br><span class="line">                                      &#123;@link ChannelHandlerContext&#125;</span><br><span class="line">                                                    |</span><br><span class="line">+---------------------------------------------------+---------------+</span><br><span class="line">|                           ChannelPipeline         |               |</span><br><span class="line">|                                                  \|/              |</span><br><span class="line">|    +---------------------+            +-----------+----------+    |</span><br><span class="line">|    | Inbound Handler  N  |            | Outbound Handler  1  |    |</span><br><span class="line">|    +----------+----------+            +-----------+----------+    |</span><br><span class="line">|              /|\                                  |               |</span><br><span class="line">|               |                                  \|/              |</span><br><span class="line">|    +----------+----------+            +-----------+----------+    |</span><br><span class="line">|    | Inbound Handler N-1 |            | Outbound Handler  2  |    |</span><br><span class="line">|    +----------+----------+            +-----------+----------+    |</span><br><span class="line">|              /|\                                  .               |</span><br><span class="line">|               .                                   .               |</span><br><span class="line">| ChannelHandlerContext.fireIN_EVT() ChannelHandlerContext.OUT_EVT()|</span><br><span class="line">|        [ method call]                       [method call]         |</span><br><span class="line">|               .                                   .               |</span><br><span class="line">|               .                                  \|/              |</span><br><span class="line">|    +----------+----------+            +-----------+----------+    |</span><br><span class="line">|    | Inbound Handler  2  |            | Outbound Handler M-1 |    |</span><br><span class="line">|    +----------+----------+            +-----------+----------+    |</span><br><span class="line">|              /|\                                  |               |</span><br><span class="line">|               |                                  \|/              |</span><br><span class="line">|    +----------+----------+            +-----------+----------+    |</span><br><span class="line">|    | Inbound Handler  1  |            | Outbound Handler  M  |    |</span><br><span class="line">|    +----------+----------+            +-----------+----------+    |</span><br><span class="line">|              /|\                                  |               |</span><br><span class="line">+---------------+-----------------------------------+---------------+</span><br><span class="line">                |                                  \|/</span><br><span class="line">+---------------+-----------------------------------+---------------+</span><br><span class="line">|               |                                   |               |</span><br><span class="line">|       [ Socket.read() ]                    [ Socket.write() ]     |</span><br><span class="line">|                                                                   |</span><br><span class="line">|  Netty Internal I/O Threads (Transport Implementation)            |</span><br><span class="line">+-------------------------------------------------------------------+</span><br></pre></td></tr></table></figure>


<p>入站事件由入站处理程序在自下而上的方向上进行处理，如该图的左侧所示。入站处理程序通常处理由图底部的I&#x2F;O线程生成的入站数据。通常通过实际的输入操作（例如SocketChannel.read（ByteBuffer））从远程对等方读取入站数据。如果入站事件超出了顶部入站处理程序的范围，则将其静默丢弃，或者在需要引起注意时将其记录下来。</p>
<p>出站事件由出站处理程序按自上而下的方向进行处理，如该图的右侧所示。出站处理程序通常会生成或转换出站流量（例如写请求）。如果出站事件超出了底部出站处理程序，则由与通道关联的I&#x2F;O线程处理。 I&#x2F;O线程通常执行实际的输出操作，例如SocketChannel.write（ByteBuffer）。</p>
<p>假设我们创建了如下的管道</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ChannelPipeline p = ...;</span><br><span class="line">p.addLast(&quot;1&quot;, new InboundHandlerA());</span><br><span class="line">p.addLast(&quot;2&quot;, new InboundHandlerB());</span><br><span class="line">p.addLast(&quot;3&quot;, new OutboundHandlerA());</span><br><span class="line">p.addLast(&quot;4&quot;, new OutboundHandlerB());</span><br><span class="line">p.addLast(&quot;5&quot;, new InboundOutboundHandlerX());</span><br></pre></td></tr></table></figure>

<p>在上面的示例中，名称以Inbound开头的类表示它是一个入站处理程序。名称以Outbound开头的类表示它是一个出站处理程序。<br>在给定的示例配置中，事件进入时处理程序的评估顺序为1、2、3、4、5。事件离开时，处理程序的评估顺序为5、4、3、2、1。   </p>
<p>ChannelPipeline跳过某些处理程序的评估，以缩短堆栈深度：</p>
<ul>
<li>3和4没有实现ChannelInboundHandler，因此入站事件的实际评估顺序为：1、2和5。</li>
<li>1和2没有实现ChannelOutboundHandler，因此出站事件的实际评估顺序为：5、4和3。</li>
<li>如5同时实现ChannelInboundHandler和ChannelOutboundHandler，则入站和出站事件的评估顺序可能分别为1 2 5和5 4 3。</li>
</ul>
<p>ChannelPipeline是线程安全的，也就是说，我们可以动态的添加、删除其中的ChannelHandler。考虑这样的场景：服务器需要对用户登录信息进行加密，而其他信息不加密，则可以首先将加密Handler添加到ChannelPipeline，验证完用户信息后，主动从ChnanelPipeline中删除，从而实现该需求</p>
<h3 id="ChannelHandlerContext-（处理器的上下文）"><a href="#ChannelHandlerContext-（处理器的上下文）" class="headerlink" title="ChannelHandlerContext （处理器的上下文）"></a>ChannelHandlerContext （处理器的上下文）</h3><p>channelHandler 的上下文对象，使ChannelHandler可以与ChannelPipeline中的其他Handler进行交互。<br>使用上下文对象，ChannelHandler可以在上下游传递事件，动态修改管道（在管道中动态的插入或删除ChannelHandler）或存储特定于处理程序的信息（使用AttributeKeys）。</p>
<p><strong>结合ChannelPipeline</strong><br>处理程序必须调用ChannelHandlerContext中的事件传播方法，以将事件转发到其下一个处理程序。这些方法包括：</p>
<p>入站事件传播方法：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">ChannelHandlerContext.fireChannelRegistered()</span><br><span class="line">ChannelHandlerContext.fireChannelActive()</span><br><span class="line">ChannelHandlerContext.fireChannelRead(Object)</span><br><span class="line">ChannelHandlerContext.fireChannelReadComplete()</span><br><span class="line">ChannelHandlerContext.fireExceptionCaught(Throwable)</span><br><span class="line">ChannelHandlerContext.fireUserEventTriggered(Object)</span><br><span class="line">ChannelHandlerContext.fireChannelWritabilityChanged()</span><br><span class="line">ChannelHandlerContext.fireChannelInactive()</span><br><span class="line">ChannelHandlerContext.fireChannelUnregistered()</span><br></pre></td></tr></table></figure>
<p>出站事件传播方法：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ChannelHandlerContext.bind(SocketAddress，ChannelPromise)</span><br><span class="line">ChannelHandlerContext.connect(SocketAddress，SocketAddress，ChannelPromise)</span><br><span class="line">ChannelHandlerContext.write(Object，ChannelPromise)</span><br><span class="line">ChannelHandlerContext.flush()</span><br><span class="line">ChannelHandlerContext.read()</span><br><span class="line">ChannelHandlerContext.disconnect(ChannelPromise)</span><br><span class="line">ChannelHandlerContext.close(ChannelPromise)</span><br><span class="line">ChannelHandlerContext.deregister(ChannelPromise)</span><br></pre></td></tr></table></figure>

<p>如何进行事件传播:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">public class MyInboundHandler extends ChannelInboundHandlerAdapter &#123;</span><br><span class="line">     @Override</span><br><span class="line">     public void channelActive(ChannelHandlerContext ctx) &#123;</span><br><span class="line">         System.out.println(&quot;Connected!&quot;);</span><br><span class="line">         ctx.fireChannelActive();</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> public class MyOutboundHandler extends ChannelOutboundHandlerAdapter &#123;</span><br><span class="line">     @Override</span><br><span class="line">     public void close(ChannelHandlerContext ctx, ChannelPromise promise) &#123;</span><br><span class="line">         System.out.println(&quot;Closing ..&quot;);</span><br><span class="line">         ctx.close(promise);</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>



<h3 id="ChannelInitializer（通道初始化器）"><a href="#ChannelInitializer（通道初始化器）" class="headerlink" title="ChannelInitializer（通道初始化器）"></a>ChannelInitializer（通道初始化器）</h3><p>一个特殊的ChannelHandler，用于给ChannelPipeline绑定handler<br>在连接建立时会调用handlerAdded方法然后调用initChannel方法，然后执行我们编写的<br>channelPipeline.addLast(new StringDecoder())<br>等代码，这里使用的是new 一个新对象，这样就能给每一个连接创建独立的handler实例了，这些实例就可以保存各种状态</p>
<hr>
<h3 id="ChannelHandler（处理器）"><a href="#ChannelHandler（处理器）" class="headerlink" title="ChannelHandler（处理器）"></a>ChannelHandler（处理器）</h3><p>处理网络IO事件，对消息进行编码解码，和一定的业务逻辑处理。我们主要就实现各种Handler。  </p>
<blockquote>
<p>过长时间的业务逻辑代码如果编写在ChannelHandler中，不能直接在workerGroup线程池中处理，可能阻塞其他的IO操作<br>通过外部线程池，或指定Handler的执行线程池来处理</p>
</blockquote>
<p>通常必须实现下面的两个子类之一：</p>
<ol>
<li>ChannelInboundHandler 处理入站I&#x2F;O事件</li>
<li>ChannelOutboundHandler 处理出站I&#x2F;O事件</li>
</ol>
<p>另外还提供了以下适配器类：  </p>
<ul>
<li>ChannelInboundHandlerAdapter 处理入站I&#x2F;O事件</li>
<li>ChannelOutboundHandlerAdapter 处理出站I&#x2F;事件</li>
<li>ChannelDuplexHandler 可以处理入站和出站事件</li>
</ul>
<h4 id="Handler中的状态管理"><a href="#Handler中的状态管理" class="headerlink" title="Handler中的状态管理"></a>Handler中的状态管理</h4><h5 id="1-在Handler实现类中使用成员变量控制状态"><a href="#1-在Handler实现类中使用成员变量控制状态" class="headerlink" title="1. 在Handler实现类中使用成员变量控制状态"></a>1. 在Handler实现类中使用成员变量控制状态</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">public class DataServerHandler extends SimpleChannelInboundHandler&lt;Message&gt; &#123;</span><br><span class="line"></span><br><span class="line">     private boolean loggedIn;</span><br><span class="line"></span><br><span class="line">     @Override</span><br><span class="line">     public void channelRead0(ChannelHandlerContext ctx, Message message) &#123;</span><br><span class="line">         if (message instanceof LoginMessage) &#123;</span><br><span class="line">             authenticate((LoginMessage) message);</span><br><span class="line">             loggedIn = true;</span><br><span class="line">         &#125; else (message instanceof GetDataMessage) &#123;</span><br><span class="line">             if (loggedIn) &#123;</span><br><span class="line">                 ctx.writeAndFlush(fetchSecret((GetDataMessage) message));</span><br><span class="line">             &#125; else &#123;</span><br><span class="line">                 fail();</span><br><span class="line">             &#125;</span><br><span class="line">         &#125;</span><br><span class="line">     &#125;</span><br><span class="line">     ...</span><br><span class="line"> &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>因为处理程序实例具有专用于一个连接的状态变量，所以您必须为每个新通道创建一个新的处理程序实例</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">public class DataServerInitializer extends ChannelInitializer&lt;Channel&gt; &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public void initChannel(Channel channel) &#123;</span><br><span class="line">        channel.pipeline().addLast(&quot;handler&quot;, new DataServerHandler());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="2-使用ChannelHandlerContext提供的AttributeKey"><a href="#2-使用ChannelHandlerContext提供的AttributeKey" class="headerlink" title="2. 使用ChannelHandlerContext提供的AttributeKey"></a>2. 使用ChannelHandlerContext提供的AttributeKey</h5><p>当不想创建许多处理器的实例时，用可以使用ChannelHandlerContext提供的AttributeKey来存储程序的状态信息</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">@Sharable</span><br><span class="line"> public class DataServerHandler extends SimpleChannelInboundHandler&lt;Message&gt; &#123;</span><br><span class="line">     private final AttributeKey&lt;Boolean&gt; auth =</span><br><span class="line">           AttributeKey.valueOf(&quot;auth&quot;);</span><br><span class="line"></span><br><span class="line">     @Override</span><br><span class="line">     public void channelRead(ChannelHandlerContext ctx, Message message) &#123;</span><br><span class="line">         Attribute&lt;Boolean&gt; attr = ctx.attr(auth);</span><br><span class="line">         if (message instanceof LoginMessage) &#123;</span><br><span class="line">             authenticate((LoginMessage) o);</span><br><span class="line">             attr.set(true);</span><br><span class="line">         &#125; else (message instanceof GetDataMessage) &#123;</span><br><span class="line">             if (Boolean.TRUE.equals(attr.get())) &#123;</span><br><span class="line">                 ctx.writeAndFlush(fetchSecret((GetDataMessage) o));</span><br><span class="line">             &#125; else &#123;</span><br><span class="line">                 fail();</span><br><span class="line">             &#125;</span><br><span class="line">         &#125;</span><br><span class="line">     &#125;</span><br><span class="line">     ...</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<p>只需要一个处理器的实例即可</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">public class DataServerInitializer extends ChannelInitializer&lt;Channel&gt; &#123;</span><br><span class="line"></span><br><span class="line">    private static final DataServerHandler SHARED = new DataServerHandler();</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void initChannel(Channel channel) &#123;</span><br><span class="line">        channel.pipeline().addLast(&quot;handler&quot;, SHARED);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>要注意这些ChannelHandler的线程安全性</p>
<h4 id="Sharable注解"><a href="#Sharable注解" class="headerlink" title="@Sharable注解"></a>@Sharable注解</h4><p><strong>提供此注释是为了文档目的，就像JCIP注释一样。实际上是否创建多个实例取决于上面的两种写法</strong></p>
<p>如果ChannelHandler使用@Sharable注解进行标注，则表示可以只创建一次该处理程器的实例，然后将其多次添加到一个或多个ChannelPipelines中</p>
<p>如果未指定此注释，则每次将其添加到管道时都必须创建一个新的处理程序实例，因为它具有未共享的状态，例如成员变量。</p>
<hr>
<h2 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h2><h3 id="ChannelOption"><a href="#ChannelOption" class="headerlink" title="ChannelOption"></a>ChannelOption</h3><p>ChannelOption允许以类型安全的方式配置ChannelConfig。 支持哪个ChannelOption取决于ChannelConfig的实际实现，并且可能取决于其所属传输的性质。</p>
<h3 id="ChannelConfig"><a href="#ChannelConfig" class="headerlink" title="ChannelConfig"></a>ChannelConfig</h3><p>通道的一组配置属性</p>
<p>请向下转换为更特定的配置类型，例如SocketChannelConfig或使用setOptions（Map）设置特定于传输的属性：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Channel ch = ...;</span><br><span class="line">SocketChannelConfig cfg = (SocketChannelConfig) ch.getConfig();</span><br><span class="line">cfg.setTcpNoDelay(false);</span><br></pre></td></tr></table></figure>



<p><strong>Option map</strong></p>
<p>选项map 属性是动态只写属性，它允许配置Channel而不向下转换其关联的ChannelConfig。要更新选项map，请调用setOptions(Map)。<br>所有ChannelConfig都具有以下选项：</p>
<table>
<thead>
<tr>
<th>名称</th>
<th>关联的setter方法</th>
</tr>
</thead>
<tbody><tr>
<td>ChannelOption.CONNECT_TIMEOUT_MILLIS</td>
<td>setConnectTimeoutMillis(int)</td>
</tr>
<tr>
<td>ChannelOption.WRITE_SPIN_COUNT</td>
<td>setWriteSpinCount(int)</td>
</tr>
<tr>
<td>ChannelOption.WRITE_BUFFER_WATER_MARK</td>
<td>setWriteBufferWaterMark(WriteBufferWaterMark)</td>
</tr>
<tr>
<td>ChannelOption.ALLOCATOR</td>
<td>setAllocator(ByteBufAllocator)</td>
</tr>
<tr>
<td>ChannelOption.AUTO_READ</td>
<td>setAutoRead(boolean)</td>
</tr>
</tbody></table>
<h4 id="SocketChannelConfig"><a href="#SocketChannelConfig" class="headerlink" title="SocketChannelConfig"></a>SocketChannelConfig</h4><p><strong>可用选项</strong></p>
<p>除了ChannelConfig提供的选项外，SocketChannelConfig允许在选项映射中使用以下选项:</p>
<table>
<thead>
<tr>
<th>名称</th>
<th>关联的setter方法</th>
</tr>
</thead>
<tbody><tr>
<td>ChannelOption.SO_KEEPALIVE</td>
<td>setKeepAlive(boolean)</td>
</tr>
<tr>
<td>ChannelOption.SO_REUSEADDR</td>
<td>setReuseAddress(boolean)</td>
</tr>
<tr>
<td>ChannelOption.SO_LINGER</td>
<td>setSoLinger(int)</td>
</tr>
<tr>
<td>ChannelOption.TCP_NODELAY</td>
<td>setTcpNoDelay(boolean)</td>
</tr>
<tr>
<td>ChannelOption.SO_RCVBUF</td>
<td>setReceiveBufferSize(int)</td>
</tr>
<tr>
<td>ChannelOption.SO_SNDBUF</td>
<td>setSendBufferSize(int)</td>
</tr>
<tr>
<td>ChannelOption.IP_TOS</td>
<td>setTrafficClass(int)</td>
</tr>
<tr>
<td>ChannelOption.ALLOW_HALF_CLOSURE</td>
<td>setAllowHalfClosure(boolean)</td>
</tr>
</tbody></table>
<h3 id="主动释放对象"><a href="#主动释放对象" class="headerlink" title="主动释放对象"></a>主动释放对象</h3><p>这里主要指的是ByteBuf  </p>
<p>ByteBuf是一个引用计数对象（ReferenceCounted），必须通过该release()方法显式释放它。请记住，释放任何传递给处理程序的引用计数对象是处理程序的责任。通常，channelRead()处理程序方法的实现如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">public void channelRead(ChannelHandlerContext ctx, Object msg) &#123;</span><br><span class="line">    try &#123;</span><br><span class="line">        // Do something with msg</span><br><span class="line">    &#125; finally &#123;</span><br><span class="line">        ReferenceCountUtil.release(msg);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>




<h3 id="读数据"><a href="#读数据" class="headerlink" title="读数据"></a>读数据</h3><h4 id="从字节流到数据包（碎片化问题）"><a href="#从字节流到数据包（碎片化问题）" class="headerlink" title="从字节流到数据包（碎片化问题）"></a>从字节流到数据包（碎片化问题）</h4><p>在基于流的传输（例如TCP &#x2F; IP）中，将接收到的数据存储到套接字接收缓冲区中。基于流的传输的缓冲区不是数据包队列而是字节队列。这意味着，即使您将两个消息作为两个独立的数据包发送，操作系统也不会将它们视为两个消息，而只是一堆字节。因此，不能保证你读到的内容与远程对等方写的完全一样。</p>
<p>例如，让我们假设操作系统的TCP&#x2F;IP堆栈已收到三个数据包：  </p>
<blockquote>
<p>【ABC】【DEF】【GHI】  </p>
</blockquote>
<p>由于是基于流的传输协议，因此很有可能在你的应用程序中以以下分段形式读取它们：  </p>
<blockquote>
<p>【AB】【CDEFG】【H】【I】  </p>
</blockquote>
<p>因此，无论是服务器端还是客户端，接收方都应将接收到的数据整理到一个或多个有意义的帧中，以使应用程序逻辑易于理解。在上面的示例中，接收到的数据应采用以下格式：  </p>
<blockquote>
<p>【ABC】【DEF】【GHI】 </p>
</blockquote>
<h5 id="处理方案一"><a href="#处理方案一" class="headerlink" title="处理方案一"></a>处理方案一</h5><p>创建一个内部累积缓冲区，然后等待直到所有的字节都被接收到内部缓冲区中为止</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">package io.netty.example.time;</span><br><span class="line"></span><br><span class="line">import java.util.Date;</span><br><span class="line"></span><br><span class="line">public class TimeClientHandler extends ChannelInboundHandlerAdapter &#123;</span><br><span class="line">    private ByteBuf buf;</span><br><span class="line">    </span><br><span class="line">    @Override</span><br><span class="line">    public void handlerAdded(ChannelHandlerContext ctx) &#123;</span><br><span class="line">        buf = ctx.alloc().buffer(4); // (1)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    @Override</span><br><span class="line">    public void handlerRemoved(ChannelHandlerContext ctx) &#123;</span><br><span class="line">        buf.release(); // (1)</span><br><span class="line">        buf = null;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    @Override</span><br><span class="line">    public void channelRead(ChannelHandlerContext ctx, Object msg) &#123;</span><br><span class="line">        ByteBuf m = (ByteBuf) msg;</span><br><span class="line">        buf.writeBytes(m); // (2)</span><br><span class="line">        m.release();</span><br><span class="line">        </span><br><span class="line">        if (buf.readableBytes() &gt;= 4) &#123; // (3)</span><br><span class="line">            long currentTimeMillis = (buf.readUnsignedInt() - 2208988800L) * 1000L;</span><br><span class="line">            System.out.println(new Date(currentTimeMillis));</span><br><span class="line">            ctx.close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    @Override</span><br><span class="line">    public void exceptionCaught(ChannelHandlerContext ctx, Throwable cause) &#123;</span><br><span class="line">        cause.printStackTrace();</span><br><span class="line">        ctx.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li>一个ChannelHandler有两个生命周期侦听器方法：handlerAdded()和handlerRemoved()。可以执行任意（取消）初始化任务，只要它不会长时间阻塞即可。</li>
<li>应将所有接收到的数据累加到中buf</li>
<li>然后，处理程序必须检查是否buf有足够的数据（在此示例中为4个字节），然后继续进行实际的业务逻辑。否则，Netty将channelRead()在有更多数据到达时再次调用该方法，最终将累加所有4个字节。</li>
</ol>
<h5 id="处理方案二"><a href="#处理方案二" class="headerlink" title="处理方案二"></a>处理方案二</h5><p>添加多个ChannelHandler到ChannelPipeline，拆分一个ChannelHandler成多个，使其模块化减少应用程序的复杂性。</p>
<p><strong>使用编码解码器</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">package io.netty.example.time;</span><br><span class="line"></span><br><span class="line">public class TimeDecoder extends ByteToMessageDecoder &#123; // (1)</span><br><span class="line">    @Override</span><br><span class="line">    protected void decode(ChannelHandlerContext ctx, ByteBuf in, List&lt;Object&gt; out) &#123; // (2)</span><br><span class="line">        if (in.readableBytes() &lt; 4) &#123;</span><br><span class="line">            return; // (3)</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        out.add(in.readBytes(4)); // (4)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li>ByteToMessageDecoder是一个实现ChannelInboundHandler，可以轻松处理碎片问题。</li>
<li>ByteToMessageDecoderdecode()每当接收到新数据时，都使用内部维护的累积缓冲区调用该方法。</li>
<li>decode()可以决定out不向累积缓冲区中没有足够数据的位置添加任何内容。收到更多数据时ByteToMessageDecoder将decode()再次调用。</li>
<li>如果decode()将对象添加到out，则表示解码器成功解码了一条消息。ByteToMessageDecoder将丢弃累积缓冲区的读取部分。请记住，您不需要解码多条消息。ByteToMessageDecoder会一直调用该decode()方法，直到该方法不添加任何内容out。</li>
</ol>
<p><strong>累积缓冲区有两种实现</strong></p>
<ol>
<li>MERGE_CUMULATOR<br>通过使用内存副本，将它们合并到一个ByteBuf中来累积ByteBufs。</li>
<li>COMPOSITE_CUMULATOR<br>通过将bytebuf添加到CompositeByteBuf中来累积bytebuf，因此尽可能不进行内存复制。注意CompositeByteBuf使用了一个更复杂的索引实现，所以取决于你的用例和解码器实现，这可能比仅仅使用merge_accumulator要慢。</li>
</ol>
<p><strong>或者使用重复解码器 ReplayingDecoder</strong></p>
<p>ByteToMessageDecoder的变体，使得能够在阻塞I&#x2F;O范例中实现非阻塞解码器。<br>ReplayingDecoder您可以像已收到所有必需字节一样实现decode()和decodeLast()方法，而不用检查所需字节的可用性。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">public class TimeDecoder extends ReplayingDecoder&lt;Void&gt; &#123;</span><br><span class="line">    @Override</span><br><span class="line">    protected void decode(</span><br><span class="line">            ChannelHandlerContext ctx, ByteBuf in, List&lt;Object&gt; out) &#123;</span><br><span class="line">        out.add(in.readBytes(4));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ReplayingDecoder通过一个特殊的ByteBuf 实现，Error当缓冲区中没有足够的数据时，该实现将抛出某种类型的实现。在上面的例子中只是假设调用时缓冲区中将有4个或更多字节。如果缓冲区中确实有4个字节，它将按预期返回整数标头。否则将引发Error。如果ReplayingDecoder捕获到 Error，则它将readerIndex把缓冲区的内容倒回到“初始”位置（即缓冲区的开头），并decode(..)在缓冲区中接收到更多数据时再次调用该方法。</p>
<p>详见：<a target="_blank" rel="noopener" href="https://netty.io/4.1/api/io/netty/handler/codec/ReplayingDecoder.html">https://netty.io/4.1/api/io/netty/handler/codec/ReplayingDecoder.html</a></p>
<p>此外，Netty提供了开箱即用的解码器，使您能够非常轻松地实现大多数协议  </p>
<ul>
<li>io.netty.example.factorial  对于二进制协议</li>
<li>io.netty.example.telnet  用于基于文本行的协议</li>
</ul>
<h4 id="用POJO代替ByteBuf"><a href="#用POJO代替ByteBuf" class="headerlink" title="用POJO代替ByteBuf"></a>用POJO代替ByteBuf</h4><p>在handler中将字节流转成对象，然后在调用链中传递，会使我们开发程序变得更方便</p>
<p>经过解码器，将字节流转成对象之后再out出去，在调用链后面的Handler中就可以直接取到对象了</p>
<p>如：<br>解码器</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">protected void decode(ChannelHandlerContext ctx, ByteBuf in, List&lt;Object&gt; out) &#123;</span><br><span class="line">    if (in.readableBytes() &lt; 4) &#123;</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    out.add(new UnixTime(in.readUnsignedInt()));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>handler</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">public void channelRead(ChannelHandlerContext ctx, Object msg) &#123;</span><br><span class="line">    UnixTime m = (UnixTime) msg;</span><br><span class="line">    System.out.println(m);</span><br><span class="line">    ctx.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h3 id="写数据"><a href="#写数据" class="headerlink" title="写数据"></a>写数据</h3><p>通过ChannelHandlerContext的write方法异步发送应答消息个客户端<br>数据不直接写入SocketChannel，而是写入待发送数据的缓存区中 </p>
<p>ChannelHandlerContext的flush方法将队列中的消息写入到SockChannel中</p>
<h3 id="优雅关闭"><a href="#优雅关闭" class="headerlink" title="优雅关闭"></a>优雅关闭</h3><p>原理同线程池的关闭</p>
<p>channel.closeFuture().sync();</p>
<p>关闭所有事件循环以终止所有线程</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">bossGroup.shutdownGracefully();</span><br><span class="line">workerGroup.shutdownGracefully();</span><br></pre></td></tr></table></figure>

<h3 id="耗时任务处理"><a href="#耗时任务处理" class="headerlink" title="耗时任务处理"></a>耗时任务处理</h3><p>bossGroup用于来接受连接，workGroup用于处理业务逻辑和IO操作，如果在handler中执行的业务逻辑特别慢会阻塞IO操作</p>
<p>处理方法</p>
<h4 id="一、在hander中启动新的线程来执行耗时操作"><a href="#一、在hander中启动新的线程来执行耗时操作" class="headerlink" title="一、在hander中启动新的线程来执行耗时操作"></a>一、在hander中启动新的线程来执行耗时操作</h4><h4 id="二、告诉netty不要用之前定义的workGroup-来执行某些hander"><a href="#二、告诉netty不要用之前定义的workGroup-来执行某些hander" class="headerlink" title="二、告诉netty不要用之前定义的workGroup 来执行某些hander"></a>二、告诉netty不要用之前定义的workGroup 来执行某些hander</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">// 事件处理线程</span><br><span class="line">EventExecutorGroup eventExecutorGroup = new DefaultEventExecutorGroup(16);</span><br><span class="line"></span><br><span class="line">ServerBootstrap b = new ServerBootstrap();</span><br><span class="line">b.group(bossGroup, workerGroup)</span><br><span class="line">.channel(NioServerSocketChannel.class)</span><br><span class="line">.childHandler(new ChannelInitializer&lt;SocketChannel&gt;() &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public void initChannel(SocketChannel ch) throws Exception &#123;</span><br><span class="line">    ChannelPipeline p = ch.pipeline();</span><br><span class="line">    p.addLast(new StringDecoder());</span><br><span class="line">    p.addLast(new StringEncoder());</span><br><span class="line">    </span><br><span class="line">    // 如果你的业务逻辑是完全异步的，或者完成得非常快，那么就不需要这样做</span><br><span class="line">    // 需要指定一个EventExecutorGroup，将用于执行ChannelHandler中的方法</span><br><span class="line">    p.addLast(eventExecutorGroup, &quot;String Echo&quot;, new StringEchoHandler());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>





<h2 id="工具类"><a href="#工具类" class="headerlink" title="工具类"></a>工具类</h2><p>…<br>…</p>
<hr>
<blockquote>
<p>大部分都是代码中的注释翻译过来的，没写完，有空再补充吧！</p>
</blockquote>
<h2 id="常用功能"><a href="#常用功能" class="headerlink" title="常用功能"></a>常用功能</h2><h3 id="心跳"><a href="#心跳" class="headerlink" title="心跳"></a>心跳</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">//心跳检测，6分钟无心跳，触发关闭</span><br><span class="line">public void initChannel(SocketChannel ch) throws Exception &#123;</span><br><span class="line">    ......</span><br><span class="line">    pipeline.addLast( new IdleStateHandler( 6, 0, 0, TimeUnit.MINUTES ) );</span><br><span class="line">    ......</span><br><span class="line">&#125;       </span><br><span class="line">       </span><br><span class="line">//6分钟没有读取到消息，会触发：userEventTriggered 方法</span><br><span class="line"></span><br><span class="line">XxxxHandler</span><br><span class="line"></span><br><span class="line">@Override</span><br><span class="line">public void userEventTriggered(ChannelHandlerContext ctx, Object evt) throws Exception &#123;</span><br><span class="line">	if (evt instanceof IdleStateEvent) &#123;</span><br><span class="line">		IdleStateEvent event = (IdleStateEvent) evt;</span><br><span class="line">		if (event.state() == IdleState.READER_IDLE) &#123;</span><br><span class="line">			logger.warn(&quot;到达指定时间间隔没有收到心跳，关闭连接：&#123;&#125;&quot;, ctx.channel().remoteAddress());</span><br><span class="line">			ctx.fireUserEventTriggered(evt);</span><br><span class="line">			ctx.close();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125; else &#123;</span><br><span class="line">		super.userEventTriggered(ctx, evt);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://wangwen135.github.io/%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6/git/github-22%E7%AB%AF%E5%8F%A3%E8%BF%9E%E6%8E%A5%E8%B6%85%E6%97%B6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="王某某">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="王某某的笔记">
      <meta itemprop="description" content="这是一个使用 Hexo 构建的博客，用于分享我的编程经验和学习笔记。">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 王某某的笔记">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6/git/github-22%E7%AB%AF%E5%8F%A3%E8%BF%9E%E6%8E%A5%E8%B6%85%E6%97%B6/" class="post-title-link" itemprop="url">github-22端口连接超时</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-04-05 23:41:00" itemprop="dateCreated datePublished" datetime="2023-04-05T23:41:00+08:00">2023-04-05</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6/" itemprop="url" rel="index"><span itemprop="name">版本控制</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6/git/" itemprop="url" rel="index"><span itemprop="name">git</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>159</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>1 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>现象</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt;git pull</span><br><span class="line">ssh: connect to host github.com port 22: Connection timed out</span><br><span class="line">fatal: Could not read from remote repository.</span><br><span class="line"></span><br><span class="line">Please make sure you have the correct access rights</span><br><span class="line">and the repository exists.</span><br></pre></td></tr></table></figure>

<p>但是443端口可以</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt;ssh -T -p 443 git@ssh.github.com</span><br><span class="line">The authenticity of host &#x27;[ssh.github.com]:443 ([20.205.243.160]:443)&#x27; can&#x27;t be established.</span><br><span class="line">ED25519 key fingerprint is SHA256:+DiY3wvvV6TuJJhbpZisF/zLDA0zPMSvHdkr4UvCOqU.</span><br><span class="line">This key is not known by any other names</span><br><span class="line">Are you sure you want to continue connecting (yes/no/[fingerprint])? yes</span><br><span class="line">Warning: Permanently added &#x27;[ssh.github.com]:443&#x27; (ED25519) to the list of known hosts.</span><br><span class="line">Hi wangwen135! You&#x27;ve successfully authenticated, but GitHub does not provide shell access.</span><br></pre></td></tr></table></figure>

<p>在用户目录新增config文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ vim ~/.ssh/config</span><br></pre></td></tr></table></figure>
<p>内容如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># Add section below to it</span><br><span class="line">Host github.com</span><br><span class="line">  Hostname ssh.github.com</span><br><span class="line">  Port 443</span><br></pre></td></tr></table></figure>

<p>再测试一下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ ssh -T git@github.com</span><br><span class="line">Hi xxxxx! You&#x27;ve successfully authenticated, but GitHub does not</span><br><span class="line">provide shell access.</span><br><span class="line"></span><br></pre></td></tr></table></figure>




      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://wangwen135.github.io/Nginx/Nginx-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E8%87%AA%E5%8A%A8%E5%A4%87%E4%BB%BD%E8%84%9A%E6%9C%AC/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="王某某">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="王某某的笔记">
      <meta itemprop="description" content="这是一个使用 Hexo 构建的博客，用于分享我的编程经验和学习笔记。">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 王某某的笔记">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/Nginx/Nginx-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E8%87%AA%E5%8A%A8%E5%A4%87%E4%BB%BD%E8%84%9A%E6%9C%AC/" class="post-title-link" itemprop="url">Nginx-配置文件自动备份脚本</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-02-18 23:41:00" itemprop="dateCreated datePublished" datetime="2023-02-18T23:41:00+08:00">2023-02-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Nginx/" itemprop="url" rel="index"><span itemprop="name">Nginx</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>276</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>1 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>脚本：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line"></span><br><span class="line"># 配置源目录和备份目录</span><br><span class="line">source_dir=&quot;/etc/nginx/conf.d&quot;</span><br><span class="line">backup_dir=&quot;/www/mnt/backup/nginx&quot;</span><br><span class="line"></span><br><span class="line"># 创建备份目录（如果不存在）</span><br><span class="line">mkdir -p &quot;$backup_dir&quot;</span><br><span class="line"></span><br><span class="line"># 获取当前日期（格式：YYYY-MM-DD）</span><br><span class="line">current_date=$(date +%Y-%m-%d)</span><br><span class="line"></span><br><span class="line"># 压缩配置文件到临时tar包</span><br><span class="line">tar_filename=&quot;/tmp/nginx_config_backup_$current_date.tar.gz&quot;</span><br><span class="line">tar -czf &quot;$tar_filename&quot; -C &quot;$source_dir&quot; .</span><br><span class="line"></span><br><span class="line"># 检查上一个备份是否存在且与当前备份不同</span><br><span class="line">last_backup=$(ls -t &quot;$backup_dir&quot; | head -1)</span><br><span class="line">if [ -n &quot;$last_backup&quot; ]; then</span><br><span class="line">    # 解压上一个备份和当前备份</span><br><span class="line">    mkdir -p /tmp/last_backup /tmp/current_backup</span><br><span class="line">    tar -xzf &quot;$backup_dir/$last_backup&quot; -C /tmp/last_backup</span><br><span class="line">    tar -xzf &quot;$tar_filename&quot; -C /tmp/current_backup</span><br><span class="line"></span><br><span class="line">    # 使用diff命令比较两个目录中的文件差异</span><br><span class="line">    diff_output=$(diff -r /tmp/last_backup /tmp/current_backup)</span><br><span class="line"></span><br><span class="line">    # 清理临时目录</span><br><span class="line">    rm -r /tmp/last_backup /tmp/current_backup</span><br><span class="line"></span><br><span class="line">    if [ -z &quot;$diff_output&quot; ]; then</span><br><span class="line">        # 上一个备份与当前备份相同，抛弃当前备份</span><br><span class="line">        echo &quot;No changes in Nginx configuration. Discarding backup.&quot;</span><br><span class="line">        rm &quot;$tar_filename&quot;</span><br><span class="line">        exit 0</span><br><span class="line">    fi</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line"># 移动当前备份到备份目录</span><br><span class="line">mv &quot;$tar_filename&quot; &quot;$backup_dir&quot;</span><br><span class="line"></span><br><span class="line"># 删除多余的备份（保留最多10个备份）</span><br><span class="line">backup_count=$(ls -1 &quot;$backup_dir&quot; | wc -l)</span><br><span class="line">if [ &quot;$backup_count&quot; -gt 10 ]; then</span><br><span class="line">    oldest_backup=$(ls -t &quot;$backup_dir&quot; | tail -1)</span><br><span class="line">    rm &quot;$backup_dir/$oldest_backup&quot;</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">echo &quot;Nginx configuration backup completed.&quot;</span><br></pre></td></tr></table></figure>

<p>编辑定时任务</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">crontab -e</span><br></pre></td></tr></table></figure>

<p>增加：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">5     3       *       *       *       /opt/shell/nginx/nginx_config_backup.sh</span><br></pre></td></tr></table></figure>





      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://wangwen135.github.io/MySQL/%E6%9F%A5%E7%9C%8Bbinlog%E6%97%A5%E5%BF%97/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="王某某">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="王某某的笔记">
      <meta itemprop="description" content="这是一个使用 Hexo 构建的博客，用于分享我的编程经验和学习笔记。">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 王某某的笔记">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/MySQL/%E6%9F%A5%E7%9C%8Bbinlog%E6%97%A5%E5%BF%97/" class="post-title-link" itemprop="url">查看binlog日志</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-11-07 23:41:00" itemprop="dateCreated datePublished" datetime="2022-11-07T23:41:00+08:00">2022-11-07</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/MySQL/" itemprop="url" rel="index"><span itemprop="name">MySQL</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>900</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>3 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <blockquote>
<p><em>2018年9月</em></p>
</blockquote>
<h3 id="mysqlbinlog"><a href="#mysqlbinlog" class="headerlink" title="mysqlbinlog"></a>mysqlbinlog</h3><p>使用mysqlbinlog 命令查看</p>
<p>常用选项：  </p>
<ul>
<li>–start-position&#x3D;953                   起始pos点</li>
<li>–stop-position&#x3D;1437                   结束pos点</li>
<li>–start-datetime&#x3D;”2013-11-29 13:18:54” 起始时间点</li>
<li>–stop-datetime&#x3D;”2013-11-29 13:21:53”  结束时间点</li>
</ul>
<p>如：</p>
<blockquote>
<p>进入到binlog目录执行，指定具体的binlog文件名</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 从指定的时间开始查</span><br><span class="line">$ mysqlbinlog mysql-bin.001575 --start-datetime=&quot;2018-09-25 11:25:54&quot;</span><br><span class="line"></span><br><span class="line"># 从指定位置开始查</span><br><span class="line">$ mysqlbinlog mysql-bin.001575 --start-position=16839697</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>默认只能查看到base-64编码的信息<br>如：</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"># at 22452867</span><br><span class="line">#180925 11:44:02 server id 8  end_log_pos 22452944 CRC32 0xc23d3641     Table_map: `base`.`by_renew_history` mapped to number 182</span><br><span class="line"># at 22452944</span><br><span class="line">#180925 11:44:02 server id 8  end_log_pos 22453106 CRC32 0x7a809e4e     Update_rows: table id 182 flags: STMT_END_F</span><br><span class="line"></span><br><span class="line">BINLOG &#x27;</span><br><span class="line">Aq+pWxMIAAAATQAAANCaVgEAALYAAAAAAAEABGJhc2UAEGJ5X3JlbmV3X2hpc3RvcnkACwMPAw8S</span><br><span class="line">ARIDEgMDB5YAWgAAAAD+B0E2PcI=</span><br><span class="line">Aq+pWx8IAAAAogAAAHKbVgEAALYAAAAAAAEAAgAL/////wD+igAAAA4yMDE4MDcyNTE2MzcyNugD</span><br><span class="line">AAAQMTExMTExMTExMDExMTExNJmgcwlbAZmgcwlbAwAAAJmgcwlaAP6KAAAADjIwMTgwNzI1MTYz</span><br><span class="line">NzI26AMAABAxMTExMTExMTEwMTExMTEzmaBzCVsBmaBzCVsDAAAAmaBzCVpOnoB6</span><br><span class="line">&#x27;/*!*/;</span><br><span class="line"># at 22453106</span><br><span class="line">#180925 11:44:02 server id 8  end_log_pos 22453137 CRC32 0x3787881e     Xid = 8121164</span><br><span class="line">COMMIT/*!*/;</span><br><span class="line">SET @@SESSION.GTID_NEXT= &#x27;AUTOMATIC&#x27; /* added by mysqlbinlog */ /*!*/;</span><br><span class="line">DELIMITER ;</span><br><span class="line"># End of log file</span><br><span class="line">/*!50003 SET COMPLETION_TYPE=@OLD_COMPLETION_TYPE*/;</span><br><span class="line">/*!50530 SET @@SESSION.PSEUDO_SLAVE_MODE=0*/;</span><br></pre></td></tr></table></figure>

<p>此时需要 <strong>–base64-output&#x3D;value</strong> 选项</p>
<p>此选项确定何时应使用BINLOG语句将事件编码为base-64字符串。该选项具有以下允许值（不区分大小写）:</p>
<ul>
<li><p>AUTO （“自动”）或UNSPEC（“未指定”）在必要时自动显示BINLOG语句（即，用于格式描述事件和行事件）。如果没有给出–base64-output选项，则效果与–base64-output &#x3D; AUTO相同。</p>
</li>
<li><p>NEVER 不显示BINLOG语句</p>
</li>
<li><p>DECODE-ROWS 通过配合–verbose选项将行事件解码并显示为注释的SQL语句。</p>
</li>
</ul>
<hr>
<p>使用参数–verbose(或-v)，将生成带注释的语句，如果使用两次这个参数(如-v -v)，会生成字段的类型、长度、是否为null等属性信息。</p>
<p>如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ mysqlbinlog -v --base64-output=DECODE-ROWS mysql-bin.001576 --start-datetime=&quot;2018-09-25 13:41:30&quot;</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"># at 1664232</span><br><span class="line">#180925 13:42:02 server id 8  end_log_pos 1664309 CRC32 0x28bbcc7e      Table_map: `base`.`by_renew_history` mapped to number 182</span><br><span class="line"># at 1664309</span><br><span class="line">#180925 13:42:02 server id 8  end_log_pos 1664471 CRC32 0xca13320e      Update_rows: table id 182 flags: STMT_END_F</span><br><span class="line">### UPDATE `base`.`by_renew_history`</span><br><span class="line">### WHERE</span><br><span class="line">###   @1=138</span><br><span class="line">###   @2=&#x27;20180725163726&#x27;</span><br><span class="line">###   @3=1000</span><br><span class="line">###   @4=&#x27;1111111110111113&#x27;</span><br><span class="line">###   @5=&#x27;2018-07-25 16:37:27&#x27;</span><br><span class="line">###   @6=1</span><br><span class="line">###   @7=&#x27;2018-07-25 16:37:27&#x27;</span><br><span class="line">###   @8=3</span><br><span class="line">###   @9=&#x27;2018-07-25 16:37:26&#x27;</span><br><span class="line">###   @10=NULL</span><br><span class="line">###   @11=NULL</span><br><span class="line">### SET</span><br><span class="line">###   @1=138</span><br><span class="line">###   @2=&#x27;20180725163726&#x27;</span><br><span class="line">###   @3=1000</span><br><span class="line">###   @4=&#x27;1111111110111114&#x27;</span><br><span class="line">###   @5=&#x27;2018-07-25 16:37:27&#x27;</span><br><span class="line">###   @6=1</span><br><span class="line">###   @7=&#x27;2018-07-25 16:37:27&#x27;</span><br><span class="line">###   @8=3</span><br><span class="line">###   @9=&#x27;2018-07-25 16:37:26&#x27;</span><br><span class="line">###   @10=NULL</span><br><span class="line">###   @11=NULL</span><br><span class="line"># at 1664471</span><br><span class="line">#180925 13:42:02 server id 8  end_log_pos 1664502 CRC32 0xb64f6d4f      Xid = 8266920</span><br><span class="line">COMMIT/*!*/;</span><br><span class="line">SET @@SESSION.GTID_NEXT= &#x27;AUTOMATIC&#x27; /* added by mysqlbinlog */ /*!*/;</span><br><span class="line">DELIMITER ;</span><br><span class="line"># End of log file</span><br><span class="line">/*!50003 SET COMPLETION_TYPE=@OLD_COMPLETION_TYPE*/;</span><br><span class="line">/*!50530 SET @@SESSION.PSEUDO_SLAVE_MODE=0*/;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqlbinlog -v -v --base64-output=DECODE-ROWS mysql-bin.001576 --start-datetime=&quot;2018-09-25 13:41:30&quot;</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"># at 1899587</span><br><span class="line">#180925 13:44:02 server id 8  end_log_pos 1899664 CRC32 0x7fff0312      Table_map: `base`.`by_renew_history` mapped to number 182</span><br><span class="line"># at 1899664</span><br><span class="line">#180925 13:44:02 server id 8  end_log_pos 1899826 CRC32 0x5cdb92c1      Update_rows: table id 182 flags: STMT_END_F</span><br><span class="line">### UPDATE `base`.`by_renew_history`</span><br><span class="line">### WHERE</span><br><span class="line">###   @1=138 /* INT meta=0 nullable=0 is_null=0 */</span><br><span class="line">###   @2=&#x27;20180725163726&#x27; /* VARSTRING(150) meta=150 nullable=1 is_null=0 */</span><br><span class="line">###   @3=1000 /* INT meta=0 nullable=1 is_null=0 */</span><br><span class="line">###   @4=&#x27;1111111110111114&#x27; /* VARSTRING(90) meta=90 nullable=1 is_null=0 */</span><br><span class="line">###   @5=&#x27;2018-07-25 16:37:27&#x27; /* DATETIME(0) meta=0 nullable=1 is_null=0 */</span><br><span class="line">###   @6=1 /* TINYINT meta=0 nullable=1 is_null=0 */</span><br><span class="line">###   @7=&#x27;2018-07-25 16:37:27&#x27; /* DATETIME(0) meta=0 nullable=1 is_null=0 */</span><br><span class="line">###   @8=3 /* INT meta=0 nullable=1 is_null=0 */</span><br><span class="line">###   @9=&#x27;2018-07-25 16:37:26&#x27; /* DATETIME(0) meta=0 nullable=1 is_null=0 */</span><br><span class="line">###   @10=NULL /* INT meta=0 nullable=1 is_null=1 */</span><br><span class="line">###   @11=NULL /* INT meta=0 nullable=1 is_null=1 */</span><br><span class="line">### SET</span><br><span class="line">###   @1=138 /* INT meta=0 nullable=0 is_null=0 */</span><br><span class="line">###   @2=&#x27;20180725163726&#x27; /* VARSTRING(150) meta=150 nullable=1 is_null=0 */</span><br><span class="line">###   @3=1000 /* INT meta=0 nullable=1 is_null=0 */</span><br><span class="line">###   @4=&#x27;1111111110111113&#x27; /* VARSTRING(90) meta=90 nullable=1 is_null=0 */</span><br><span class="line">###   @5=&#x27;2018-07-25 16:37:27&#x27; /* DATETIME(0) meta=0 nullable=1 is_null=0 */</span><br><span class="line">###   @6=1 /* TINYINT meta=0 nullable=1 is_null=0 */</span><br><span class="line">###   @7=&#x27;2018-07-25 16:37:27&#x27; /* DATETIME(0) meta=0 nullable=1 is_null=0 */</span><br><span class="line">###   @8=3 /* INT meta=0 nullable=1 is_null=0 */</span><br><span class="line">###   @9=&#x27;2018-07-25 16:37:26&#x27; /* DATETIME(0) meta=0 nullable=1 is_null=0 */</span><br><span class="line">###   @10=NULL /* INT meta=0 nullable=1 is_null=1 */</span><br><span class="line">###   @11=NULL /* INT meta=0 nullable=1 is_null=1 */</span><br><span class="line"># at 1899826</span><br><span class="line">#180925 13:44:02 server id 8  end_log_pos 1899857 CRC32 0xc1b4c0c7      Xid = 8297691</span><br><span class="line">COMMIT/*!*/;</span><br><span class="line">SET @@SESSION.GTID_NEXT= &#x27;AUTOMATIC&#x27; /* added by mysqlbinlog */ /*!*/;</span><br><span class="line">DELIMITER ;</span><br><span class="line"># End of log file</span><br><span class="line">/*!50003 SET COMPLETION_TYPE=@OLD_COMPLETION_TYPE*/;</span><br><span class="line">/*!50530 SET @@SESSION.PSEUDO_SLAVE_MODE=0*/;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" title="上一页" aria-label="上一页" href="/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/16/">16</a><a class="extend next" rel="next" title="下一页" aria-label="下一页" href="/page/3/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2024</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">王某某</span>
  </div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
    <span title="站点总字数">138k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">8:20</span>
  </span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/pisces/" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script><script src="/js/bookmark.js"></script>

  






  





</body>
</html>
