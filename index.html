<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" integrity="sha256-5eIC48iZUHmSlSUz9XtjRyK2mzQkHScZY1WdMaoz74E=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"wangwen135.github.io","root":"/","images":"/images","scheme":"Pisces","darkmode":false,"version":"8.21.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":true,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="这是一个使用 Hexo 构建的博客，用于分享我的编程经验和学习笔记。">
<meta property="og:type" content="website">
<meta property="og:title" content="王某某的笔记">
<meta property="og:url" content="https://wangwen135.github.io/index.html">
<meta property="og:site_name" content="王某某的笔记">
<meta property="og:description" content="这是一个使用 Hexo 构建的博客，用于分享我的编程经验和学习笔记。">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="王某某">
<meta property="article:tag" content="java">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://wangwen135.github.io/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>王某某的笔记</title>
  







<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-MBG120GJ9P"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-MBG120GJ9P');
</script>
  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">王某某的笔记</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">记录我的编程之路</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="王某某"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">王某某</p>
  <div class="site-description" itemprop="description">这是一个使用 Hexo 构建的博客，用于分享我的编程经验和学习笔记。</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">170</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">55</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">147</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/wangwen135" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;wangwen135" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.jianshu.com/u/66c41e72644b" title="简  书 → https:&#x2F;&#x2F;www.jianshu.com&#x2F;u&#x2F;66c41e72644b" rel="noopener me" target="_blank"><i class="fa fa-link fa-fw"></i>简  书</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:wangwen135@gmail.com" title="E-Mail → mailto:wangwen135@gmail.com" rel="noopener me" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://twitter.com/wangwen135" title="Twitter → https:&#x2F;&#x2F;twitter.com&#x2F;wangwen135" rel="noopener me" target="_blank"><i class="fab fa-twitter fa-fw"></i>Twitter</a>
      </span>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://wangwen135.github.io/%E5%8D%9A%E5%AE%A2/Hexo/Hexo%E9%85%8D%E7%BD%AEGoogle%20Analytics/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="王某某">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="王某某的笔记">
      <meta itemprop="description" content="这是一个使用 Hexo 构建的博客，用于分享我的编程经验和学习笔记。">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 王某某的笔记">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/%E5%8D%9A%E5%AE%A2/Hexo/Hexo%E9%85%8D%E7%BD%AEGoogle%20Analytics/" class="post-title-link" itemprop="url">Hexo配置Google Analytics</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-09-29 01:32:00" itemprop="dateCreated datePublished" datetime="2024-09-29T01:32:00+08:00">2024-09-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%8D%9A%E5%AE%A2/" itemprop="url" rel="index"><span itemprop="name">博客</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%8D%9A%E5%AE%A2/Hexo/" itemprop="url" rel="index"><span itemprop="name">Hexo</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>514</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>2 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="配置Google-Analytics"><a href="#配置Google-Analytics" class="headerlink" title="配置Google Analytics"></a>配置Google Analytics</h3><h4 id="创建Google-Analytics-账号"><a href="#创建Google-Analytics-账号" class="headerlink" title="创建Google Analytics 账号"></a>创建Google Analytics 账号</h4><p>打开  <a target="_blank" rel="noopener" href="https://analytics.google.com/">Google Analytics</a> 并使用你的 Google 帐户登录。</p>
<p><a target="_blank" rel="noopener" href="https://analytics.google.com/">https://analytics.google.com/</a></p>
<p>按提示创建账号 </p>
<p><img src="https://img.wangwen135.top:23456/note/2024/09/66f57d542223e.png" alt="1727364435788.png"></p>
<h4 id="创建资源"><a href="#创建资源" class="headerlink" title="创建资源"></a>创建资源</h4><p>（就是一个名字）</p>
<p><img src="https://img.wangwen135.top:23456/note/2024/09/66f57dfb93b95.png" alt="1727364603317.png"></p>
<h4 id="目标选择流量分析"><a href="#目标选择流量分析" class="headerlink" title="目标选择流量分析"></a>目标选择流量分析</h4><p><img src="https://img.wangwen135.top:23456/note/2024/09/66f57e2a81a39.png" alt="1727364650222.png"></p>
<h4 id="配置网站"><a href="#配置网站" class="headerlink" title="配置网站"></a>配置网站</h4><p><img src="https://img.wangwen135.top:23456/note/2024/09/66f57e7fc3cd0.png" alt="1727364735473.png"></p>
<h4 id="获得追踪ID"><a href="#获得追踪ID" class="headerlink" title="获得追踪ID"></a>获得追踪ID</h4><p>之后就能得到一个ID，如：G-MXXXXXXXXX</p>
<p><img src="https://img.wangwen135.top:23456/note/2024/09/66f5827fb7bc2.png" alt="1727365759366.png"></p>
<hr>
<h3 id="配置hexo"><a href="#配置hexo" class="headerlink" title="配置hexo"></a>配置hexo</h3><p>这里使用的next主题，打开配置文件：_config.next.yml</p>
<p>找到：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># Google Analytics</span><br><span class="line"># See: https://analytics.google.com</span><br><span class="line">google_analytics:</span><br><span class="line">  tracking_id: G-XXXXXXXXXX   # 替换为你的 GA4 追踪 ID</span><br><span class="line">  </span><br><span class="line">  # By default, NexT will load an external gtag.js script on your site.</span><br><span class="line">  # If you only need the pageview feature, set the following option to true to get a better performance.</span><br><span class="line">  only_pageview: true   # 如果只需要页面浏览量追踪，可以设置为 true</span><br><span class="line">  </span><br></pre></td></tr></table></figure>
<blockquote>
<p>替换为你的 GA4 追踪 ID</p>
</blockquote>
<p>保存配置并重新生成网站</p>
<p>在源代码中应该能看到 Google Analytics 相关的内容：</p>
<p><img src="https://img.wangwen135.top:23456/note/2024/09/66f58a1c24c10.png" alt="1727367707827.png"></p>
<h3 id="测试验证"><a href="#测试验证" class="headerlink" title="测试验证"></a>测试验证</h3><p>访问你的网站，并在 Google Analytics 后台的“实时（Real-time）”页面查看是否能看到访客信息。如果能看到你的访问记录，说明 Google Analytics 已成功集成。</p>
<p>当访问页面时会向 <a target="_blank" rel="noopener" href="http://www.google-analytics.com/">www.google-analytics.com</a> 发送一个post请求，内容如：</p>
<p><img src="https://img.wangwen135.top:23456/note/2024/09/66f5a0501cced.png" alt="1727373391674.png"></p>
<blockquote>
<p><strong>注意，这个脚本太老了，在google nalytics上看不到请求数据</strong></p>
</blockquote>
<hr>
<h3 id="重新配置"><a href="#重新配置" class="headerlink" title="重新配置"></a>重新配置</h3><p>使用google提供的代码，通过自定义head部分的方式配置</p>
<p>参考文档：<br><a target="_blank" rel="noopener" href="https://theme-next.js.org/docs/advanced-settings/custom-files">https://theme-next.js.org/docs/advanced-settings/custom-files</a></p>
<p>在 <strong>source</strong> 目录中添加 <strong>_data</strong> 目录，然后添加：<strong>head.njk</strong> 文件</p>
<p>在文件中添加google提供的代码，内容如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- Google tag (gtag.js) --&gt;</span><br><span class="line">&lt;script async src=&quot;https://www.googletagmanager.com/gtag/js?id=G-MBG120GJ9P&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">  window.dataLayer = window.dataLayer || [];</span><br><span class="line">  function gtag()&#123;dataLayer.push(arguments);&#125;</span><br><span class="line">  gtag(&#x27;js&#x27;, new Date());</span><br><span class="line"></span><br><span class="line">  gtag(&#x27;config&#x27;, &#x27;G-MBG120GJ9P&#x27;);</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意替换你自己的ID</p>
</blockquote>
<p>然后取消NexT配置文件<code>_config.next.yml</code> 中 custom_file_path 下 head 的注释</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># Define custom file paths.</span><br><span class="line"># Create your custom files in site directory `source/_data` and uncomment needed files below.</span><br><span class="line">custom_file_path:</span><br><span class="line">  head: source/_data/head.njk</span><br><span class="line">  #header: source/_data/header.njk</span><br><span class="line">  #sidebar: source/_data/sidebar.njk</span><br></pre></td></tr></table></figure>

<h3 id="重新测试验证"><a href="#重新测试验证" class="headerlink" title="重新测试验证"></a>重新测试验证</h3><p>重新发布，刷新页面查看效果  </p>
<p>查看源代码可以看到head部分已经添加了上面的内容</p>
<p>请求如：<br><img src="https://img.wangwen135.top:23456/note/2024/10/66fae0522c24a.png" alt="1727717457398.png"></p>
<p>实时效果如：<br><img src="https://img.wangwen135.top:23456/note/2024/10/66fae020a6e3e.png" alt="1727717407814.png"></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://wangwen135.github.io/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/Linux/Linux%E6%97%A5%E5%BF%97%E6%96%87%E4%BB%B6%E8%87%AA%E5%8A%A8%E5%BD%92%E6%A1%A3logrotate/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="王某某">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="王某某的笔记">
      <meta itemprop="description" content="这是一个使用 Hexo 构建的博客，用于分享我的编程经验和学习笔记。">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 王某某的笔记">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/Linux/Linux%E6%97%A5%E5%BF%97%E6%96%87%E4%BB%B6%E8%87%AA%E5%8A%A8%E5%BD%92%E6%A1%A3logrotate/" class="post-title-link" itemprop="url">Linux日志文件自动归档logrotate</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-09-08 01:02:00" itemprop="dateCreated datePublished" datetime="2024-09-08T01:02:00+08:00">2024-09-08</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/" itemprop="url" rel="index"><span itemprop="name">操作系统</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/Linux/" itemprop="url" rel="index"><span itemprop="name">Linux</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>1.2k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>4 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="logrotate"><a href="#logrotate" class="headerlink" title="logrotate"></a>logrotate</h2><p>logrotate 是 Linux 系统中用于管理日志文件的工具，它可以根据定义的规则对日志文件进行轮转、压缩、删除或归档，常用于防止日志文件占用过多的磁盘空间。</p>
<h3 id="主要功能"><a href="#主要功能" class="headerlink" title="主要功能"></a>主要功能</h3><ol>
<li><strong>轮转日志文件</strong>：当日志文件达到设定的大小或时间限制时，生成一个新的日志文件。</li>
<li><strong>压缩旧日志</strong>：对轮转后的日志进行压缩（如 .gz 格式）。</li>
<li><strong>删除旧日志</strong>：可以设置保留一定数量的日志文件，超过数量的旧日志会被删除。</li>
<li><strong>发送信号</strong>：轮转后可以通知服务重新生成新的日志文件，通常通过 SIGHUP 信号完成。</li>
<li><strong>灵活的配置</strong>：支持基于文件大小、日期等多种条件来轮转日志。</li>
</ol>
<h3 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h3><p>logrotate 的配置文件位于 &#x2F;etc&#x2F;logrotate.conf，你可以在这里指定全局的日志轮转策略。此外，每个服务可以通过 &#x2F;etc&#x2F;logrotate.d&#x2F; 目录下的文件配置自己的日志轮转规则。</p>
<p><strong>配置文件示例</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">/var/log/myapp/*.log &#123;</span><br><span class="line">    daily             # 每天轮转</span><br><span class="line">    missingok         # 忽略不存在的日志文件</span><br><span class="line">    rotate 7          # 保留7天的日志</span><br><span class="line">    compress          # 轮转后压缩日志文件</span><br><span class="line">    delaycompress     # 延迟到下一次轮转时才压缩</span><br><span class="line">    notifempty        # 如果日志文件为空，不轮转</span><br><span class="line">    create 0640 root root  # 轮转后创建新的日志文件，权限为0640，所有者为root</span><br><span class="line">    postrotate        # 轮转后执行的命令</span><br><span class="line">        systemctl reload myapp</span><br><span class="line">    endscript</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>常用选项说明</strong></p>
<ul>
<li>daily&#x2F;weekly&#x2F;monthly：指定轮转周期为天、周、月。</li>
<li>rotate [数字]：指定保留日志文件的数量。</li>
<li>compress：启用压缩（默认使用gzip）。</li>
<li>create [权限] [所有者] [组]：轮转后创建一个新的日志文件，并指定权限和所有者。</li>
<li>postrotate&#x2F;endscript：日志轮转完成后执行的脚本，可以用于通知服务重启或重新加载日志。</li>
</ul>
<h3 id="手动执行日志轮转"><a href="#手动执行日志轮转" class="headerlink" title="手动执行日志轮转"></a>手动执行日志轮转</h3><p>可以使用以下命令手动执行轮转：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">logrotate -f /etc/logrotate.conf</span><br></pre></td></tr></table></figure>

<p>-f 表示强制轮转，即使日志没有达到轮转条件。</p>
<hr>
<h3 id="nginx-日志文件"><a href="#nginx-日志文件" class="headerlink" title="nginx 日志文件"></a>nginx 日志文件</h3><p>nginx 日志默认会自动归档，配置文件位于：&#x2F;etc&#x2F;logrotate.d&#x2F;nginx</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">/var/log/nginx/*.log &#123;</span><br><span class="line">    create 0640 nginx root</span><br><span class="line">    daily</span><br><span class="line">    rotate 10</span><br><span class="line">    missingok</span><br><span class="line">    notifempty</span><br><span class="line">    compress</span><br><span class="line">    delaycompress</span><br><span class="line">    sharedscripts</span><br><span class="line">    postrotate</span><br><span class="line">        /bin/kill -USR1 `cat /run/nginx.pid 2&gt;/dev/null` 2&gt;/dev/null || true</span><br><span class="line">    endscript</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>但是只会归档&#x2F;var&#x2F;log&#x2F;nginx&#x2F;*.log，如果你配置了其他目录则需要自己写配置文件  </p>
<p><code>/bin/kill -USR1 </code>cat &#x2F;run&#x2F;nginx.pid 2&gt;&#x2F;dev&#x2F;null<code> 2&gt;/dev/null || true</code> 这一行是在日志轮转后通过向 Nginx 主进程发送USR1&#96; 信号，通知 Nginx 重新打开日志文件。<br>-USR1 是用户定义的信号（SIGUSR1），Nginx 支持使用 USR1 信号来指示它重新打开日志文件。</p>
<h3 id="java-app-out日志文件"><a href="#java-app-out日志文件" class="headerlink" title="java app out日志文件"></a>java app out日志文件</h3><p>在 Java 应用程序中，日志归档通常是通过日志框架如 Log4j、SLF4J（结合其他日志实现如 Logback 或 Log4j）来管理的。这些日志框架提供了非常灵活的日志输出和轮转功能，允许开发者对日志进行归档、压缩、删除等操作。</p>
<p>一般启动java应用还是会使用 nohup 命令生成一个 out 文件，确保即使日志配置不正确或者应用程序崩溃时，依然能保留日志信息。这是为了增加日志记录的安全性和完整性，尤其是在程序异常退出或日志框架配置出错的情况下。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nohup java -jar test.jar &gt; test.out 2&gt;&amp;1 &amp;</span><br></pre></td></tr></table></figure>

<p>由于 test.out 文件包含了应用程序的所有输出（包括标准输出和错误输出），随着程序运行时间的增长，该日志文件会越来越大。为了避免 test.out 文件过大导致磁盘空间耗尽，可以使用 logrotate 管理 test.out 的日志轮转。</p>
<h4 id="配置示例："><a href="#配置示例：" class="headerlink" title="配置示例："></a>配置示例：</h4><p>在 &#x2F;etc&#x2F;logrotate.d&#x2F; 下创建一个文件，比如 test，内容如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">/opt/java/test/out/*.out &#123;</span><br><span class="line">    # 每天轮转一次</span><br><span class="line">    daily</span><br><span class="line">    # 如果日志文件不存在则跳过</span><br><span class="line">    missingok</span><br><span class="line">    # 保留 30 天的日志文件</span><br><span class="line">    rotate 30</span><br><span class="line">    # 轮转后压缩旧的日志文件</span><br><span class="line">    compress</span><br><span class="line">    # 延迟到下一次轮转时才压缩</span><br><span class="line">    delaycompress</span><br><span class="line">    # 如果文件为空，则不轮转</span><br><span class="line">    notifempty</span><br><span class="line">    # 复制日志文件并清空原始文件（避免重启应用）</span><br><span class="line">    copytruncate</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>其中：  </p>
<ul>
<li>copytruncate：复制当前日志内容并清空原文件，而不需要重启 Java 程序。这是因为直接删除或移动 test.out 文件后，正在运行的程序仍然会继续写入已被删除的文件描述符，因此需要使用 copytruncate 来保留文件描述符。</li>
</ul>
<p>使用命令进行测试：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">logrotate -f /etc/logrotate.d/test</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://wangwen135.github.io/%E7%BD%91%E7%BB%9C%E4%B8%8E%E5%AE%89%E5%85%A8/SSH/sshuttle/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="王某某">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="王某某的笔记">
      <meta itemprop="description" content="这是一个使用 Hexo 构建的博客，用于分享我的编程经验和学习笔记。">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 王某某的笔记">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/%E7%BD%91%E7%BB%9C%E4%B8%8E%E5%AE%89%E5%85%A8/SSH/sshuttle/" class="post-title-link" itemprop="url">sshuttle</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-08-27 23:58:00" itemprop="dateCreated datePublished" datetime="2024-08-27T23:58:00+08:00">2024-08-27</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%BD%91%E7%BB%9C%E4%B8%8E%E5%AE%89%E5%85%A8/" itemprop="url" rel="index"><span itemprop="name">网络与安全</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%BD%91%E7%BB%9C%E4%B8%8E%E5%AE%89%E5%85%A8/SSH/" itemprop="url" rel="index"><span itemprop="name">SSH</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>787</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>3 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="sshuttle-一个使用ssh协议的透明代理VPN"><a href="#sshuttle-一个使用ssh协议的透明代理VPN" class="headerlink" title="sshuttle 一个使用ssh协议的透明代理VPN"></a>sshuttle 一个使用ssh协议的透明代理VPN</h3><p>sshuttle 通过 SSH 隧道将本地网络流量转发到远程主机，类似于一个轻量级的 VPN。<br>sshuttle 的工作原理是通过 SSH 将流量转发到远程主机，然后远程主机再将流量发出。因此，它非常适合在只有 SSH 访问权限的情况下进行简单的网络隧道代理。</p>
<h3 id="安装-sshuttle"><a href="#安装-sshuttle" class="headerlink" title="安装 sshuttle"></a>安装 sshuttle</h3><p>在大多数 Linux 发行版上，可以通过包管理器安装 sshuttle：</p>
<h4 id="Debian-Ubuntu"><a href="#Debian-Ubuntu" class="headerlink" title="Debian&#x2F;Ubuntu:"></a>Debian&#x2F;Ubuntu:</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install sshuttle</span><br></pre></td></tr></table></figure>

<h4 id="CentOS-RHEL"><a href="#CentOS-RHEL" class="headerlink" title="CentOS&#x2F;RHEL:"></a>CentOS&#x2F;RHEL:</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install epel-release</span><br><span class="line">sudo yum install sshuttle</span><br></pre></td></tr></table></figure>

<h3 id="使用-sshuttle"><a href="#使用-sshuttle" class="headerlink" title="使用 sshuttle"></a>使用 sshuttle</h3><p>sshuttle 的基本使用方法如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sshuttle [options...] [-r [username@]sshserver[:port]] \&lt;subnets...&gt;</span><br><span class="line"></span><br><span class="line">sshuttle -r &lt;user&gt;@&lt;remote_host&gt; &lt;network&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>-r <user>@<remote_host>：指定 SSH 连接的远程主机及其用户名</li>
<li><network>：指定你想要通过 SSH 隧道转发的目标网络或 IP 地址</li>
</ul>
<p>其他选项：</p>
<ul>
<li>–dns：通过 SSH 隧道转发 DNS 请求</li>
<li>-v 或 –verbose：启用详细输出，用于调试</li>
</ul>
<h4 id="示例用法"><a href="#示例用法" class="headerlink" title="示例用法"></a>示例用法</h4><h5 id="将所有网络流量转发到远程主机："><a href="#将所有网络流量转发到远程主机：" class="headerlink" title="将所有网络流量转发到远程主机："></a>将所有网络流量转发到远程主机：</h5><p>假设你的远程主机 IP 是 192.168.1.100，用户名是 user，并且你希望将本地的所有网络流量通过这个远程主机进行转发：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sshuttle -r user@192.168.1.100 0.0.0.0/0</span><br></pre></td></tr></table></figure>
<p>这条命令会将所有网络流量通过 SSH 隧道转发到 192.168.1.100。</p>
<h5 id="仅转发特定网络的流量："><a href="#仅转发特定网络的流量：" class="headerlink" title="仅转发特定网络的流量："></a>仅转发特定网络的流量：</h5><p>如果你只想通过 SSH 隧道转发特定子网的流量，比如 192.168.10.0&#x2F;24：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sshuttle -r user@192.168.1.100 192.168.10.0/24</span><br></pre></td></tr></table></figure>
<p>这条命令会将所有指向 192.168.10.0&#x2F;24 网络的流量通过 SSH 隧道转发到远程主机 192.168.1.100。</p>
<p>多个子网</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sshuttle -r user@192.168.1.100 192.168.10.0/24 10.10.10.0/24</span><br></pre></td></tr></table></figure>


<h5 id="后台运行："><a href="#后台运行：" class="headerlink" title="后台运行："></a>后台运行：</h5><p>如果你希望 sshuttle 在后台运行，可以加上 -D 参数：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sshuttle -r user@192.168.1.100 0.0.0.0/0 -D</span><br></pre></td></tr></table></figure>
<p>使用 -D 选项后，sshuttle 会在后台运行并持续工作。</p>
<h3 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h3><ul>
<li>权限：sshuttle 通常需要 root 权限或使用 sudo 执行，因为它需要修改本地的网络路由表和防火墙规则。</li>
<li>Python：sshuttle 是用 Python 编写的，因此需要安装 Python 环境。</li>
<li>SSH 访问：使用 sshuttle 需要目标远程主机上有 SSH 访问权限，并且 SSH 连接成功后才能转发流量。</li>
<li>端口转发：sshuttle 默认会转发 TCP 流量，但也支持 UDP 流量，可以使用 -x 参数排除特定的地址或使用 -e 选项指定自定义的 SSH 选项。</li>
</ul>
<hr>
<h3 id="检测和验证"><a href="#检测和验证" class="headerlink" title="检测和验证"></a>检测和验证</h3><h4 id="查看当前的iptables-NAT规则"><a href="#查看当前的iptables-NAT规则" class="headerlink" title="查看当前的iptables NAT规则"></a>查看当前的iptables NAT规则</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo iptables -t nat -L -n -v</span><br></pre></td></tr></table></figure>
<p>应该能看到：Chain sshuttle 如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Chain sshuttle-12300 (2 references)</span><br><span class="line"> pkts bytes target     prot opt in     out     source               destination         </span><br><span class="line">   38  1976 REDIRECT   tcp  --  *      *       0.0.0.0/0            10.10.0.0/16         TTL match TTL != 42 redir ports 12300</span><br><span class="line">    1    52 RETURN     tcp  --  *      *       0.0.0.0/0            127.0.0.0/8</span><br></pre></td></tr></table></figure>

<blockquote>
<p>firewalld 是 CentOS 7 上的默认防火墙管理工具，它为用户提供了一个更高级的管理界面来配置防火墙规则。<br>iptables 是 Linux 内核中用于设置、维护和检查 IP 包过滤规则的工具。firewalld 在后台实际上还是使用 iptables 来应用防火墙规则的。</p>
</blockquote>
<h4 id="增加调试日志"><a href="#增加调试日志" class="headerlink" title="增加调试日志"></a>增加调试日志</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sshuttle -vvr username@sshserver 0.0.0.0/0</span><br></pre></td></tr></table></figure>
<p>这里的 -vv 参数会增加日志的详细程度，有助于调试问题</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://wangwen135.github.io/DevOps/%E7%9B%91%E6%8E%A7%E4%B8%8E%E5%8F%AF%E8%A7%86%E5%8C%96/Prometheus%E6%94%B6%E9%9B%86Docker%E4%BF%A1%E6%81%AF%E5%B9%B6%E4%BD%BF%E7%94%A8Grafana%E5%B1%95%E7%A4%BA/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="王某某">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="王某某的笔记">
      <meta itemprop="description" content="这是一个使用 Hexo 构建的博客，用于分享我的编程经验和学习笔记。">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 王某某的笔记">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/DevOps/%E7%9B%91%E6%8E%A7%E4%B8%8E%E5%8F%AF%E8%A7%86%E5%8C%96/Prometheus%E6%94%B6%E9%9B%86Docker%E4%BF%A1%E6%81%AF%E5%B9%B6%E4%BD%BF%E7%94%A8Grafana%E5%B1%95%E7%A4%BA/" class="post-title-link" itemprop="url">Prometheus收集Docker信息并使用Grafana展示</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-08-22 23:34:00" itemprop="dateCreated datePublished" datetime="2024-08-22T23:34:00+08:00">2024-08-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/DevOps/" itemprop="url" rel="index"><span itemprop="name">DevOps</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/DevOps/%E7%9B%91%E6%8E%A7%E4%B8%8E%E5%8F%AF%E8%A7%86%E5%8C%96/" itemprop="url" rel="index"><span itemprop="name">监控与可视化</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>1.3k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>5 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>Prometheus 收集 Docker 信息时，通常使用 cAdvisor（Container Advisor）作为收集器。cAdvisor 是一个开源的工具，专门用于收集容器运行时的资源使用情况和性能数据，支持 Docker 容器。它能够监控 CPU、内存、网络、磁盘 I&#x2F;O 等多种指标，并将这些数据暴露为 Prometheus 可以抓取的指标。</p>
<p>官方地址：<br><a target="_blank" rel="noopener" href="https://github.com/google/cadvisor">https://github.com/google/cadvisor</a></p>
<p>在CentOS上运行参考地址：<br><a target="_blank" rel="noopener" href="https://github.com/google/cadvisor/blob/master/docs/running.md">https://github.com/google/cadvisor/blob/master/docs/running.md</a></p>
<h3 id="运行-cAdvisor-容器"><a href="#运行-cAdvisor-容器" class="headerlink" title="运行 cAdvisor 容器"></a>运行 cAdvisor 容器</h3><p>你可以通过 Docker 启动一个 cAdvisor 容器</p>
<p>命令如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">docker run \</span><br><span class="line">  --volume=/:/rootfs:ro \</span><br><span class="line">  --volume=/var/run:/var/run:ro \</span><br><span class="line">  --volume=/sys:/sys:ro \</span><br><span class="line">  --volume=/var/lib/docker/:/var/lib/docker:ro \</span><br><span class="line">  --volume=/cgroup:/cgroup:ro \</span><br><span class="line">  --publish=8080:8080 \</span><br><span class="line">  --detach=true \</span><br><span class="line">  --restart unless-stopped \</span><br><span class="line">  --name=cadvisor \</span><br><span class="line">  google/cadvisor:latest</span><br></pre></td></tr></table></figure>
<p>在 Docker 中，–volume（或者简写为 -v）选项用于将宿主机的文件或目录挂载到容器中。这里的命令示例中使用了多个 –volume 选项，每个选项都将宿主机上的目录或文件挂载到容器内的某个位置。以下是这些挂载的含义：</p>
<p>如：<code>--volume=/:/rootfs:ro：</code></p>
<ul>
<li>宿主机路径：&#x2F; （根目录）</li>
<li>容器内路径：&#x2F;rootfs</li>
<li>挂载模式：ro （只读）</li>
<li>含义：将宿主机的根文件系统以只读模式挂载到容器的 &#x2F;rootfs 目录中。这样容器能够访问宿主机的所有文件系统结构，但不能进行任何修改。</li>
</ul>
<p>其他目录：  </p>
<ul>
<li>&#x2F;var&#x2F;run： 通常包含一些运行时的进程和服务相关的文件，如 Docker 守护进程的 Unix socket，这样容器可以读取这些文件，但无法修改。 </li>
<li>&#x2F;sys： 文件系统是 Linux 中用于存储和访问系统设备的信息和状态的虚拟文件系统，通过只读方式挂载，可以让容器获取系统的状态信息。</li>
<li>&#x2F;var&#x2F;lib&#x2F;docker：宿主机的 Docker 数据目录（存放容器、镜像、网络等信息），cAdvisor 通过访问这个目录，可以获取有关 Docker 容器的信息。</li>
<li>cgroup 是 Linux 内核提供的一种机制，用于对系统资源（CPU、内存、I&#x2F;O 等）进行分组管理和限制，通过访问 cgroup 文件系统，cAdvisor 可以获取和监控容器的资源使用情况。</li>
</ul>
<h3 id="查看指标"><a href="#查看指标" class="headerlink" title="查看指标"></a>查看指标</h3><p>启动 cAdvisor 后，它会在 http:&#x2F;&#x2F;<cAdvisor_host>:8080&#x2F;metrics 路径下暴露所有收集的指标数据。Prometheus 将按照配置的抓取间隔自动抓取这些指标。</p>
<p>如：</p>
<ul>
<li><a target="_blank" rel="noopener" href="http://192.168.31.77:8080/metrics">http://192.168.31.77:8080/metrics</a>  </li>
<li><a target="_blank" rel="noopener" href="http://192.168.31.77:8080/containers/">http://192.168.31.77:8080/containers/</a>  </li>
<li><a target="_blank" rel="noopener" href="http://192.168.31.77:8080/containers/docker">http://192.168.31.77:8080/containers/docker</a></li>
</ul>
<p><img src="https://img.wangwen135.top:23456/image/2024/08/66c4bc675d8ac.png" alt="1724169316705.png"></p>
<h3 id="在-Prometheus-中配置抓取"><a href="#在-Prometheus-中配置抓取" class="headerlink" title="在 Prometheus 中配置抓取"></a>在 Prometheus 中配置抓取</h3><p>在 Prometheus 的配置文件 prometheus.yml 中，添加一个 scrape job 来抓取 cAdvisor 暴露的指标。比如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">scrape_configs:</span><br><span class="line">  - job_name: &#x27;cadvisor&#x27;</span><br><span class="line">    static_configs:</span><br><span class="line">      - targets: [&#x27;&lt;cAdvisor_host&gt;:8080&#x27;]</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>重启容器：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker restart prometheus</span><br></pre></td></tr></table></figure>
<blockquote>
<p>prometheus 也是docker安装的</p>
</blockquote>
<p>查看：<br><img src="https://img.wangwen135.top:23456/image/2024/08/66c4bbf738057.png" alt="1724169204562.png"></p>
<hr>
<h3 id="Grafana可视化配置"><a href="#Grafana可视化配置" class="headerlink" title="Grafana可视化配置"></a>Grafana可视化配置</h3><p>要在 Grafana 中展示 cAdvisor 收集的 Docker 容器信息，可以使用以仪表盘模板。这些模板已经预先配置好，可以直接导入并使用，从而快速开始监控 Docker 容器的资源使用情况。</p>
<h4 id="使用模板"><a href="#使用模板" class="headerlink" title="使用模板"></a>使用模板</h4><p>在仪表盘中选择新建 -&gt; 导入，填如复制的模板ID，选择数据源，保存</p>
<h4 id="搜索模板："><a href="#搜索模板：" class="headerlink" title="搜索模板："></a>搜索模板：</h4><p><a target="_blank" rel="noopener" href="https://grafana.com/grafana/dashboards/?search=Docker">https://grafana.com/grafana/dashboards/?search=Docker</a></p>
<p>通过关键词如 “Docker” 或 “cAdvisor” 进行搜索</p>
<h4 id="可用模板如："><a href="#可用模板如：" class="headerlink" title="可用模板如："></a>可用模板如：</h4><ul>
<li>cAdvisor Dashboard<ul>
<li>ID: 19792</li>
</ul>
</li>
<li>Docker Dashboard for Prometheus 中文版<ul>
<li>ID：11558</li>
</ul>
</li>
<li>Docker overview with Cadvisor + docker state exporter + node exporter    <ul>
<li>ID：21154</li>
</ul>
</li>
<li>Docker and system monitoring<ul>
<li>ID: 893</li>
</ul>
</li>
<li>Docker Swarm and Containers<ul>
<li>ID：609</li>
</ul>
</li>
<li>docker container &amp; OS node(node_exporter, cadvisor)<ul>
<li>ID: 16314</li>
<li>中文 docker 容器 cadvisor 和主机指标面板</li>
<li>主机指标 ( 可绑定到主机，需要 node-exporter 的 instance 标签值与 cadvisor 的 instance 标签值相同 )</li>
</ul>
</li>
</ul>
<hr>
<h3 id="将-cadvisor-与-node-exporter-指标关联"><a href="#将-cadvisor-与-node-exporter-指标关联" class="headerlink" title="将 cadvisor 与 node_exporter 指标关联"></a>将 cadvisor 与 node_exporter 指标关联</h3><p>有的面板可以同时监控 cadvisor 和 node_exporter 指标，如需将 cadvisor 与 node_exporter 指标关联，需要将 cadvisor 和 node_exporter 的 instance 标签设置为相同的值 ( 例如主机名、ip地址等 )</p>
<blockquote>
<p>cAdvisor 和 node_exporter 是常用的两个数据源。cAdvisor 用于监控 Docker 容器的资源使用情况，而 node_exporter 用于监控主机级别的系统资源（如 CPU、内存、磁盘等）。</p>
</blockquote>
<p>为了在同一个 Grafana 面板中同时展示这两者的数据，并确保它们的监控数据能够正确关联起来，你需要确保这两个数据源的 instance 标签具有相同的值。通常这个值是主机名或 IP 地址。</p>
<h4 id="如何设置-instance-标签为相同值"><a href="#如何设置-instance-标签为相同值" class="headerlink" title="如何设置 instance 标签为相同值"></a>如何设置 instance 标签为相同值</h4><p>你需要在 prometheus.yml 配置文件中使用 relabel_configs 来覆盖 instance 标签的默认值。<br>找到配置 cAdvisor 和 docker宿主机Node Exporter 的抓取任务的部分，并添加 relabel_configs 来替换 instance 标签的。<br>如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"> # 监控Docker宿主机主机的 Node Exporter</span><br><span class="line">- job_name: &#x27;docker_node_exporter&#x27; </span><br><span class="line">  static_configs:</span><br><span class="line">    - targets: [&#x27;192.168.31.77:9100&#x27;]  </span><br><span class="line">  relabel_configs:</span><br><span class="line">    - target_label: instance</span><br><span class="line">      replacement: &#x27;DockerHost&#x27;</span><br><span class="line"></span><br><span class="line"># 监控Docker相关信息</span><br><span class="line">- job_name: &#x27;cadvisor&#x27; </span><br><span class="line">  static_configs:</span><br><span class="line">    - targets: [&#x27;192.168.31.77:8080&#x27;]</span><br><span class="line">  relabel_configs:</span><br><span class="line">    - target_label: instance</span><br><span class="line">      replacement: &#x27;DockerHost&#x27;</span><br></pre></td></tr></table></figure>
<blockquote>
<ul>
<li>target_label 指定要替换或设置的目标标签。在这个例子中，instance 标签就是我们要替换的目标标签。</li>
<li>replacement 定义了 target_label 标签的新值。在这个例子中，我们将 instance 标签的值设置为 ‘DockerHost’。</li>
</ul>
</blockquote>
<p>重启</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker restart prometheus</span><br></pre></td></tr></table></figure>

<p>在 Prometheus 的 Status -&gt; Targets 中查看</p>
<p><img src="https://img.wangwen135.top:23456/image/2024/08/66c7583c44c01.png" alt="1724340279966.png"></p>
<p>这样 cAdvisor 的 instance 标签将与 宿主机的 node_exporter 的 instance 标签一致。</p>
<p>展示效果如：<br><img src="https://img.wangwen135.top:23456/image/2024/08/66c75a3b3b3a4.png" alt="1724340790569.png"></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://wangwen135.github.io/DevOps/%E7%9B%91%E6%8E%A7%E4%B8%8E%E5%8F%AF%E8%A7%86%E5%8C%96/Grafana%E4%BB%AA%E8%A1%A8%E7%9B%98Angular%E4%BE%9D%E8%B5%96%E9%97%AE%E9%A2%98/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="王某某">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="王某某的笔记">
      <meta itemprop="description" content="这是一个使用 Hexo 构建的博客，用于分享我的编程经验和学习笔记。">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 王某某的笔记">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/DevOps/%E7%9B%91%E6%8E%A7%E4%B8%8E%E5%8F%AF%E8%A7%86%E5%8C%96/Grafana%E4%BB%AA%E8%A1%A8%E7%9B%98Angular%E4%BE%9D%E8%B5%96%E9%97%AE%E9%A2%98/" class="post-title-link" itemprop="url">Grafana仪表盘Angular依赖问题</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-08-21 23:54:00" itemprop="dateCreated datePublished" datetime="2024-08-21T23:54:00+08:00">2024-08-21</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/DevOps/" itemprop="url" rel="index"><span itemprop="name">DevOps</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/DevOps/%E7%9B%91%E6%8E%A7%E4%B8%8E%E5%8F%AF%E8%A7%86%E5%8C%96/" itemprop="url" rel="index"><span itemprop="name">监控与可视化</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>392</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>1 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p><img src="https://img.wangwen135.top:23456/image/2024/08/66c5fcdd97018.png" alt="1724251354622.png"></p>
<p>This dashboard depends on Angular, which is deprecated and will stop working in future releases of Grafana.</p>
<blockquote>
<p>该仪表板依赖于 Angular，后者已被弃用，并将在 Grafana 的未来版本中停止工作。</p>
</blockquote>
<p>官方说明：<br><a target="_blank" rel="noopener" href="https://grafana.com/docs/grafana/latest/developers/angular_deprecation/">https://grafana.com/docs/grafana/latest/developers/angular_deprecation/</a></p>
<p>Angular 插件支持已弃用，并将在未来版本中删除。有些旧版核心 Grafana 可视化和外部插件依赖 Grafana 的 Angular 插件支持才能工作。</p>
<p>从 Grafana v9 及更高版本开始，有一个服务器配置选项，它是整个实例的全局选项，用于控制是否提供 Angular 插件支持。在 Grafana 11 中，将更改配置的默认值以删除支持。</p>
<p>在 Grafana 11 中（该版本将于 2024 年 4 月发布预览版，并于 5 月正式发布），将更改 <strong>angular_support_enabled</strong> 配置参数的默认值为：false，以关闭对基于 AngularJS 的插件的支持。如果您仍然依赖内部或社区开发的基于 AngularJS 的插件，则需要启用此选项才能继续使用它们。<br>新的 Grafana Cloud 用户将无法请求将支持添加到他们的实例中。</p>
<p>目前的计划是完全删除版本 12 中对 Angular 插件的任何剩余支持。包括删除angular_support_enabled配置参数。</p>
<h3 id="启用Angular支持"><a href="#启用Angular支持" class="headerlink" title="启用Angular支持"></a>启用Angular支持</h3><blockquote>
<p>这里的版本是： Grafana  <strong>V11.1.4</strong></p>
</blockquote>
<h3 id="进入容器："><a href="#进入容器：" class="headerlink" title="进入容器："></a>进入容器：</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker exec -it --user root grafana /bin/bash</span><br></pre></td></tr></table></figure>

<h3 id="编辑-Grafana-配置文件"><a href="#编辑-Grafana-配置文件" class="headerlink" title="编辑 Grafana 配置文件"></a>编辑 Grafana 配置文件</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/grafana/grafana.ini</span><br></pre></td></tr></table></figure>
<p>在配置文件中查找或添加以下内容：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">angular_support_enabled = true</span><br></pre></td></tr></table></figure>
<p>配置文件中默认是：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">;angular_support_enabled = false</span><br></pre></td></tr></table></figure>
<blockquote>
<p>这个分号表示注释</p>
</blockquote>
<h3 id="重启-Grafana-容器"><a href="#重启-Grafana-容器" class="headerlink" title="重启 Grafana 容器"></a>重启 Grafana 容器</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker restart grafana</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://wangwen135.github.io/DevOps/%E7%9B%91%E6%8E%A7%E4%B8%8E%E5%8F%AF%E8%A7%86%E5%8C%96/Prometheus%20%E5%92%8C%20Grafana/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="王某某">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="王某某的笔记">
      <meta itemprop="description" content="这是一个使用 Hexo 构建的博客，用于分享我的编程经验和学习笔记。">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 王某某的笔记">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/DevOps/%E7%9B%91%E6%8E%A7%E4%B8%8E%E5%8F%AF%E8%A7%86%E5%8C%96/Prometheus%20%E5%92%8C%20Grafana/" class="post-title-link" itemprop="url">Prometheus 和 Grafana</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-08-19 23:54:00" itemprop="dateCreated datePublished" datetime="2024-08-19T23:54:00+08:00">2024-08-19</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/DevOps/" itemprop="url" rel="index"><span itemprop="name">DevOps</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/DevOps/%E7%9B%91%E6%8E%A7%E4%B8%8E%E5%8F%AF%E8%A7%86%E5%8C%96/" itemprop="url" rel="index"><span itemprop="name">监控与可视化</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>1.8k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>7 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <blockquote>
<p>时间：2024-8-18<br>版本信息：</p>
<ul>
<li>Prometheus  V2.53.2</li>
<li>Grafana     V11.1.4</li>
</ul>
</blockquote>
<h2 id="Prometheus-和-Grafana-介绍"><a href="#Prometheus-和-Grafana-介绍" class="headerlink" title="Prometheus 和 Grafana 介绍"></a>Prometheus 和 Grafana 介绍</h2><p>Prometheus 和 Grafana 是监控领域中经常搭配使用的两个开源工具，它们共同构成了一个强大的监控解决方案。</p>
<h3 id="Prometheus"><a href="#Prometheus" class="headerlink" title="Prometheus"></a>Prometheus</h3><p>一个开源的监控系统和时间序列数据库，主要用于收集和存储各种指标数据。它具有强大的查询语言 PromQL，可以对时间序列数据进行灵活的查询和聚合。</p>
<p>Prometheus 主要分为两个部分：服务端（Prometheus Server）和数据收集端（ Exporter）</p>
<h4 id="Prometheus-Server（服务端）"><a href="#Prometheus-Server（服务端）" class="headerlink" title="Prometheus Server（服务端）"></a>Prometheus Server（服务端）</h4><p>Prometheus Server 负责从配置的目标（例如 Node Exporter）抓取数据，并存储这些数据。它执行数据采集、存储、查询和报警等任务。</p>
<h5 id="主要组件："><a href="#主要组件：" class="headerlink" title="主要组件："></a>主要组件：</h5><ul>
<li>数据采集：通过 HTTP 请求抓取暴露的时间序列数据。</li>
<li>时间序列数据库：存储和管理时间序列数据。</li>
<li>查询语言：提供 PromQL（Prometheus Query Language）用于查询数据。</li>
<li>报警管理：集成 Alertmanager 用于处理和发送报警通知。</li>
</ul>
<h4 id="Exporter（数据收集端）"><a href="#Exporter（数据收集端）" class="headerlink" title="Exporter（数据收集端）"></a>Exporter（数据收集端）</h4><p>Prometheus官方提供了很多Exporter，用于采集不同类型的指标数据，如Node Exporter、MySQL Exporter、Kafka Exporter等。</p>
<h5 id="Node-Exporter"><a href="#Node-Exporter" class="headerlink" title="Node Exporter"></a>Node Exporter</h5><p>Node Exporter 是一种常见的 Prometheus 导出器，用于从 Linux 系统上收集系统级的指标数据（如 CPU 使用率、内存、磁盘 IO 等）。它将这些数据暴露为 Prometheus 可抓取的格式。<br>它的主要功能是：  </p>
<ul>
<li>数据收集：从操作系统的各种指标中获取数据。</li>
<li>数据暴露：通过 HTTP 将这些数据暴露给 Prometheus Server。</li>
</ul>
<h3 id="Grafana"><a href="#Grafana" class="headerlink" title="Grafana"></a>Grafana</h3><p>一个开源的分析和可视化平台，可以连接到多个数据源（包括 Prometheus），并以图形化的方式展示数据。Grafana 提供了丰富的图表类型、仪表盘和报警功能，使得监控数据更加直观易懂。</p>
<h4 id="Grafana-的主要功能"><a href="#Grafana-的主要功能" class="headerlink" title="Grafana 的主要功能"></a>Grafana 的主要功能</h4><ul>
<li>创建仪表盘： 将多个图表、表格等元素组合成一个仪表盘，以展示系统的整体运行状况。</li>
<li>自定义图表： 支持多种图表类型，如折线图、柱状图、饼图、热力图等，可以对数据进行灵活的展示。</li>
<li>设置报警： 当指标数据超出设定的阈值时，触发报警，及时通知相关人员。</li>
<li>探索数据： 提供一个交互式的查询界面，方便用户探索和分析数据。</li>
</ul>
<hr>
<h2 id="以Docker方式安装Prometheus和Grafana"><a href="#以Docker方式安装Prometheus和Grafana" class="headerlink" title="以Docker方式安装Prometheus和Grafana"></a>以Docker方式安装Prometheus和Grafana</h2><blockquote>
<p>安装在 DockerHost 192.168.31.77</p>
</blockquote>
<h3 id="创建目录和配置文件"><a href="#创建目录和配置文件" class="headerlink" title="创建目录和配置文件"></a>创建目录和配置文件</h3><h4 id="创建目录"><a href="#创建目录" class="headerlink" title="创建目录"></a>创建目录</h4><blockquote>
<p>如果不想映射这两个数据，也可不用配置<br>映射数据目录只是为了删除容器之后数据不会丢失  </p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /opt/prometheus/data</span><br><span class="line">mkdir -p /opt/grafana/data</span><br></pre></td></tr></table></figure>

<h4 id="修改目录权限"><a href="#修改目录权限" class="headerlink" title="修改目录权限"></a>修改目录权限</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo chown -R 65534:65534 /opt/prometheus/data</span><br><span class="line">sudo chmod -R 775 /opt/prometheus/data</span><br></pre></td></tr></table></figure>
<blockquote>
<p>上面的 65534:65534 是 Docker 中常用的 nobody 用户和组的 UID 和 GID，确保 Prometheus 容器能够写入数据。</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo chown -R 472:472 /opt/grafana/data</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Grafana 容器中的进程通常以 grafana 用户（UID 为 472）运行，因此，你需要确保该用户对 &#x2F;var&#x2F;lib&#x2F;grafana 有读写权限。<br>用户ID可以通过如：<code>docker inspect grafana | grep User</code> 之类的命令查看</p>
</blockquote>
<p>也可以简单粗暴的让所有用户都有读写权限，如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo chmod -R 777 /opt/prometheus/data</span><br><span class="line">sudo chmod -R 777 /opt/grafana/data</span><br></pre></td></tr></table></figure>


<h4 id="创建配置文件"><a href="#创建配置文件" class="headerlink" title="创建配置文件"></a>创建配置文件</h4><p>为 Prometheus 创建一个配置文件 prometheus.yml：<br>vim &#x2F;opt&#x2F;prometheus&#x2F;prometheus.yml  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">global:</span><br><span class="line">  scrape_interval: 10s  # 抓取数据的时间间隔</span><br><span class="line"></span><br><span class="line">scrape_configs:</span><br><span class="line">  - job_name: &#x27;prometheus&#x27;</span><br><span class="line">    static_configs:</span><br><span class="line">      - targets: [&#x27;localhost:9090&#x27;]</span><br><span class="line"></span><br><span class="line">  - job_name: &#x27;node_exporter&#x27;</span><br><span class="line">    static_configs:</span><br><span class="line">      - targets: [&#x27;192.168.31.77:9100&#x27;]  # 监控宿主机的 Node Exporter</span><br></pre></td></tr></table></figure>
<blockquote>
<p>这只是一个示例，先跑起来</p>
</blockquote>
<h3 id="拉取镜像"><a href="#拉取镜像" class="headerlink" title="拉取镜像"></a>拉取镜像</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker pull prom/prometheus</span><br><span class="line">docker pull grafana/grafana</span><br></pre></td></tr></table></figure>

<blockquote>
<p>需要科学上网，或者配置国内的镜像地址</p>
</blockquote>
<h3 id="启动容器"><a href="#启动容器" class="headerlink" title="启动容器"></a>启动容器</h3><h4 id="启动-Prometheus-容器"><a href="#启动-Prometheus-容器" class="headerlink" title="启动 Prometheus 容器"></a>启动 Prometheus 容器</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">docker run -d \</span><br><span class="line">  --name prometheus \</span><br><span class="line">  --restart unless-stopped \</span><br><span class="line">  -p 9090:9090 \</span><br><span class="line">  -v /opt/prometheus/data:/prometheus \</span><br><span class="line">  -v /opt/prometheus/prometheus.yml:/etc/prometheus/prometheus.yml \</span><br><span class="line">  prom/prometheus</span><br></pre></td></tr></table></figure>

<p>访问 <a target="_blank" rel="noopener" href="http://192.168.31.77:9090/">http://192.168.31.77:9090</a> 来查看 Prometheus 的 Web 界面</p>
<blockquote>
<p>有防火墙的要注意开放端口  </p>
</blockquote>
<h4 id="启动-Grafana-容器"><a href="#启动-Grafana-容器" class="headerlink" title="启动 Grafana 容器"></a>启动 Grafana 容器</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">docker run -d \</span><br><span class="line">    --name grafana \</span><br><span class="line">    --restart unless-stopped \</span><br><span class="line">    -p 3000:3000 \</span><br><span class="line">    -v /opt/grafana/data:/var/lib/grafana \</span><br><span class="line">    grafana/grafana</span><br></pre></td></tr></table></figure>

<p>访问 <a target="_blank" rel="noopener" href="http://192.168.31.77:3000/">http://192.168.31.77:3000</a>  </p>
<p>默认用户名密码是：amdin&#x2F;admin ，第一次登录会提示修改密码</p>
<blockquote>
<p>有防火墙时需要开放对应端口</p>
</blockquote>
<h3 id="在目标机器上安装Node-Exporter"><a href="#在目标机器上安装Node-Exporter" class="headerlink" title="在目标机器上安装Node Exporter"></a>在目标机器上安装Node Exporter</h3><blockquote>
<p>安装在 192.168.31.77 这台docker宿主机上</p>
</blockquote>
<p>首先，从 Prometheus 官方的 GitHub 仓库下载 Node Exporter 的最新版本。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /opt/prometheus/node_exporter</span><br><span class="line">wget https://github.com/prometheus/node_exporter/releases/download/v1.8.2/node_exporter-1.8.2.linux-amd64.tar.gz</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>解压缩后运行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf node_exporter-1.8.2.linux-amd64.tar.gz </span><br><span class="line"></span><br><span class="line">cd node_exporter-1.8.2.linux-amd64</span><br><span class="line"></span><br><span class="line">nohup ./node_exporter &amp;</span><br></pre></td></tr></table></figure>
<p>Node Exporter 默认会在端口 9100 上启动，并暴露 &#x2F;metrics 端点。如果一切正常，你可以在浏览器中访问 http:&#x2F;&#x2F;&lt;目标机器的IP地址&gt;:9100&#x2F;metrics，查看暴露的系统指标。<br>如：<br><a target="_blank" rel="noopener" href="http://192.168.31.77:9100/metrics">http://192.168.31.77:9100/metrics</a></p>
<p>此时应该能在 prometheus 的 status菜单的 targets 中看到端点已连接</p>
<p><img src="https://img.wangwen135.top:23456/image/2024/08/66c1b36a68c7a.png" alt="1723970385587.png"></p>
<h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><h3 id="配置-Grafana"><a href="#配置-Grafana" class="headerlink" title="配置 Grafana"></a>配置 Grafana</h3><h4 id="添加-Prometheus-数据源："><a href="#添加-Prometheus-数据源：" class="headerlink" title="添加 Prometheus 数据源："></a>添加 Prometheus 数据源：</h4><ul>
<li>左侧菜单 Connections -&gt; Data Sources</li>
<li>点击Add data source</li>
<li>选择Prometheus</li>
<li>给数据源起一个有意义的名称，比如“Prometheus”</li>
<li>URL：输入Prometheus服务器的HTTP API地址，例如：<a target="_blank" rel="noopener" href="http://192.168.31.77:9090/">http://192.168.31.77:9090</a></li>
</ul>
<h4 id="创建仪表盘："><a href="#创建仪表盘：" class="headerlink" title="创建仪表盘："></a>创建仪表盘：</h4><ul>
<li>选择 “Dashboards” 菜单，选择“Create dashboard”，选择“Add visualization”</li>
<li>选择刚刚添加的 Prometheus 数据源</li>
</ul>
<h5 id="配置面板："><a href="#配置面板：" class="headerlink" title="配置面板："></a>配置面板：</h5><ul>
<li>Metric：选择要查询的指标，例如node_cpu_seconds_total</li>
<li>标签：根据需要过滤数据，例如{instance&#x3D;”your_host”}。<br><img src="https://img.wangwen135.top:23456/image/2024/08/66c1b745f2fc5.png" alt="1723971325393.png"></li>
</ul>
<p>给面板命名并保存即可</p>
<h3 id="导入仪表盘"><a href="#导入仪表盘" class="headerlink" title="导入仪表盘"></a>导入仪表盘</h3><p>给一个个监控指标来配置图标的方式相对的麻烦，需要相关的经验也非常费时间，我们可以通过导入配置的方式快速搭建出专业的监控界面，而无需从头开始配置每一个图表和面板。可以提高效率，复用性和专业性。</p>
<blockquote>
<p>官方网站上有各种各样的模板可以使用  </p>
</blockquote>
<p>如我们要监控linux主机的各种指标：</p>
<ul>
<li>打开：<a target="_blank" rel="noopener" href="https://grafana.com/grafana/dashboards">https://grafana.com/grafana/dashboards</a></li>
<li>搜索：Node Exporter，点击第一个，如：<a target="_blank" rel="noopener" href="https://grafana.com/grafana/dashboards/1860-node-exporter-full/">https://grafana.com/grafana/dashboards/1860-node-exporter-full/</a></li>
<li>点击右边的复制模板ID （1860）</li>
<li>回到普罗米修斯中点击创建面板 –&gt; <code>Import dashboards from files or grafana.com.</code></li>
<li>在上面粘贴ID，点击Load，下一步选择数据源</li>
</ul>
<p><img src="https://img.wangwen135.top:23456/image/2024/08/66c2d08f31690.png" alt="1724043381275.png"></p>
<hr>
<h2 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h2><h3 id="将Node-Exporter配置为系统服务"><a href="#将Node-Exporter配置为系统服务" class="headerlink" title="将Node Exporter配置为系统服务"></a>将Node Exporter配置为系统服务</h3><p>为了确保 Node Exporter 在系统重启后自动启动，你可以将其配置为系统服务。</p>
<ul>
<li><p>创建一个新的系统服务文件 &#x2F;etc&#x2F;systemd&#x2F;system&#x2F;node_exporter.service：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/systemd/system/node_exporter.service</span><br></pre></td></tr></table></figure></li>
<li><p>在文件中添加以下内容：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=Node Exporter</span><br><span class="line">Wants=network-online.target</span><br><span class="line">After=network-online.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">User=nobody</span><br><span class="line">ExecStart=/usr/local/bin/node_exporter</span><br><span class="line">Restart=on-failure</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=default.target</span><br></pre></td></tr></table></figure>
<blockquote>
<p>如果你将 Node Exporter 安装在其他目录下，比如 &#x2F;usr&#x2F;local&#x2F;bin，请相应地调整 ExecStart 路径。<br>这里使用软连接的方式</p>
</blockquote>
</li>
<li><p>创建软链接</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ln -s /opt/prometheus/node_exporter/node_exporter-1.8.2.linux-amd64/node_exporter /usr/local/bin/node_exporter</span><br></pre></td></tr></table></figure>
</li>
<li><p>重新加载 systemd 配置以应用更改：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl daemon-reload</span><br></pre></td></tr></table></figure>
</li>
<li><p>启动 Node Exporter 服务：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl start node_exporter</span><br></pre></td></tr></table></figure>
</li>
<li><p>验证:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl status node_exporter</span><br></pre></td></tr></table></figure>
<p>访问：<a target="_blank" rel="noopener" href="http://192.168.31.85:9100/metrics">http://192.168.31.85:9100/metrics</a></p>
</li>
<li><p>设置开机自启动：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl enable node_exporter</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="中文配置"><a href="#中文配置" class="headerlink" title="中文配置"></a>中文配置</h3><h4 id="设置-Grafana-语言为中文"><a href="#设置-Grafana-语言为中文" class="headerlink" title="设置 Grafana 语言为中文"></a>设置 Grafana 语言为中文</h4><p>点击页面左上角的个人头像，然后选择“Profile”（偏好设置）<br>在“Preferences”页面中，找到“Language”（语言）选项，设置为中文（简体）  </p>
<h4 id="使用中文监控面板"><a href="#使用中文监控面板" class="headerlink" title="使用中文监控面板"></a>使用中文监控面板</h4><p>如：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://grafana.com/grafana/dashboards/12633-linux/">https://grafana.com/grafana/dashboards/12633-linux/</a></li>
<li><a target="_blank" rel="noopener" href="https://grafana.com/grafana/dashboards/8919">https://grafana.com/grafana/dashboards/8919</a></li>
<li><a target="_blank" rel="noopener" href="https://grafana.com/grafana/dashboards/16098">https://grafana.com/grafana/dashboards/16098</a></li>
</ul>
<p><strong>Linux主机详情</strong><br>（12633-linux）效果如下：</p>
<p><img src="https://img.wangwen135.top:23456/image/2024/08/66c3656c0ebdd.png" alt="1724081514391.png"></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://wangwen135.github.io/%E5%8D%9A%E5%AE%A2/Hexo/%E4%BD%BF%E7%94%A8%20github%20actions%20%E9%83%A8%E7%BD%B2%20github%20pages/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="王某某">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="王某某的笔记">
      <meta itemprop="description" content="这是一个使用 Hexo 构建的博客，用于分享我的编程经验和学习笔记。">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 王某某的笔记">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/%E5%8D%9A%E5%AE%A2/Hexo/%E4%BD%BF%E7%94%A8%20github%20actions%20%E9%83%A8%E7%BD%B2%20github%20pages/" class="post-title-link" itemprop="url">使用 github actions 部署 github pages</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-08-08 00:00:00" itemprop="dateCreated datePublished" datetime="2024-08-08T00:00:00+08:00">2024-08-08</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%8D%9A%E5%AE%A2/" itemprop="url" rel="index"><span itemprop="name">博客</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%8D%9A%E5%AE%A2/Hexo/" itemprop="url" rel="index"><span itemprop="name">Hexo</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>1.2k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>4 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>官方的和我实际想要实现的有一点差异，官方的是部署到当前仓库的 GitHub Pages  </p>
<p>我这边是原来有一个网站，这次又使用Hexo重新做了一个博客，又新建了一个<code>hexo-blog</code>仓库</p>
<p>我想实现的效果是，往<strong>hexo-blog</strong> 仓库提交Markdown内容之后自动编译，然后将编译后的内容提交到 <strong>wangwen135.github.io</strong>这个仓库</p>
<hr>
<h2 id="官方的"><a href="#官方的" class="headerlink" title="官方的"></a>官方的</h2><p>先参考一下官方的文档说明</p>
<p>官方说明文档：<a target="_blank" rel="noopener" href="https://hexo.io/zh-cn/docs/github-pages">https://hexo.io/zh-cn/docs/github-pages</a></p>
<p><code>.github/workflows/pages.yml</code> 文件内容如下：</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">name:</span> <span class="string">Pages</span></span><br><span class="line"></span><br><span class="line"><span class="attr">on:</span></span><br><span class="line">  <span class="attr">push:</span></span><br><span class="line">    <span class="attr">branches:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">main</span> <span class="comment"># 当推送到 main 分支时触发工作流</span></span><br><span class="line"></span><br><span class="line"><span class="attr">jobs:</span></span><br><span class="line">  <span class="attr">build:</span></span><br><span class="line">    <span class="attr">runs-on:</span> <span class="string">ubuntu-latest</span> <span class="comment"># 工作运行在最新的 Ubuntu 环境中</span></span><br><span class="line">    <span class="attr">steps:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">uses:</span> <span class="string">actions/checkout@v4</span> <span class="comment"># 检出代码</span></span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="attr">token:</span> <span class="string">$&#123;&#123;</span> <span class="string">secrets.GITHUB_TOKEN</span> <span class="string">&#125;&#125;</span> <span class="comment"># 使用 GitHub token</span></span><br><span class="line">          <span class="attr">submodules:</span> <span class="string">recursive</span> <span class="comment"># 如果仓库依赖子模块，则递归检出</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Use</span> <span class="string">Node.js</span> <span class="number">20</span> <span class="comment"># 使用 Node.js 20</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">actions/setup-node@v4</span></span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="attr">node-version:</span> <span class="string">&quot;20&quot;</span> <span class="comment"># 指定 Node.js 版本为 20</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Cache</span> <span class="string">NPM</span> <span class="string">dependencies</span> <span class="comment"># 缓存 NPM 依赖</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">actions/cache@v4</span></span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="attr">path:</span> <span class="string">node_modules</span></span><br><span class="line">          <span class="attr">key:</span> <span class="string">$&#123;&#123;</span> <span class="string">runner.OS</span> <span class="string">&#125;&#125;-npm-cache</span></span><br><span class="line">          <span class="attr">restore-keys:</span> <span class="string">|</span></span><br><span class="line"><span class="string">            $&#123;&#123; runner.OS &#125;&#125;-npm-cache</span></span><br><span class="line"><span class="string"></span>      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Install</span> <span class="string">Dependencies</span> <span class="comment"># 安装依赖</span></span><br><span class="line">        <span class="attr">run:</span> <span class="string">npm</span> <span class="string">install</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Build</span> <span class="comment"># 构建项目</span></span><br><span class="line">        <span class="attr">run:</span> <span class="string">npm</span> <span class="string">run</span> <span class="string">build</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Upload</span> <span class="string">Pages</span> <span class="string">artifact</span> <span class="comment"># 上传构建产物</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">actions/upload-pages-artifact@v3</span></span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="attr">path:</span> <span class="string">./public</span> <span class="comment"># 指定上传的路径</span></span><br><span class="line">  <span class="attr">deploy:</span></span><br><span class="line">    <span class="attr">needs:</span> <span class="string">build</span> <span class="comment"># 依赖 build 任务</span></span><br><span class="line">    <span class="attr">permissions:</span></span><br><span class="line">      <span class="attr">pages:</span> <span class="string">write</span> <span class="comment"># 给予 GitHub Pages 写权限</span></span><br><span class="line">      <span class="attr">id-token:</span> <span class="string">write</span> <span class="comment"># 给予 ID 令牌写权限</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">github-pages</span></span><br><span class="line">      <span class="attr">url:</span> <span class="string">$&#123;&#123;</span> <span class="string">steps.deployment.outputs.page_url</span> <span class="string">&#125;&#125;</span></span><br><span class="line">    <span class="attr">runs-on:</span> <span class="string">ubuntu-latest</span> <span class="comment"># 工作运行在最新的 Ubuntu 环境中</span></span><br><span class="line">    <span class="attr">steps:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Deploy</span> <span class="string">to</span> <span class="string">GitHub</span> <span class="string">Pages</span> <span class="comment"># 部署到 GitHub Pages</span></span><br><span class="line">        <span class="attr">id:</span> <span class="string">deployment</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">actions/deploy-pages@v4</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<blockquote>
<p>这个 GitHub Actions 配置文件用于将编译后的 HTML 文件自动部署到当前仓库的 GitHub Pages。<br>这里加上了一点注释</p>
</blockquote>
<hr>
<h2 id="修改后的"><a href="#修改后的" class="headerlink" title="修改后的"></a>修改后的</h2><h3 id="完整的-GitHub-Actions-工作流-YAML-文件"><a href="#完整的-GitHub-Actions-工作流-YAML-文件" class="headerlink" title="完整的 GitHub Actions 工作流 YAML 文件"></a>完整的 GitHub Actions 工作流 YAML 文件</h3><p><code>.github/workflows/deploy.yml</code> </p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">name:</span> <span class="string">Deploy</span> <span class="string">to</span> <span class="string">GitHub</span> <span class="string">Pages</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 触发条件：当推送到 main 分支时</span></span><br><span class="line"><span class="attr">on:</span></span><br><span class="line">  <span class="attr">push:</span></span><br><span class="line">    <span class="attr">branches:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">main</span></span><br><span class="line">  <span class="attr">workflow_dispatch:</span> <span class="comment"># 允许手动触发</span></span><br><span class="line"></span><br><span class="line"><span class="attr">jobs:</span></span><br><span class="line">  <span class="attr">build:</span></span><br><span class="line">    <span class="attr">runs-on:</span> <span class="string">ubuntu-latest</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">steps:</span></span><br><span class="line">      <span class="comment"># 检出 hexo-blog 仓库的代码</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Checkout</span> <span class="string">repository</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">actions/checkout@v4</span></span><br><span class="line"></span><br><span class="line">      <span class="comment"># 设置 Node.js 环境</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Setup</span> <span class="string">Node.js</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">actions/setup-node@v4</span></span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="attr">node-version:</span> <span class="string">&#x27;20&#x27;</span></span><br><span class="line"></span><br><span class="line">      <span class="comment"># 缓存 NPM 依赖</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Cache</span> <span class="string">NPM</span> <span class="string">dependencies</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">actions/cache@v4</span></span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="attr">path:</span> <span class="string">~/.npm</span></span><br><span class="line">          <span class="attr">key:</span> <span class="string">$&#123;&#123;</span> <span class="string">runner.os</span> <span class="string">&#125;&#125;-node-$&#123;&#123;</span> <span class="string">hashFiles(&#x27;**/package-lock.json&#x27;)</span> <span class="string">&#125;&#125;</span></span><br><span class="line">          <span class="attr">restore-keys:</span> <span class="string">|</span></span><br><span class="line"><span class="string">            $&#123;&#123; runner.os &#125;&#125;-node-</span></span><br><span class="line"><span class="string"></span></span><br><span class="line">      <span class="comment"># 安装依赖</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Install</span> <span class="string">dependencies</span></span><br><span class="line">        <span class="attr">run:</span> <span class="string">npm</span> <span class="string">install</span></span><br><span class="line"></span><br><span class="line">      <span class="comment"># 构建 Hexo 网站</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Build</span> <span class="string">Hexo</span> <span class="string">site</span></span><br><span class="line">        <span class="attr">run:</span> <span class="string">npm</span> <span class="string">run</span> <span class="string">build</span></span><br><span class="line"></span><br><span class="line">      <span class="comment"># 部署到 GitHub Pages</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Deploy</span> <span class="string">to</span> <span class="string">GitHub</span> <span class="string">Pages</span></span><br><span class="line">        <span class="attr">env:</span></span><br><span class="line">          <span class="attr">ACTIONS_DEPLOY_KEY:</span> <span class="string">$&#123;&#123;</span> <span class="string">secrets.ACTIONS_DEPLOY_KEY</span> <span class="string">&#125;&#125;</span></span><br><span class="line">        <span class="attr">run:</span> <span class="string">|</span></span><br><span class="line"><span class="string">          echo &quot;创建 .ssh 目录&quot;</span></span><br><span class="line"><span class="string">          mkdir -p ~/.ssh</span></span><br><span class="line"><span class="string">          echo &#x27;写入部署密钥到 id_ed25519 文件中&#x27;</span></span><br><span class="line"><span class="string">          echo &quot;$&#123;&#123; secrets.ACTIONS_DEPLOY_KEY &#125;&#125;&quot; &gt; ~/.ssh/id_ed25519</span></span><br><span class="line"><span class="string">          echo &quot;设置私钥文件权限&quot;</span></span><br><span class="line"><span class="string">          chmod 600 ~/.ssh/id_ed25519</span></span><br><span class="line"><span class="string"></span></span><br><span class="line">          <span class="string">cat</span> <span class="string">~/.ssh/id_ed25519</span></span><br><span class="line"></span><br><span class="line">          <span class="string">echo</span> <span class="string">&quot;添加 GitHub 的 SSH 主机密钥到 known_hosts 文件中&quot;</span></span><br><span class="line">          <span class="string">ssh-keyscan</span> <span class="string">github.com</span> <span class="string">&gt;&gt;</span> <span class="string">~/.ssh/known_hosts</span></span><br><span class="line">          </span><br><span class="line">          <span class="string">echo</span> <span class="string">&quot;配置 Git 用户信息&quot;</span></span><br><span class="line">          <span class="string">git</span> <span class="string">config</span> <span class="string">--global</span> <span class="string">user.name</span> <span class="string">&#x27;github-actions[bot]&#x27;</span></span><br><span class="line">          <span class="string">git</span> <span class="string">config</span> <span class="string">--global</span> <span class="string">user.email</span> <span class="string">&#x27;github-actions[bot]@users.noreply.github.com&#x27;</span></span><br><span class="line">          </span><br><span class="line">          <span class="string">echo</span> <span class="string">&quot;克隆 wangwen135.github.io 仓库的 main 分支到 .deploy_repo 目录&quot;</span></span><br><span class="line">          <span class="string">git</span> <span class="string">clone</span> <span class="string">--branch</span> <span class="string">main</span> <span class="string">git@github.com:wangwen135/wangwen135.github.io.git</span> <span class="string">.deploy_repo</span></span><br><span class="line"></span><br><span class="line">          <span class="string">echo</span> <span class="string">&quot;切换到 .deploy_repo 目录&quot;</span></span><br><span class="line">          <span class="string">cd</span> <span class="string">.deploy_repo</span></span><br><span class="line"></span><br><span class="line">          <span class="string">echo</span> <span class="string">&quot;更新一下代码&quot;</span></span><br><span class="line">          <span class="string">git</span> <span class="string">pull</span></span><br><span class="line"></span><br><span class="line">          <span class="string">echo</span> <span class="string">&quot;使用 rsync 将 public 目录中的内容同步到 .deploy_repo 目录&quot;</span></span><br><span class="line">          <span class="string">rsync</span> <span class="string">-av</span> <span class="string">--delete</span> <span class="string">--exclude</span> <span class="string">&#x27;.git&#x27;</span> <span class="string">../public/</span> <span class="string">.</span></span><br><span class="line"></span><br><span class="line">          <span class="string">echo</span> <span class="string">&quot;添加所有更改&quot;</span></span><br><span class="line">          <span class="string">git</span> <span class="string">add</span> <span class="string">.</span></span><br><span class="line">          <span class="string">echo</span> <span class="string">&#x27;提交更改，提交信息为 &quot;Deploy updates&quot;&#x27;</span></span><br><span class="line">          <span class="string">git</span> <span class="string">commit</span> <span class="string">-m</span> <span class="string">&quot;Deploy updates&quot;</span></span><br><span class="line">          <span class="string">echo</span> <span class="string">&quot;推送更改到远程仓库的 main 分支&quot;</span></span><br><span class="line">          <span class="string">git</span> <span class="string">push</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>相关步骤上面都有注释</p>
</blockquote>
<p>因为要使用git将文件推送到仓库<code>wangwen135.github.io</code> 需要配置ssh key，还需要进行下面的步骤</p>
<h2 id="配置-Secrets"><a href="#配置-Secrets" class="headerlink" title="配置 Secrets"></a>配置 Secrets</h2><p>在 GitHub Actions 中，Secrets 是一种安全存储和管理敏感信息的方法，例如访问令牌、API 密钥、SSH 密钥等。Secrets 可以在工作流中使用，但不会在日志中显示，确保了敏感信息的安全。</p>
<h3 id="设置步骤"><a href="#设置步骤" class="headerlink" title="设置步骤"></a>设置步骤</h3><h4 id="生成-SSH-部署密钥"><a href="#生成-SSH-部署密钥" class="headerlink" title="生成 SSH 部署密钥"></a>生成 SSH 部署密钥</h4><p>在本地机器上生成 SSH 密钥对：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t ed25519 -C &quot;wangwen135@gmail.com&quot; -f ./id_ed25519</span><br></pre></td></tr></table></figure>
<blockquote>
<p>按提示操作，将会在当前执行的目录中生成 id_ed25519 和 id_ed25519.pub 两个文件</p>
</blockquote>
<h4 id="添加-id-ed25519-到-hexo-blog-的-GitHub-Secrets"><a href="#添加-id-ed25519-到-hexo-blog-的-GitHub-Secrets" class="headerlink" title="添加 id_ed25519 到 hexo-blog 的 GitHub Secrets"></a>添加 id_ed25519 到 hexo-blog 的 GitHub Secrets</h4><p>将生成的私钥 id_ed25519 的内容添加到 hexo-blog 仓库的 GitHub Secrets 中，步骤如下：</p>
<ul>
<li>打开 GitHub，进入你的 hexo-blog 仓库。</li>
<li>点击 “Settings” 选项卡。</li>
<li>在左侧边栏中，找到并点击 “Secrets and variables” 下的 “Actions”。</li>
<li>点击 “New repository secret” 按钮。</li>
<li>在 “Name” 字段中输入 <strong>ACTIONS_DEPLOY_KEY</strong>，在 “Secret” 字段中粘贴 id_ed25519 文件的内容。</li>
<li>点击 “Add secret” 按钮保存。</li>
</ul>
<h4 id="添加-id-ed25519-pub-到目标仓库的部署密钥"><a href="#添加-id-ed25519-pub-到目标仓库的部署密钥" class="headerlink" title="添加 id_ed25519.pub 到目标仓库的部署密钥"></a>添加 id_ed25519.pub 到目标仓库的部署密钥</h4><p>将生成的公钥 id_ed25519.pub 添加到 wangwen135.github.io 仓库的部署密钥中，步骤如下：</p>
<ul>
<li>打开 GitHub，进入你的 wangwen135.github.io 仓库。</li>
<li>点击 “Settings” 选项卡。</li>
<li>在左侧边栏中，找到并点击 “Deploy keys”。</li>
<li>点击 “Add deploy key” 按钮。</li>
<li>在 “Title” 字段中输入一个描述性的名称，例如 “GitHub Actions Deploy Key”。</li>
<li>在 “Key” 字段中粘贴 id_ed25519.pub 文件的内容。</li>
<li>确保勾选 “Allow write access” 复选框。</li>
<li>点击 “Add key” 按钮保存。</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://wangwen135.github.io/%E7%BD%91%E7%BB%9C%E4%B8%8E%E5%AE%89%E5%85%A8/SSH/SSH%20%E7%AB%AF%E5%8F%A3%E8%BD%AC%E5%8F%91/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="王某某">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="王某某的笔记">
      <meta itemprop="description" content="这是一个使用 Hexo 构建的博客，用于分享我的编程经验和学习笔记。">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 王某某的笔记">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/%E7%BD%91%E7%BB%9C%E4%B8%8E%E5%AE%89%E5%85%A8/SSH/SSH%20%E7%AB%AF%E5%8F%A3%E8%BD%AC%E5%8F%91/" class="post-title-link" itemprop="url">ssh 端口转发</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-08-05 22:15:00" itemprop="dateCreated datePublished" datetime="2024-08-05T22:15:00+08:00">2024-08-05</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%BD%91%E7%BB%9C%E4%B8%8E%E5%AE%89%E5%85%A8/" itemprop="url" rel="index"><span itemprop="name">网络与安全</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%BD%91%E7%BB%9C%E4%B8%8E%E5%AE%89%E5%85%A8/SSH/" itemprop="url" rel="index"><span itemprop="name">SSH</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>1.1k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>4 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>SSH 端口转发可以灵活的解决网络访问受限的问题</p>
<p>通常分为两种方式：</p>
<ul>
<li><strong>本地端口转发</strong> </li>
<li><strong>远程（反向）端口转发</strong></li>
</ul>
<hr>
<h2 id="本地端口转发"><a href="#本地端口转发" class="headerlink" title="本地端口转发"></a>本地端口转发</h2><p>SSH本地端口转发（Local Port Forwarding）是一种通过SSH隧道将本地计算机的某个端口转发到远程服务器的某个端口的技术。这样，访问本地端口的请求会通过SSH隧道传输到远程服务器，从而实现安全的通信。</p>
<h3 id="使用场景"><a href="#使用场景" class="headerlink" title="使用场景"></a>使用场景</h3><ul>
<li><strong>访问内网服务</strong>：通过SSH隧道访问公司内网或远程服务器上的服务，避免直接暴露服务端口。</li>
<li><strong>安全传输数据</strong>：将本地端口转发到远程服务器上的敏感服务，实现加密传输。</li>
<li><strong>绕过防火墙</strong>：通过SSH隧道绕过防火墙限制访问某些服务。</li>
</ul>
<h3 id="基本命令格式"><a href="#基本命令格式" class="headerlink" title="基本命令格式"></a>基本命令格式</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -L [本地端口]:[目标主机]:[目标端口] [用户名]@[SSH服务器]</span><br></pre></td></tr></table></figure>

<h3 id="配置示例"><a href="#配置示例" class="headerlink" title="配置示例"></a>配置示例</h3><h4 id="示例-1"><a href="#示例-1" class="headerlink" title="示例 1"></a>示例 1</h4><p>假设你有一台远程服务器remote_server_ip，上面运行了一个Web服务，监听在端口80。你希望通过SSH隧道，将本地计算机的端口8080转发到远程服务器的端口80，以便在本地浏览器中访问localhost:8080时能够访问远程服务器的Web服务。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -L 8080:localhost:80 user@remote_server_ip</span><br></pre></td></tr></table></figure>
<ul>
<li>-L 8080:localhost:80：指定本地端口8080转发到远程服务器的localhost:80。</li>
<li>user@remote_server_ip：SSH登录的用户名和远程服务器的IP地址。</li>
</ul>
<h5 id="访问方法"><a href="#访问方法" class="headerlink" title="访问方法"></a>访问方法</h5><p>在执行上述命令后，在本地浏览器中访问<a href="http://localhost:8080，这将通过SSH隧道转发到远程服务器的端口80。">http://localhost:8080，这将通过SSH隧道转发到远程服务器的端口80。</a></p>
<h4 id="示例-2"><a href="#示例-2" class="headerlink" title="示例 2"></a>示例 2</h4><p>又比如假设你想访问远程服务器上的MySQL服务，该服务只监听<strong>localhost</strong>。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -L 3306:localhost:3306 user@remote-ssh-server</span><br></pre></td></tr></table></figure>
<p>这会将本地计算机的3306端口上的所有连接通过remote-ssh-server，转发到其localhost的3306端口。</p>
<h5 id="访问方法-1"><a href="#访问方法-1" class="headerlink" title="访问方法"></a>访问方法</h5><p>使用Mysql客户端工具连127.0.0.1:3306</p>
<h4 id="转发到不同的远程主机"><a href="#转发到不同的远程主机" class="headerlink" title="转发到不同的远程主机"></a>转发到不同的远程主机</h4><p>如果需要转发到远程服务器能访问到的另一台主机（ssh服务器作为跳板），可以使用远程主机的IP或域名。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -L 8080:target_host:80 user@remote_server_ip</span><br></pre></td></tr></table></figure>

<ul>
<li>target_host：远程服务器可以访问的目标主机的IP或域名。</li>
</ul>
<hr>
<h2 id="远程端口转发"><a href="#远程端口转发" class="headerlink" title="远程端口转发"></a>远程端口转发</h2><p>远程端口转发（Remote Port Forwarding）是指在远程计算机上创建一个端口，并将其流量通过 SSH 隧道转发到本地计算机的指定目标。通常用于让外部网络访问本地服务。</p>
<h3 id="使用场景-1"><a href="#使用场景-1" class="headerlink" title="使用场景"></a>使用场景</h3><ul>
<li><strong>让外部访问内部服务</strong>：适合在远程服务器不能直接访问本地服务时，通过中间服务器进行访问。</li>
<li><strong>绕过防火墙限制</strong>：利用远程端口转发，通过中间服务器绕过防火墙访问内部服务。</li>
<li><strong>安全访问</strong>：让远程用户安全地访问公司内部网络中的资源。</li>
<li><strong>反向 SSH 隧道</strong>：将本地机器的端口暴露到远程服务器，方便远程访问本地服务。</li>
</ul>
<h3 id="基本命令格式-1"><a href="#基本命令格式-1" class="headerlink" title="基本命令格式"></a>基本命令格式</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh -R [远程端口]:[目标主机]:[目标端口] [用户名]@[SSH服务器]</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="配置示例-1"><a href="#配置示例-1" class="headerlink" title="配置示例"></a>配置示例</h3><p>假设你想让远程服务器（remote.example.com）通过其 8080 端口访问你本地机器上的一个运行在 localhost:3000 的服务，可以使用以下命令：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -R 8080:localhost:3000 user@remote.example.com</span><br></pre></td></tr></table></figure>
<ul>
<li>-R：用于指定反向隧道的选项。</li>
<li>8080：远程服务器上的端口号。</li>
<li>localhost:3000：本地机器上运行服务的地址和端口号。</li>
<li><a href="mailto:&#117;&#x73;&#101;&#x72;&#x40;&#114;&#101;&#109;&#x6f;&#116;&#101;&#x2e;&#x65;&#x78;&#97;&#x6d;&#x70;&#108;&#x65;&#x2e;&#99;&#111;&#x6d;">&#117;&#x73;&#101;&#x72;&#x40;&#114;&#101;&#109;&#x6f;&#116;&#101;&#x2e;&#x65;&#x78;&#97;&#x6d;&#x70;&#108;&#x65;&#x2e;&#99;&#111;&#x6d;</a>：远程服务器的 SSH 用户和地址。</li>
</ul>
<h4 id="访问方法-2"><a href="#访问方法-2" class="headerlink" title="访问方法"></a>访问方法</h4><p>在执行上述命令后，你可以在远程服务器上访问 <a target="_blank" rel="noopener" href="http://localhost:8080/">http://localhost:8080</a> 来访问本地机器上 localhost:3000 端口运行的服务。</p>
<hr>
<h3 id="更多"><a href="#更多" class="headerlink" title="更多"></a>更多</h3><h4 id="后台运行SSH隧道："><a href="#后台运行SSH隧道：" class="headerlink" title="后台运行SSH隧道："></a>后台运行SSH隧道：</h4><p>使用-f选项将隧道命令放入后台运行。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh -L 8080:localhost:80 -f user@remote_server_ip -N</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>-N：表示不执行远程命令，仅进行端口转发。</li>
<li>-f：表示后台运行SSH隧道。</li>
</ul>
<h4 id="保持隧道活跃："><a href="#保持隧道活跃：" class="headerlink" title="保持隧道活跃："></a>保持隧道活跃：</h4><p>如果需要保持隧道长时间活跃，可以使用 autossh 来自动重连，或者设置 SSH 的 ServerAliveInterval 和 ServerAliveCountMax 参数：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -R 8080:localhost:3000 user@remote.example.com -o ServerAliveInterval=60 -o ServerAliveCountMax=3</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://wangwen135.github.io/%E7%BD%91%E7%BB%9C%E4%B8%8E%E5%AE%89%E5%85%A8/SSH/%E9%80%9A%E8%BF%87ssh%E5%AE%9E%E7%8E%B0socks%E4%BB%A3%E7%90%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="王某某">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="王某某的笔记">
      <meta itemprop="description" content="这是一个使用 Hexo 构建的博客，用于分享我的编程经验和学习笔记。">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 王某某的笔记">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/%E7%BD%91%E7%BB%9C%E4%B8%8E%E5%AE%89%E5%85%A8/SSH/%E9%80%9A%E8%BF%87ssh%E5%AE%9E%E7%8E%B0socks%E4%BB%A3%E7%90%86/" class="post-title-link" itemprop="url">通过ssh实现socks代理</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-08-05 22:15:00" itemprop="dateCreated datePublished" datetime="2024-08-05T22:15:00+08:00">2024-08-05</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%BD%91%E7%BB%9C%E4%B8%8E%E5%AE%89%E5%85%A8/" itemprop="url" rel="index"><span itemprop="name">网络与安全</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%BD%91%E7%BB%9C%E4%B8%8E%E5%AE%89%E5%85%A8/SSH/" itemprop="url" rel="index"><span itemprop="name">SSH</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>592</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>2 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="通过SSH实现SOCKS代理"><a href="#通过SSH实现SOCKS代理" class="headerlink" title="通过SSH实现SOCKS代理"></a>通过SSH实现SOCKS代理</h2><p>它允许你通过SSH隧道加密你的网络流量，并通过SSH服务器转发</p>
<h3 id="用途"><a href="#用途" class="headerlink" title="用途"></a>用途</h3><h4 id="安全访问："><a href="#安全访问：" class="headerlink" title="安全访问："></a>安全访问：</h4><p>在不安全的网络环境中，使用SSH隧道可以加密流量并保护隐私。</p>
<h4 id="绕过地理限制："><a href="#绕过地理限制：" class="headerlink" title="绕过地理限制："></a>绕过地理限制：</h4><p>可以通过SSH隧道访问被地理位置限制的内容。</p>
<h4 id="测试和调试："><a href="#测试和调试：" class="headerlink" title="测试和调试："></a>测试和调试：</h4><p>开发和测试应用程序时，可以使用SOCKS代理来模拟不同的网络环境。</p>
<hr>
<p>设置SSH动态端口转发（SOCKS代理）的步骤如下：</p>
<h3 id="1-安装SSH客户端"><a href="#1-安装SSH客户端" class="headerlink" title="1. 安装SSH客户端"></a>1. 安装SSH客户端</h3><p>确保你的计算机上安装了SSH客户端。大多数Unix-like系统（如Linux和macOS）都预装了SSH客户端。在Windows上，你可以使用PuTTY或者安装Windows的Linux子系统。</p>
<blockquote>
<p>这里用Git Bash 实现</p>
</blockquote>
<h3 id="2-连接到SSH服务器"><a href="#2-连接到SSH服务器" class="headerlink" title="2. 连接到SSH服务器"></a>2. 连接到SSH服务器</h3><p>使用以下命令连接到你的SSH服务器，并通过SSH建立SOCKS代理：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh -D 本地端口 用户名@ssh服务器地址</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>这里的本地端口是你希望在本地机器上监听的端口，用于SOCKS代理。用户名和ssh服务器地址是你在SSH服务器上的登录凭证。</p>
<p>如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ssh -D 8080 user@ssh.example.com</span><br><span class="line"></span><br><span class="line">ssh -D 8080 -N -f user@remote_server_ip</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>这个命令会在本地机器上开启一个监听在8080端口的SOCKS代理。</p>
<p>参数说明：</p>
<ul>
<li>-D 8080：指定本地端口8080作为SOCKS代理端口。</li>
<li>-N：不执行远程命令，只进行端口转发。</li>
<li>-f：后台运行SSH会话。</li>
</ul>
<h3 id="3-配置你的应用程序或浏览器"><a href="#3-配置你的应用程序或浏览器" class="headerlink" title="3. 配置你的应用程序或浏览器"></a>3. 配置你的应用程序或浏览器</h3><p>一旦SSH隧道建立，你需要配置你的应用程序或浏览器使用这个SOCKS代理。</p>
<h4 id="对于浏览器："><a href="#对于浏览器：" class="headerlink" title="对于浏览器："></a>对于浏览器：</h4><ul>
<li>在Chrome或Firefox中，你可以安装一个代理扩展，如”Proxy SwitchyOmega”，并设置SOCKS5代理为localhost，端口为8080。</li>
<li>在其他浏览器中，通常在设置中找到网络或代理设置，并手动配置SOCKS代理。</li>
</ul>
<h4 id="对于其他应用程序："><a href="#对于其他应用程序：" class="headerlink" title="对于其他应用程序："></a>对于其他应用程序：</h4><p>查找应用程序的网络设置或代理设置，并配置SOCKS5代理为localhost，端口为8080。</p>
<h3 id="4-测试连接"><a href="#4-测试连接" class="headerlink" title="4. 测试连接"></a>4. 测试连接</h3><p>现在，当你通过配置了SOCKS代理的应用程序或浏览器访问网络时，所有的流量都应该通过SSH隧道加密并转发。</p>
<p>如打开你的浏览器访问目标地址</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://wangwen135.github.io/%E5%8D%9A%E5%AE%A2/Hexo/%E4%BD%BF%E7%94%A8python%E8%84%9A%E6%9C%AC%E4%B8%BAmarkdown%E7%AC%94%E8%AE%B0%E6%89%B9%E9%87%8F%E7%94%9F%E6%88%90yaml%E5%A4%B4%E9%83%A8%E4%BF%A1%E6%81%AF/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="王某某">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="王某某的笔记">
      <meta itemprop="description" content="这是一个使用 Hexo 构建的博客，用于分享我的编程经验和学习笔记。">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 王某某的笔记">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/%E5%8D%9A%E5%AE%A2/Hexo/%E4%BD%BF%E7%94%A8python%E8%84%9A%E6%9C%AC%E4%B8%BAmarkdown%E7%AC%94%E8%AE%B0%E6%89%B9%E9%87%8F%E7%94%9F%E6%88%90yaml%E5%A4%B4%E9%83%A8%E4%BF%A1%E6%81%AF/" class="post-title-link" itemprop="url">使用python脚本为markdown笔记批量生成yaml头部信息</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-07-25 23:11:00" itemprop="dateCreated datePublished" datetime="2024-07-25T23:11:00+08:00">2024-07-25</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%8D%9A%E5%AE%A2/" itemprop="url" rel="index"><span itemprop="name">博客</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%8D%9A%E5%AE%A2/Hexo/" itemprop="url" rel="index"><span itemprop="name">Hexo</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>464</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>2 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>为了快速的将其他地方Markdown笔记导入到Hexo中，使用Python脚本为Markdown笔记批量生成YAML头部信息</p>
<h3 id="整理笔记目录"><a href="#整理笔记目录" class="headerlink" title="整理笔记目录"></a>整理笔记目录</h3><p>比如已经规划好了目录，如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">├─开发</span><br><span class="line">│  ├─java</span><br><span class="line">│  │      Java入门.md</span><br><span class="line">│  │      Java数据结构.md </span><br><span class="line">│  │      xxxx.md</span><br><span class="line">│  │</span><br><span class="line">│  ├─Spring</span><br><span class="line">│  │      Spring MVC.md</span><br><span class="line">│  │      Spring AOP.md</span><br><span class="line">│  │      Spring Data.md</span><br><span class="line">│  │</span><br><span class="line">│  └─网络</span><br><span class="line">│          协议.md</span><br><span class="line">│          网络通信.md</span><br></pre></td></tr></table></figure>

<h3 id="生成YAML头部信息要求"><a href="#生成YAML头部信息要求" class="headerlink" title="生成YAML头部信息要求"></a>生成YAML头部信息要求</h3><p>目标是为将目录和下级目录中全部的Markdown文件自动生成YAML头部信息，如在文件：<br><strong>.\博客\Hexo\Hexo安装使用.md</strong><br>的头部添加：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">title: Hexo安装使用</span><br><span class="line">date: 2024-07-24 23:31</span><br><span class="line">tags: </span><br><span class="line">  - Hexo</span><br><span class="line">categories:</span><br><span class="line">  - [博客, Hexo]</span><br><span class="line">---</span><br></pre></td></tr></table></figure>

<p>要求：</p>
<ul>
<li>title：为文件名称，不要后缀</li>
<li>date：随机时间（小于当前时间）</li>
<li>tags: 为最近一级的目录名称</li>
<li>categories：为多级目录名称</li>
</ul>
<hr>
<h3 id="Python脚本"><a href="#Python脚本" class="headerlink" title="Python脚本"></a>Python脚本</h3><p>创建Python脚本文件：<strong>add_front_matter.py</strong><br>内容如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">import os</span><br><span class="line">import random</span><br><span class="line">import datetime</span><br><span class="line"></span><br><span class="line">def get_random_date():</span><br><span class="line">    now = datetime.datetime.now()</span><br><span class="line">    random_days = random.randint(1, 365 * 5)  # 过去五年中的随机天数</span><br><span class="line">    random_date = now - datetime.timedelta(days=random_days)</span><br><span class="line">    return random_date.strftime(&#x27;%Y-%m-%d %H:%M&#x27;)</span><br><span class="line"></span><br><span class="line">def add_front_matter(directory):</span><br><span class="line">    for root, _, files in os.walk(directory):</span><br><span class="line">        print(f&quot;Scanning directory: &#123;root&#125;&quot;)</span><br><span class="line">        for file in files:</span><br><span class="line">            if file.endswith(&#x27;.md&#x27;):</span><br><span class="line">                file_path = os.path.join(root, file)</span><br><span class="line">                print(f&quot;Found markdown file: &#123;file_path&#125;&quot;)</span><br><span class="line"></span><br><span class="line">                try:</span><br><span class="line">                    with open(file_path, &#x27;r&#x27;, encoding=&#x27;utf-8&#x27;) as f:</span><br><span class="line">                        content = f.read()</span><br><span class="line">                    </span><br><span class="line">                    title = os.path.splitext(file)[0]</span><br><span class="line">                    date = get_random_date()</span><br><span class="line">                    tags = os.path.basename(root)</span><br><span class="line">                    categories = os.path.relpath(root, directory).split(os.sep)</span><br><span class="line"></span><br><span class="line">                    front_matter = f&#x27;&#x27;&#x27;---</span><br><span class="line">title: &#123;title&#125;</span><br><span class="line">date: &#123;date&#125;</span><br><span class="line">tags: </span><br><span class="line">  - &#123;tags&#125;</span><br><span class="line">categories:</span><br><span class="line">  - [&#123;&#x27;, &#x27;.join(categories)&#125;]</span><br><span class="line">---</span><br><span class="line"></span><br><span class="line">&#x27;&#x27;&#x27;</span><br><span class="line"></span><br><span class="line">                    new_content = front_matter + content</span><br><span class="line">                    with open(file_path, &#x27;w&#x27;, encoding=&#x27;utf-8&#x27;) as f:</span><br><span class="line">                        f.write(new_content)</span><br><span class="line"></span><br><span class="line">                    print(f&quot;Updated: &#123;file_path&#125;&quot;)</span><br><span class="line">                except Exception as e:</span><br><span class="line">                    print(f&quot;Error updating &#123;file_path&#125;: &#123;e&#125;&quot;)</span><br><span class="line"></span><br><span class="line">if __name__ == &quot;__main__&quot;:</span><br><span class="line">    directory = r&quot;D:\develop\blog\hexo-blog\source\_posts&quot;  # 替换为你的Markdown文件所在目录</span><br><span class="line">    print(f&quot;Starting to update markdown files in: &#123;directory&#125;&quot;)</span><br><span class="line">    add_front_matter(directory)</span><br><span class="line">    print(&quot;Finished updating markdown files.&quot;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="执行脚本更新文件"><a href="#执行脚本更新文件" class="headerlink" title="执行脚本更新文件"></a>执行脚本更新文件</h3><p><strong>注意：将上面脚本中的Markdown文件所在目录替换为你的整理后的笔记目录</strong></p>
<p>打开终端或命令提示符，导航到脚本所在目录，运行脚本：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python add_front_matter.py</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>问题： 时间不好处理，需要自己修改</p>
</blockquote>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/17/">17</a><a class="extend next" rel="next" title="下一页" aria-label="下一页" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2024</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">王某某</span>
  </div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
    <span title="站点总字数">150k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">9:07</span>
  </span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/pisces/" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script><script src="/js/bookmark.js"></script>

  






  





</body>
</html>
